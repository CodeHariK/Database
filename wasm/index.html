<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>Go wasm</title>
</head>

<body>
    <p id="result"></p>

    <button onClick="run();" id="runButton">Run</button>
    <button onClick="set();" id="setButton">Run</button>

    <script src="wasm_exec.js"></script>
    <script>

        let WASM = "wasm/secretary.wasm"

        const go = new Go();
        let mod, inst;
        WebAssembly.instantiateStreaming(fetch(WASM), go.importObject).then(async (result) => {
            mod = result.module;
            inst = result.instance;

            await go.run(inst); // Start Go runtime
        }).catch((err) => {
            console.error(err);
        });

        async function run() {
            if (!inst) {
                console.error("WebAssembly instance not loaded yet!");
                return;
            }

            if (typeof window.lib.add === "function") {
                document.getElementById("result").innerText = "Result: " + window.lib.add(10, 20);
            } else {
                console.error("window.lib.add is undefined!");
            }
        }

        async function set() {
            if (!inst) {
                console.error("WebAssembly instance not loaded yet!");
                return;
            }

            if (typeof window.lib.set === "function") {
                document.getElementById("result").innerText = "Result: " + window.lib.set("hello");
            } else {
                console.error("window.lib.set is undefined!");
            }
        }

    </script>

</body>

</html>