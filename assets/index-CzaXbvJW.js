var mu=Object.defineProperty;var yu=(t,e,n)=>e in t?mu(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var _t=(t,e,n)=>yu(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const{round:bu,floor:xu,PI:Yo}=Math,wu={linear:function(t,e,n){var r=t[1]-t[0],i=e[1]-e[0];return(n-t[0])/r*i+e[0]||0}},Qt=function(t){return t%360+(t<0?360:0)},je=function(t,e){return e*bu(t/e)},Nr=function(t){return 180*t/Yo%360},$t=function(t,e){return e=e||!1,t=e?t:t%360,t*Yo/180},yi=function(t,e){if(e===void 0)e=t===void 0?1:t,t=0;else if(e<t){const n=t;t=e,e=n}return xu(Math.random()*(e-t+1)+t)},{cos:Zn,sin:Jr,atan2:Su}=Math,Xo=function(t,e){var n=$t(t.y),r=$t(e.y),i=t.x,s=e.x,o=$t(s-i),a=Jr(o)*Zn(r),c=Zn(n)*Jr(r)-Jr(n)*Zn(r)*Zn(o),l=Nr(Su(a,c)),f=["NE","E","SE","S","SW","W","NW","N"],u=l-22.5;return u<0&&(u+=360),u=parseInt(u/45),f[u]},Fi=function(t,e){var n=t.x,r=t.y,i=e.x,s=e.y;return(n-=i)*n+(r-=s)*r},Zo=function(t,e){return Math.sqrt(Fi(t,e))},lt={Point:1,Line:2,Ellipse:3,Rect:4,Polyline:5,Polygon:6,Curve:7,Path:8},{abs:Sr,cos:bi,sin:xi,sqrt:Ls,min:Ms,max:Os,atan2:Au,round:Ns,pow:Tu,PI:Is}=Math,E=function(t,e){if(!(this instanceof E))return new E(t,e);if(typeof t=="string"){var n=t.split(t.indexOf("@")===-1?" ":"@");t=parseFloat(n[0]),e=parseFloat(n[1])}else Object(t)===t&&(e=t.y,t=t.x);this.x=t===void 0?0:t,this.y=e===void 0?0:e};E.fromPolar=function(t,e,n){n=new E(n);var r=Sr(t*bi(e)),i=Sr(t*xi(e)),s=Qt(Nr(e));return s<90?i=-i:s<180?(r=-r,i=-i):s<270&&(r=-r),new E(n.x+r,n.y+i)};E.random=function(t,e,n,r){return new E(yi(t,e),yi(n,r))};E.prototype={type:lt.Point,chooseClosest:function(t){var e=t.length;if(e===1)return new E(t[0]);for(var n=null,r=1/0,i=0;i<e;i++){var s=new E(t[i]),o=this.squaredDistance(s);o<r&&(n=s,r=o)}return n},adhereToRect:function(t){return t.containsPoint(this)?this:(this.x=Ms(Os(this.x,t.x),t.x+t.width),this.y=Ms(Os(this.y,t.y),t.y+t.height),this)},angleBetween:function(t,e){var n=this.equals(t)||this.equals(e)?NaN:this.theta(e)-this.theta(t);return n<0&&(n+=360),n},bearing:function(t){return Xo(this,t)},changeInAngle:function(t,e,n){return this.clone().offset(-t,-e).theta(n)-this.theta(n)},clone:function(){return new E(this)},cross:function(t,e){return t&&e?(e.x-this.x)*(t.y-this.y)-(e.y-this.y)*(t.x-this.x):NaN},difference:function(t,e){return Object(t)===t&&(e=t.y,t=t.x),new E(this.x-(t||0),this.y-(e||0))},distance:function(t){return Zo(this,t)},dot:function(t){return t?this.x*t.x+this.y*t.y:NaN},equals:function(t){return!!t&&this.x===t.x&&this.y===t.y},lerp:function(t,e){var n=this.x,r=this.y;return new E((1-e)*n+e*t.x,(1-e)*r+e*t.y)},magnitude:function(){return Ls(this.x*this.x+this.y*this.y)||.01},manhattanDistance:function(t){return Sr(t.x-this.x)+Sr(t.y-this.y)},move:function(t,e){var n=$t(new E(t).theta(this)),r=this.offset(bi(n)*e,-xi(n)*e);return r},normalize:function(t){var e=(t||1)/this.magnitude();return this.scale(e,e)},offset:function(t,e){return Object(t)===t&&(e=t.y,t=t.x),this.x+=t||0,this.y+=e||0,this},reflection:function(t){return new E(t).move(this,this.distance(t))},rotate:function(t,e){if(e===0)return this;t=t||new E(0,0),e=$t(Qt(-e));var n=bi(e),r=xi(e),i=n*(this.x-t.x)-r*(this.y-t.y)+t.x,s=r*(this.x-t.x)+n*(this.y-t.y)+t.y;return this.x=i,this.y=s,this},round:function(t){let e=1;if(t)switch(t){case 1:e=10;break;case 2:e=100;break;case 3:e=1e3;break;default:e=Tu(10,t);break}return this.x=Ns(this.x*e)/e,this.y=Ns(this.y*e)/e,this},scale:function(t,e,n){return n=n&&new E(n)||new E(0,0),this.x=n.x+t*(this.x-n.x),this.y=n.y+e*(this.y-n.y),this},snapToGrid:function(t,e){return this.x=je(this.x,t),this.y=je(this.y,e||t),this},squaredDistance:function(t){return Fi(this,t)},theta:function(t){t=new E(t);var e=-(t.y-this.y),n=t.x-this.x,r=Au(e,n);return r<0&&(r=2*Is+r),180*r/Is},toJSON:function(){return{x:this.x,y:this.y}},toPolar:function(t){t=t&&new E(t)||new E(0,0);var e=this.x,n=this.y;return this.x=Ls((e-t.x)*(e-t.x)+(n-t.y)*(n-t.y)),this.y=$t(t.theta(new E(e,n))),this},toString:function(){return this.x+"@"+this.y},serialize:function(){return this.x+","+this.y},update:function(t,e){return Object(t)===t&&(e=t.y,t=t.x),this.x=t||0,this.y=e||0,this},vectorAngle:function(t){var e=new E(0,0);return e.angleBetween(this,t)}};E.prototype.translate=E.prototype.offset;const Ar=E,{max:Kr,min:Qr}=Math,X=function(t,e){if(!(this instanceof X))return new X(t,e);if(t instanceof X)return new X(t.start,t.end);this.start=new E(t),this.end=new E(e)};X.prototype={type:lt.Line,angle:function(){var t=new E(this.start.x+1,this.start.y);return this.start.angleBetween(this.end,t)},bbox:function(){var t=Qr(this.start.x,this.end.x),e=Qr(this.start.y,this.end.y),n=Kr(this.start.x,this.end.x),r=Kr(this.start.y,this.end.y);return new Y(t,e,n-t,r-e)},bearing:function(){return Xo(this.start,this.end)},clone:function(){return new X(this.start,this.end)},closestPoint:function(t){return this.pointAt(this.closestPointNormalizedLength(t))},closestPointLength:function(t){return this.closestPointNormalizedLength(t)*this.length()},closestPointNormalizedLength:function(t){var e=this.vector().dot(new X(this.start,t).vector()),n=Qr(1,Kr(0,e/this.squaredLength()));return n!==n?0:n},closestPointTangent:function(t){return this.tangentAt(this.closestPointNormalizedLength(t))},containsPoint:function(t){var e=this.start,n=this.end;if(e.cross(t,n)!==0)return!1;var r=this.length();return!(new X(e,t).length()>r||new X(t,n).length()>r)},divideAt:function(t){var e=this.pointAt(t);return[new X(this.start,e),new X(e,this.end)]},divideAtLength:function(t){var e=this.pointAtLength(t);return[new X(this.start,e),new X(e,this.end)]},equals:function(t){return!!t&&this.start.x===t.start.x&&this.start.y===t.start.y&&this.end.x===t.end.x&&this.end.y===t.end.y},intersect:function(t,e){if(t&&t.intersectionWithLine){var n=t.intersectionWithLine(this,e);return n&&t instanceof X&&(n=n[0]),n}return null},intersectionWithLine:function(t){var e=new E(this.end.x-this.start.x,this.end.y-this.start.y),n=new E(t.end.x-t.start.x,t.end.y-t.start.y),r=e.x*n.y-e.y*n.x,i=new E(t.start.x-this.start.x,t.start.y-this.start.y),s=i.x*n.y-i.y*n.x,o=i.x*e.y-i.y*e.x;if(r===0||s*r<0||o*r<0)return null;if(r>0){if(s>r||o>r)return null}else if(s<r||o<r)return null;return[new E(this.start.x+s*e.x/r,this.start.y+s*e.y/r)]},isDifferentiable:function(){return!this.start.equals(this.end)},length:function(){return Zo(this.start,this.end)},midpoint:function(){return new E((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)},parallel:function(t){const e=this.clone();if(!this.isDifferentiable())return e;const{start:n,end:r}=e,i=n.clone().rotate(r,270),s=r.clone().rotate(n,90);return n.move(s,t),r.move(i,t),e},pointAt:function(t){var e=this.start,n=this.end;return t<=0?e.clone():t>=1?n.clone():e.lerp(n,t)},pointAtLength:function(t){var e=this.start,n=this.end,r=!0;t<0&&(r=!1,t=-t);var i=this.length();return t>=i?r?n.clone():e.clone():this.pointAt((r?t:i-t)/i)},pointOffset:function(t){t=new E(t);var e=this.start,n=this.end,r=(n.x-e.x)*(t.y-e.y)-(n.y-e.y)*(t.x-e.x);return r/this.length()},rotate:function(t,e){return this.start.rotate(t,e),this.end.rotate(t,e),this},round:function(t){return this.start.round(t),this.end.round(t),this},scale:function(t,e,n){return this.start.scale(t,e,n),this.end.scale(t,e,n),this},setLength:function(t){var e=this.length();if(!e)return this;var n=t/e;return this.scale(n,n,this.start)},squaredLength:function(){return Fi(this.start,this.end)},tangentAt:function(t){if(!this.isDifferentiable())return null;var e=this.start,n=this.end,r=this.pointAt(t),i=new X(e,n);return i.translate(r.x-e.x,r.y-e.y),i},tangentAtLength:function(t){if(!this.isDifferentiable())return null;var e=this.start,n=this.end,r=this.pointAtLength(t),i=new X(e,n);return i.translate(r.x-e.x,r.y-e.y),i},toString:function(){return this.start.toString()+" "+this.end.toString()},serialize:function(){return this.start.serialize()+" "+this.end.serialize()},translate:function(t,e){return this.start.translate(t,e),this.end.translate(t,e),this},vector:function(){return new E(this.end.x-this.start.x,this.end.y-this.start.y)}};X.prototype.intersection=X.prototype.intersect;const qe=X,{sqrt:Rs,round:Jn,pow:Eu}=Math,Vt=function(t,e,n){if(!(this instanceof Vt))return new Vt(t,e,n);if(t instanceof Vt)return new Vt(new E(t.x,t.y),t.a,t.b);t=new E(t),this.x=t.x,this.y=t.y,this.a=e,this.b=n};Vt.fromRect=function(t){return t=new Y(t),new Vt(t.center(),t.width/2,t.height/2)};Vt.prototype={type:lt.Ellipse,bbox:function(){return new Y(this.x-this.a,this.y-this.b,2*this.a,2*this.b)},center:function(){return new E(this.x,this.y)},clone:function(){return new Vt(this)},containsPoint:function(t){return this.normalizedDistance(t)<=1},equals:function(t){return!!t&&t.x===this.x&&t.y===this.y&&t.a===this.a&&t.b===this.b},inflate:function(t,e){return t===void 0&&(t=0),e===void 0&&(e=t),this.a+=2*t,this.b+=2*e,this},intersectionWithLine:function(t){var e=[],n=t.start,r=t.end,i=this.a,s=this.b,o=t.vector(),a=n.difference(new E(this)),c=new E(o.x/(i*i),o.y/(s*s)),l=new E(a.x/(i*i),a.y/(s*s)),f=o.dot(c),u=o.dot(l),d=a.dot(l)-1,g=u*u-f*d;if(g<0)return null;if(g>0){var v=Rs(g),y=(-u-v)/f,x=(-u+v)/f;if((y<0||1<y)&&(x<0||1<x))return null;0<=y&&y<=1&&e.push(n.lerp(r,y)),0<=x&&x<=1&&e.push(n.lerp(r,x))}else{var w=-u/f;if(0<=w&&w<=1)e.push(n.lerp(r,w));else return null}return e},intersectionWithLineFromCenterToPoint:function(t,e){t=new E(t),e&&t.rotate(new E(this.x,this.y),e);var n=t.x-this.x,r=t.y-this.y,i;if(n===0)return i=this.bbox().pointNearestToPoint(t),e?i.rotate(new E(this.x,this.y),-e):i;var s=r/n,o=s*s,a=this.a*this.a,c=this.b*this.b,l=Rs(1/(1/a+o/c));l=n<0?-l:l;var f=s*l;return i=new E(this.x+l,this.y+f),e?i.rotate(new E(this.x,this.y),-e):i},normalizedDistance:function(t){var e=t.x,n=t.y,r=this.a,i=this.b,s=this.x,o=this.y;return(e-s)*(e-s)/(r*r)+(n-o)*(n-o)/(i*i)},round:function(t){let e=1;if(t)switch(t){case 1:e=10;break;case 2:e=100;break;case 3:e=1e3;break;default:e=Eu(10,t);break}return this.x=Jn(this.x*e)/e,this.y=Jn(this.y*e)/e,this.a=Jn(this.a*e)/e,this.b=Jn(this.b*e)/e,this},tangentTheta:function(t){var e=30,n=t.x,r=t.y,i=this.a,s=this.b,o=this.bbox().center(),a=o.x,c=o.y,l=n>o.x+i/2,f=n<o.x-i/2,u,d;return l||f?(u=n>o.x?r-e:r+e,d=i*i/(n-a)-i*i*(r-c)*(u-c)/(s*s*(n-a))+a):(d=r>o.y?n+e:n-e,u=s*s/(r-c)-s*s*(n-a)*(d-a)/(i*i*(r-c))+c),new E(d,u).theta(t)},toString:function(){return new E(this.x,this.y).toString()+" "+this.a+" "+this.b}};const Pu=Vt,{abs:ks,cos:Cu,sin:_u,min:wn,max:Ds,round:Kn,pow:Lu}=Math,Y=function(t,e,n,r){if(!(this instanceof Y))return new Y(t,e,n,r);Object(t)===t&&(e=t.y,n=t.width,r=t.height,t=t.x),this.x=t===void 0?0:t,this.y=e===void 0?0:e,this.width=n===void 0?0:n,this.height=r===void 0?0:r};Y.fromEllipse=function(t){return t=new Vt(t),new Y(t.x-t.a,t.y-t.b,2*t.a,2*t.b)};Y.fromPointUnion=function(...t){if(t.length===0)return null;const e=new E;let n,r,i,s;n=r=1/0,i=s=-1/0;for(let o=0;o<t.length;o++){e.update(t[o]);const a=e.x,c=e.y;a<n&&(n=a),a>i&&(i=a),c<r&&(r=c),c>s&&(s=c)}return new Y(n,r,i-n,s-r)};Y.fromRectUnion=function(...t){if(t.length===0)return null;const e=new Y;let n,r,i,s;n=r=1/0,i=s=-1/0;for(let o=0;o<t.length;o++){e.update(t[o]);const a=e.x,c=e.y,l=a+e.width,f=c+e.height;a<n&&(n=a),l>i&&(i=l),c<r&&(r=c),f>s&&(s=f)}return new Y(n,r,i-n,s-r)};Y.prototype={type:lt.Rect,bbox:function(t){return this.clone().rotateAroundCenter(t)},rotateAroundCenter:function(t){if(!t)return this;const{width:e,height:n}=this,r=$t(t),i=ks(_u(r)),s=ks(Cu(r)),o=e*s+n*i,a=e*i+n*s;return this.x+=(e-o)/2,this.y+=(n-a)/2,this.width=o,this.height=a,this},bottomLeft:function(){return new E(this.x,this.y+this.height)},bottomLine:function(){return new X(this.bottomLeft(),this.bottomRight())},bottomMiddle:function(){return new E(this.x+this.width/2,this.y+this.height)},center:function(){return new E(this.x+this.width/2,this.y+this.height/2)},clone:function(){return new Y(this)},containsPoint:function(t,e){let n,r;return!t||typeof t=="string"?{x:n,y:r}=new E(t):{x:n=0,y:r=0}=t,e&&e.strict?n>this.x&&n<this.x+this.width&&r>this.y&&r<this.y+this.height:n>=this.x&&n<=this.x+this.width&&r>=this.y&&r<=this.y+this.height},containsRect:function(t){var e=new Y(this).normalize(),n=new Y(t).normalize(),r=e.width,i=e.height,s=n.width,o=n.height;if(!r||!i||!s||!o)return!1;var a=e.x,c=e.y,l=n.x,f=n.y;return s+=l,r+=a,o+=f,i+=c,a<=l&&s<=r&&c<=f&&o<=i},corner:function(){return new E(this.x+this.width,this.y+this.height)},equals:function(t){var e=new Y(this).normalize(),n=new Y(t).normalize();return e.x===n.x&&e.y===n.y&&e.width===n.width&&e.height===n.height},inflate:function(t,e){return t===void 0&&(t=0),e===void 0&&(e=t),this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this},intersect:function(t){var e=this.origin(),n=this.corner(),r=t.origin(),i=t.corner();if(i.x<=e.x||i.y<=e.y||r.x>=n.x||r.y>=n.y)return null;var s=Ds(e.x,r.x),o=Ds(e.y,r.y);return new Y(s,o,wn(n.x,i.x)-s,wn(n.y,i.y)-o)},intersectionWithLine:function(t){var e=this,n=[e.topLine(),e.rightLine(),e.bottomLine(),e.leftLine()],r=[],i=[],s,o,a=n.length;for(o=0;o<a;o++)s=t.intersect(n[o]),s!==null&&i.indexOf(s.toString())<0&&(r.push(s),i.push(s.toString()));return r.length>0?r:null},intersectionWithLineFromCenterToPoint:function(t,e){t=new E(t);var n=new E(this.x+this.width/2,this.y+this.height/2),r;e&&t.rotate(n,e);for(var i=[this.topLine(),this.rightLine(),this.bottomLine(),this.leftLine()],s=new X(n,t),o=i.length-1;o>=0;--o){var a=i[o].intersection(s);if(a!==null){r=a;break}}return r&&e&&r.rotate(n,-e),r},leftLine:function(){return new X(this.topLeft(),this.bottomLeft())},leftMiddle:function(){return new E(this.x,this.y+this.height/2)},maxRectScaleToFit:function(t,e){t=new Y(t),e||(e=t.center());var n,r,i,s,o,a,c,l,f=e.x,u=e.y;n=r=i=s=o=a=c=l=1/0;var d=t.topLeft();d.x<f&&(n=(this.x-f)/(d.x-f)),d.y<u&&(o=(this.y-u)/(d.y-u));var g=t.bottomRight();g.x>f&&(r=(this.x+this.width-f)/(g.x-f)),g.y>u&&(a=(this.y+this.height-u)/(g.y-u));var v=t.topRight();v.x>f&&(i=(this.x+this.width-f)/(v.x-f)),v.y<u&&(c=(this.y-u)/(v.y-u));var y=t.bottomLeft();return y.x<f&&(s=(this.x-f)/(y.x-f)),y.y>u&&(l=(this.y+this.height-u)/(y.y-u)),{sx:wn(n,r,i,s),sy:wn(o,a,c,l)}},maxRectUniformScaleToFit:function(t,e){var n=this.maxRectScaleToFit(t,e);return wn(n.sx,n.sy)},moveAndExpand:function(t){return this.x+=t.x||0,this.y+=t.y||0,this.width+=t.width||0,this.height+=t.height||0,this},normalize:function(){var t=this.x,e=this.y,n=this.width,r=this.height;return this.width<0&&(t=this.x+this.width,n=-this.width),this.height<0&&(e=this.y+this.height,r=-this.height),this.x=t,this.y=e,this.width=n,this.height=r,this},offset:function(t,e){return E.prototype.offset.call(this,t,e)},origin:function(){return new E(this.x,this.y)},pointNearestToPoint:function(t){if(t=new E(t),this.containsPoint(t)){var e=this.sideNearestToPoint(t);switch(e){case"right":return new E(this.x+this.width,t.y);case"left":return new E(this.x,t.y);case"bottom":return new E(t.x,this.y+this.height);case"top":return new E(t.x,this.y)}}return t.adhereToRect(this)},rightLine:function(){return new X(this.topRight(),this.bottomRight())},rightMiddle:function(){return new E(this.x+this.width,this.y+this.height/2)},round:function(t){let e=1;if(t)switch(t){case 1:e=10;break;case 2:e=100;break;case 3:e=1e3;break;default:e=Lu(10,t);break}return this.x=Kn(this.x*e)/e,this.y=Kn(this.y*e)/e,this.width=Kn(this.width*e)/e,this.height=Kn(this.height*e)/e,this},scale:function(t,e,n){return n=this.origin().scale(t,e,n),this.x=n.x,this.y=n.y,this.width*=t,this.height*=e,this},sideNearestToPoint:function(t){t=new E(t);var e=t.x-this.x,n=this.x+this.width-t.x,r=t.y-this.y,i=this.y+this.height-t.y,s=e,o="left";return n<s&&(s=n,o="right"),r<s&&(s=r,o="top"),i<s&&(o="bottom"),o},snapToGrid:function(t,e){var n=this.origin().snapToGrid(t,e),r=this.corner().snapToGrid(t,e);return this.x=n.x,this.y=n.y,this.width=r.x-n.x,this.height=r.y-n.y,this},toJSON:function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},topLine:function(){return new X(this.topLeft(),this.topRight())},topMiddle:function(){return new E(this.x+this.width/2,this.y)},topRight:function(){return new E(this.x+this.width,this.y)},toString:function(){return this.origin().toString()+" "+this.corner().toString()},union:function(t){return Y.fromRectUnion(this,t)},update:function(t,e,n,r){return Object(t)===t&&(e=t.y,n=t.width,r=t.height,t=t.x),this.x=t||0,this.y=e||0,this.width=n||0,this.height=r||0,this}};Y.prototype.bottomRight=Y.prototype.corner;Y.prototype.topLeft=Y.prototype.origin;Y.prototype.translate=Y.prototype.offset;const Mu=Y;function Jo(t){const e=t.trim();if(e==="")return[];const n=[],r=e.split(/\b\s*,\s*|,\s*|\s+/),i=r.length;for(let s=0;s<i;s+=2)n.push({x:+r[s],y:+r[s+1]});return n}function Ko(t){const e=t.length;if(e===0)return[];const n=[];for(let r=0;r<e;r++){const i=t[r].clone();n.push(i)}return n}function Qo(t){const{abs:e}=Math;var n,r,i=t.length;if(i===0)return[];var s;for(n=0;n<i;n++)(s===void 0||t[n].y<s.y||t[n].y===s.y&&t[n].x>s.x)&&(s=t[n]);var o=[];for(n=0;n<i;n++){var a=s.theta(t[n]);a===0&&(a=360);var c=[t[n],n,a];o.push(c)}if(o.sort(function(N,F){var q=N[2]-F[2];return q===0&&(q=F[1]-N[1]),q}),o.length>2){var l=o[o.length-1];o.unshift(l)}for(var f={},u=[],d,g,v,y,x,w;o.length!==0;)if(d=o.pop(),g=d[0],!f.hasOwnProperty(d[0]+"@@"+d[1]))for(var T=!1;!T;)if(u.length<2)u.push(d),T=!0;else{v=u.pop(),y=v[0],x=u.pop(),w=x[0];var P=w.cross(y,g);if(P<0)u.push(x),u.push(v),u.push(d),T=!0;else if(P===0){var M=1e-10,I=y.angleBetween(w,g);e(I-180)<M||y.equals(g)||w.equals(y)?(f[v[0]+"@@"+v[1]]=y,u.push(x)):e((I+1)%360-1)<M&&(u.push(x),o.push(v))}else f[v[0]+"@@"+v[1]]=y,u.push(x)}u.length>2&&u.pop();var D,h=-1;for(r=u.length,n=0;n<r;n++){var p=u[n][1];(D===void 0||p<D)&&(D=p,h=n)}var m=[];if(h>0){var b=u.slice(h),S=u.slice(0,h);m=b.concat(S)}else m=u;var O=[];for(r=m.length,n=0;n<r;n++)O.push(m[n][0]);return O}const St=function(t){if(!(this instanceof St))return new St(t);if(typeof t=="string")return new St.parse(t);this.points=Array.isArray(t)?t.map(E):[]};St.parse=function(t){return new St(Jo(t))};St.fromRect=function(t){return new St([t.topLeft(),t.topRight(),t.bottomRight(),t.bottomLeft(),t.topLeft()])};St.prototype={type:lt.Polyline,bbox:function(){var t=1/0,e=-1/0,n=1/0,r=-1/0,i=this.points,s=i.length;if(s===0)return null;for(var o=0;o<s;o++){var a=i[o],c=a.x,l=a.y;c<t&&(t=c),c>e&&(e=c),l<n&&(n=l),l>r&&(r=l)}return new Y(t,n,e-t,r-n)},clone:function(){return new St(Ko(this.points))},closestPoint:function(t){var e=this.closestPointLength(t);return this.pointAtLength(e)},closestPointLength:function(t){var e=this.lengthPoints(),n=e.length;if(n===0||n===1)return 0;for(var r,i=1/0,s=0,o=n-1,a=0;a<o;a++){var c=new X(e[a],e[a+1]),l=c.length(),f=c.closestPointNormalizedLength(t),u=c.pointAt(f),d=u.squaredDistance(t);d<i&&(i=d,r=s+f*l),s+=l}return r},closestPointNormalizedLength:function(t){var e=this.closestPointLength(t);if(e===0)return 0;var n=this.length();return n===0?0:e/n},closestPointTangent:function(t){var e=this.closestPointLength(t);return this.tangentAtLength(e)},containsPoint:function(t){var e=this.points,n=e.length;if(n===0)return!1;for(var r=t.x,i=t.y,s=n-1,o=0,a=0,c=new X,l=new X,f=new E;o<n;o++){var u=e[s],d=e[o];if(t.equals(u)||(c.start=u,c.end=d,c.containsPoint(t)))return!0;if(i<=u.y&&i>d.y||i>u.y&&i<=d.y){var g=u.x-r>d.x-r?u.x-r:d.x-r;g>=0&&(f.x=r+g,f.y=i,l.start=t,l.end=f,c.intersect(l)&&a++)}s=o}return a%2===1},close:function(){const{start:t,end:e,points:n}=this;return t&&e&&!t.equals(e)&&n.push(t.clone()),this},lengthPoints:function(){return this.points},convexHull:function(){return new St(Qo(this.points))},equals:function(t){if(!t)return!1;var e=this.points,n=t.points,r=e.length;if(n.length!==r)return!1;for(var i=0;i<r;i++){var s=e[i],o=t.points[i];if(!s.equals(o))return!1}return!0},intersectionWithLine:function(t){for(var e=new X(t),n=[],r=this.lengthPoints(),i=new X,s=0,o=r.length-1;s<o;s++){i.start=r[s],i.end=r[s+1];var a=e.intersectionWithLine(i);a&&n.push(a[0])}return n.length>0?n:null},isDifferentiable:function(){var t=this.points,e=t.length;if(e===0)return!1;for(var n=new X,r=e-1,i=0;i<r;i++)if(n.start=t[i],n.end=t[i+1],n.isDifferentiable())return!0;return!1},length:function(){var t=this.lengthPoints(),e=t.length;if(e===0)return 0;for(var n=0,r=e-1,i=0;i<r;i++)n+=t[i].distance(t[i+1]);return n},pointAt:function(t){var e=this.lengthPoints(),n=e.length;if(n===0)return null;if(n===1||t<=0)return e[0].clone();if(t>=1)return e[n-1].clone();var r=this.length(),i=r*t;return this.pointAtLength(i)},pointAtLength:function(t){var e=this.lengthPoints(),n=e.length;if(n===0)return null;if(n===1)return e[0].clone();var r=!0;t<0&&(r=!1,t=-t);for(var i=0,s=n-1,o=0;o<s;o++){var a=r?o:s-1-o,c=e[a],l=e[a+1],f=new X(c,l),u=c.distance(l);if(t<=i+u)return f.pointAtLength((r?1:-1)*(t-i));i+=u}var d=r?e[n-1]:e[0];return d.clone()},round:function(t){for(var e=this.points,n=e.length,r=0;r<n;r++)e[r].round(t);return this},scale:function(t,e,n){for(var r=this.points,i=r.length,s=0;s<i;s++)r[s].scale(t,e,n);return this},simplify:function(t={}){const e=this.points;if(e.length<3)return this;const n=t.threshold||1e-10;let r=0;for(;e[r+2];){const i=r,s=r+1,o=r+2,a=e[i],c=e[s],l=e[o];new X(a,l).closestPoint(c).distance(c)<=n?e.splice(s,1):r+=1}return this},tangentAt:function(t){var e=this.lengthPoints(),n=e.length;if(n===0||n===1)return null;t<0&&(t=0),t>1&&(t=1);var r=this.length(),i=r*t;return this.tangentAtLength(i)},tangentAtLength:function(t){var e=this.lengthPoints(),n=e.length;if(n===0||n===1)return null;var r=!0;t<0&&(r=!1,t=-t);for(var i,s=0,o=n-1,a=0;a<o;a++){var c=r?a:o-1-a,l=e[c],f=e[c+1],u=new X(l,f),d=l.distance(f);if(u.isDifferentiable()){if(t<=s+d)return u.tangentAtLength((r?1:-1)*(t-s));i=u}s+=d}if(i){var g=r?1:0;return i.tangentAt(g)}return null},toString:function(){return this.points+""},translate:function(t,e){for(var n=this.points,r=n.length,i=0;i<r;i++)n[i].translate(t,e);return this},serialize:function(){var t=this.points,e=t.length;if(e===0)return"";for(var n="",r=0;r<e;r++){var i=t[r];n+=i.x+","+i.y+" "}return n.trim()}};Object.defineProperty(St.prototype,"start",{configurable:!0,enumerable:!0,get:function(){var t=this.points,e=t.length;return e===0?null:this.points[0]}});Object.defineProperty(St.prototype,"end",{configurable:!0,enumerable:!0,get:function(){var t=this.points,e=t.length;return e===0?null:this.points[e-1]}});const{abs:Qn,sqrt:Ou,min:Bs,max:Fs,pow:ti}=Math,vt=function(t,e,n,r){if(!(this instanceof vt))return new vt(t,e,n,r);if(t instanceof vt)return new vt(t.start,t.controlPoint1,t.controlPoint2,t.end);this.start=new E(t),this.controlPoint1=new E(e),this.controlPoint2=new E(n),this.end=new E(r)};vt.throughPoints=function(){function t(n){var r=[],i=[],s=n.length-1,o;if(s==1)return r[0]=new E((2*n[0].x+n[1].x)/3,(2*n[0].y+n[1].y)/3),i[0]=new E(2*r[0].x-n[0].x,2*r[0].y-n[0].y),[r,i];var a=[];for(o=1;o<s-1;o++)a[o]=4*n[o].x+2*n[o+1].x;a[0]=n[0].x+2*n[1].x,a[s-1]=(8*n[s-1].x+n[s].x)/2;var c=e(a);for(o=1;o<s-1;++o)a[o]=4*n[o].y+2*n[o+1].y;a[0]=n[0].y+2*n[1].y,a[s-1]=(8*n[s-1].y+n[s].y)/2;var l=e(a);for(o=0;o<s;o++)r.push(new E(c[o],l[o])),o<s-1?i.push(new E(2*n[o+1].x-c[o+1],2*n[o+1].y-l[o+1])):i.push(new E((n[s].x+c[s-1])/2,(n[s].y+l[s-1])/2));return[r,i]}function e(n){var r=n.length,i=[],s=[],o=2;i[0]=n[0]/o;for(var a=1;a<r;a++)s[a]=1/o,o=(a<r-1?4:3.5)-s[a],i[a]=(n[a]-i[a-1])/o;for(a=1;a<r;a++)i[r-a-1]-=s[r-a]*i[r-a];return i}return function(n){if(!n||Array.isArray(n)&&n.length<2)throw new Error("At least 2 points are required");for(var r=t(n),i=[],s=r[0].length,o=0;o<s;o++){var a=new E(r[0][o].x,r[0][o].y),c=new E(r[1][o].x,r[1][o].y);i.push(new vt(n[o],a,c,n[o+1]))}return i}}();vt.prototype={type:lt.Curve,bbox:function(){for(var t=this.start,e=this.controlPoint1,n=this.controlPoint2,r=this.end,i=t.x,s=t.y,o=e.x,a=e.y,c=n.x,l=n.y,f=r.x,u=r.y,d=new Array,g=new Array,v=[new Array,new Array],y,x,w,T,P,M,I,D,h=0;h<2;++h){if(h===0?(x=6*i-12*o+6*c,y=-3*i+9*o-9*c+3*f,w=3*o-3*i):(x=6*s-12*a+6*l,y=-3*s+9*a-9*l+3*u,w=3*a-3*s),Qn(y)<1e-12){if(Qn(x)<1e-12)continue;T=-w/x,0<T&&T<1&&g.push(T);continue}I=x*x-4*w*y,D=Ou(I),!(I<0)&&(P=(-x+D)/(2*y),0<P&&P<1&&g.push(P),M=(-x-D)/(2*y),0<M&&M<1&&g.push(M))}for(var p=g.length,m=p,b,S,O;p--;)T=g[p],b=1-T,S=b*b*b*i+3*b*b*T*o+3*b*T*T*c+T*T*T*f,v[0][p]=S,O=b*b*b*s+3*b*b*T*a+3*b*T*T*l+T*T*T*u,v[1][p]=O,d[p]={X:S,Y:O};g[m]=0,g[m+1]=1,d[m]={X:i,Y:s},d[m+1]={X:f,Y:u},v[0][m]=i,v[1][m]=s,v[0][m+1]=f,v[1][m+1]=u,g.length=m+2,v[0].length=m+2,v[1].length=m+2,d.length=m+2;var N=Bs.apply(null,v[0]),F=Bs.apply(null,v[1]),q=Fs.apply(null,v[0]),A=Fs.apply(null,v[1]);return new Y(N,F,q-N,A-F)},clone:function(){return new vt(this.start,this.controlPoint1,this.controlPoint2,this.end)},closestPoint:function(t,e){return this.pointAtT(this.closestPointT(t,e))},closestPointLength:function(t,e){e=e||{};var n=e.precision===void 0?this.PRECISION:e.precision,r=e.subdivisions===void 0?this.getSubdivisions({precision:n}):e.subdivisions,i={precision:n,subdivisions:r};return this.lengthAtT(this.closestPointT(t,i),i)},closestPointNormalizedLength:function(t,e){e=e||{};var n=e.precision===void 0?this.PRECISION:e.precision,r=e.subdivisions===void 0?this.getSubdivisions({precision:n}):e.subdivisions,i={precision:n,subdivisions:r},s=this.closestPointLength(t,i);if(!s)return 0;var o=this.length(i);return o===0?0:s/o},closestPointT:function(t,e){e=e||{};for(var n=e.precision===void 0?this.PRECISION:e.precision,r=e.subdivisions===void 0?this.getSubdivisions({precision:n}):e.subdivisions,i,s,o,a,c,l,f,u=r.length,d=u?1/u:0,g=0;g<u;g++){var v=r[g],y=v.start.distance(t),x=v.end.distance(t),w=y+x;(!f||w<f)&&(i=v,s=g*d,o=(g+1)*d,a=y,c=x,l=v.start.distance(v.end),f=w)}for(var T=ti(10,-n);;){var P=a?Qn(a-c)/a:0,M=c?Qn(a-c)/c:0,I=P<T||M<T,D=a?a<l*T:!0,h=c?c<l*T:!0,p=D||h;if(I||p)return a<=c?s:o;var m=i.divide(.5);d/=2;var b=m[0].start.distance(t),S=m[0].end.distance(t),O=b+S,N=m[1].start.distance(t),F=m[1].end.distance(t),q=N+F;O<=q?(i=m[0],o-=d,a=b,c=S):(i=m[1],s+=d,a=N,c=F)}},closestPointTangent:function(t,e){return this.tangentAtT(this.closestPointT(t,e))},containsPoint:function(t,e){var n=this.toPolyline(e);return n.containsPoint(t)},divideAt:function(t,e){if(t<=0)return this.divideAtT(0);if(t>=1)return this.divideAtT(1);var n=this.tAt(t,e);return this.divideAtT(n)},divideAtLength:function(t,e){var n=this.tAtLength(t,e);return this.divideAtT(n)},divideAtT:function(t){var e=this.start,n=this.controlPoint1,r=this.controlPoint2,i=this.end;if(t<=0)return[new vt(e,e,e,e),new vt(e,n,r,i)];if(t>=1)return[new vt(e,n,r,i),new vt(i,i,i,i)];var s=this.getSkeletonPoints(t),o=s.startControlPoint1,a=s.startControlPoint2,c=s.divider,l=s.dividerControlPoint1,f=s.dividerControlPoint2;return[new vt(e,o,a,c),new vt(c,l,f,i)]},endpointDistance:function(){return this.start.distance(this.end)},equals:function(t){return!!t&&this.start.x===t.start.x&&this.start.y===t.start.y&&this.controlPoint1.x===t.controlPoint1.x&&this.controlPoint1.y===t.controlPoint1.y&&this.controlPoint2.x===t.controlPoint2.x&&this.controlPoint2.y===t.controlPoint2.y&&this.end.x===t.end.x&&this.end.y===t.end.y},getSkeletonPoints:function(t){var e=this.start,n=this.controlPoint1,r=this.controlPoint2,i=this.end;if(t<=0)return{startControlPoint1:e.clone(),startControlPoint2:e.clone(),divider:e.clone(),dividerControlPoint1:n.clone(),dividerControlPoint2:r.clone()};if(t>=1)return{startControlPoint1:n.clone(),startControlPoint2:r.clone(),divider:i.clone(),dividerControlPoint1:i.clone(),dividerControlPoint2:i.clone()};var s=new X(e,n).pointAt(t),o=new X(n,r).pointAt(t),a=new X(r,i).pointAt(t),c=new X(s,o).pointAt(t),l=new X(o,a).pointAt(t),f=new X(c,l).pointAt(t),u={startControlPoint1:s,startControlPoint2:c,divider:f,dividerControlPoint1:l,dividerControlPoint2:a};return u},getSubdivisions:function(t){t=t||{};var e=t.precision===void 0?this.PRECISION:t.precision,n=this.start,r=this.controlPoint1,i=this.controlPoint2,s=this.end,o=[new vt(n,r,i,s)];if(e===0)return o;var a=!this.isDifferentiable();if(a)return o;var c=this.endpointDistance(),l=ti(10,-e),f=2,u=r.cross(n,s)===0&&i.cross(n,s)===0;u&&(f=2*e);for(var d=0;;){d+=1;for(var g=[],v=o.length,y=0;y<v;y++){var x=o[y],w=x.divide(.5);g.push(w[0],w[1])}for(var T=0,P=g.length,M=0;M<P;M++){var I=g[M];T+=I.endpointDistance()}if(d>=f){var D=T!==0?(T-c)/T:0;if(D<l)return g}o=g,c=T}},isDifferentiable:function(){var t=this.start,e=this.controlPoint1,n=this.controlPoint2,r=this.end;return!(t.equals(e)&&e.equals(n)&&n.equals(r))},length:function(t){t=t||{};for(var e=t.precision===void 0?this.PRECISION:t.precision,n=t.subdivisions===void 0?this.getSubdivisions({precision:e}):t.subdivisions,r=0,i=n.length,s=0;s<i;s++){var o=n[s];r+=o.endpointDistance()}return r},lengthAtT:function(t,e){if(t<=0)return 0;e=e||{};var n=e.precision===void 0?this.PRECISION:e.precision,r=this.divide(t)[0],i=r.length({precision:n});return i},pointAt:function(t,e){if(t<=0)return this.start.clone();if(t>=1)return this.end.clone();var n=this.tAt(t,e);return this.pointAtT(n)},pointAtLength:function(t,e){var n=this.tAtLength(t,e);return this.pointAtT(n)},pointAtT:function(t){return t<=0?this.start.clone():t>=1?this.end.clone():this.getSkeletonPoints(t).divider},PRECISION:3,round:function(t){return this.start.round(t),this.controlPoint1.round(t),this.controlPoint2.round(t),this.end.round(t),this},scale:function(t,e,n){return this.start.scale(t,e,n),this.controlPoint1.scale(t,e,n),this.controlPoint2.scale(t,e,n),this.end.scale(t,e,n),this},tangentAt:function(t,e){if(!this.isDifferentiable())return null;t<0?t=0:t>1&&(t=1);var n=this.tAt(t,e);return this.tangentAtT(n)},tangentAtLength:function(t,e){if(!this.isDifferentiable())return null;var n=this.tAtLength(t,e);return this.tangentAtT(n)},tangentAtT:function(t){if(!this.isDifferentiable())return null;t<0?t=0:t>1&&(t=1);var e=this.getSkeletonPoints(t),n=e.startControlPoint2,r=e.dividerControlPoint1,i=e.divider,s=new X(n,r);return s.translate(i.x-n.x,i.y-n.y),s},tAt:function(t,e){if(t<=0)return 0;if(t>=1)return 1;e=e||{};var n=e.precision===void 0?this.PRECISION:e.precision,r=e.subdivisions===void 0?this.getSubdivisions({precision:n}):e.subdivisions,i={precision:n,subdivisions:r},s=this.length(i),o=s*t;return this.tAtLength(o,i)},tAtLength:function(t,e){var n=!0;t<0&&(n=!1,t=-t),e=e||{};for(var r=e.precision===void 0?this.PRECISION:e.precision,i=e.subdivisions===void 0?this.getSubdivisions({precision:r}):e.subdivisions,s={precision:r,subdivisions:i},o,a,c,l,f,u=0,d=i.length,g=1/d,v=0;v<d;v++){var y=n?v:d-1-v,x=i[v],w=x.endpointDistance();if(t<=u+w){o=x,a=y*g,c=(y+1)*g,l=n?t-u:w+u-t,f=n?w+u-t:t-u;break}u+=w}if(!o)return n?1:0;for(var T=this.length(s),P=ti(10,-r);;){var M;if(M=T!==0?l/T:0,M<P)return a;if(M=T!==0?f/T:0,M<P)return c;var I,D,h=o.divide(.5);g/=2;var p=h[0].endpointDistance(),m=h[1].endpointDistance();l<=p?(o=h[0],c-=g,I=l,D=p-I):(o=h[1],a+=g,I=l-p,D=m-I),l=I,f=D}},toPoints:function(t){t=t||{};for(var e=t.precision===void 0?this.PRECISION:t.precision,n=t.subdivisions===void 0?this.getSubdivisions({precision:e}):t.subdivisions,r=[n[0].start.clone()],i=n.length,s=0;s<i;s++){var o=n[s];r.push(o.end.clone())}return r},toPolyline:function(t){return new St(this.toPoints(t))},toString:function(){return this.start+" "+this.controlPoint1+" "+this.controlPoint2+" "+this.end},translate:function(t,e){return this.start.translate(t,e),this.controlPoint1.translate(t,e),this.controlPoint2.translate(t,e),this.end.translate(t,e),this}};vt.prototype.divide=vt.prototype.divideAtT;function Vn(t){var e,n,r=[];for(n=arguments.length,e=1;e<n;e++)r.push(arguments[e]);if(!t)throw new Error("Missing a parent object.");var i=Object.create(t);for(n=r.length,e=0;e<n;e++){var s=r[e],o,a;for(a in s)s.hasOwnProperty(a)&&(delete i[a],o=Object.getOwnPropertyDescriptor(s,a),Object.defineProperty(i,a,o))}return i}const et=function(t){if(!(this instanceof et))return new et(t);if(typeof t=="string")return new et.parse(t);this.segments=[];var e,n;if(t)if(Array.isArray(t)&&t.length!==0)if(t=t.reduce(function(a,c){return a.concat(c)},[]),n=t.length,t[0].isSegment)for(e=0;e<n;e++){var r=t[e];this.appendSegment(r)}else{var i=null;for(e=0;e<n;e++){var s=t[e];if(!(s instanceof X||s instanceof vt))throw new Error("Cannot construct a path segment from the provided object.");e===0&&this.appendSegment(et.createSegment("M",s.start)),i&&!i.end.equals(s.start)&&this.appendSegment(et.createSegment("M",s.start)),s instanceof X?this.appendSegment(et.createSegment("L",s.end)):s instanceof vt&&this.appendSegment(et.createSegment("C",s.controlPoint1,s.controlPoint2,s.end)),i=s}}else if(t.isSegment)this.appendSegment(t);else if(t instanceof X)this.appendSegment(et.createSegment("M",t.start)),this.appendSegment(et.createSegment("L",t.end));else if(t instanceof vt)this.appendSegment(et.createSegment("M",t.start)),this.appendSegment(et.createSegment("C",t.controlPoint1,t.controlPoint2,t.end));else if(t instanceof St){if(!(t.points&&t.points.length!==0))return;for(n=t.points.length,e=0;e<n;e++){var o=t.points[e];e===0?this.appendSegment(et.createSegment("M",o)):this.appendSegment(et.createSegment("L",o))}}else throw new Error("Cannot construct a path from the provided object.")};et.parse=function(t){if(!t)return new et;for(var e=new et,n=/(?:[a-zA-Z] *)(?:(?:-?\d+(?:\.\d+)?(?:e[-+]?\d+)? *,? *)|(?:-?\.\d+ *,? *))+|(?:[a-zA-Z] *)(?! |\d|-|\.)/g,r=t.match(n),i=r.length,s=0;s<i;s++){var o=r[s],a=/(?:[a-zA-Z])|(?:(?:-?\d+(?:\.\d+)?(?:e[-+]?\d+)?))|(?:(?:-?\.\d+))/g,c=o.match(a),l=et.createSegment.apply(this,c);e.appendSegment(l)}return e};et.createSegment=function(t){if(!t)throw new Error("Type must be provided.");var e=et.segmentTypes[t];if(!e)throw new Error(t+" is not a recognized path segment type.");for(var n=[],r=arguments.length,i=1;i<r;i++)n.push(arguments[i]);return pe(e,n)};et.prototype={type:lt.Path,appendSegment:function(t){var e=this.segments,n=e.length,r,i=n!==0?e[n-1]:null,s=null;if(Array.isArray(t)){if(t=t.reduce(function(l,f){return l.concat(f)},[]),!t[0].isSegment)throw new Error("Segments required.");for(var o=t.length,a=0;a<o;a++){var c=t[a];r=this.prepareSegment(c,i,s),e.push(r),i=r}}else{if(!t||!t.isSegment)throw new Error("Segment required.");r=this.prepareSegment(t,i,s),e.push(r)}},bbox:function(){var t=this.segments,e=t.length;if(e===0)return null;for(var n,r=0;r<e;r++){var i=t[r];if(i.isVisible){var s=i.bbox();n=n?n.union(s):s}}if(n)return n;var o=t[e-1];return new Y(o.end.x,o.end.y,0,0)},clone:function(){for(var t=this.segments,e=t.length,n=new et,r=0;r<e;r++){var i=t[r].clone();n.appendSegment(i)}return n},closestPoint:function(t,e){var n=this.closestPointT(t,e);return n?this.pointAtT(n):null},closestPointLength:function(t,e){e=e||{};var n=e.precision===void 0?this.PRECISION:e.precision,r=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:n}):e.segmentSubdivisions,i={precision:n,segmentSubdivisions:r},s=this.closestPointT(t,i);return s?this.lengthAtT(s,i):0},closestPointNormalizedLength:function(t,e){e=e||{};var n=e.precision===void 0?this.PRECISION:e.precision,r=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:n}):e.segmentSubdivisions,i={precision:n,segmentSubdivisions:r},s=this.closestPointLength(t,i);if(s===0)return 0;var o=this.length(i);return o===0?0:s/o},closestPointT:function(t,e){var n=this.segments,r=n.length;if(r===0)return null;e=e||{};for(var i=e.precision===void 0?this.PRECISION:e.precision,s=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions,o,a=1/0,c=0;c<r;c++){var l=n[c],f=s[c];if(l.isVisible){var u=l.closestPointT(t,{precision:i,subdivisions:f}),d=l.pointAtT(u),g=new X(d,t).squaredLength();g<a&&(o={segmentIndex:c,value:u},a=g)}}return o||{segmentIndex:r-1,value:1}},closestPointTangent:function(t,e){var n=this.segments,r=n.length;if(r===0)return null;e=e||{};for(var i=e.precision===void 0?this.PRECISION:e.precision,s=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions,o,a=1/0,c=0;c<r;c++){var l=n[c],f=s[c];if(l.isDifferentiable()){var u=l.closestPointT(t,{precision:i,subdivisions:f}),d=l.pointAtT(u),g=new X(d,t).squaredLength();g<a&&(o=l.tangentAtT(u),a=g)}}return o||null},containsPoint:function(t,e){var n=this.toPolylines(e);if(!n)return!1;for(var r=n.length,i=0,s=0;s<r;s++){var o=n[s];o.containsPoint(t)&&i++}return i%2===1},divideAt:function(t,e){var n=this.segments,r=n.length;if(r===0)return null;t<0&&(t=0),t>1&&(t=1),e=e||{};var i=e.precision===void 0?this.PRECISION:e.precision,s=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions,o={precision:i,segmentSubdivisions:s},a=this.length(o),c=a*t;return this.divideAtLength(c,o)},divideAtLength:function(t,e){var n=this.segments.length;if(n===0)return null;var r=!0;t<0&&(r=!1,t=-t),e=e||{};var i=e.precision===void 0?this.PRECISION:e.precision,s=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions,o,a,c=0,l,f,u,d,g;for(o=0;o<n;o++){var v=r?o:n-1-o;a=this.getSegment(v);var y=s[v],x=a.length({precision:i,subdivisions:y});if(a.isDifferentiable()&&(u=a,d=v,t<=c+x)){f=v,l=a.divideAtLength((r?1:-1)*(t-c),{precision:i,subdivisions:y});break}c+=x}if(!u)return null;l||(f=d,g=r?1:0,l=u.divideAtT(g));var w=this.clone();w.replaceSegment(f,l);var T=f,P=f+1,M=f+2;l[0].isDifferentiable()||(w.removeSegment(T),P-=1,M-=1);var I=w.getSegment(P).start;w.insertSegment(P,et.createSegment("M",I)),M+=1,l[1].isDifferentiable()||(w.removeSegment(M-1),M-=1);var D=M-T-1;for(o=M;o<w.segments.length;o++){var h=this.getSegment(o-D);if(a=w.getSegment(o),a.type==="Z"&&!h.subpathStartSegment.end.equals(a.subpathStartSegment.end)){var p=et.createSegment("L",h.end);w.replaceSegment(o,p)}}var m=new et(w.segments.slice(0,P)),b=new et(w.segments.slice(P));return[m,b]},equals:function(t){if(!t)return!1;var e=this.segments,n=t.segments,r=e.length;if(n.length!==r)return!1;for(var i=0;i<r;i++){var s=e[i],o=n[i];if(s.type!==o.type||!s.equals(o))return!1}return!0},getSegment:function(t){var e=this.segments,n=e.length;if(n===0)throw new Error("Path has no segments.");if(t<0&&(t=n+t),t>=n||t<0)throw new Error("Index out of range.");return e[t]},getSegmentSubdivisions:function(t){var e=this.segments,n=e.length;t=t||{};for(var r=t.precision===void 0?this.PRECISION:t.precision,i=[],s=0;s<n;s++){var o=e[s],a=o.getSubdivisions({precision:r});i.push(a)}return i},getSubpaths:function(){const e=this.clone().validate().segments,n=e.length,r=[];for(let i=0;i<n;i++){const s=e[i];s.isSubpathStart?r.push(new et(s)):r[r.length-1].appendSegment(s)}return r},insertSegment:function(t,e){var n=this.segments,r=n.length;if(t<0&&(t=r+t+1),t>r||t<0)throw new Error("Index out of range.");var i,s=null,o=null;if(r!==0&&(t>=1?(s=n[t-1],o=s.nextSegment):o=n[0]),Array.isArray(e)){if(e=e.reduce(function(f,u){return f.concat(u)},[]),!e[0].isSegment)throw new Error("Segments required.");for(var a=e.length,c=0;c<a;c++){var l=e[c];i=this.prepareSegment(l,s,o),n.splice(t+c,0,i),s=i}}else{if(!e||!e.isSegment)throw new Error("Segment required.");i=this.prepareSegment(e,s,o),n.splice(t,0,i)}},intersectionWithLine:function(t,e){var n=null,r=this.toPolylines(e);if(!r)return null;for(var i=0,s=r.length;i<s;i++){var o=r[i],a=t.intersect(o);a&&(n||(n=[]),Array.isArray(a)?Array.prototype.push.apply(n,a):n.push(a))}return n},isDifferentiable:function(){for(var t=this.segments,e=t.length,n=0;n<e;n++){var r=t[n];if(r.isDifferentiable())return!0}return!1},isValid:function(){var t=this.segments,e=t.length===0||t[0].type==="M";return e},length:function(t){var e=this.segments,n=e.length;if(n===0)return 0;t=t||{};for(var r=t.precision===void 0?this.PRECISION:t.precision,i=t.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:r}):t.segmentSubdivisions,s=0,o=0;o<n;o++){var a=e[o],c=i[o];s+=a.length({subdivisions:c})}return s},lengthAtT:function(t,e){var n=this.segments,r=n.length;if(r===0)return 0;var i=t.segmentIndex;if(i<0)return 0;var s=t.value;i>=r?(i=r-1,s=1):s<0?s=0:s>1&&(s=1),e=e||{};for(var o=e.precision===void 0?this.PRECISION:e.precision,a=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:o}):e.segmentSubdivisions,c,l=0,f=0;f<i;f++){var u=n[f];c=a[f],l+=u.length({precisison:o,subdivisions:c})}return u=n[i],c=a[i],l+=u.lengthAtT(s,{precisison:o,subdivisions:c}),l},pointAt:function(t,e){var n=this.segments,r=n.length;if(r===0)return null;if(t<=0)return this.start.clone();if(t>=1)return this.end.clone();e=e||{};var i=e.precision===void 0?this.PRECISION:e.precision,s=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions,o={precision:i,segmentSubdivisions:s},a=this.length(o),c=a*t;return this.pointAtLength(c,o)},pointAtLength:function(t,e){var n=this.segments,r=n.length;if(r===0)return null;if(t===0)return this.start.clone();var i=!0;t<0&&(i=!1,t=-t),e=e||{};for(var s=e.precision===void 0?this.PRECISION:e.precision,o=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:s}):e.segmentSubdivisions,a,c=0,l=0;l<r;l++){var f=i?l:r-1-l,u=n[f],d=o[f],g=u.length({precision:s,subdivisions:d});if(u.isVisible){if(t<=c+g)return u.pointAtLength((i?1:-1)*(t-c),{precision:s,subdivisions:d});a=u}c+=g}if(a)return i?a.end:a.start;var v=n[r-1];return v.end.clone()},pointAtT:function(t){var e=this.segments,n=e.length;if(n===0)return null;var r=t.segmentIndex;if(r<0)return e[0].pointAtT(0);if(r>=n)return e[n-1].pointAtT(1);var i=t.value;return i<0?i=0:i>1&&(i=1),e[r].pointAtT(i)},PRECISION:3,prepareSegment:function(t,e,n){t.previousSegment=e,t.nextSegment=n,e&&(e.nextSegment=t),n&&(n.previousSegment=t);var r=t;return t.isSubpathStart&&(t.subpathStartSegment=t,r=n),r&&this.updateSubpathStartSegment(r),t},removeSegment:function(t){var e=this.segments,n=e.length;if(n===0)throw new Error("Path has no segments.");if(t<0&&(t=n+t),t>=n||t<0)throw new Error("Index out of range.");var r=e.splice(t,1)[0],i=r.previousSegment,s=r.nextSegment;i&&(i.nextSegment=s),s&&(s.previousSegment=i),r.isSubpathStart&&s&&this.updateSubpathStartSegment(s)},replaceSegment:function(t,e){var n=this.segments,r=n.length;if(r===0)throw new Error("Path has no segments.");if(t<0&&(t=r+t),t>=r||t<0)throw new Error("Index out of range.");var i,s=n[t],o=s.previousSegment,a=s.nextSegment,c=s.isSubpathStart;if(Array.isArray(e)){if(e=e.reduce(function(d,g){return d.concat(g)},[]),!e[0].isSegment)throw new Error("Segments required.");n.splice(t,1);for(var l=e.length,f=0;f<l;f++){var u=e[f];i=this.prepareSegment(u,o,a),n.splice(t+f,0,i),o=i,c&&i.isSubpathStart&&(c=!1)}}else{if(!e||!e.isSegment)throw new Error("Segment required.");i=this.prepareSegment(e,o,a),n.splice(t,1,i),c&&i.isSubpathStart&&(c=!1)}c&&a&&this.updateSubpathStartSegment(a)},round:function(t){for(var e=this.segments,n=e.length,r=0;r<n;r++){var i=e[r];i.round(t)}return this},scale:function(t,e,n){for(var r=this.segments,i=r.length,s=0;s<i;s++){var o=r[s];o.scale(t,e,n)}return this},segmentAt:function(t,e){var n=this.segmentIndexAt(t,e);return n?this.getSegment(n):null},segmentAtLength:function(t,e){var n=this.segmentIndexAtLength(t,e);return n?this.getSegment(n):null},segmentIndexAt:function(t,e){var n=this.segments,r=n.length;if(r===0)return null;t<0&&(t=0),t>1&&(t=1),e=e||{};var i=e.precision===void 0?this.PRECISION:e.precision,s=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions,o={precision:i,segmentSubdivisions:s},a=this.length(o),c=a*t;return this.segmentIndexAtLength(c,o)},segmentIndexAtLength:function(t,e){var n=this.segments,r=n.length;if(r===0)return null;var i=!0;t<0&&(i=!1,t=-t),e=e||{};for(var s=e.precision===void 0?this.PRECISION:e.precision,o=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:s}):e.segmentSubdivisions,a=null,c=0,l=0;l<r;l++){var f=i?l:r-1-l,u=n[f],d=o[f],g=u.length({precision:s,subdivisions:d});if(u.isVisible){if(t<=c+g)return f;a=f}c+=g}return a},serialize:function(){if(!this.isValid())throw new Error("Invalid path segments.");return this.toString()},tangentAt:function(t,e){var n=this.segments,r=n.length;if(r===0)return null;t<0&&(t=0),t>1&&(t=1),e=e||{};var i=e.precision===void 0?this.PRECISION:e.precision,s=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions,o={precision:i,segmentSubdivisions:s},a=this.length(o),c=a*t;return this.tangentAtLength(c,o)},tangentAtLength:function(t,e){var n=this.segments,r=n.length;if(r===0)return null;var i=!0;t<0&&(i=!1,t=-t),e=e||{};for(var s=e.precision===void 0?this.PRECISION:e.precision,o=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:s}):e.segmentSubdivisions,a,c=0,l=0;l<r;l++){var f=i?l:r-1-l,u=n[f],d=o[f],g=u.length({precision:s,subdivisions:d});if(u.isDifferentiable()){if(t<=c+g)return u.tangentAtLength((i?1:-1)*(t-c),{precision:s,subdivisions:d});a=u}c+=g}if(a){var v=i?1:0;return a.tangentAtT(v)}return null},tangentAtT:function(t){var e=this.segments,n=e.length;if(n===0)return null;var r=t.segmentIndex;if(r<0)return e[0].tangentAtT(0);if(r>=n)return e[n-1].tangentAtT(1);var i=t.value;return i<0?i=0:i>1&&(i=1),e[r].tangentAtT(i)},toPoints:function(t){var e=this.segments,n=e.length;if(n===0)return null;t=t||{};for(var r=t.precision===void 0?this.PRECISION:t.precision,i=t.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:r}):t.segmentSubdivisions,s=[],o=[],a=0;a<n;a++){var c=e[a];if(c.isVisible){var l=i[a];if(l.length>0){var f=l.map(function(u){return u.start});Array.prototype.push.apply(o,f)}else o.push(c.start)}else o.length>0&&(o.push(e[a-1].end),s.push(o),o=[])}return o.length>0&&(o.push(this.end),s.push(o)),s},toPolylines:function(t){var e=[],n=this.toPoints(t);if(!n)return null;for(var r=0,i=n.length;r<i;r++)e.push(new St(n[r]));return e},toString:function(){for(var t=this.segments,e=t.length,n="",r=0;r<e;r++){var i=t[r];n+=i.serialize()+" "}return n.trim()},translate:function(t,e){for(var n=this.segments,r=n.length,i=0;i<r;i++){var s=n[i];s.translate(t,e)}return this},updateSubpathStartSegment:function(t){for(var e=t.previousSegment;t&&!t.isSubpathStart;)e?t.subpathStartSegment=e.subpathStartSegment:t.subpathStartSegment=null,e=t,t=t.nextSegment},validate:function(){return this.isValid()||this.insertSegment(0,et.createSegment("M",0,0)),this}};Object.defineProperty(et.prototype,"start",{configurable:!0,enumerable:!0,get:function(){var t=this.segments,e=t.length;if(e===0)return null;for(var n=0;n<e;n++){var r=t[n];if(r.isVisible)return r.start}return t[e-1].end}});Object.defineProperty(et.prototype,"end",{configurable:!0,enumerable:!0,get:function(){var t=this.segments,e=t.length;if(e===0)return null;for(var n=e-1;n>=0;n--){var r=t[n];if(r.isVisible)return r.end}return t[e-1].end}});function pe(t,e){return e.unshift(null),new(Function.prototype.bind.apply(t,e))}var Ze={bbox:function(){throw new Error("Declaration missing for virtual function.")},clone:function(){throw new Error("Declaration missing for virtual function.")},closestPoint:function(){throw new Error("Declaration missing for virtual function.")},closestPointLength:function(){throw new Error("Declaration missing for virtual function.")},closestPointNormalizedLength:function(){throw new Error("Declaration missing for virtual function.")},closestPointT:function(t){if(this.closestPointNormalizedLength)return this.closestPointNormalizedLength(t);throw new Error("Neither closestPointT() nor closestPointNormalizedLength() function is implemented.")},closestPointTangent:function(){throw new Error("Declaration missing for virtual function.")},divideAt:function(){throw new Error("Declaration missing for virtual function.")},divideAtLength:function(){throw new Error("Declaration missing for virtual function.")},divideAtT:function(t){if(this.divideAt)return this.divideAt(t);throw new Error("Neither divideAtT() nor divideAt() function is implemented.")},equals:function(){throw new Error("Declaration missing for virtual function.")},getSubdivisions:function(){throw new Error("Declaration missing for virtual function.")},isDifferentiable:function(){throw new Error("Declaration missing for virtual function.")},isSegment:!0,isSubpathStart:!1,isVisible:!0,length:function(){throw new Error("Declaration missing for virtual function.")},lengthAtT:function(t){if(t<=0)return 0;var e=this.length();return t>=1?e:e*t},nextSegment:null,pointAt:function(){throw new Error("Declaration missing for virtual function.")},pointAtLength:function(){throw new Error("Declaration missing for virtual function.")},pointAtT:function(t){if(this.pointAt)return this.pointAt(t);throw new Error("Neither pointAtT() nor pointAt() function is implemented.")},previousSegment:null,round:function(){throw new Error("Declaration missing for virtual function.")},subpathStartSegment:null,scale:function(){throw new Error("Declaration missing for virtual function.")},serialize:function(){throw new Error("Declaration missing for virtual function.")},tangentAt:function(){throw new Error("Declaration missing for virtual function.")},tangentAtLength:function(){throw new Error("Declaration missing for virtual function.")},tangentAtT:function(t){if(this.tangentAt)return this.tangentAt(t);throw new Error("Neither tangentAtT() nor tangentAt() function is implemented.")},toString:function(){throw new Error("Declaration missing for virtual function.")},translate:function(){throw new Error("Declaration missing for virtual function.")}};Object.defineProperty(Ze,"end",{configurable:!0,enumerable:!0,writable:!0});Object.defineProperty(Ze,"start",{configurable:!0,enumerable:!0,get:function(){if(!this.previousSegment)throw new Error("Missing previous segment. (This segment cannot be the first segment of a path; OR segment has not yet been added to a path.)");return this.previousSegment.end}});Object.defineProperty(Ze,"type",{configurable:!0,enumerable:!0,get:function(){throw new Error("Bad segment declaration. No type specified.")}});var Nt=function(){for(var t=[],e=arguments.length,n=0;n<e;n++)t.push(arguments[n]);if(!(this instanceof Nt))return pe(Nt,t);if(e===0)throw new Error("Lineto constructor expects a line, 1 point, or 2 coordinates (none provided).");var r;if(t[0]instanceof X){if(e===1)return this.end=t[0].end.clone(),this;throw new Error("Lineto constructor expects a line, 1 point, or 2 coordinates ("+e+" lines provided).")}else if(typeof t[0]=="string"||typeof t[0]=="number"){if(e===2)return this.end=new E(+t[0],+t[1]),this;if(e<2)throw new Error("Lineto constructor expects a line, 1 point, or 2 coordinates ("+e+" coordinates provided).");var i;for(r=[],n=0;n<e;n+=2)i=t.slice(n,n+2),r.push(pe(Nt,i));return r}else{if(e===1)return this.end=new E(t[0]),this;var s;for(r=[],n=0;n<e;n+=1)s=t[n],r.push(new Nt(s));return r}},ta={clone:function(){return new Nt(this.end)},divideAt:function(t){var e=new X(this.start,this.end),n=e.divideAt(t);return[new Nt(n[0]),new Nt(n[1])]},divideAtLength:function(t){var e=new X(this.start,this.end),n=e.divideAtLength(t);return[new Nt(n[0]),new Nt(n[1])]},getSubdivisions:function(){return[]},isDifferentiable:function(){return this.previousSegment?!this.start.equals(this.end):!1},round:function(t){return this.end.round(t),this},scale:function(t,e,n){return this.end.scale(t,e,n),this},serialize:function(){var t=this.end;return this.type+" "+t.x+" "+t.y},toString:function(){return this.type+" "+this.start+" "+this.end},translate:function(t,e){return this.end.translate(t,e),this}};Object.defineProperty(ta,"type",{configurable:!0,enumerable:!0,value:"L"});Nt.prototype=Vn(Ze,X.prototype,ta);var Wt=function(){for(var t=[],e=arguments.length,n=0;n<e;n++)t.push(arguments[n]);if(!(this instanceof Wt))return pe(Wt,t);if(e===0)throw new Error("Curveto constructor expects a curve, 3 points, or 6 coordinates (none provided).");var r;if(t[0]instanceof vt){if(e===1)return this.controlPoint1=t[0].controlPoint1.clone(),this.controlPoint2=t[0].controlPoint2.clone(),this.end=t[0].end.clone(),this;throw new Error("Curveto constructor expects a curve, 3 points, or 6 coordinates ("+e+" curves provided).")}else if(typeof t[0]=="string"||typeof t[0]=="number"){if(e===6)return this.controlPoint1=new E(+t[0],+t[1]),this.controlPoint2=new E(+t[2],+t[3]),this.end=new E(+t[4],+t[5]),this;if(e<6)throw new Error("Curveto constructor expects a curve, 3 points, or 6 coordinates ("+e+" coordinates provided).");var i;for(r=[],n=0;n<e;n+=6)i=t.slice(n,n+6),r.push(pe(Wt,i));return r}else{if(e===3)return this.controlPoint1=new E(t[0]),this.controlPoint2=new E(t[1]),this.end=new E(t[2]),this;if(e<3)throw new Error("Curveto constructor expects a curve, 3 points, or 6 coordinates ("+e+" points provided).");var s;for(r=[],n=0;n<e;n+=3)s=t.slice(n,n+3),r.push(pe(Wt,s));return r}},ea={clone:function(){return new Wt(this.controlPoint1,this.controlPoint2,this.end)},divideAt:function(t,e){var n=new vt(this.start,this.controlPoint1,this.controlPoint2,this.end),r=n.divideAt(t,e);return[new Wt(r[0]),new Wt(r[1])]},divideAtLength:function(t,e){var n=new vt(this.start,this.controlPoint1,this.controlPoint2,this.end),r=n.divideAtLength(t,e);return[new Wt(r[0]),new Wt(r[1])]},divideAtT:function(t){var e=new vt(this.start,this.controlPoint1,this.controlPoint2,this.end),n=e.divideAtT(t);return[new Wt(n[0]),new Wt(n[1])]},isDifferentiable:function(){if(!this.previousSegment)return!1;var t=this.start,e=this.controlPoint1,n=this.controlPoint2,r=this.end;return!(t.equals(e)&&e.equals(n)&&n.equals(r))},round:function(t){return this.controlPoint1.round(t),this.controlPoint2.round(t),this.end.round(t),this},scale:function(t,e,n){return this.controlPoint1.scale(t,e,n),this.controlPoint2.scale(t,e,n),this.end.scale(t,e,n),this},serialize:function(){var t=this.controlPoint1,e=this.controlPoint2,n=this.end;return this.type+" "+t.x+" "+t.y+" "+e.x+" "+e.y+" "+n.x+" "+n.y},toString:function(){return this.type+" "+this.start+" "+this.controlPoint1+" "+this.controlPoint2+" "+this.end},translate:function(t,e){return this.controlPoint1.translate(t,e),this.controlPoint2.translate(t,e),this.end.translate(t,e),this}};Object.defineProperty(ea,"type",{configurable:!0,enumerable:!0,value:"C"});Wt.prototype=Vn(Ze,vt.prototype,ea);var Ge=function(){for(var t=[],e=arguments.length,n=0;n<e;n++)t.push(arguments[n]);if(!(this instanceof Ge))return pe(Ge,t);if(e===0)throw new Error("Moveto constructor expects a line, a curve, 1 point, or 2 coordinates (none provided).");var r;if(t[0]instanceof X){if(e===1)return this.end=t[0].end.clone(),this;throw new Error("Moveto constructor expects a line, a curve, 1 point, or 2 coordinates ("+e+" lines provided).")}else if(t[0]instanceof vt){if(e===1)return this.end=t[0].end.clone(),this;throw new Error("Moveto constructor expects a line, a curve, 1 point, or 2 coordinates ("+e+" curves provided).")}else if(typeof t[0]=="string"||typeof t[0]=="number"){if(e===2)return this.end=new E(+t[0],+t[1]),this;if(e<2)throw new Error("Moveto constructor expects a line, a curve, 1 point, or 2 coordinates ("+e+" coordinates provided).");var i;for(r=[],n=0;n<e;n+=2)i=t.slice(n,n+2),n===0?r.push(pe(Ge,i)):r.push(pe(Nt,i));return r}else{if(e===1)return this.end=new E(t[0]),this;var s;for(r=[],n=0;n<e;n+=1)s=t[n],n===0?r.push(new Ge(s)):r.push(new Nt(s));return r}},Vi={bbox:function(){return null},clone:function(){return new Ge(this.end)},closestPoint:function(){return this.end.clone()},closestPointNormalizedLength:function(){return 0},closestPointLength:function(){return 0},closestPointT:function(){return 1},closestPointTangent:function(){return null},divideAt:function(){return[this.clone(),this.clone()]},divideAtLength:function(){return[this.clone(),this.clone()]},equals:function(t){return this.end.equals(t.end)},getSubdivisions:function(){return[]},isDifferentiable:function(){return!1},isSubpathStart:!0,isVisible:!1,length:function(){return 0},lengthAtT:function(){return 0},pointAt:function(){return this.end.clone()},pointAtLength:function(){return this.end.clone()},pointAtT:function(){return this.end.clone()},round:function(t){return this.end.round(t),this},scale:function(t,e,n){return this.end.scale(t,e,n),this},serialize:function(){var t=this.end;return this.type+" "+t.x+" "+t.y},tangentAt:function(){return null},tangentAtLength:function(){return null},tangentAtT:function(){return null},toString:function(){return this.type+" "+this.end},translate:function(t,e){return this.end.translate(t,e),this}};Object.defineProperty(Vi,"start",{configurable:!0,enumerable:!0,get:function(){throw new Error("Illegal access. Moveto segments should not need a start property.")}});Object.defineProperty(Vi,"type",{configurable:!0,enumerable:!0,value:"M"});Ge.prototype=Vn(Ze,Vi);var dn=function(){for(var t=[],e=arguments.length,n=0;n<e;n++)t.push(arguments[n]);if(!(this instanceof dn))return pe(dn,t);if(e>0)throw new Error("Closepath constructor expects no arguments.");return this},zi={clone:function(){return new dn},divideAt:function(t){var e=new X(this.start,this.end),n=e.divideAt(t);return[n[1].isDifferentiable()?new Nt(n[0]):this.clone(),new Nt(n[1])]},divideAtLength:function(t){var e=new X(this.start,this.end),n=e.divideAtLength(t);return[n[1].isDifferentiable()?new Nt(n[0]):this.clone(),new Nt(n[1])]},getSubdivisions:function(){return[]},isDifferentiable:function(){return!this.previousSegment||!this.subpathStartSegment?!1:!this.start.equals(this.end)},round:function(){return this},scale:function(){return this},serialize:function(){return this.type},toString:function(){return this.type+" "+this.start+" "+this.end},translate:function(){return this}};Object.defineProperty(zi,"end",{configurable:!0,enumerable:!0,get:function(){if(!this.subpathStartSegment)throw new Error("Missing subpath start segment. (This segment needs a subpath start segment (e.g. Moveto); OR segment has not yet been added to a path.)");return this.subpathStartSegment.end}});Object.defineProperty(zi,"type",{configurable:!0,enumerable:!0,value:"Z"});dn.prototype=Vn(Ze,X.prototype,zi);var Nu=et.segmentTypes={L:Nt,C:Wt,M:Ge,Z:dn,z:dn};et.regexSupportedData=new RegExp("^[\\s\\d"+Object.keys(Nu).join("")+",.]*$");et.isDataSupported=function(t){return typeof t!="string"?!1:this.regexSupportedData.test(t)};const Iu={curveThroughPoints:function(t){return console.warn("deprecated"),new et(vt.throughPoints(t)).serialize()},getCurveControlPoints:function(t){console.warn("deprecated");var e=[],n=[],r=t.length-1,i;if(r==1)return e[0]=new E((2*t[0].x+t[1].x)/3,(2*t[0].y+t[1].y)/3),n[0]=new E(2*e[0].x-t[0].x,2*e[0].y-t[0].y),[e,n];var s=[];for(i=1;i<r-1;i++)s[i]=4*t[i].x+2*t[i+1].x;s[0]=t[0].x+2*t[1].x,s[r-1]=(8*t[r-1].x+t[r].x)/2;var o=this.getFirstControlPoints(s);for(i=1;i<r-1;++i)s[i]=4*t[i].y+2*t[i+1].y;s[0]=t[0].y+2*t[1].y,s[r-1]=(8*t[r-1].y+t[r].y)/2;var a=this.getFirstControlPoints(s);for(i=0;i<r;i++)e.push(new E(o[i],a[i])),i<r-1?n.push(new E(2*t[i+1].x-o[i+1],2*t[i+1].y-a[i+1])):n.push(new E((t[r].x+o[r-1])/2,(t[r].y+a[r-1])/2));return[e,n]},getCurveDivider:function(t,e,n,r){console.warn("deprecated");var i=new vt(t,e,n,r);return function(o){var a=i.divide(o);return[{p0:a[0].start,p1:a[0].controlPoint1,p2:a[0].controlPoint2,p3:a[0].end},{p0:a[1].start,p1:a[1].controlPoint1,p2:a[1].controlPoint2,p3:a[1].end}]}},getFirstControlPoints:function(t){console.warn("deprecated");var e=t.length,n=[],r=[],i=2;n[0]=t[0]/i;for(var s=1;s<e;s++)r[s]=1/i,i=(s<e-1?4:3.5)-r[s],n[s]=(t[s]-n[s-1])/i;for(s=1;s<e;s++)n[e-s-1]-=r[e-s]*n[e-s];return n},getInversionSolver:function(t,e,n,r){console.warn("deprecated");var i=new vt(t,e,n,r);return function(o){return i.closestPointT(o)}}},Ht=function(t){if(!(this instanceof Ht))return new Ht(t);if(typeof t=="string")return new Ht.parse(t);this.points=Array.isArray(t)?t.map(E):[]};Ht.parse=function(t){return new Ht(Jo(t))};Ht.fromRect=function(t){return new Ht([t.topLeft(),t.topRight(),t.bottomRight(),t.bottomLeft()])};Ht.prototype=Vn(St.prototype,{type:lt.Polygon,clone:function(){return new Ht(Ko(this.points))},convexHull:function(){return new Ht(Qo(this.points))},lengthPoints:function(){const{start:t,end:e,points:n}=this;return n.length<=1||t.equals(e)?n:[...n,t.clone()]}});function na(t,e,n,r){switch(t.type){case lt.Line:{switch(e.type){case lt.Line:return Ue(t,e)}break}case lt.Ellipse:{switch(e.type){case lt.Line:return Gi(t,e);case lt.Ellipse:return ra(t,e)}break}case lt.Rect:{switch(e.type){case lt.Line:return ia(t,e);case lt.Ellipse:return sa(t,e);case lt.Rect:return Ui(t,e)}break}case lt.Polyline:{switch(e.type){case lt.Line:return Ir(t,e);case lt.Ellipse:return $i(t,e);case lt.Rect:return oa(t,e);case lt.Polyline:return aa(t,e)}break}case lt.Polygon:{switch(e.type){case lt.Line:return Hi(t,e);case lt.Ellipse:return Rr(t,e);case lt.Rect:return ca(t,e);case lt.Polyline:return ua(t,e);case lt.Polygon:return la(t,e)}break}case lt.Path:{switch(e.type){case lt.Line:return fa(t,e,n);case lt.Ellipse:return ha(t,e,n);case lt.Rect:return da(t,e,n);case lt.Polyline:return qi(t,e,n);case lt.Polygon:return kr(t,e,n);case lt.Path:return ga(t,e,n,r)}break}}switch(e.type){case lt.Ellipse:case lt.Rect:case lt.Polyline:case lt.Polygon:case lt.Path:return na(e,t,r,n);default:throw Error(`The intersection for ${t} and ${e} could not be found.`)}}function Ue(t,e){const n=t.start.x,r=t.start.y,i=t.end.x,s=t.end.y,o=e.start.x,a=e.start.y,c=e.end.x,l=e.end.y,f=i-n,u=s-r,d=c-o,g=l-a,v=n-o,y=r-a,x=f*g-d*u,w=(f*y-u*v)/x,T=(d*y-g*v)/x;return w>=0&&w<=1&&T>=0&&T<=1}function Gi(t,e){const n=t.a,r=t.b,i=t.x,s=t.y,o=e.start.x-i,a=e.end.x-i,c=e.start.y-s,l=e.end.y-s,f=n*n,u=r*r,d=a-o,g=l-c,v=d*d/f+g*g/u,y=2*o*d/f+2*c*g/u,x=o*o/f+c*c/u-1,w=y*y-4*v*x;if(w===0){const T=-y/2/v;return T>=0&&T<=1}else if(w>0){const T=Math.sqrt(w),P=(-y+T)/2/v,M=(-y-T)/2/v;return P>=0&&P<=1||M>=0&&M<=1}return!1}function ra(t,e){return Ru(t,0,e,0)}function ia(t,e){const{start:n,end:r}=e,{x:i,y:s,width:o,height:a}=t;return n.x>i+o&&r.x>i+o||n.x<i&&r.x<i||n.y>s+a&&r.y>s+a||n.y<s&&r.y<s?!1:t.containsPoint(e.start)||t.containsPoint(e.end)?!0:Ue(t.topLine(),e)||Ue(t.rightLine(),e)||Ue(t.bottomLine(),e)||Ue(t.leftLine(),e)}function sa(t,e){return Ui(t,Y.fromEllipse(e))?Rr(Ht.fromRect(t),e):!1}function Ui(t,e){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}function Ir(t,e){return pa(t,e,{interior:!1})}function $i(t,e){return va(t,e,{interior:!1})}function oa(t,e){return ma(t,e,{interior:!1})}function aa(t,e){return Dr(t,e,{interior:!1})}function Hi(t,e){return pa(t,e,{interior:!0})}function Rr(t,e){return va(t,e,{interior:!0})}function ca(t,e){return ma(t,e,{interior:!0})}function ua(t,e){return Dr(t,e,{interior:!0})}function la(t,e){return Wi(t,e,{interior:!0})}function fa(t,e,n){return t.getSubpaths().some(r=>{const[i]=r.toPolylines(n),{type:s}=r.getSegment(-1);return s==="Z"?Hi(i,e):Ir(i,e)})}function ha(t,e,n){return t.getSubpaths().some(r=>{const[i]=r.toPolylines(n),{type:s}=r.getSegment(-1);return s==="Z"?Rr(i,e):$i(i,e)})}function da(t,e,n){return kr(t,Ht.fromRect(e),n)}function qi(t,e,n){return ya(t,e,n,{interior:!1})}function kr(t,e,n){return ya(t,e,n,{interior:!0})}function ga(t,e,n,r){return t.getSubpaths().some(i=>{const[s]=i.toPolylines(n),{type:o}=i.getSegment(-1);return o==="Z"?kr(e,s,r):qi(e,s,r)})}function pa(t,e,n={}){const{interior:r=!1}=n;let i;if(r){if(t.containsPoint(e.start))return!0;const{start:a,end:c,points:l}=t;i=c.equals(a)?l:[...l,a]}else i=t.points;const{length:s}=i,o=new X;for(let a=0;a<s-1;a++)if(o.start=i[a],o.end=i[a+1],Ue(e,o))return!0;return!1}function va(t,e,n={}){const{start:r,end:i,points:s}=t;if(e.containsPoint(r))return!0;let o;const{interior:a=!1}=n;if(a){if(t.containsPoint(e.center()))return!0;o=i.equals(r)?s:[...s,r]}else o=s;const{length:c}=o,l=new X;for(let f=0;f<c-1;f++)if(l.start=o[f],l.end=o[f+1],Gi(e,l))return!0;return!1}function ma(t,e,n){const r=Ht.fromRect(e);return Wi(t,r,n)}function ya(t,e,n,r){return t.getSubpaths().some(i=>{const[s]=i.toPolylines(n),{type:o}=i.getSegment(-1);return o==="Z"?Wi(e,s,r):Dr(e,s,r)})}function Dr(t,e,n={}){const{interior:r=!1}=n;let i;if(r){const{start:c}=e;if(t.containsPoint(c))return!0;i=t.clone().close()}else i=t;const s=e.points,{length:o}=s,a=new X;for(let c=0;c<o-1;c++)if(a.start=s[c],a.end=s[c+1],Ir(i,a))return!0;return!1}function Wi(t,e,n){return e.containsPoint(t.start)||Dr(t,e.clone().close(),n)}function Ru(t,e,n,r){const{cos:i,sin:s}=Math,o=s(e),a=i(e),c=s(r),l=i(r),f=o*o,u=a*a,d=o*a,g=c*c,v=l*l,y=c*l,x=t.a*t.a,w=t.b*t.b,T=n.a*n.a,P=n.b*n.b,M=x*f+w*u,I=T*g+P*v,D=x*u+w*f,h=T*v+P*g;let p=2*(w-x)*d,m=2*(P-T)*y,b=-2*M*t.x-p*t.y,S=-2*I*n.x-m*n.y,O=-p*t.x-2*D*t.y,N=-m*n.x-2*h*n.y;const F=M*t.x*t.x+D*t.y*t.y+p*t.x*t.y-x*w,q=I*n.x*n.x+h*n.y*n.y+m*n.x*n.y-T*P;p=p/2,m=m/2,b=b/2,S=S/2,O=O/2,N=N/2;const A=Ae([[M,p,b],[p,D,O],[b,O,F]]),C=Ae([[I,m,S],[m,h,N],[S,N,q]]),_=.33333333*(Ae([[I,p,b],[m,D,O],[S,O,F]])+Ae([[M,m,b],[p,h,O],[b,N,F]])+Ae([[M,p,S],[p,D,N],[b,O,q]])),L=.33333333*(Ae([[M,m,S],[p,h,N],[b,N,q]])+Ae([[I,p,S],[m,D,N],[S,O,q]])+Ae([[I,m,b],[m,h,O],[S,N,F]])),ct=tr([[A,_],[_,L]]),ot=tr([[A,L],[_,C]]),bt=tr([[_,L],[L,C]]);return!(tr([[2*ct,ot],[ot,2*bt]])>0&&(L>0||_>0))}function tr(t){return t[0][0]*t[1][1]-t[0][1]*t[1][0]}function Ae(t){return t[0][0]*t[1][1]*t[2][2]-t[0][0]*t[1][2]*t[2][1]-t[0][1]*t[1][0]*t[2][2]+t[0][1]*t[1][2]*t[2][0]+t[0][2]*t[1][0]*t[2][1]-t[0][2]*t[1][1]*t[2][0]}const ku=Object.freeze(Object.defineProperty({__proto__:null,ellipseWithEllipse:ra,ellipseWithLine:Gi,exists:na,lineWithLine:Ue,pathWithEllipse:ha,pathWithLine:fa,pathWithPath:ga,pathWithPolygon:kr,pathWithPolyline:qi,pathWithRect:da,polygonWithEllipse:Rr,polygonWithLine:Hi,polygonWithPolygon:la,polygonWithPolyline:ua,polygonWithRect:ca,polylineWithEllipse:$i,polylineWithLine:Ir,polylineWithPolyline:aa,polylineWithRect:oa,rectWithEllipse:sa,rectWithLine:ia,rectWithRect:Ui},Symbol.toStringTag,{value:"Module"})),$e=ku,Du=Object.freeze(Object.defineProperty({__proto__:null,Curve:vt,Ellipse:Vt,Line:X,Path:et,Point:E,Polygon:Ht,Polyline:St,Rect:Y,bezier:Iu,ellipse:Pu,intersection:$e,line:qe,normalizeAngle:Qt,point:Ar,random:yi,rect:Mu,scale:wu,snapToGrid:je,toDeg:Nr,toRad:$t,types:lt},Symbol.toStringTag,{value:"Module"})),z=function(){var t=typeof window=="object"&&!!window.SVGAngle;if(!t)return function(){throw new Error("SVG is required to use Vectorizer.")};var e={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns/",xml:"http://www.w3.org/XML/1998/namespace",xlink:"http://www.w3.org/1999/xlink",xhtml:"http://www.w3.org/1999/xhtml"},n="1.1",r=Math,i=r.PI,s=r.atan2,o=r.sqrt,a=r.min,c=r.max,l=r.cos,f=r.sin,u=function(h,p,m){if(!(this instanceof u))return u.apply(Object.create(u.prototype),arguments);if(h){if(u.isV(h)&&(h=h.node),p=p||{},u.isString(h)){if(h=h.trim(),h.toLowerCase()==="svg")h=u.createSvgDocument();else if(h[0]==="<"){var b=u.createSvgDocument(h);if(b.childNodes.length>1){var S=[],O,N;for(O=0,N=b.childNodes.length;O<N;O++){var F=b.childNodes[O];S.push(new u(document.importNode(F,!0)))}return S}h=document.importNode(b.firstChild,!0)}else h=document.createElementNS(e.svg,h);u.ensureId(h)}return this.node=h,this.setAttributes(p),m&&this.append(m),this}},d=u.prototype;Object.defineProperty(d,"id",{enumerable:!0,get:function(){return this.node.id},set:function(h){this.node.id=h}}),d.getTransformToElement=function(h){var p=this.node;if(u.isSVGGraphicsElement(h)&&u.isSVGGraphicsElement(p)){var m=u.toNode(h).getScreenCTM(),b=p.getScreenCTM();if(m&&b)return m.inverse().multiply(b)}return u.createSVGMatrix()},d.transform=function(h,p){var m=this.node;if(u.isUndefined(h))return u.transformStringToMatrix(this.attr("transform"));if(p&&p.absolute)return this.attr("transform",u.matrixToTransformString(h));var b=u.createSVGTransform(h);return m.transform.baseVal.appendItem(b),this},d.translate=function(h,p,m){m=m||{},p=p||0;var b=this.attr("transform")||"",S=u.parseTransformString(b);if(b=S.value,u.isUndefined(h))return S.translate;b=b.replace(/translate\([^)]*\)/g,"").trim();var O=m.absolute?h:S.translate.tx+h,N=m.absolute?p:S.translate.ty+p,F="translate("+O+","+N+")";return this.attr("transform",(F+" "+b).trim()),this},d.rotate=function(h,p,m,b){b=b||{};var S=this.attr("transform")||"",O=u.parseTransformString(S);if(S=O.value,u.isUndefined(h))return O.rotate;S=S.replace(/rotate\([^)]*\)/g,"").trim(),h%=360;var N=b.absolute?h:O.rotate.angle+h,F=p!==void 0&&m!==void 0?","+p+","+m:"",q="rotate("+N+F+")";return this.attr("transform",(S+" "+q).trim()),this},d.scale=function(h,p){p=u.isUndefined(p)?h:p;var m=this.attr("transform")||"",b=u.parseTransformString(m);if(m=b.value,u.isUndefined(h))return b.scale;m=m.replace(/scale\([^)]*\)/g,"").trim();var S="scale("+h+","+p+")";return this.attr("transform",(m+" "+S).trim()),this},d.bbox=function(h,p){var m,b=this.node,S=b.ownerSVGElement;if(!S)return new Y(0,0,0,0);try{m=b.getBBox()}catch{m={x:b.clientLeft,y:b.clientTop,width:b.clientWidth,height:b.clientHeight}}if(h)return new Y(m);var O=this.getTransformToElement(p||S);return u.transformRect(m,O)},d.getBBox=function(h){var p={},m,b=this.node,S=b.ownerSVGElement;if(!S||!u.isSVGGraphicsElement(b))return new Y(0,0,0,0);if(h&&(h.target&&(p.target=u.toNode(h.target)),h.recursive&&(p.recursive=h.recursive)),p.recursive){var N=this.children(),F=N.length;if(F===0)return this.getBBox({target:p.target,recursive:!1});p.target||(p.target=this);for(var q=0;q<F;q++){var A=N[q],C;A.children().length===0?C=A.getBBox({target:p.target,recursive:!1}):C=A.getBBox({target:p.target,recursive:!0}),m?m=m.union(C):m=C}return m}else{try{m=b.getBBox()}catch{m={x:b.clientLeft,y:b.clientTop,width:b.clientWidth,height:b.clientHeight}}if(p.target){var O=this.getTransformToElement(p.target);return u.transformRect(m,O)}else return new Y(m)}};function g(h,p){h||(h={});var m=u("textPath"),b=h.d;if(b&&h["xlink:href"]===void 0){var S=u("path").attr("d",b).appendTo(p.defs());m.attr("xlink:href","#"+S.id)}return u.isObject(h)&&m.attr(h),m.node}function v(h,p,m){m||(m={});for(var b=m.includeAnnotationIndices,S=m.eol,O=m.lineHeight,N=m.baseSize,F=0,q={},A=p.length-1,C=0;C<=A;C++){var _=p[C],L=null;if(u.isObject(_)){var ct=_.attrs,ot=u("tspan",ct),bt=ot.node,wt=_.t;S&&C===A&&(wt+=S),bt.textContent=wt;var K=ct.class;K&&ot.addClass(K),b&&ot.attr("annotations",_.annotations),L=parseFloat(ct["font-size"]),isFinite(L)||(L=N),L&&L>F&&(F=L)}else S&&C===A&&(_+=S),bt=document.createTextNode(_||" "),N&&N>F&&(F=N);h.appendChild(bt)}return F&&(q.maxFontSize=F),O?q.lineHeight=O:F&&(q.lineHeight=F*1.2),q}var y=/em$/;function x(h,p){var m=parseFloat(h);return y.test(h)?m*p:m}function w(h,p,m,b){if(!Array.isArray(p))return 0;var S=p.length;if(!S)return 0;for(var O=p[0],N=x(O.maxFontSize,m)||m,F=0,q=x(b,m),A=1;A<S;A++){O=p[A];var C=x(O.lineHeight,m)||q;F+=C}var _=x(O.maxFontSize,m)||m,L;switch(h){case"middle":L=N/2-.15*_-F/2;break;case"bottom":L=-(.25*_)-F;break;case"top":default:L=.8*N;break}return L}d.text=function(h,p){if(h&&typeof h!="string")throw new Error("Vectorizer: text() expects the first argument to be a string.");h=u.sanitizeText(h),p||(p={});var m=p.displayEmpty,b=p.eol,S=p.textPath,O=p.textVerticalAnchor,N=O==="middle"||O==="bottom"||O==="top",F=p.x;F===void 0&&(F=this.attr("x")||0);var q=p.includeAnnotationIndices,A=p.annotations;A&&!u.isArray(A)&&(A=[A]);var C=p.lineHeight,_=C==="auto",L=_?"1.5em":C||"1em";this.empty(),this.attr({"xml:space":"preserve",display:h||m?null:"none"});var ct=parseFloat(this.attr("font-size"));ct||(ct=16,(N||A)&&this.attr("font-size",ct));var ot=document,bt;S?(typeof S=="string"&&(S={d:S}),bt=g(S,this)):bt=ot.createDocumentFragment();for(var wt=0,K=h.split(`
`),nt=[],st,rt=0,U=K.length-1;rt<=U;rt++){var k=L,$="v-line",W=ot.createElementNS(e.svg,"tspan"),at=K[rt],Q;if(at)if(A){var tt=u.annotateString(at,A,{offset:-wt,includeAnnotationIndices:q});Q=v(W,tt,{includeAnnotationIndices:q,eol:rt!==U&&b,lineHeight:_?null:L,baseSize:ct});var ut=Q.lineHeight;ut&&_&&rt!==0&&(k=ut),rt===0&&(st=Q.maxFontSize*.8)}else b&&rt!==U&&(at+=b),W.textContent=at;else{W.textContent="-",$+=" v-empty-line";var Z=W.style;if(Z.fillOpacity=0,Z.strokeOpacity=0,A){Q={},tt=u.findAnnotationsAtIndex(A,wt);let V=ct;for(let B=tt.length;B>0;B--){const it=tt[B-1].attrs;if(!it||!("font-size"in it))continue;const At=parseFloat(it["font-size"]);if(isFinite(At)){V=At;break}}_&&(rt>0?k=V*1.2:st=V*.8),W.setAttribute("font-size",V),Q.maxFontSize=V}}Q&&nt.push(Q),rt>0&&W.setAttribute("dy",k),(rt>0||S)&&W.setAttribute("x",F),W.className.baseVal=$,bt.appendChild(W),wt+=at.length+1}if(N)if(A)k=w(O,nt,ct,L);else if(O==="top")k="0.8em";else{var R;switch(U>0?(R=parseFloat(L)||1,R*=U,y.test(L)||(R/=ct)):R=0,O){case"middle":k=.3-R/2+"em";break;case"bottom":k=-R-.3+"em";break}}else O===0?k="0em":O?k=O:(k=0,this.attr("y")===null&&this.attr("y",st||"0.8em"));return bt.firstChild.setAttribute("dy",k),this.append(bt),this},d.removeAttr=function(h){const p=I[h],{ns:m,local:b}=u.qualifyAttr(p),S=this.node;return m?S.hasAttributeNS(m,b)&&S.removeAttributeNS(m,b):S.hasAttribute(p)&&S.removeAttribute(p),this},d.attr=function(h,p){if(u.isUndefined(h)){for(var m=this.node.attributes,b={},S=0;S<m.length;S++)b[m[S].name]=m[S].value;return b}if(u.isString(h)&&u.isUndefined(p))return this.node.getAttribute(I[h]);if(typeof h=="object")for(var O in h)h.hasOwnProperty(O)&&this.setAttribute(O,h[O]);else this.setAttribute(h,p);return this},d.normalizePath=function(){var h=this.tagName();return h==="PATH"&&this.attr("d",u.normalizePathData(this.attr("d"))),this},d.remove=function(){return this.node.parentNode&&this.node.parentNode.removeChild(this.node),this},d.empty=function(){for(;this.node.firstChild;)this.node.removeChild(this.node.firstChild);return this},d.setAttributes=function(h){for(var p in h)h.hasOwnProperty(p)&&this.setAttribute(p,h[p]);return this},d.append=function(h){u.isArray(h)||(h=[h]);for(var p=0,m=h.length;p<m;p++)this.node.appendChild(u.toNode(h[p]));return this},d.prepend=function(h){var p=this.node.firstChild;return p?u(p).before(h):this.append(h)},d.before=function(h){var p=this.node,m=p.parentNode;if(m){u.isArray(h)||(h=[h]);for(var b=0,S=h.length;b<S;b++)m.insertBefore(u.toNode(h[b]),p)}return this},d.appendTo=function(h){return u.toNode(h).appendChild(this.node),this},d.svg=function(){return this.node instanceof window.SVGSVGElement?this:u(this.node.ownerSVGElement)},d.tagName=function(){return this.node.tagName.toUpperCase()},d.defs=function(){var h=this.svg()||this,p=h.node.getElementsByTagName("defs")[0];return p?u(p):u("defs").appendTo(h)},d.clone=function(){var h=u(this.node.cloneNode(!0));return h.node.id=u.uniqueId(),h},d.findOne=function(h){var p=this.node.querySelector(h);return p?u(p):void 0},d.find=function(h){var p=[],m=this.node.querySelectorAll(h);if(m)for(var b=0;b<m.length;b++)p.push(u(m[b]));return p},d.children=function(){for(var h=this.node.childNodes,p=[],m=0;m<h.length;m++){var b=h[m];b.nodeType===1&&p.push(u(h[m]))}return p},d.parent=function(){return u(this.node.parentNode)||null},d.index=function(){for(var h=0,p=this.node.previousSibling;p;)p.nodeType===1&&h++,p=p.previousSibling;return h},d.findParentByClass=function(h,p){for(var m=this.node.ownerSVGElement,b=this.node.parentNode;b&&b!==p&&b!==m;){var S=u(b);if(S.hasClass(h))return S;b=b.parentNode}return null},d.contains=function(h){var p=this.node,m=u.toNode(h),b=m&&m.parentNode;return p===b||!!(b&&b.nodeType===1&&p.compareDocumentPosition(b)&16)},d.toLocalPoint=function(h,p){var m=this.svg().node,b=m.createSVGPoint();b.x=h,b.y=p;try{var S=b.matrixTransform(m.getScreenCTM().inverse()),O=this.getTransformToElement(m).inverse()}catch{return b}return S.matrixTransform(O)},d.translateCenterToPoint=function(h){var p=this.getBBox({target:this.svg()}),m=p.center();return this.translate(h.x-m.x,h.y-m.y),this},d.translateAndAutoOrient=function(h,p,m){h=new E(h),p=new E(p),m||(m=this.svg());var b=this.scale();this.attr("transform","");var S=this.getBBox({target:m}).scale(b.sx,b.sy),O=u.createSVGTransform();O.setTranslate(-S.x-S.width/2,-S.y-S.height/2);var N=u.createSVGTransform(),F=h.angleBetween(p,h.clone().offset(1,0));F&&N.setRotate(F,0,0);var q=u.createSVGTransform(),A=h.clone().move(p,S.width/2);q.setTranslate(2*h.x-A.x,2*h.y-A.y);var C=this.getTransformToElement(m),_=u.createSVGTransform();return _.setMatrix(q.matrix.multiply(N.matrix.multiply(O.matrix.multiply(C.scale(b.sx,b.sy))))),this.attr("transform",u.matrixToTransformString(_.matrix)),this},d.animateAlongPath=function(h,p){p=u.toNode(p);var m=u.ensureId(p),b=u("animateMotion",h),S=u("mpath",{"xlink:href":"#"+m});b.append(S),this.append(b);try{b.node.beginElement()}catch{if(document.documentElement.getAttribute("smiling")==="fake"){var O=b.node;O.animators=[];var N=O.getAttribute("id");N&&(id2anim[N]=O);for(var F=getTargets(O),q=0,A=F.length;q<A;q++){var C=F[q],_=new Animator(O,C,q);animators.push(_),O.animators[q]=_,_.register()}}}return this};const T=/[^\x20\t\r\n\f]+/g;function P(h){return u.isString(h)?h.trim().match(T)||[]:[]}d.hasClass=function(h){return u.isString(h)?this.node.classList.contains(h.trim()):!1},d.addClass=function(h){return this.node.classList.add(...P(h)),this},d.removeClass=function(h){return this.node.classList.remove(...P(h)),this},d.toggleClass=function(h,p){const m=P(h);for(let b=0;b<m.length;b++)this.node.classList.toggle(m[b],p);return this},d.sample=function(h){h=h||1;for(var p=this.node,m=p.getTotalLength(),b=[],S=0,O;S<m;)O=p.getPointAtLength(S),b.push({x:O.x,y:O.y,distance:S}),S+=h;return b},d.convertToPath=function(){var h=u("path");h.attr(this.attr());var p=this.convertToPathData();return p&&h.attr("d",p),h},d.convertToPathData=function(){var h=this.tagName();switch(h){case"PATH":return this.attr("d");case"LINE":return u.convertLineToPathData(this.node);case"POLYGON":return u.convertPolygonToPathData(this.node);case"POLYLINE":return u.convertPolylineToPathData(this.node);case"ELLIPSE":return u.convertEllipseToPathData(this.node);case"CIRCLE":return u.convertCircleToPathData(this.node);case"RECT":return u.convertRectToPathData(this.node)}throw new Error(h+" cannot be converted to PATH.")},u.prototype.toGeometryShape=function(){var h,p,m,b,S,O,N,F,q,A,C,_,L,ct,ot;switch(this.tagName()){case"RECT":return h=parseFloat(this.attr("x"))||0,p=parseFloat(this.attr("y"))||0,m=parseFloat(this.attr("width"))||0,b=parseFloat(this.attr("height"))||0,new Y(h,p,m,b);case"CIRCLE":return S=parseFloat(this.attr("cx"))||0,O=parseFloat(this.attr("cy"))||0,N=parseFloat(this.attr("r"))||0,new Vt({x:S,y:O},N,N);case"ELLIPSE":return S=parseFloat(this.attr("cx"))||0,O=parseFloat(this.attr("cy"))||0,F=parseFloat(this.attr("rx"))||0,q=parseFloat(this.attr("ry"))||0,new Vt({x:S,y:O},F,q);case"POLYLINE":return A=u.getPointsFromSvgNode(this),new St(A);case"POLYGON":return A=u.getPointsFromSvgNode(this),A.length>1&&A.push(A[0]),new St(A);case"PATH":return C=this.attr("d"),et.isDataSupported(C)||(C=u.normalizePathData(C)),new et(C);case"LINE":return _=parseFloat(this.attr("x1"))||0,ct=parseFloat(this.attr("y1"))||0,L=parseFloat(this.attr("x2"))||0,ot=parseFloat(this.attr("y2"))||0,new X({x:_,y:ct},{x:L,y:ot})}return this.getBBox()},d.findIntersection=function(h,p){var m=this.svg().node;p=p||m;var b=this.getBBox({target:p}),S=b.center();if(b.intersectionWithLineFromCenterToPoint(h)){var O,N=this.tagName();if(N==="RECT"){var F=new Y(parseFloat(this.attr("x")||0),parseFloat(this.attr("y")||0),parseFloat(this.attr("width")),parseFloat(this.attr("height"))),q=this.getTransformToElement(p),A=u.decomposeMatrix(q),C=m.createSVGTransform();C.setRotate(-A.rotation,S.x,S.y);var _=u.transformRect(F,C.matrix.multiply(q));O=new Y(_).intersectionWithLineFromCenterToPoint(h,A.rotation)}else if(N==="PATH"||N==="POLYGON"||N==="POLYLINE"||N==="CIRCLE"||N==="ELLIPSE"){var L=N==="PATH"?this:this.convertToPath(),ct=L.sample(),ot=1/0,bt=[],wt,K,nt,st,rt,U;for(wt=0;wt<ct.length;wt++)K=ct[wt],nt=u.createSVGPoint(K.x,K.y),nt=nt.matrixTransform(this.getTransformToElement(p)),K=new E(nt),st=K.distance(S),rt=K.distance(h)*1.1,U=st+rt,U<ot?(ot=U,bt=[{sample:K,refDistance:rt}]):U<ot+1&&bt.push({sample:K,refDistance:rt});bt.sort(function(k,$){return k.refDistance-$.refDistance}),bt[0]&&(O=bt[0].sample)}return O}},d.setAttribute=function(h,p){const m=this.node;if(p===null)return this.removeAttr(h),this;const b=I[h],{ns:S}=u.qualifyAttr(b);return S?m.setAttributeNS(S,b,p):b==="id"?m.id=p:m.setAttribute(b,p),this},u.createSvgDocument=function(h){if(h){const m=`<svg xmlns="${e.svg}" xmlns:xlink="${e.xlink}" version="${n}">${h}</svg>`,{documentElement:b}=u.parseXML(m,{async:!1});return b}const p=document.createElementNS(e.svg,"svg");return p.setAttributeNS(e.xmlns,"xmlns:xlink",e.xlink),p.setAttribute("version",n),p},u.createSVGStyle=function(h){const{node:p}=u("style",{type:"text/css"},[u.createCDATASection(h)]);return p},u.createCDATASection=function(h=""){return document.implementation.createDocument(null,"xml",null).createCDATASection(h)},u.idCounter=0,u.uniqueId=function(){return"v-"+ ++u.idCounter},u.toNode=function(h){return u.isV(h)?h.node:h.nodeName&&h||h[0]},u.ensureId=function(h){return h=u.toNode(h),h.id||(h.id=u.uniqueId())},u.sanitizeText=function(h){return(h||"").replace(/ /g,"")},u.isUndefined=function(h){return typeof h>"u"},u.isString=function(h){return typeof h=="string"},u.isObject=function(h){return h&&typeof h=="object"},u.isArray=Array.isArray,u.parseXML=function(h,p){p=p||{};var m;try{var b=new DOMParser;u.isUndefined(p.async)||(b.async=p.async),m=b.parseFromString(h,"text/xml")}catch{m=void 0}if(!m||m.getElementsByTagName("parsererror").length)throw new Error("Invalid XML: "+h);return m};const M=Object.create(null);["baseFrequency","baseProfile","clipPathUnits","contentScriptType","contentStyleType","diffuseConstant","edgeMode","externalResourcesRequired","filterRes","filterUnits","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","requiredExtensions","requiredFeatures","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].forEach(h=>M[h]=h),M.xlinkShow="xlink:show",M.xlinkRole="xlink:role",M.xlinkActuate="xlink:actuate",M.xlinkHref="xlink:href",M.xlinkType="xlink:type",M.xlinkTitle="xlink:title",M.xmlBase="xml:base",M.xmlLang="xml:lang",M.xmlSpace="xml:space";const I=new Proxy(M,{get(h,p){return u.supportCamelCaseAttributes?p in h?h[p]:h[p]=p.replace(/[A-Z]/g,"-$&").toLowerCase():p}});Object.defineProperty(u,"attributeNames",{enumerable:!0,value:I,writable:!1}),Object.defineProperty(u,"supportCamelCaseAttributes",{enumerable:!0,value:!0,writable:!0}),u.qualifyAttr=function(h){if(h.indexOf(":")!==-1){var p=h.split(":");return{ns:e[p[0]],local:p[1]}}return{ns:null,local:h}},u.transformSeparatorRegex=/[ ,]+/,u.transformRegex=/\b\w+\([^()]+\)/g,u.transformFunctionRegex=/\b(\w+)\(([^()]+)\)/,u.transformTranslateRegex=/\btranslate\(([^()]+)\)/,u.transformRotateRegex=/\brotate\(([^()]+)\)/,u.transformScaleRegex=/\bscale\(([^()]+)\)/,u.transformStringToMatrix=function(h){let p=u.createSVGMatrix();const m=h&&h.match(u.transformRegex);if(!m)return p;const b=m.length;for(let S=0;S<b;S++){const N=m[S].match(u.transformFunctionRegex);if(N){let F,q,A,C,_,L=u.createSVGMatrix();const ct=N[1].toLowerCase(),ot=N[2].split(u.transformSeparatorRegex);switch(ct){case"scale":F=parseFloat(ot[0]),q=ot[1]===void 0?F:parseFloat(ot[1]),L=L.scaleNonUniform(F,q);break;case"translate":A=parseFloat(ot[0]),C=parseFloat(ot[1]),L=L.translate(A,C);break;case"rotate":_=parseFloat(ot[0]),A=parseFloat(ot[1])||0,C=parseFloat(ot[2])||0,A!==0||C!==0?L=L.translate(A,C).rotate(_).translate(-A,-C):L=L.rotate(_);break;case"skewx":_=parseFloat(ot[0]),L=L.skewX(_);break;case"skewy":_=parseFloat(ot[0]),L=L.skewY(_);break;case"matrix":L.a=parseFloat(ot[0]),L.b=parseFloat(ot[1]),L.c=parseFloat(ot[2]),L.d=parseFloat(ot[3]),L.e=parseFloat(ot[4]),L.f=parseFloat(ot[5]);break;default:continue}p=p.multiply(L)}}return p},u.matrixToTransformString=function(h){return h||(h=!0),"matrix("+(h.a!==void 0?h.a:1)+","+(h.b!==void 0?h.b:0)+","+(h.c!==void 0?h.c:0)+","+(h.d!==void 0?h.d:1)+","+(h.e!==void 0?h.e:0)+","+(h.f!==void 0?h.f:0)+")"},u.parseTransformString=function(h){var p,m,b;if(h){var S=u.transformSeparatorRegex;if(h.trim().indexOf("matrix")>=0){var O=u.transformStringToMatrix(h),N=u.decomposeMatrix(O);p=[N.translateX,N.translateY],b=[N.scaleX,N.scaleY],m=[N.rotation];var F=[];(p[0]!==0||p[1]!==0)&&F.push("translate("+p+")"),(b[0]!==1||b[1]!==1)&&F.push("scale("+b+")"),m[0]!==0&&F.push("rotate("+m+")"),h=F.join(" ")}else{const A=h.match(u.transformTranslateRegex);A&&(p=A[1].split(S));const C=h.match(u.transformRotateRegex);C&&(m=C[1].split(S));const _=h.match(u.transformScaleRegex);_&&(b=_[1].split(S))}}var q=b&&b[0]?parseFloat(b[0]):1;return{value:h,translate:{tx:p&&p[0]?parseInt(p[0],10):0,ty:p&&p[1]?parseInt(p[1],10):0},rotate:{angle:m&&m[0]?parseInt(m[0],10):0,cx:m&&m[1]?parseInt(m[1],10):void 0,cy:m&&m[2]?parseInt(m[2],10):void 0},scale:{sx:q,sy:b&&b[1]?parseFloat(b[1]):q}}},u.deltaTransformPoint=function(h,p){var m=p.x*h.a+p.y*h.c+0,b=p.x*h.b+p.y*h.d+0;return{x:m,y:b}},u.decomposeMatrix=function(h){var p=u.deltaTransformPoint(h,{x:0,y:1}),m=u.deltaTransformPoint(h,{x:1,y:0}),b=180/i*s(p.y,p.x)-90,S=180/i*s(m.y,m.x);return{translateX:h.e,translateY:h.f,scaleX:o(h.a*h.a+h.b*h.b),scaleY:o(h.c*h.c+h.d*h.d),skewX:b,skewY:S,rotation:b}},u.matrixToScale=function(h){var p,m,b,S;return h?(p=u.isUndefined(h.a)?1:h.a,S=u.isUndefined(h.d)?1:h.d,m=h.b,b=h.c):p=S=1,{sx:m?o(p*p+m*m):p,sy:b?o(b*b+S*S):S}},u.matrixToRotate=function(h){var p={x:0,y:1};return h&&(p=u.deltaTransformPoint(h,p)),{angle:Qt(Nr(s(p.y,p.x))-90)}},u.matrixToTranslate=function(h){return{tx:h&&h.e||0,ty:h&&h.f||0}},u.isV=function(h){return h instanceof u},u.isVElement=u.isV,u.isSVGGraphicsElement=function(h){return h?(h=u.toNode(h),h instanceof SVGElement&&typeof h.getScreenCTM=="function"):!1};var D=u("svg").node;return u.createSVGMatrix=function(h){var p=D.createSVGMatrix();for(var m in h)p[m]=h[m];return p},u.createSVGTransform=function(h){return u.isUndefined(h)?D.createSVGTransform():(h instanceof SVGMatrix||(h=u.createSVGMatrix(h)),D.createSVGTransformFromMatrix(h))},u.createSVGPoint=function(h,p){var m=D.createSVGPoint();return m.x=h,m.y=p,m},u.transformRect=function(h,p){var m=D.createSVGPoint();m.x=h.x,m.y=h.y;var b=m.matrixTransform(p);m.x=h.x+h.width,m.y=h.y;var S=m.matrixTransform(p);m.x=h.x+h.width,m.y=h.y+h.height;var O=m.matrixTransform(p);m.x=h.x,m.y=h.y+h.height;var N=m.matrixTransform(p),F=a(b.x,S.x,O.x,N.x),q=c(b.x,S.x,O.x,N.x),A=a(b.y,S.y,O.y,N.y),C=c(b.y,S.y,O.y,N.y);return new Y(F,A,q-F,C-A)},u.transformPoint=function(h,p){return new E(u.createSVGPoint(h.x,h.y).matrixTransform(p))},u.transformLine=function(h,p){return new X(u.transformPoint(h.start,p),u.transformPoint(h.end,p))},u.transformPolyline=function(h,p){var m=h instanceof St?h.points:h;u.isArray(m)||(m=[]);for(var b=[],S=0,O=m.length;S<O;S++)b[S]=u.transformPoint(m[S],p);return new St(b)},u.styleToObject=function(h){for(var p={},m=h.split(";"),b=0;b<m.length;b++){var S=m[b],O=S.split("=");p[O[0].trim()]=O[1].trim()}return p},u.createSlicePathData=function(h,p,m,b){var S=2*i-1e-6,O=h,N=p,F=m,q=b,A=(q<F&&(A=F,F=q,q=A),q-F),C=A<i?"0":"1",_=l(F),L=f(F),ct=l(q),ot=f(q);return A>=S?O?"M0,"+N+"A"+N+","+N+" 0 1,1 0,"+-N+"A"+N+","+N+" 0 1,1 0,"+N+"M0,"+O+"A"+O+","+O+" 0 1,0 0,"+-O+"A"+O+","+O+" 0 1,0 0,"+O+"Z":"M0,"+N+"A"+N+","+N+" 0 1,1 0,"+-N+"A"+N+","+N+" 0 1,1 0,"+N+"Z":O?"M"+N*_+","+N*L+"A"+N+","+N+" 0 "+C+",1 "+N*ct+","+N*ot+"L"+O*ct+","+O*ot+"A"+O+","+O+" 0 "+C+",0 "+O*_+","+O*L+"Z":"M"+N*_+","+N*L+"A"+N+","+N+" 0 "+C+",1 "+N*ct+","+N*ot+"L0,0Z"},u.mergeAttrs=function(h,p){for(var m in p)m==="class"?h[m]=h[m]?h[m]+" "+p[m]:p[m]:m==="style"?u.isObject(h[m])&&u.isObject(p[m])?h[m]=u.mergeAttrs(h[m],p[m]):u.isObject(h[m])?h[m]=u.mergeAttrs(h[m],u.styleToObject(p[m])):u.isObject(p[m])?h[m]=u.mergeAttrs(u.styleToObject(h[m]),p[m]):h[m]=u.mergeAttrs(u.styleToObject(h[m]),u.styleToObject(p[m])):h[m]=p[m];return h},u.annotateString=function(h,p,m){p=p||[],m=m||{};for(var b=m.offset||0,S=[],O,N=[],F,q,A=0;A<h.length;A++){F=N[A]=h[A];for(var C=0;C<p.length;C++){var _=p[C],L=_.start+b,ct=_.end+b;A>=L&&A<ct&&(u.isObject(F)?F.attrs=u.mergeAttrs(u.mergeAttrs({},F.attrs),_.attrs):F=N[A]={t:h[A],attrs:_.attrs},m.includeAnnotationIndices&&(F.annotations||(F.annotations=[])).push(C))}q=N[A-1],q?u.isObject(F)&&u.isObject(q)?JSON.stringify(F.attrs)===JSON.stringify(q.attrs)?O.t+=F.t:(S.push(O),O=F):u.isObject(F)||u.isObject(q)?(S.push(O),O=F):O=(O||"")+F:O=F}return O&&S.push(O),S},u.findAnnotationsAtIndex=function(h,p){var m=[];return h&&h.forEach(function(b){b.start<p&&p<=b.end&&m.push(b)}),m},u.findAnnotationsBetweenIndexes=function(h,p,m){var b=[];return h&&h.forEach(function(S){(p>=S.start&&p<S.end||m>S.start&&m<=S.end||S.start>=p&&S.end<m)&&b.push(S)}),b},u.shiftAnnotations=function(h,p,m){return h&&h.forEach(function(b){b.start<p&&b.end>=p?b.end+=m:b.start>=p&&(b.start+=m,b.end+=m)}),h},u.convertLineToPathData=function(h){h=u(h);var p=["M",h.attr("x1"),h.attr("y1"),"L",h.attr("x2"),h.attr("y2")].join(" ");return p},u.convertPolygonToPathData=function(h){var p=u.getPointsFromSvgNode(h);return p.length===0?null:u.svgPointsToPath(p)+" Z"},u.convertPolylineToPathData=function(h){var p=u.getPointsFromSvgNode(h);return p.length===0?null:u.svgPointsToPath(p)},u.svgPointsToPath=function(h){for(var p=0,m=h.length;p<m;p++)h[p]=h[p].x+" "+h[p].y;return"M "+h.join(" L")},u.getPointsFromSvgNode=function(h){h=u.toNode(h);var p=[],m=h.points;if(m)for(var b=0,S=m.numberOfItems;b<S;b++)p.push(m.getItem(b));return p},u.KAPPA=.551784,u.convertCircleToPathData=function(h){h=u(h);var p=parseFloat(h.attr("cx"))||0,m=parseFloat(h.attr("cy"))||0,b=parseFloat(h.attr("r")),S=b*u.KAPPA,O=["M",p,m-b,"C",p+S,m-b,p+b,m-S,p+b,m,"C",p+b,m+S,p+S,m+b,p,m+b,"C",p-S,m+b,p-b,m+S,p-b,m,"C",p-b,m-S,p-S,m-b,p,m-b,"Z"].join(" ");return O},u.convertEllipseToPathData=function(h){h=u(h);var p=parseFloat(h.attr("cx"))||0,m=parseFloat(h.attr("cy"))||0,b=parseFloat(h.attr("rx")),S=parseFloat(h.attr("ry"))||b,O=b*u.KAPPA,N=S*u.KAPPA,F=["M",p,m-S,"C",p+O,m-S,p+b,m-N,p+b,m,"C",p+b,m+N,p+O,m+S,p,m+S,"C",p-O,m+S,p-b,m+N,p-b,m,"C",p-b,m-N,p-O,m-S,p,m-S,"Z"].join(" ");return F},u.convertRectToPathData=function(h){return h=u(h),u.rectToPath({x:parseFloat(h.attr("x"))||0,y:parseFloat(h.attr("y"))||0,width:parseFloat(h.attr("width"))||0,height:parseFloat(h.attr("height"))||0,rx:parseFloat(h.attr("rx"))||0,ry:parseFloat(h.attr("ry"))||0})},u.rectToPath=function(h){var p,m=h.x,b=h.y,S=h.width,O=h.height,N=a(h.rx||h["top-rx"]||0,S/2),F=a(h.rx||h["bottom-rx"]||0,S/2),q=a(h.ry||h["top-ry"]||0,O/2),A=a(h.ry||h["bottom-ry"]||0,O/2);return N||F||q||A?p=["M",m,b+q,"v",O-q-A,"a",F,A,0,0,0,F,A,"h",S-2*F,"a",F,A,0,0,0,F,-A,"v",-(O-A-q),"a",N,q,0,0,0,-N,-q,"h",-(S-2*N),"a",N,q,0,0,0,-N,q,"Z"]:p=["M",m,b,"H",m+S,"V",b+O,"H",m,"V",b,"Z"],p.join(" ")},u.normalizePathData=function(){var h=`	
\v\f\r \u2028\u2029`,p=new RegExp("([a-z])["+h+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+h+"]*,?["+h+"]*)+)","ig"),m=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+h+"]*,?["+h+"]*","ig"),b=Math,S=b.PI,O=b.sin,N=b.cos,F=b.tan,q=b.asin,A=b.sqrt,C=b.abs;function _(K,nt,st,rt,U,k){var $=.3333333333333333,W=2/3;return[$*K+W*st,$*nt+W*rt,$*U+W*st,$*k+W*rt,U,k]}function L(K,nt,st){var rt=K*N(st)-nt*O(st),U=K*O(st)+nt*N(st);return{x:rt,y:U}}function ct(K,nt,st,rt,U,k,$,W,at,Q){var tt=S*120/180,ut=S/180*(+U||0),Z=[],R;if(Q)Mt=Q[0],Et=Q[1],bn=Q[2],xn=Q[3];else{R=L(K,nt,-ut),K=R.x,nt=R.y,R=L(W,at,-ut),W=R.x,at=R.y;var V=(K-W)/2,B=(nt-at)/2,it=V*V/(st*st)+B*B/(rt*rt);it>1&&(it=A(it),st=it*st,rt=it*rt);var At=st*st,mt=rt*rt,Xr=(k==$?-1:1)*A(C((At*mt-At*B*B-mt*V*V)/(At*B*B+mt*V*V)));if(!Number.isFinite(Xr))return[K,nt,W,at,W,at];var bn=Xr*st*B/rt+(K+W)/2,xn=Xr*-rt*V/st+(nt+at)/2,Mt=q(((nt-xn)/rt).toFixed(9)),Et=q(((at-xn)/rt).toFixed(9));Mt=K<bn?S-Mt:Mt,Et=W<bn?S-Et:Et,Mt<0&&(Mt=S*2+Mt),Et<0&&(Et=S*2+Et),$&&Mt>Et&&(Mt=Mt-S*2),!$&&Et>Mt&&(Et=Et-S*2)}var Zr=Et-Mt;if(C(Zr)>tt){var uu=Et,lu=W,fu=at;Et=Mt+tt*($&&Et>Mt?1:-1),W=bn+st*N(Et),at=xn+rt*O(Et),Z=ct(W,at,st,rt,U,0,$,lu,fu,[Et,uu,bn,xn])}Zr=Et-Mt;var hu=N(Mt),du=O(Mt),gu=N(Et),pu=O(Et),Ss=F(Zr/4),As=4/3*(st*Ss),Ts=4/3*(rt*Ss),Es=[K,nt],tn=[K+As*du,nt-Ts*hu],Ps=[W+As*pu,at-Ts*gu],Cs=[W,at];if(tn[0]=2*Es[0]-tn[0],tn[1]=2*Es[1]-tn[1],Q)return[tn,Ps,Cs].concat(Z);Z=[tn,Ps,Cs].concat(Z).join().split(",");for(var _s=[],vu=Z.length,Se=0;Se<vu;Se++)_s[Se]=Se%2?L(Z[Se-1],Z[Se],ut).y:L(Z[Se],Z[Se+1],ut).x;return _s}function ot(K){if(!K)return null;var nt={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},st=[];return String(K).replace(p,function(rt,U,k){var $=[],W=U.toLowerCase();for(k.replace(m,function(at,Q){Q&&$.push(+Q)}),W==="m"&&$.length>2&&(st.push([U].concat($.splice(0,2))),W="l",U=U==="m"?"l":"L");$.length>=nt[W]&&(st.push([U].concat($.splice(0,nt[W]))),!!nt[W]););}),st}function bt(K){if((!Array.isArray(K)||!Array.isArray(K&&K[0]))&&(K=ot(K)),!K||!K.length)return[["M",0,0]];for(var nt=[],st=0,rt=0,U=0,k=0,$=0,W,at=K.length,Q=$;Q<at;Q++){var tt=[];nt.push(tt);var ut=K[Q];if(W=ut[0],W!=W.toUpperCase()){tt[0]=W.toUpperCase();var Z,R;switch(tt[0]){case"A":tt[1]=ut[1],tt[2]=ut[2],tt[3]=ut[3],tt[4]=ut[4],tt[5]=ut[5],tt[6]=+ut[6]+st,tt[7]=+ut[7]+rt;break;case"V":tt[1]=+ut[1]+rt;break;case"H":tt[1]=+ut[1]+st;break;case"M":for(U=+ut[1]+st,k=+ut[2]+rt,Z=ut.length,R=1;R<Z;R++)tt[R]=+ut[R]+(R%2?st:rt);break;default:for(Z=ut.length,R=1;R<Z;R++)tt[R]=+ut[R]+(R%2?st:rt);break}}else for(var V=ut.length,B=0;B<V;B++)tt[B]=ut[B];switch(tt[0]){case"Z":st=+U,rt=+k;break;case"H":st=tt[1];break;case"V":rt=tt[1];break;case"M":U=tt[tt.length-2],k=tt[tt.length-1],st=tt[tt.length-2],rt=tt[tt.length-1];break;default:st=tt[tt.length-2],rt=tt[tt.length-1];break}}return nt}function wt(K){var nt=bt(K),st={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null};function rt(Z,R,V){var B,it;if(!Z)return["C",R.x,R.y,R.x,R.y,R.x,R.y];switch(Z[0]in{T:1,Q:1}||(R.qx=null,R.qy=null),Z[0]){case"M":R.X=Z[1],R.Y=Z[2];break;case"A":parseFloat(Z[1])===0||parseFloat(Z[2])===0?Z=["L",Z[6],Z[7]]:Z=["C"].concat(ct.apply(0,[R.x,R.y].concat(Z.slice(1))));break;case"S":V==="C"||V==="S"?(B=R.x*2-R.bx,it=R.y*2-R.by):(B=R.x,it=R.y),Z=["C",B,it].concat(Z.slice(1));break;case"T":V==="Q"||V==="T"?(R.qx=R.x*2-R.qx,R.qy=R.y*2-R.qy):(R.qx=R.x,R.qy=R.y),Z=["C"].concat(_(R.x,R.y,R.qx,R.qy,Z[1],Z[2]));break;case"Q":R.qx=Z[1],R.qy=Z[2],Z=["C"].concat(_(R.x,R.y,Z[1],Z[2],Z[3],Z[4]));break;case"H":Z=["L"].concat(Z[1],R.y);break;case"V":Z=["L"].concat(R.x,Z[1]);break}return Z}function U(Z,R){if(Z[R].length>7){Z[R].shift();for(var V=Z[R];V.length;)k[R]="A",Z.splice(R++,0,["C"].concat(V.splice(0,6)));Z.splice(R,1),at=nt.length}}for(var k=[],$="",W="",at=nt.length,Q=0;Q<at;Q++){nt[Q]&&($=nt[Q][0]),$!=="C"&&(k[Q]=$,Q>0&&(W=k[Q-1])),nt[Q]=rt(nt[Q],st,W),k[Q]!=="A"&&$==="C"&&(k[Q]="C"),U(nt,Q);var tt=nt[Q],ut=tt.length;st.x=tt[ut-2],st.y=tt[ut-1],st.bx=parseFloat(tt[ut-4])||st.x,st.by=parseFloat(tt[ut-3])||st.y}return(!nt[0][0]||nt[0][0]!=="M")&&nt.unshift(["M",0,0]),nt}return function(K){return wt(K).join(",").split(",").join(" ")}}(),u.namespace=e,u.g=Du,u}(),Nn="[object Arguments]",wi="[object Array]",Br="[object Boolean]",ji="[object Date]",ba="[object Error]",Bu="[object Function]",zn="[object Map]",Fr="[object Number]",Fu="[object Null]",un="[object Object]",Yi="[object RegExp]",Gn="[object Set]",Vr="[object String]",zr="[object Symbol]",Vu="[object Undefined]",zu="[object WeakMap]",Xi="[object ArrayBuffer]",Zi="[object DataView]",xa="[object Float32Array]",wa="[object Float64Array]",Sa="[object Int8Array]",Aa="[object Int16Array]",Ta="[object Int32Array]",Ea="[object Uint8Array]",Pa="[object Uint8ClampedArray]",Ca="[object Uint16Array]",_a="[object Uint32Array]",Gu={[Nn]:!0,[wi]:!0,[Xi]:!0,[Zi]:!0,[Br]:!0,[ji]:!0,[xa]:!0,[wa]:!0,[Sa]:!0,[Aa]:!0,[Ta]:!0,[zn]:!0,[Fr]:!0,[un]:!0,[Yi]:!0,[Gn]:!0,[Vr]:!0,[zr]:!0,[Ea]:!0,[Pa]:!0,[Ca]:!0,[_a]:!0,[ba]:!1,[Bu]:!1,[zu]:!1},Ji="\\ud800-\\udfff",Uu="\\u0300-\\u036f",$u="\\ufe20-\\ufe2f",Hu="\\u20d0-\\u20ff",qu="\\u1ab0-\\u1aff",Wu="\\u1dc0-\\u1dff",ju=Uu+$u+Hu+qu+Wu,La="\\u2700-\\u27bf",Ma="a-z\\xdf-\\xf6\\xf8-\\xff",Yu="\\xac\\xb1\\xd7\\xf7",Xu="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Zu="\\u2000-\\u206f",Ju=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Oa="A-Z\\xc0-\\xd6\\xd8-\\xde",Ku="\\ufe0e\\ufe0f",Na=Yu+Xu+Zu+Ju,Ia="[']",Vs=`[${Na}]`,Ki=`[${ju}]`,Ra="\\d",Qu=`[${La}]`,ka=`[${Ma}]`,Da=`[^${Ji}${Na+Ra+La+Ma+Oa}]`,Si="\\ud83c[\\udffb-\\udfff]",tl=`(?:${Ki}|${Si})`,Ba=`[^${Ji}]`,Qi="(?:\\ud83c[\\udde6-\\uddff]){2}",ts="[\\ud800-\\udbff][\\udc00-\\udfff]",an=`[${Oa}]`,el="\\u200d",zs=`(?:${ka}|${Da})`,nl=`(?:${an}|${Da})`,Gs=`(?:${Ia}(?:d|ll|m|re|s|t|ve))?`,Us=`(?:${Ia}(?:D|LL|M|RE|S|T|VE))?`,Fa=`${tl}?`,Va=`[${Ku}]?`,rl=`(?:${el}(?:${[Ba,Qi,ts].join("|")})${Va+Fa})*`,il="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",sl="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",za=Va+Fa+rl,ol=`(?:${[Qu,Qi,ts].join("|")})${za}`,al=RegExp([`${an}?${ka}+${Gs}(?=${[Vs,an,"$"].join("|")})`,`${nl}+${Us}(?=${[Vs,an+zs,"$"].join("|")})`,`${an}?${zs}+${Gs}`,`${an}+${Us}`,sl,il,`${Ra}+`,ol].join("|"),"g"),es=200,Ai="__hash_undefined__",cl=/^\[object (?:Float(?:32|64)|(?:Int|Uint)(?:8|16|32)|Uint8Clamped)Array\]$/,ul=`[${Ji}]`,ll=`${Ba}${Ki}?`,fl=`(?:${[ll,Ki,Qi,ts,ul].join("|")})`,Ga=RegExp(`${Si}(?=${Si})|${fl+za}`,"g"),hl=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,dl=/^\w*$/,gl=46,pl=/\\(\\)?/g,vl=RegExp(`[^.[\\]]+|\\[(?:([^"'][^[]*)|(["'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))`,"g"),ml=/^(?:0|[1-9]\d*)$/,yl=RegExp.prototype.test.bind(/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/),bl=4294967294,xl=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ua=t=>Ga.test(t),wl=t=>t.match(Ga)||[],Sl=t=>t.split(""),$a=t=>Ua(t)?wl(t):Sl(t),Al=t=>t==null?[]:Un(t).map(e=>t[e]),Un=t=>ee(t)?Ha(t):Object.keys(Object(t)),Tl=t=>{if(!Gr(t))return Object.keys(t);var e=[];for(var n in Object(t))hasOwnProperty.call(t,n)&&n!="constructor"&&e.push(n);return e},Ha=(t,e)=>{const n=Array.isArray(t),r=!n&&ue(t)&&te(t)===Nn,i=!n&&!r&&Hn(t),s=n||r||i,o=t.length,a=new Array(s?o:0);let c=s?-1:o;for(;++c<o;)a[c]=`${c}`;for(const l in t)(e||hasOwnProperty.call(t,l))&&!(s&&(l==="length"||os(l,o)))&&a.push(l);return a},er=(t,e)=>{let{length:n}=t;for(;n--;)if(mn(t[n][0],e))return n;return-1},mn=(t,e)=>t===e||t!==t&&e!==e,ue=t=>t!=null&&typeof t=="object",Tr=(t,e,n)=>{if(!gt(n))return!1;const r=typeof e;return(r=="number"?ee(n)&&e>-1&&e<n.length:r=="string"&&e in n)?mn(n[e],t):!1},El=t=>ue(t)&&te(t)==Gn,Pl=t=>ue(t)&&te(t)==zn,Gr=t=>{const e=t&&t.constructor,n=typeof e=="function"&&e.prototype||Object.prototype;return t===n},yn=(t,e,n)=>{const r=t[e];(!(hasOwnProperty.call(t,e)&&mn(r,n))||n===void 0&&!(e in t))&&(t[e]=n)},$n=(t,e,n)=>{let r=-1;const i=e.length;for(;++r<i;){const s=e[r];yn(n,s,t[s])}return n},ee=t=>t!=null&&typeof t!="function"&&typeof t.length=="number"&&t.length>-1&&t.length%1===0,gn=t=>typeof t=="symbol"||ue(t)&&te(t)===zr,Cl=t=>{const e=t.length;let n=new t.constructor(e);return e&&typeof t[0]=="string"&&hasOwnProperty.call(t,"index")&&(n.index=t.index,n.input=t.input),n},ns=(t,e)=>{let n=-1;const r=t.length;for(e||(e=new Array(r));++n<r;)e[n]=t[n];return e},te=t=>t==null?t===void 0?Vu:Fu:Object.prototype.toString.call(t),rs=t=>{const e=new t.constructor(t.byteLength);return new Uint8Array(e).set(new Uint8Array(t)),e},qa=(t,e)=>{const n=e?rs(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)},_l=t=>{const e=new t.constructor(t.source,/\w*$/.exec(t));return e.lastIndex=t.lastIndex,e},Wa=t=>typeof t.constructor=="function"&&!Gr(t)?Object.create(Object.getPrototypeOf(t)):{},is=t=>t==null?[]:(t=Object(t),Object.getOwnPropertySymbols(t).filter(n=>propertyIsEnumerable.call(t,n))),Ll=(t,e)=>$n(t,is(t),e);function Ml(t,e){const n=e?rs(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}const Ol=(t,e,n)=>{const r=t.constructor;switch(e){case Xi:return rs(t);case Br:case ji:return new r(+t);case Zi:return Ml(t,n);case xa:case wa:case Sa:case Aa:case Ta:case Ea:case Pa:case Ca:case _a:return qa(t,n);case zn:return new r(t);case Fr:case Vr:return new r(t);case Yi:return _l(t);case Gn:return new r;case zr:return Symbol.prototype.valueOf?Object(Symbol.prototype.valueOf.call(t)):{}}},Hn=t=>ue(t)&&cl.test(te(t)),Ti=t=>{const e=Object.keys(t);return!Array.isArray(t)&&t!=null&&e.push(...is(Object(t))),e},ja=t=>{const e=[];for(;t;)e.push(...is(t)),t=Object.getPrototypeOf(Object(t));return e},Ya=t=>{const e=[];for(const n in t)e.push(n);return Array.isArray(t)||e.push(...ja(t)),e},nr=({__data__:t},e)=>{const n=t;return $l(e)?n[typeof e=="string"?"string":"hash"]:n.map},Nl=(t,e,n,r)=>{const i=Ti(t),s=i.length,a=Ti(e).length;if(s!=a)return!1;let c,l=s;for(;l--;)if(c=i[l],!hasOwnProperty.call(e,c))return!1;const f=r.get(t),u=r.get(e);if(f&&u)return f==e&&u==t;let d=!0;r.set(t,e),r.set(e,t);let g;for(;++l<s;){c=i[l];const v=t[c],y=e[c];if(!(v===y||n(v,y,r))){d=!1;break}g||(g=c=="constructor")}if(d&&!g){const v=t.constructor,y=e.constructor;v!=y&&"constructor"in t&&"constructor"in e&&!(typeof v=="function"&&v instanceof v&&typeof y=="function"&&y instanceof y)&&(d=!1)}return r.delete(t),r.delete(e),d},Ur=(t,e,n)=>t===e?!0:t==null||e==null||!ue(t)&&!ue(e)?t!==t&&e!==e:Il(t,e,Ur,n),Il=(t,e,n,r)=>{let i=Array.isArray(t);const s=Array.isArray(e);let o=i?wi:te(t),a=s?wi:te(e);o=o==Nn?un:o,a=a==Nn?un:a;let c=o==un;const l=a==un,f=o==a;if(f&&!c)return r||(r=new fn),i||Hn(t)?Xa(t,e,!1,n,r):Dl(t,e,o,n,r);const u=c&&hasOwnProperty.call(t,"__wrapped__"),d=l&&hasOwnProperty.call(e,"__wrapped__");if(u||d){const g=u?t.value():t,v=d?e.value():e;return r||(r=new fn),n(g,v,r)}return f?(r||(r=new fn),Nl(t,e,n,r)):!1},Xa=(t,e,n,r,i)=>{const s=t.length,o=e.length;if(s!=o)return!1;const a=i.get(t),c=i.get(e);if(a&&c)return a==e&&c==t;let l=-1,f=!0;const u=n?new Rn:void 0;for(i.set(t,e),i.set(e,t);++l<s;){const d=t[l],g=e[l];if(u){if(!Rl(e,(v,y)=>{if(!kl(u,y)&&(d===v||r(d,v,i)))return u.push(y)})){f=!1;break}}else if(!(d===g||r(d,g,i))){f=!1;break}}return i.delete(t),i.delete(e),f},Rl=(t,e)=>{let n=-1;const r=t==null?0:t.length;for(;++n<r;)if(e(t[n],n,t))return!0;return!1},kl=(t,e)=>t.has(e),$s=(t,e,n,r)=>!(t.byteLength!=e.byteLength||!n(new Uint8Array(t),new Uint8Array(e),r)),Dl=(t,e,n,r,i)=>{switch(n){case Zi:return t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset?!1:(t=t.buffer,e=e.buffer,$s(t,e,r,i));case Xi:return $s(t,e,r,i);case Br:case ji:case Fr:return mn(+t,+e);case ba:return t.name==e.name&&t.message==e.message;case Yi:case Vr:return t==`${e}`;case zn:var s=Za;case Gn:if(s||(s=$r),t.size!=e.size)return!1;const o=i.get(t);if(o)return o==e;i.set(t,e);const a=Xa(s(t),s(e),!0,r,i);return i.delete(t),a;case zr:return Symbol.prototype.valueOf.call(t)==Symbol.prototype.valueOf.call(e)}return!1},Za=t=>{let e=-1,n=Array(t.size);return t.forEach((r,i)=>{n[++e]=[i,r]}),n},$r=t=>{let e=-1;const n=new Array(t.size);return t.forEach(r=>{n[++e]=r}),n},ss=(t,e)=>{if(Array.isArray(t))return!1;const n=typeof t;return n==="number"||n==="boolean"||t==null||gn(t)?!0:dl.test(t)||!hl.test(t)||e!=null&&t in Object(e)},Bl=t=>{const e=[];return t.charCodeAt(0)===gl&&e.push(""),t.replace(vl,(n,r,i,s)=>{let o=n;i?o=s.replace(pl,"$1"):r&&(o=r.trim()),e.push(o)}),e},Re=(t,e)=>Array.isArray(t)?t:ss(t,e)?[t]:Bl(`${t}`),qn=(t,e)=>{e=Re(e,t);let n=0;const r=e.length;for(;t!=null&&n<r;)t=t[ke(e[n])],n++;return n&&n==r?t:void 0};function Fl(t,e){if(t!==e){const n=t!==void 0,r=t===null,i=t===t,s=gn(t),o=e!==void 0,a=e===null,c=e===e,l=gn(e);if(!a&&!l&&!s&&t>e||s&&o&&c&&!a&&!l||r&&o&&c||!n&&c||!i)return 1;if(!r&&!s&&!l&&t<e||l&&n&&i&&!r&&!s||a&&n&&i||!o&&i||!c)return-1}return 0}function Vl(t,e,n){let r=-1;const i=t.criteria,s=e.criteria,o=i.length,a=n.length;for(;++r<o;){const c=r<a?n[r]:null,f=(c&&typeof c=="function"?c:Fl)(i[r],s[r]);if(f)return c&&typeof c!="function"?f*(c=="desc"?-1:1):f}return t.index-e.index}const Ja=(t,e)=>{let n=(o,a)=>!!(o==null?0:o.length)&&o.indexOf(a)>-1,r=!0;const i=[],s=e.length;if(!t.length)return i;e.length>=es&&(n=(o,a)=>o.has(a),r=!1,e=new Rn(e));t:for(let o in t){let a=t[o];const c=a;if(a=a!==0?a:0,r&&c===c){let l=s;for(;l--;)if(e[l]===c)continue t;i.push(a)}else n(e,c)||i.push(a)}return i},ke=t=>{if(typeof t=="string"||gn(t))return t;const e=`${t}`;return e=="0"&&1/t==-1/0?"-0":e},We=(t,e=!1,n=!1,r=!0,i,s,o,a)=>{let c;if(i&&(c=o?i(t,s,o,a):i(t)),c!==void 0)return c;if(!gt(t))return t;const l=Array.isArray(t),f=te(t);if(l){if(c=Cl(t),!e)return ns(t,c)}else{const v=typeof t=="function";if(f===un||f===Nn||v&&!o){if(c=n||v?{}:Wa(t),!e)return n?zl(t,$n(t,Object.keys(t),c)):Ll(t,Object.assign(c,t))}else{if(v||!Gu[f])return o?t:{};c=Ol(t,f,e)}}a||(a=new fn);const u=a.get(t);if(u)return u;if(a.set(t,c),Pl(t))return t.forEach((v,y)=>{c.set(y,We(v,e,n,r,i,y,t,a))}),c;if(El(t))return t.forEach(v=>{c.add(We(v,e,n,r,i,v,t,a))}),c;if(Hn(t))return c;const g=l?void 0:(r?n?Ya:Ti:n?Qa:Un)(t);return(g||t).forEach((v,y)=>{g&&(y=v,v=t[y]),yn(c,y,We(v,e,n,r,i,y,t,a))}),c},zl=(t,e)=>$n(t,ja(t),e),Ka=(t,e)=>e.length<2?t:qn(t,e.slice(0,-1)),Gl=(t,e,n)=>{if(!gt(t))return t;e=Re(e,t);const r=e.length,i=r-1;let s=-1,o=t;for(;o!=null&&++s<r;){const a=ke(e[s]);let c=n;if(s!=i){const l=o[a];c=void 0,c===void 0&&(c=gt(l)?l:os(e[s+1])?[]:{})}yn(o,a,c),o=o[a]}return t},os=(t,e)=>{const n=typeof t;return e=e??Number.MAX_SAFE_INTEGER,!!e&&(n==="number"||n!=="symbol"&&ml.test(t))&&t>-1&&t%1==0&&t<e},Ul=(t,e)=>{e=Re(e,t),t=Ka(t,e);const n=e[e.length-1];return t==null||delete t[ke(n)]},$l=t=>{const e=typeof t;return e==="string"||e==="number"||e==="symbol"||e==="boolean"?t!=="__proto__":t===null},Qa=t=>{const e=[];for(const n in t)e.push(n);return e},Hl=t=>{t=Object(t);const e={};for(const n in t)e[n]=t[n];return e},Hs=(t,e)=>{if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]};function tc(t,e=!1){return(n,...r)=>{let i=-1,s=r.length,o=s>1?r[s-1]:void 0;const a=s>2?r[2]:void 0;for(o=t.length>3&&typeof o=="function"?(s--,o):e?(c,l)=>{if(Array.isArray(c)&&!Array.isArray(l))return l}:void 0,a&&Tr(r[0],r[1],a)&&(o=s<3?void 0:o,s=1),n=Object(n);++i<s;){const c=r[i];c&&t(n,c,i,o)}return n}}const as=(t,e,n,r,i)=>{t!==e&&he(e,(s,o)=>{if(gt(s))i||(i=new fn),ql(t,e,o,n,as,r,i);else{let a=r?r(t[o],s,`${o}`,t,e,i):void 0;a===void 0&&(a=s),Ei(t,o,a)}})},ql=(t,e,n,r,i,s,o)=>{const a=Hs(t,n),c=Hs(e,n),l=o.get(c);if(l){Ei(t,n,l);return}let f=s?s(a,c,`${n}`,t,e,o):void 0,u=f===void 0;if(u){const d=Array.isArray(c),g=!d&&Hn(c);f=c,d||g?Array.isArray(a)?f=a:ue(a)&&ee(a)?f=ns(a):g?(u=!1,f=qa(c,!0)):f=[]:Pt(c)||In(c)?(f=a,In(a)?f=Hl(a):(typeof a=="function"||!gt(a))&&(f=Wa(c))):u=!1}u&&(o.set(c,f),i(f,c,r,s,o),o.delete(c)),Ei(t,n,f)},Ei=(t,e,n)=>{(n!==void 0&&!mn(t[e],n)||n===void 0&&!(e in t))&&yn(t,e,n)};function Wl(t,e,n){const r=Object(t),i=n(t);let{length:s}=i,o=-1;for(;s--;){const a=i[++o];if(e(r[a],a,r)===!1)break}return t}const jl=(t,e)=>t&&Wl(t,e,Un),cs=(t,e)=>{if(t==null)return t;if(!ee(t))return jl(t,e);const n=t.length,r=Object(t);let i=-1;for(;++i<n&&e(r[i],i,r)!==!1;);return t};function Yl(t){const e=t==null?0:t.length;return e?t[e-1]:void 0}const Xl=Set&&1/$r(new Set([void 0,-0]))[1]==1/0?t=>new Set(t):()=>{};function ec(t,e,n,r,i,s){return gt(t)&&gt(e)&&(s.set(e,t),as(t,e,void 0,ec,s),s.delete(e)),t}function Zl(t,e,n){e.length?e=e.map(o=>Array.isArray(o)?a=>qn(a,o.length===1?o[0]:o):o):e=[o=>o];let r=-1,i=-1;const s=ee(t)?new Array(t.length):[];return cs(t,o=>{const a=e.map(c=>c(o));s[++i]={criteria:a,index:++r,value:o}}),Jl(s,(o,a)=>Vl(o,a,n))}function Jl(t,e){let{length:n}=t;for(t.sort(e);n--;)t[n]=t[n].value;return t}function nc(t){return t===t&&!gt(t)}function rc(t,e){return n=>n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}function ic(t,e){return t!=null&&gf(t,e,df)}function Kl(t,e){return ss(t)&&nc(e)?rc(ke(t),e):n=>{const r=qn(n,t);return r===void 0&&r===e?ic(n,t):Ur(e,r)}}function sc(t){const e=Ql(t);return e.length===1&&e[0][2]?rc(e[0][0],e[0][1]):n=>n===t||tf(n,t,e)}function Ql(t){const e=Un(t);let n=e.length;for(;n--;){const r=e[n],i=t[r];e[n]=[r,i,nc(i)]}return e}function tf(t,e,n,r){let i=n.length;const s=i;if(t==null)return!s;let o;for(t=Object(t);i--;)if(o=n[i],o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1;for(;++i<s;){o=n[i];const a=o[0],c=t[a],l=o[1];if(o[2]){if(c===void 0&&!(a in t))return!1}else{const f=new fn;if(!Ur(l,c,f))return!1}}return!0}function ef(t){return ss(t)?nf(ke(t)):rf(t)}function nf(t){return e=>e==null?void 0:e[t]}function rf(t){return e=>qn(e,t)}function sf(t){return typeof t=="function"?t:t==null?e=>e:typeof t=="object"?Array.isArray(t)?Kl(t[0],t[1]):sc(t):ef(t)}function Hr(){const t=sf;return arguments.length?t(arguments[0]):t}const of=(t,e,n,r)=>{let i=-1;const s=t==null?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n},af=(t,e,n,r,i)=>(i(t,(s,o,a)=>{n=r?(r=!1,s):e(n,s,o,a)}),n);function cf(t,e,n){const r=Array.isArray(t)?of:af,i=arguments.length<3;return r(t,e,n,i,cs)}const uf=t=>Array.isArray(t)||In(t)||!!(t&&t[Symbol.isConcatSpreadable]);function oc(t,e,n,r,i){let s=-1;const o=t.length;for(n||(n=uf),i||(i=[]);++s<o;){var a=t[s];e>0&&n(a)?e>1?oc(a,e-1,n,r,i):i.push(...a):i[i.length]=a}return i}const In=t=>ue(t)&&te(t)=="[object Arguments]",lf=(t,e)=>ff(t,e,(n,r)=>ic(t,r)),ff=(t,e,n)=>{let r=-1;const i=e.length,s={};for(;++r<i;){const o=e[r],a=qn(t,o);n(a,o)&&Gl(s,Re(o,t),a)}return s},hf=t=>typeof t=="number"&&t>-1&&t%1==0&&t<=Number.MAX_SAFE_INTEGER,df=(t,e)=>t!=null&&e in Object(t),gf=(t,e,n)=>{e=Re(e,t);for(var r=-1,i=e.length,s=!1;++r<i;){var o=ke(e[r]);if(!(s=t!=null&&n(t,o)))break;t=t[o]}return s||++r!=i?s:(i=t==null?0:t.length,!!i&&hf(i)&&os(o,i)&&(Array.isArray(t)||In(t)))},pf=t=>t.match(xl),vf=t=>t.match(al),mf=(t,e)=>(yl(t)?vf(t):pf(t))||[],yf=(t,e,n)=>{const{length:r}=t;return n=n===void 0?r:n,t.slice(e,n)},bf=xf("toUpperCase");function xf(t){return e=>{if(!e)return"";const n=Ua(e)?$a(e):void 0,r=n?n[0]:e[0],i=n?yf(n,1).join(""):e.slice(1);return r[t]()+i}}function wf(t){return sc(We(t,!0))}class fn{constructor(e){const n=this.__data__=new ei(e);this.size=n.size}clear(){this.__data__=new ei,this.size=0}delete(e){const n=this.__data__,r=n.delete(e);return this.size=n.size,r}get(e){return this.__data__.get(e)}has(e){return this.__data__.has(e)}set(e,n){let r=this.__data__;if(r instanceof ei){const i=r.__data__;if(i.length<es-1)return i.push([e,n]),this.size=++r.size,this;r=this.__data__=new ac(i)}return r.set(e,n),this.size=r.size,this}}class ei{constructor(e){let n=-1;const r=e==null?0:e.length;for(this.clear();++n<r;){const i=e[n];this.set(i[0],i[1])}}clear(){this.__data__=[],this.size=0}delete(e){const n=this.__data__,r=er(n,e);if(r<0)return!1;const i=n.length-1;return r==i?n.pop():n.splice(r,1),--this.size,!0}get(e){const n=this.__data__,r=er(n,e);return r<0?void 0:n[r][1]}has(e){return er(this.__data__,e)>-1}set(e,n){const r=this.__data__,i=er(r,e);return i<0?(++this.size,r.push([e,n])):r[i][1]=n,this}}class ac{constructor(e){let n=-1;const r=e==null?0:e.length;for(this.clear();++n<r;){const i=e[n];this.set(i[0],i[1])}}clear(){this.size=0,this.__data__={hash:new qs,map:new Map,string:new qs}}delete(e){const n=nr(this,e).delete(e);return this.size-=n?1:0,n}get(e){return nr(this,e).get(e)}has(e){return nr(this,e).has(e)}set(e,n){const r=nr(this,e),i=r.size;return r.set(e,n),this.size+=r.size==i?0:1,this}}class qs{constructor(e){let n=-1;const r=e==null?0:e.length;for(this.clear();++n<r;){const i=e[n];this.set(i[0],i[1])}}clear(){this.__data__=Object.create(null),this.size=0}delete(e){const n=this.has(e)&&delete this.__data__[e];return this.size-=n?1:0,n}get(e){const r=this.__data__[e];return r===Ai?void 0:r}has(e){return this.__data__[e]!==void 0}set(e,n){const r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=n===void 0?Ai:n,this}}class Rn{constructor(e){let n=-1;const r=e==null?0:e.length;for(this.__data__=new ac;++n<r;)this.add(e[n])}add(e){return this.__data__.set(e,Ai),this}has(e){return this.__data__.has(e)}}Rn.prototype.push=Rn.prototype.add;const Sf=function(t){var e=Object.prototype.toString;return t===!0||t===!1||!!t&&typeof t=="object"&&e.call(t)===Br},gt=function(t){return!!t&&(typeof t=="object"||typeof t=="function")},Bt=function(t){var e=Object.prototype.toString;return typeof t=="number"||!!t&&typeof t=="object"&&e.call(t)===Fr},Ct=function(t){var e=Object.prototype.toString;return typeof t=="string"||!!t&&typeof t=="object"&&e.call(t)===Vr},J=tc((t,e)=>{if(Gr(e)||ee(e)){$n(e,Un(e),t);return}for(var n in e)hasOwnProperty.call(e,n)&&yn(t,n,e[n])}),Af=(t,...e)=>{let n=-1,r=e.length;const i=r>2?e[2]:void 0;for(i&&Tr(e[0],e[1],i)&&(r=1);++n<r;){const s=e[n];if(s==null)continue;const o=Object.keys(s),a=o.length;let c=-1;for(;++c<a;){const l=o[c],f=t[l];(f===void 0||mn(f,Object.prototype[l])&&!hasOwnProperty.call(t,l))&&(t[l]=s[l])}}return t},Yt=Af,Tf=function(...e){return e.push(void 0,ec),Lt.apply(void 0,e)},us=Tf,de=(t,e,...n)=>{let r=-1;const i=typeof e=="function",s=ee(t)?new Array(t.length):[];return cs(t,o=>{s[++r]=i?e.apply(o,n):Ef(o,e,...n)}),s},Ef=(t,e,...n)=>{e=Re(e,t),t=Ka(t,e);const r=t==null?t:t[ke(Yl(e))];return r==null?void 0:r.apply(t,n)},cc=(t,e,n)=>{let r=0,i=t==null?0:t.length;if(i==0)return 0;n=Hr(n,2),e=n(e);const s=e!==e,o=e===null,a=gn(e),c=e===void 0;for(;r<i;){let l;const f=Math.floor((r+i)/2),u=n(t[f]),d=u!==void 0,g=u===null,v=u===u,y=gn(u);s?l=v:c?l=v&&d:o?l=v&&d&&!g:a?l=v&&d&&!g&&!y:g||y?l=!1:l=u<e,l?r=f+1:i=f}return Math.min(i,bl)},Ye=(t,e)=>{let n=-1,r=(c,l)=>!!(c==null?0:c.length)&&c.indexOf(l)>-1;e=Hr(e,2);let i=!0;const{length:s}=t,o=[];let a=o;if(s>=es){const c=e?null:Xl(t);if(c)return $r(c);i=!1,r=(l,f)=>l.has(f),a=new Rn}else a=e?[]:o;t:for(;++n<s;){let c=t[n];const l=e?e(c):c;if(c=c!==0?c:0,i&&l===l){let f=a.length;for(;f--;)if(a[f]===l)continue t;e&&a.push(l),o.push(c)}else r(a,l)||(a!==o&&a.push(l),o.push(c))}return o},Dt=t=>We(t),jt=t=>We(t,!0),Xt=t=>{if(t==null)return!0;if(ee(t)&&(Array.isArray(t)||typeof t=="string"||typeof t.splice=="function"||Hn(t)||In(t)))return!t.length;const e=te(t);if(e=="[object Map]"||e=="[object Set]")return!t.size;if(Gr(t))return!Tl(t).length;for(const n in t)if(hasOwnProperty.call(t,n))return!1;return!0},_e=(t,e)=>Ur(t,e),yt=t=>typeof t=="function",Pt=t=>{if(!ue(t)||te(t)!="[object Object]")return!1;if(Object.getPrototypeOf(t)===null)return!0;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},pt=t=>{if(!t)return[];if(ee(t))return Ct(t)?$a(t):ns(t);if(Symbol.iterator&&Symbol.iterator in Object(t)){const r=t[Symbol.iterator]();let i;const s=[];for(;!(i=r.next()).done;)s.push(i.value);return s}const e=te(t);return(e==zn?Za:e==Gn?$r:Al)(t)};function Pf(t,e,n){if(typeof t!="function")throw new TypeError("Expected a function");let r,i,s,o,a,c,l=0,f=!1,u=!1,d=!0;const g=!e&&e!==0&&window&&typeof window.requestAnimationFrame=="function";e=+e||0,gt(n)&&(f=!!n.leading,u="maxWait"in n,s=u?Math.max(20,e):s,d="trailing"in n?!!n.trailing:d);function v(h){const p=r,m=i;return r=i=void 0,l=h,o=t.apply(m,p),o}function y(h,p){return g?(window.cancelAnimationFrame(a),window.requestAnimationFrame(h)):setTimeout(h,p)}function x(h){if(g)return window.cancelAnimationFrame(h);clearTimeout(h)}function w(h){return l=h,a=y(M,e),f?v(h):o}function T(h){const p=h-c,m=h-l,b=e-p;return u?Math.min(b,s-m):b}function P(h){const p=h-c,m=h-l;return c===void 0||p>=e||p<0||u&&m>=s}function M(){const h=Date.now();if(P(h))return I(h);a=y(M,T(h))}function I(h){return a=void 0,d&&r?v(h):(r=i=void 0,o)}function D(...h){const p=Date.now(),m=P(p);if(r=h,i=this,c=p,m){if(a===void 0)return w(c);if(u)return a=y(M,e),v(c)}return a===void 0&&(a=y(M,e)),o}return D.cancel=()=>{a!==void 0&&x(a),l=0,r=c=i=a=void 0},D.flush=()=>a===void 0?o:I(Date.now()),D.pending=()=>a!==void 0,D}const Cf=(t,e)=>(e=Hr(e,2),cf(t,(n,r)=>{const i=e(r);return hasOwnProperty.call(n,i)?n[i].push(r):yn(n,i,[r]),n},{})),dr=(t,e=[])=>{if(t==null)return[];const n=e.length;return n>1&&Tr(t,e[0],e[1])?e=[]:n>2&&Tr(e[0],e[1],e[2])&&(e=[e[0]]),Array.isArray(e)||(e=[Hr(e,2)]),Zl(t,e.flat(1),[])},_f=t=>(t==null?0:t.length)?oc(t,1/0):[],Ws=(t,...e)=>ee(t)?Ja(t,e):[],Lf=(t,...e)=>ue(t)&&ee(t)?Ja(t,e.flat(1)):[],Pi=(...t)=>{const e=t.flat(1);return Ye(e)},ge=(t,e)=>{if(t==null)return!1;typeof e=="string"&&(e=e.split("."));let n=-1,r=t;for(;++n<e.length;){if(!r||!hasOwnProperty.call(r,e[n]))return!1;r=r[e[n]]}return!0},xt=(t,e,n)=>{e=Re(e,t);let r=-1,i=e.length;for(i||(i=1,t=void 0);++r<i;){let s=t==null?void 0:t[ke(e[r])];s===void 0&&(r=i,s=n),t=typeof s=="function"?s.call(t):s}return t},Wn=(t,...e)=>{let n={};if(t==null)return n;let r=!1;e=e.flat(1).map(s=>(s=Re(s,t),r||(r=s.length>1),s)),$n(t,Ya(t),n),r&&(n=We(n,!0,!0,!0,s=>Pt(s)?void 0:s));let i=e.length;for(;i--;)Ul(n,e[i]);return n},Mf=(t,...e)=>t==null?{}:lf(t,e.flat(1/0)),he=(t,e=n=>n)=>{let n=-1;const r=Object(t),i=ee(t)?Ha(t,!0):Qa(t);let s=i.length;for(;s--;){const o=i[++n];if(e(r[o],o,r)===!1)break}},uc=(t="")=>mf(`${t}`.replace(/['\u2019]/g,"")).reduce((e,n,r)=>(n=n.toLowerCase(),e+(r?bf(n):n)),"");let Of=0;const kn=(t="")=>{const e=++Of;return`${t}`+e},Lt=tc((t,e,n,r)=>{as(t,e,n,r)},!0);class lc{constructor(){this.map=new WeakMap}has(e,n){return n===void 0?this.map.has(e):n in this.map.get(e)}create(e){return this.has(e)||this.map.set(e,Object.create(null)),this.get(e)}get(e,n){if(!this.has(e))return;const r=this.map.get(e);return n===void 0?r:r[n]}set(e,n,r){if(n===void 0)return;const i=this.create(e);typeof n=="string"?i[n]=r:Object.assign(i,n)}remove(e,n){if(this.has(e))if(n===void 0)this.map.delete(e);else{const r=this.map.get(e);delete r[n]}}}const ce=new lc,fc=new lc,Xe=function(t,e){if(!(this instanceof Xe))return new Xe(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented?gr:pr,this.target=t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,e&&Object.assign(this,e),this.timeStamp=t&&t.timeStamp||Date.now(),this.envelope=!0};Xe.prototype={constructor:Xe,isDefaultPrevented:pr,isPropagationStopped:pr,isImmediatePropagationStopped:pr,preventDefault:function(){const t=this.originalEvent;this.isDefaultPrevented=gr,t&&t.preventDefault()},stopPropagation:function(){const t=this.originalEvent;this.isPropagationStopped=gr,t&&t.stopPropagation()},stopImmediatePropagation:function(){const t=this.originalEvent;this.isImmediatePropagationStopped=gr,t&&t.stopImmediatePropagation(),this.stopPropagation()}};["altKey","bubbles","cancelable","changedTouches","ctrlKey","detail","eventPhase","metaKey","pageX","pageY","shiftKey","view","char","code","charCode","key","keyCode","button","buttons","clientX","clientY","offsetX","offsetY","pointerId","pointerType","screenX","screenY","targetTouches","toElement","touches","which"].forEach(t=>Nf(t));function Nf(t){Object.defineProperty(Xe.prototype,t,{enumerable:!0,configurable:!0,get:function(){return this.originalEvent?this.originalEvent[t]:void 0},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})}function gr(){return!0}function pr(){return!1}const pn=typeof window<"u"?window.document:null,If=pn&&pn.documentElement,hc=/^([^.]*)(?:\.(.+)|)/,dc=/[^\x20\t\r\n\f]+/g,j=function(t){return new j.Dom(t)};j.fn=j.prototype={constructor:j,length:0};j.guid=1;j.data=fc;j.merge=function(t,e){let n=+e.length,r=t.length;for(let i=0;i<n;i++)t[r++]=e[i];return t.length=r,t};j.parseHTML=function(t){const e=pn.implementation.createHTMLDocument(),n=e.createElement("base");n.href=pn.location.href,e.head.appendChild(n),e.body.innerHTML=t;const r=e.getElementsByTagName("script");for(let i=0;i<r.length;i++)r[i].remove();return Array.from(e.body.childNodes)};typeof Symbol=="function"&&(j.fn[Symbol.iterator]=Array.prototype[Symbol.iterator]);j.fn.toArray=function(){return Array.from(this)};j.fn.pushStack=function(t){const e=j.merge(this.constructor(),t);return e.prevObject=this,e};j.fn.find=function(t){const[e]=this,n=this.pushStack([]);if(!e)return n;const{nodeType:r}=e;return r!==1&&r!==9&&r!==11||(typeof t!="string"?e!==t&&e.contains(t)&&j.merge(n,[t]):j.merge(n,e.querySelectorAll(t))),n};j.fn.add=function(t){const e=j(t).toArray(),n=this.toArray(),r=this.pushStack([]);return j.merge(r,Ye(n.concat(e))),r};j.fn.addBack=function(){return this.add(this.prevObject)};j.fn.filter=function(t){const e=[];for(let n=0;n<this.length;n++){const r=this[n];r.matches(t)&&e.push(r)}return this.pushStack(e)};const Rf=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;function kf(t){return t[0]==="<"&&t[t.length-1]===">"&&t.length>=3}const gc=function(t){if(!t)return this;if(typeof t=="function")throw new Error("function not supported");if(arguments.length>1)throw new Error("selector with context not supported");if(t.nodeType)return this[0]=t,this.length=1,this;let e;if(kf(t+""))e=[null,t,null];else if(typeof t=="string")e=Rf.exec(t);else return j.merge(this,t);if(!e||!e[1])return Df.find(t);if(e[1])return j.merge(this,j.parseHTML(e[1])),this;const n=pn.getElementById(e[2]);return n&&(this[0]=n,this.length=1),this};j.Dom=gc;gc.prototype=j.fn;j.Event=Xe;j.event={special:Object.create(null)};j.event.has=function(t,e){const n=ce.get(t,"events");return n?e?Array.isArray(n[e])&&n[e].length>0:!0:!1};j.event.on=function(t,e,n,r,i,s){if(typeof e=="object"){typeof n!="string"&&(r=r||n,n=void 0);for(let o in e)j.event.on(t,o,n,r,e[o],s);return t}if(r==null&&i==null?(i=n,r=n=void 0):i==null&&(typeof n=="string"?(i=r,r=void 0):(i=r,r=n,n=void 0)),!i)return t;if(s===1){const o=i;i=function(a){return j().off(a),o.apply(this,arguments)},i.guid=o.guid||(o.guid=j.guid++)}for(let o=0;o<t.length;o++)j.event.add(t[o],e,i,r,n)};j.event.add=function(t,e,n,r,i){if(typeof t!="object")return;const s=ce.create(t);let o;n.handler&&(o=n,n=o.handler,i=o.selector),i&&If.matches(i),n.guid||(n.guid=j.guid++);let a;(a=s.events)||(a=s.events=Object.create(null));let c;(c=s.handle)||(c=s.handle=function(u){return typeof j<"u"?j.event.dispatch.apply(t,arguments):void 0});const l=(e||"").match(dc)||[""];let f=l.length;for(;f--;){const[,u,d=""]=hc.exec(l[f]);if(!u)continue;const g=d.split(".").sort();let v=j.event.special[u];const y=v&&(i?v.delegateType:v.bindType)||u;v=j.event.special[y];const x=Object.assign({type:y,origType:u,data:r,handler:n,guid:n.guid,selector:i,namespace:g.join(".")},o);let w;(w=a[y])||(w=a[y]=[],w.delegateCount=0,(!v||!v.setup||v.setup.call(t,r,g,c)===!1)&&t.addEventListener&&t.addEventListener(y,c)),v&&v.add&&(v.add.call(t,x),x.handler.guid||(x.handler.guid=n.guid)),i?w.splice(w.delegateCount++,0,x):w.push(x)}};j.event.remove=function(t,e,n,r,i){const s=ce.get(t);if(!s||!s.events)return;const o=s.events,a=(e||"").match(dc)||[""];let c=a.length;for(;c--;){const[,l,f=""]=hc.exec(a[c]);if(!l){for(const T in o)j.event.remove(t,T+a[c],n,r,!0);continue}const u=j.event.special[l],d=u&&(r?u.delegateType:u.bindType)||l,g=o[d];if(!g||g.length===0)continue;const v=f.split(".").sort(),y=f?new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,x=g.length;let w=x;for(;w--;){const T=g[w];(i||l===T.origType)&&(!n||n.guid===T.guid)&&(!y||y.test(T.namespace))&&(!r||r===T.selector||r==="**"&&T.selector)&&(g.splice(w,1),T.selector&&g.delegateCount--,u&&u.remove&&u.remove.call(t,T))}x&&g.length===0&&((!u||!u.teardown||u.teardown.call(t,v,s.handle)===!1)&&t.removeEventListener&&t.removeEventListener(d,s.handle),delete o[d])}Xt(o)&&(ce.remove(t,"handle"),ce.remove(t,"events"))};j.event.dispatch=function(t){const e=this,n=j.event.fix(t);n.delegateTarget=e;const r=Array.from(arguments);r[0]=n;const i=ce.get(e,"events"),s=i&&i[n.type]||[],o=j.event.special[n.type];if(o&&o.preDispatch&&o.preDispatch.call(e,n)===!1)return;const a=j.event.handlers.call(e,n,s);let c=0,l;for(;(l=a[c++])&&!n.isPropagationStopped();){n.currentTarget=l.elem;let f=0,u;for(;(u=l.handlers[f++])&&!n.isImmediatePropagationStopped();){n.handleObj=u,n.data=u.data;const d=j.event.special[u.origType];let g;d&&d.handle?g=d.handle:g=u.handler;const v=g.apply(l.elem,r);v!==void 0&&(n.result=v)===!1&&(n.preventDefault(),n.stopPropagation())}}return o&&o.postDispatch&&o.postDispatch.call(e,n),n.result};j.event.handlers=function(t,e){const n=e.delegateCount,r=[];if(n&&!(t.type==="click"&&t.button>=1)){for(let i=t.target;i!==this;i=i.parentNode||this)if(i.nodeType===1&&!(t.type==="click"&&i.disabled===!0)){const s=[],o={};for(let a=0;a<n;a++){const c=e[a],l=c.selector+" ";o[l]===void 0&&(o[l]=i.matches(l)),o[l]&&s.push(c)}s.length&&r.push({elem:i,handlers:s})}}return n<e.length&&r.push({elem:this,handlers:e.slice(n)}),r};j.event.fix=function(t){return t.envelope?t:new Xe(t)};const Df=j(pn);function ls(t){let e=t.length;for(;e--;)pc(t[e])}function pc(t){j.event.remove(t),ce.remove(t),fc.remove(t)}function vc(t){for(let e=0;e<t.length;e++){const n=t[e];n.parentNode&&n.parentNode.removeChild(n)}}function Bf(){for(let t=0;t<this.length;t++){const e=this[t];pc(e),ls(e.getElementsByTagName("*"))}return vc(this),this}function Ff(){return vc(this),this}function Vf(){for(let t=0;t<this.length;t++){const e=this[t];e.nodeType===1&&(ls(e.getElementsByTagName("*")),e.textContent="")}return this}function zf(){const t=[];for(let e=0;e<this.length;e++)t.push(this[e].cloneNode(!0));return this.pushStack(t)}function Gf(t){const[e]=this;if(!e)return null;if(arguments.length===0)return e.innerHTML;if(t===void 0)return this;if(ls(e.getElementsByTagName("*")),typeof t=="string"||typeof t=="number")e.innerHTML=t;else return e.innerHTML="",this.append(t);return this}function Uf(...t){const[e]=this;return e?(t.forEach(n=>{n&&(typeof n=="string"?e.append(...j.parseHTML(n)):n.toString()==="[object Object]"?this.append(...Array.from(n)):Array.isArray(n)?this.append(...n):e.appendChild(n))}),this):this}function $f(...t){const[e]=this;return e?(t.forEach(n=>{n&&(typeof n=="string"?e.prepend(...j.parseHTML(n)):n.toString()==="[object Object]"?this.prepend(...Array.from(n)):Array.isArray(n)?this.prepend(...n):e.insertBefore(n,e.firstChild))}),this):this}function Hf(t){return j(t).append(this),this}function qf(t){return j(t).prepend(this),this}const mc={};["width","height","top","bottom","left","right","padding","paddingTop","paddingBottom","paddingLeft","paddingRight","margin","marginTop","marginBottom","marginLeft","marginRight"].forEach(t=>{mc[t]=!0});function Wf(t,e,n){typeof n=="number"&&mc[uc(e)]&&(n+="px"),t.style[e]=n}function jf(t,e){let n;if(typeof t=="string")if(e===void 0){const[r]=this;return r?r.style[t]:null}else n={[t]:e};else if(t)n=t;else throw new Error("no styles provided");for(let r in n)if(n.hasOwnProperty(r))for(let i=0;i<this.length;i++)Wf(this[i],r,n[r]);return this}function Yf(t,e){if(arguments.length<2){const[n]=this;return n?t===void 0?n.dataset:n.dataset[t]:null}for(let n=0;n<this.length;n++)this[n].dataset[t]=e;return this}function fs(t,e,n){for(let r=0;r<e.length;r++){const i=e[r];z.prototype[t].apply({node:i},n)}}function Xf(){return fs("removeClass",this,arguments),this}function Zf(){return fs("addClass",this,arguments),this}function Jf(){return fs("toggleClass",this,arguments),this}function Kf(){const[t]=this;return t?z.prototype.hasClass.apply({node:t},arguments):!1}function Qf(t){const e=[];for(let n=0;n<this.length;n++){const r=this[n];let i=Array.from(r.children);typeof t=="string"&&(i=i.filter(s=>s.matches(t))),e.push(...i)}return this.pushStack(e)}function th(t){const e=[];for(let n=0;n<this.length;n++){const r=this[n];if(typeof t=="string"){const i=r.closest(t);i&&e.push(i)}else{const[i]=j(t);i&&i.contains(r)&&e.push(i)}}return this.pushStack(e)}function eh(t,e,n,r){return j.event.on(this,t,e,n,r),this}function nh(t,e,n,r){return j.event.on(this,t,e,n,r,1),this}function rh(t,e,n){if(t&&t.preventDefault&&t.handleObj){const r=t.handleObj;return j(t.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this}if(typeof t=="object"){for(let r in t)this.off(r,e,t[r]);return this}(e===!1||typeof e=="function")&&(n=e,e=void 0);for(let r=0;r<this.length;r++)j.event.remove(this[r],t,n,e);return this}function ih(){const[t]=this;if(t===window)return t.document.documentElement.clientWidth;if(!t)return;const e=window.getComputedStyle(t),n=t.offsetWidth,r=parseFloat(e.borderTopWidth),i=parseFloat(e.borderBottomWidth),s=parseFloat(e.paddingTop),o=parseFloat(e.paddingBottom);return n-i-r-s-o}function sh(){const[t]=this;if(t===window)return t.document.documentElement.clientHeight;if(!t)return;const e=window.getComputedStyle(t),n=t.offsetHeight,r=parseFloat(e.borderLeftWidth),i=parseFloat(e.borderRightWidth),s=parseFloat(e.paddingLeft),o=parseFloat(e.paddingRight);return n-r-i-s-o}function oh(){const[t]=this;if(!t)return;let e=j(t),n,r,i,s={top:0,left:0};if(e.css("position")==="fixed")r=t.getBoundingClientRect();else{r=e.offset(),i=t.ownerDocument,n=t.offsetParent||i.documentElement;const c=l=>{const{position:f}=getComputedStyle(l);return f==="static"};for(;n&&n!==i.documentElement&&c(n);)n=n.offsetParent||i.documentElement;if(n&&n!==t&&n.nodeType===1&&!c(n)){const l=window.getComputedStyle(n),f=parseFloat(l.borderTopWidth)||0,u=parseFloat(l.borderLeftWidth)||0;s=j(n).offset(),s.top+=f,s.left+=u}}const o=parseFloat(window.getComputedStyle(t).marginTop)||0,a=parseFloat(window.getComputedStyle(t).marginLeft)||0;return{top:r.top-s.top-o,left:r.left-s.left-a}}function ah(t){const[e]=this;if(t===void 0){if(!e)return null;if(!e.getClientRects().length)return{top:0,left:0};const o=e.getBoundingClientRect();return{top:o.top+window.scrollY,left:o.left+window.scrollX}}if(!e)return this;const n=window.getComputedStyle(e);n.position==="static"&&this.css("position","relative");const r=this.offset(),i=t.top-r.top,s=t.left-r.left;return this.css({top:(parseFloat(n.top)||0)+i+"px",left:(parseFloat(n.left)||0)+s+"px"}),this}const ch=Object.freeze(Object.defineProperty({__proto__:null,addClass:Zf,append:Uf,appendTo:Hf,children:Qf,clone:zf,closest:th,css:jf,data:Yf,detach:Ff,empty:Vf,hasClass:Kf,height:sh,html:Gf,off:rh,offset:ah,on:eh,one:nh,position:oh,prepend:$f,prependTo:qf,remove:Bf,removeClass:Xf,toggleClass:Jf,width:ih},Symbol.toStringTag,{value:"Module"})),Er="animationFrameId",le={};le["transition-property"]=le["transition-duration"]=le["transition-delay"]=le["transition-timing-function"]=le["animation-name"]=le["animation-duration"]=le["animation-delay"]=le["animation-timing-function"]="";function uh(t,e={}){this.stop();for(let n=0;n<this.length;n++)lh(this[n],t,e);return this}function lh(t,e,n={}){let{duration:r=400,easing:i="ease-in-out",delay:s=0,complete:o}=n;const a=setTimeout(function(){const c=j(t);let l=!1,f="transitionend";r=r/1e3,s=s/1e3;const u={};if(typeof e=="string")u["animation-name"]=e,u["animation-duration"]=r+"s",u["animation-delay"]=s+"s",u["animation-timing-function"]=i,f="animationend";else{const v=[];for(var d in e)e.hasOwnProperty(d)&&(u[d]=e[d],v.push(d));r>0&&(u["transition-property"]=v.join(", "),u["transition-duration"]=r+"s",u["transition-delay"]=s+"s",u["transition-timing-function"]=i)}const g=function(v){if(v){if(v.target!==v.currentTarget)return;v.target.removeEventListener(f,g)}else t.removeEventListener(f,g);l=!0,c.css(le),o&&o.call(t)};if(r>0){t.addEventListener(f,g);const v=setTimeout(function(){l||g(null)},(r+s)*1e3+25);ce.set(t,Er,{id:v,stop:()=>{clearTimeout(v),t.removeEventListener(f,g)}})}c.css(u),r<=0&&g(null)});ce.set(t,Er,{stop:()=>clearTimeout(a)})}function fh(){for(let t=0;t<this.length;t++){const e=this[t],n=ce.get(e,Er);n&&(n.stop(),ce.remove(e,Er))}return this.css(le),this}const hh=Object.freeze(Object.defineProperty({__proto__:null,animate:uh,stop:fh},Symbol.toStringTag,{value:"Module"})),js={outerWidth:"offsetWidth",outerHeight:"offsetHeight",innerWidth:"clientWidth",innerHeight:"clientHeight",scrollLeft:"scrollLeft",scrollTop:"scrollTop",val:"value",text:"textContent"},Ys={disabled:"disabled",value:"value",text:"textContent"};function dh(t,e){if(!t)throw new Error("no property provided");if(arguments.length===1){const[n]=this;return n?n[t]:null}if(e===void 0)return this;for(let n=0;n<this.length;n++)this[n][t]=e;return this}function gh(t,e){let n;if(typeof t=="string")if(e===void 0){const[r]=this;return r?r.getAttribute(t):null}else n={[t]:e};else if(t)n=t;else throw new Error("no attributes provided");for(let r in n)if(n.hasOwnProperty(r)){const i=n[r];if(Ys[r]){this.prop(Ys[r],i);continue}for(let s=0;s<this.length;s++)i===null?this[s].removeAttribute(r):this[s].setAttribute(r,i)}return this}const yc={prop:dh,attr:gh};Object.keys(js).forEach(t=>{yc[t]=function(...e){return this.prop(js[t],...e)}});const hn={useCSSSelectors:!1,classNamePrefix:"joint-",defaultTheme:"default",doubleTapInterval:300},qr=Object.create(null);qr.load={noBubble:!0};[["mouseenter","mouseover"],["mouseleave","mouseout"],["pointerenter","pointerover"],["pointerleave","pointerout"]].forEach(([t,e])=>{qr[t]={delegateType:e,bindType:e,handle:function(n){const r=this,i=n.relatedTarget,s=n.handleObj;let o;return(!i||!r.contains(i))&&(n.type=s.origType,o=s.handler.apply(r,arguments),n.type=e),o}}});const ph=hn.doubleTapInterval,vh=30;qr.dbltap={bindType:"touchend",delegateType:"touchend",handle:function(t,...e){const{handleObj:n,target:r}=t,i=j.data.create(r),s=new Date().getTime(),o="lastTouch"in i?s-i.lastTouch:0;o<ph&&o>vh?(i.lastTouch=null,t.type=n.origType,n.handler.call(this,t,...e)):i.lastTouch=s}};Object.assign(j.fn,ch);Object.assign(j.fn,hh);Object.assign(j.fn,yc);Object.assign(j.event.special,qr);const xe=function(t){return t&&t.toString().split(" ").map(function(e){return e.substr(0,hn.classNamePrefix.length)!==hn.classNamePrefix&&(e=hn.classNamePrefix+e),e}).join(" ")},Pr=function(t,e){const n={},r={},i=z.namespace.svg,s=e||i,o=document.createDocumentFragment(),a=function(c,l,f){for(let u=0;u<c.length;u++){const d=c[u];if(typeof d=="string"){const I=document.createTextNode(d);l.appendChild(I);continue}if(!d.hasOwnProperty("tagName"))throw new Error("json-dom-parser: missing tagName");const g=d.tagName;let v;const y=d.hasOwnProperty("namespaceURI")?d.namespaceURI:f;v=document.createElementNS(y,g);const x=y===i,w=x?z(v):j(v),T=d.attributes;T&&w.attr(T);const P=d.style;if(P&&j(v).css(P),d.hasOwnProperty("className")){const I=d.className;x?v.className.baseVal=I:v.className=I}if(d.hasOwnProperty("textContent")&&(v.textContent=d.textContent),d.hasOwnProperty("selector")){const I=d.selector;if(n[I])throw new Error("json-dom-parser: selector must be unique");n[I]=v,w.attr("joint-selector",I)}if(d.hasOwnProperty("groupSelector")){let I=d.groupSelector;Array.isArray(I)||(I=[I]);for(let D=0;D<I.length;D++){const h=I[D];let p=r[h];p||(p=r[h]=[]),p.push(v)}}l.appendChild(v);const M=d.children;Array.isArray(M)&&a(M,v,y)}};return a(t,o,s),{fragment:o,selectors:n,groupSelectors:r}},rr=function(t){let e=0;if(t.length===0)return e;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);e=(e<<5)-e+r,e=e&e}return e},vn=function(t,e,n){for(var r=Array.isArray(e)?e:e.split(n||"/"),i,s=0,o=r.length;s<o;)if(i=r[s++],Object(t)===t&&i in t)t=t[i];else return;return t},bc=function(t,e){return typeof e!="string"&&typeof e!="number"&&(e=String(e)),!(e==="constructor"&&typeof t[e]=="function"||e==="__proto__")},Xs=function(t,e,n,r){const i=Array.isArray(e)?e:e.split(r||"/"),s=i.length-1;let o=t,a=0;for(;a<s;a++){const c=i[a];if(!bc(o,c))return t;o=o[c]||(o[c]={})}return o[i[s]]=n,t},Zs=function(t,e,n){const r=Array.isArray(e)?e:e.split(n),i=r.length-1;let s=t,o=0;for(;o<i;o++){const a=r[o];if(!bc(s,a))return t;const c=s[a];if(!c)return t;s=c}return delete s[r[i]],t},mh=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=Math.random()*16|0,n=t==="x"?e:e&3|8;return n.toString(16)})},ln=function(t){return ln.id=ln.id||1,t===void 0?"j_"+ln.id++:(t.id=t.id===void 0?"j_"+ln.id++:t.id,t.id)},Ot=function(t){if(t.normalized)return t;const{originalEvent:e,target:n}=t,r=e&&e.changedTouches&&e.changedTouches[0];if(r)for(let i in r)t[i]===void 0&&(t[i]=r[i]);if(n){const i=n.correspondingUseElement;i&&(t.target=i)}return t.normalized=!0,t},yh=function(t){let i=0,s=0,o=0,a=0;return"detail"in t&&(s=t.detail),"wheelDelta"in t&&(s=-t.wheelDelta/120),"wheelDeltaY"in t&&(s=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(i=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(i=s,s=0),o="deltaX"in t?t.deltaX:i*10,a="deltaY"in t?t.deltaY:s*10,(o||a)&&t.deltaMode&&(t.deltaMode==1?(o*=40,a*=40):(o*=800,a*=800)),t.deltaX===0&&t.deltaY!==0&&t.shiftKey&&(o=a,a=0,i=s,s=0),o&&!i&&(i=o<1?-1:1),a&&!s&&(s=a<1?-1:1),{spinX:i,spinY:s,deltaX:o,deltaY:a}},bh=function(t,e){return t>e?e:t<-50?-50:t},Ci=function(){var t;if(typeof window<"u"&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame),!t){var e=0;t=function(n){var r=new Date().getTime(),i=Math.max(0,16-(r-e)),s=setTimeout(function(){n(r+i)},i);return e=r+i,s}}return function(n,r,...i){return t(r!==void 0?n.bind(r,...i):n)}}(),vr=function(){var t,e=typeof window<"u";return e&&(t=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame),t=t||clearTimeout,e?t.bind(window):t}(),It=function(t){return Ct(t)&&t.slice(-1)==="%"},xh=function(t,e){function n(a){var c=new RegExp("(?:\\d+(?:\\.\\d+)*)("+a+")$").exec(t);return c?c[1]:null}var r=parseFloat(t);if(Number.isNaN(r))return null;var i={};i.value=r;var s;if(e==null)s="[A-Za-z]*";else if(Array.isArray(e)){if(e.length===0)return null;s=e.join("|")}else Ct(e)&&(s=e);var o=n(s);return o===null?null:(i.unit=o,i)},Pn=0;function wh(t,e){const n=t.split(e);let r=1;for(let i=0,s=n.length-1;i<s;i++){const o=[];(i>0||n[0]!=="")&&o.push(Pn),o.push(e),(i<s-1||n[s]!=="")&&o.push(Pn),n.splice(r,0,...o),r+=o.length+1}return n.filter(i=>i!=="")}function Js(t,e){if(t===null)return e.getBBox().height;switch(t.unit){case"em":return e.getBBox().height*t.value;case"px":case"":return t.value}}const Sh=function(t,e,n={},r={}){var i=e.width,s=e.height,o=r.svgDocument||z("svg").node,a=z("tspan").node,c=z("text").attr(n).append(a).node,l=document.createTextNode("");c.style.opacity=0,c.style.display="block",a.style.display="block",a.appendChild(l),o.appendChild(c),r.svgDocument||document.body.appendChild(o);const f=r.preserveSpaces,u=" ",d=r.separator||r.separator===""?r.separator:u,g=typeof d=="string"?d:u;var v=r.eol||`
`,y=r.hyphen?new RegExp(r.hyphen):/[^\w\d\u00C0-\u1FFF\u2800-\uFFFD]/,x=r.maxLineCount;Bt(x)||(x=1/0);var w=t.split(d),T=[],P=[],M,I,D;f&&z(a).attr("xml:space","preserve");for(var h=0,p=0,m=w.length;h<m;h++){var b=w[h];if(!(!b&&!f)&&typeof b=="string"){var S=!1;if(b.indexOf(v)>=0)if(b.length>1){const ct=wh(w[h],v);w.splice(h,1,...ct),h--,m=w.length;continue}else{if(f&&typeof w[h-1]=="string"){w.splice(h,Pn,"",Pn),m+=2,h--;continue}P[++p]=!f||typeof w[h+1]=="string"?"":void 0,S=!0}if(!S){let ct;if(f?ct=P[p]!==void 0?P[p]+g+b:b:ct=P[p]?P[p]+g+b:b,l.data=ct,a.getComputedTextLength()<=i)P[p]=ct,(M||I)&&(T[p++]=!0,M=0,I=0);else{if(!P[p]||M){var O=!!M;if(M=b.length-1,O||!M){if(!M){if(!P[p]){P=[];break}w.splice(h,2,b+w[h+1]),m--,T[p++]=!0,h--;continue}w[h]=b.substring(0,M);const ot=w[h+1];w[h+1]=b.substring(M)+(ot===void 0||ot===Pn?"":ot)}else{if(I)w.splice(h,2,w[h]+w[h+1]),I=0;else{var N=b.search(y);N>-1&&N!==b.length-1&&N!==0&&(I=N+1,M=0),w.splice(h,1,b.substring(0,I||M),b.substring(I||M)),m++}p&&!T[p-1]&&p--}(!f||P[p]!=="")&&h--;continue}p++,h--}}var F=null;if(P.length>x)F=x-1;else if(s!==void 0){if(D===void 0&&l.data!=="")if(n.lineHeight==="auto")D=Js({value:1.5,unit:"em"},c);else{const ct=xh(n.lineHeight,["em","px",""]);D=Js(ct,c)}D*P.length>s&&(F=Math.floor(s/D)-1)}if(F!==null){P.splice(F+1);var q=r.ellipsis;if(!q||F<0)break;typeof q!="string"&&(q="");var A=P[F];if(!A&&!S)break;var C=A.length,_,L;do{if(L=A[C],_=A.substring(0,C),L?L.match(d)&&(_+=L):_+=g,_+=q,l.data=_,a.getComputedTextLength()<=i){P[F]=_;break}C--}while(C>=0);break}}}return r.svgDocument?o.removeChild(c):document.body.removeChild(o),P.join(v)},Ah=function(t,e){t=j(t).toArray();var n=t.map(function(i){var s=i.parentNode,o=s.insertBefore(document.createTextNode(""),i.nextSibling);return function(){if(s===this)throw new Error("You can't sort elements if any one is a descendant of another.");s.insertBefore(this,o),s.removeChild(o)}});t.sort(e);for(var r=0;r<n.length;r++)n[r].call(t[r]);return t},Oe=function(t){if(Object(t)!==t){var e=0;return isFinite(t)&&(e=+t),{top:e,right:e,bottom:e,left:e}}var n,r,i,s;return n=r=i=s=0,isFinite(t.vertical)&&(n=i=+t.vertical),isFinite(t.horizontal)&&(r=s=+t.horizontal),isFinite(t.top)&&(n=+t.top),isFinite(t.right)&&(r=+t.right),isFinite(t.bottom)&&(i=+t.bottom),isFinite(t.left)&&(s=+t.left),{top:n,right:r,bottom:i,left:s}},Th={linear:function(t){return t}},xc={number:function(t,e){var n=e-t;return function(r){return t+n*r}},object:function(t,e){var n=Object.keys(t);return function(r){var i,s,o={};for(i=n.length-1;i!=-1;i--)s=n[i],o[s]=t[s]+(e[s]-t[s])*r;return o}}},Eh={outline:function(t){var e='<filter><feFlood flood-color="${color}" flood-opacity="${opacity}" result="colored"/><feMorphology in="SourceAlpha" result="morphedOuter" operator="dilate" radius="${outerRadius}" /><feMorphology in="SourceAlpha" result="morphedInner" operator="dilate" radius="${innerRadius}" /><feComposite result="morphedOuterColored" in="colored" in2="morphedOuter" operator="in"/><feComposite operator="xor" in="morphedOuterColored" in2="morphedInner" result="outline"/><feMerge><feMergeNode in="outline"/><feMergeNode in="SourceGraphic"/></feMerge></filter>',n=Number.isFinite(t.margin)?t.margin:2,r=Number.isFinite(t.width)?t.width:1;return ne(e)({color:t.color||"blue",opacity:Number.isFinite(t.opacity)?t.opacity:1,outerRadius:n+r,innerRadius:n})},highlight:function(t){var e='<filter><feFlood flood-color="${color}" flood-opacity="${opacity}" result="colored"/><feMorphology result="morphed" in="SourceGraphic" operator="dilate" radius="${width}"/><feComposite result="composed" in="colored" in2="morphed" operator="in"/><feGaussianBlur result="blured" in="composed" stdDeviation="${blur}"/><feBlend in="SourceGraphic" in2="blured" mode="normal"/></filter>';return ne(e)({color:t.color||"red",width:Number.isFinite(t.width)?t.width:1,blur:Number.isFinite(t.blur)?t.blur:0,opacity:Number.isFinite(t.opacity)?t.opacity:1})},blur:function(t){var e=Number.isFinite(t.x)?t.x:2;return ne('<filter><feGaussianBlur stdDeviation="${stdDeviation}"/></filter>')({stdDeviation:Number.isFinite(t.y)?[e,t.y]:e})},dropShadow:function(t){var e="SVGFEDropShadowElement"in window?'<filter><feDropShadow stdDeviation="${blur}" dx="${dx}" dy="${dy}" flood-color="${color}" flood-opacity="${opacity}"/></filter>':'<filter><feGaussianBlur in="SourceAlpha" stdDeviation="${blur}"/><feOffset dx="${dx}" dy="${dy}" result="offsetblur"/><feFlood flood-color="${color}"/><feComposite in2="offsetblur" operator="in"/><feComponentTransfer><feFuncA type="linear" slope="${opacity}"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>';return ne(e)({dx:t.dx||0,dy:t.dy||0,opacity:Number.isFinite(t.opacity)?t.opacity:1,color:t.color||"black",blur:Number.isFinite(t.blur)?t.blur:4})},grayscale:function(t){var e=Number.isFinite(t.amount)?t.amount:1;return ne('<filter><feColorMatrix type="matrix" values="${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${b} ${h} 0 0 0 0 0 1 0"/></filter>')({a:.2126+.7874*(1-e),b:.7152-.7152*(1-e),c:.0722-.0722*(1-e),d:.2126-.2126*(1-e),e:.7152+.2848*(1-e),f:.0722-.0722*(1-e),g:.2126-.2126*(1-e),h:.0722+.9278*(1-e)})},sepia:function(t){var e=Number.isFinite(t.amount)?t.amount:1;return ne('<filter><feColorMatrix type="matrix" values="${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${h} ${i} 0 0 0 0 0 1 0"/></filter>')({a:.393+.607*(1-e),b:.769-.769*(1-e),c:.189-.189*(1-e),d:.349-.349*(1-e),e:.686+.314*(1-e),f:.168-.168*(1-e),g:.272-.272*(1-e),h:.534-.534*(1-e),i:.131+.869*(1-e)})},saturate:function(t){var e=Number.isFinite(t.amount)?t.amount:1;return ne('<filter><feColorMatrix type="saturate" values="${amount}"/></filter>')({amount:1-e})},hueRotate:function(t){return ne('<filter><feColorMatrix type="hueRotate" values="${angle}"/></filter>')({angle:t.angle||0})},invert:function(t){var e=Number.isFinite(t.amount)?t.amount:1;return ne('<filter><feComponentTransfer><feFuncR type="table" tableValues="${amount} ${amount2}"/><feFuncG type="table" tableValues="${amount} ${amount2}"/><feFuncB type="table" tableValues="${amount} ${amount2}"/></feComponentTransfer></filter>')({amount:e,amount2:1-e})},brightness:function(t){return ne('<filter><feComponentTransfer><feFuncR type="linear" slope="${amount}"/><feFuncG type="linear" slope="${amount}"/><feFuncB type="linear" slope="${amount}"/></feComponentTransfer></filter>')({amount:Number.isFinite(t.amount)?t.amount:1})},contrast:function(t){var e=Number.isFinite(t.amount)?t.amount:1;return ne('<filter><feComponentTransfer><feFuncR type="linear" slope="${amount}" intercept="${amount2}"/><feFuncG type="linear" slope="${amount}" intercept="${amount2}"/><feFuncB type="linear" slope="${amount}" intercept="${amount2}"/></feComponentTransfer></filter>')({amount:e,amount2:.5-e/2})}},ne=function(t){var e=/<%= ([^ ]+) %>|\$\{ ?([^{} ]+) ?\}|\{\{([^{} ]+)\}\}/g;return function(n){return n=n||{},t.replace(e,function(r){for(var i=Array.from(arguments),s=i.slice(1,4).find(function(c){return!!c}),o=s.split("."),a=n[o.shift()];a!==void 0&&o.length;)a=a[o.shift()];return a!==void 0?a:""})}};function wc(t,e,n,r){if(n===r)return{};const i={};return Object.keys(t).forEach(s=>{const o=t[s],a=e[s];if(!Array.isArray(o)&&!Array.isArray(a)&&gt(o)&&gt(a)){const c=n+1,l=wc(o,a,c,r);Object.keys(l).length>0?i[s]=l:(n===0||c===r)&&(i[s]={})}else _e(o,a)||(i[s]=o)}),i}function Ph(t,e,n){const{maxDepth:r=Number.POSITIVE_INFINITY}=n||{};return wc(t,e,0,r)}var Gt={},Ks=/\s+/,Ce,Je=function(t,e,n,r,i){var s=0,o;if(n&&typeof n=="object")for(r!==void 0&&("context"in i)&&i.context===void 0&&(i.context=r),o=Object.keys(n);s<o.length;s++)e=Je(t,e,o[s],n[o[s]],i);else if(n&&Ks.test(n))for(o=n.split(Ks);s<o.length;s++)e=t(e,o[s],r,i);else e=t(e,n,r,i);return e};Gt.on=function(t,e,n){if(this._events=Je(Ch,this._events||{},t,e,{context:n,ctx:this,listening:Ce}),Ce){var r=this._listeners||(this._listeners={});r[Ce.id]=Ce,Ce.interop=!1}return this};Gt.listenTo=function(t,e,n){if(!t)return this;var r=t._listenId||(t._listenId=kn("l")),i=this._listeningTo||(this._listeningTo={}),s=Ce=i[r];s||(this._listenId||(this._listenId=kn("l")),s=Ce=i[r]=new Wr(this,t));var o=_h(t,e,n,this);if(Ce=void 0,o)throw o;return s.interop&&s.on(e,n),this};var Ch=function(t,e,n,r){if(n){var i=t[e]||(t[e]=[]),s=r.context,o=r.ctx,a=r.listening;a&&a.count++,i.push({callback:n,context:s,ctx:s||o,listening:a})}return t},_h=function(t,e,n,r){try{t.on(e,n,r)}catch(i){return i}};Gt.off=function(t,e,n){return this._events?(this._events=Je(Sc,this._events,t,e,{context:n,listeners:this._listeners}),this):this};Gt.stopListening=function(t,e,n){var r=this._listeningTo;if(!r)return this;for(var i=t?[t._listenId]:Object.keys(r),s=0;s<i.length;s++){var o=r[i[s]];if(!o)break;o.obj.off(e,n,this),o.interop&&o.off(e,n)}return Xt(r)&&(this._listeningTo=void 0),this};var Sc=function(t,e,n,r){if(t){var i=r.context,s=r.listeners,o=0,a;if(!e&&!i&&!n){if(s!=null)for(a=Object.keys(s);o<a.length;o++)s[a[o]].cleanup();return}for(a=e?[e]:Object.keys(t);o<a.length;o++){e=a[o];var c=t[e];if(!c)break;for(var l=[],f=0;f<c.length;f++){var u=c[f];if(n&&n!==u.callback&&n!==u.callback._callback||i&&i!==u.context)l.push(u);else{var d=u.listening;d&&d.off(e,n)}}l.length?t[e]=l:delete t[e]}return t}};Gt.once=function(t,e,n){var r=Je(Ac,{},t,e,this.off.bind(this));return typeof t=="string"&&n==null&&(e=void 0),this.on(r,e,n)};Gt.listenToOnce=function(t,e,n){var r=Je(Ac,{},e,n,this.stopListening.bind(this,t));return this.listenTo(t,r)};var Ac=function(t,e,n,r){if(n){var i=t[e]=Lh(function(){r(e,i),n.apply(this,arguments)});i._callback=n}return t},Lh=function(t){var e;if(typeof t!="function")throw new TypeError("Expected a function");var n=2;return function(){return--n>0&&(e=t.apply(this,arguments)),n<=1&&(t=void 0),e}};Gt.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),n=Array(e),r=0;r<e;r++)n[r]=arguments[r+1];return Je(Mh,this._events,t,void 0,n),this};var Mh=function(t,e,n,r){if(t){var i=t[e],s=t.all;i&&s&&(s=s.slice()),i&&Qs(i,r),s&&Qs(s,[e].concat(r))}return t},Qs=function(t,e){var n,r=-1,i=t.length,s=e[0],o=e[1],a=e[2];switch(e.length){case 0:for(;++r<i;)(n=t[r]).callback.call(n.ctx);return;case 1:for(;++r<i;)(n=t[r]).callback.call(n.ctx,s);return;case 2:for(;++r<i;)(n=t[r]).callback.call(n.ctx,s,o);return;case 3:for(;++r<i;)(n=t[r]).callback.call(n.ctx,s,o,a);return;default:for(;++r<i;)(n=t[r]).callback.apply(n.ctx,e);return}},Wr=function(t,e){this.id=t._listenId,this.listener=t,this.obj=e,this.interop=!0,this.count=0,this._events=void 0};Wr.prototype.on=Gt.on;Wr.prototype.off=function(t,e){var n;this.interop?(this._events=Je(Sc,this._events,t,e,{context:void 0,listeners:void 0}),n=!this._events):(this.count--,n=this.count===0),n&&this.cleanup()};Wr.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]};Gt.bind=Gt.on;Gt.unbind=Gt.off;var hs=function(t,e){var n=this,r;return t&&ge(t,"constructor")?r=t.constructor:r=function(){return n.apply(this,arguments)},J(r,n,e),r.prototype=Object.assign(Object.create(n.prototype),t),r.prototype.constructor=r,r.__super__=n.prototype,r},Oh=function(t,e,n,r){switch(e){case 1:return function(){return t[n](this[r])};case 2:return function(i){return t[n](this[r],i)};case 3:return function(i,s){return t[n](this[r],to(i,this),s)};case 4:return function(i,s,o){return t[n](this[r],to(i,this),s,o)};default:return function(){var i=Array.prototype.slice.call(arguments);return i.unshift(this[r]),t[n].apply(t,i)}}},Nh=function(t,e,n,r){he(n,function(i,s){e[s]&&(t.prototype[s]=Oh(e,i,s,r))})},to=function(t,e){return yt(t)?t:gt(t)&&!e._isModel(t)?Ih(t):Ct(t)?function(n){return n.get(t)}:t},Ih=function(t){var e=wf(t);return function(n){return e(n.attributes)}},Jt=function(t,e){var n=t||{};e||(e={}),this.preinitialize.apply(this,arguments),this.cid=kn(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection);var r=xt(this,"defaults");n=Yt(J({},r,n),r),this.set(n,e),this.changed={},this.initialize.apply(this,arguments)};J(Jt.prototype,Gt,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(t){return Dt(this.attributes)},get:function(t){return this.attributes[t]},has:function(t){return this.get(t)!=null},set:function(t,e,n){if(t==null)return this;var r;if(typeof t=="object"?(r=t,n=e):(r={})[t]=e,n||(n={}),!this._validate(r,n))return!1;var i=n.unset,s=n.silent,o=[],a=this._changing;this._changing=!0,a||(this._previousAttributes=Dt(this.attributes),this.changed={});var c=this.attributes,l=this.changed,f=this._previousAttributes;for(var u in r)e=r[u],_e(c[u],e)||o.push(u),_e(f[u],e)?delete l[u]:l[u]=e,i?delete c[u]:c[u]=e;if(this.idAttribute in r){var d=this.id;this.id=this.get(this.idAttribute),this.trigger("changeId",this,d,n)}if(!s){o.length&&(this._pending=n);for(var g=0;g<o.length;g++)this.trigger("change:"+o[g],this,c[o[g]],n)}if(a)return this;if(!s)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,J({},e,{unset:!0}))},clear:function(t){var e={};for(var n in this.attributes)e[n]=void 0;return this.set(e,J({},t,{unset:!0}))},hasChanged:function(t){return t==null?!Xt(this.changed):ge(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?Dt(this.changed):!1;var e=this._changing?this._previousAttributes:this.attributes,n={},r;for(var i in t){var s=t[i];_e(e[i],s)||(n[i]=s,r=!0)}return r?n:!1},previous:function(t){return t==null||!this._previousAttributes?null:this._previousAttributes[t]},previousAttributes:function(){return Dt(this._previousAttributes)},clone:function(){return new this.constructor(this.attributes)},isValid:function(t){return this._validate({},J({},t,{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=J({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;return n?(this.trigger("invalid",this,n,J(e,{validationError:n})),!1):!0}});Jt.extend=hs;function Tc(t){t=Ye(t);const e=pt(t).reduce(function(n,r){return n[r.id]=r.clone(),n},{});return pt(t).forEach(function(n){const r=e[n.id];if(r.isLink()){const o=r.source(),a=r.target();o.id&&e[o.id]&&r.prop("source/id",e[o.id].id),a.id&&e[a.id]&&r.prop("target/id",e[a.id].id)}const i=n.get("parent");i&&e[i]&&r.set("parent",e[i].id);const s=pt(n.get("embeds")).reduce(function(o,a){return e[a]&&o.push(e[a].id),o},[]);Xt(s)||r.set("embeds",s)}),e}const Rh=["checked","selected","disabled","readOnly","contentEditable","value","indeterminate"],kh=Rh.reduce((t,e)=>(t[e]=!0,t),{}),Dh={qualify:function(t){return Pt(t)},set:function(t,e,n){Object.keys(t).forEach(function(r){if(kh[r]&&r in n){const i=t[r];n.tagName==="SELECT"&&Array.isArray(i)?Array.from(n.options).forEach(function(s,o){s.selected=i.includes(s.value)}):n[r]=i}})}};function ir(t,e,n){return function(r,i){var s=It(r);r=parseFloat(r),s&&(r/=100);var o;if(isFinite(r)){var a=i[n]();s||r>0&&r<1?o=a[t]+i[e]*r:o=a[t]+r}var c=E();return c[t]=o||0,c}}function Te(t,e){return function(n,r){var i=It(n);n=parseFloat(n),i&&(n/=100);var s={};if(isFinite(n)){var o=i||n>=0&&n<=1?n*r[e]:Math.max(n+r[e],0);s[t]=o}return s}}const Ut={"ref-x":{position:ir("x","width","origin")},"ref-y":{position:ir("y","height","origin")},"ref-dx":{position:ir("x","width","corner")},"ref-dy":{position:ir("y","height","corner")},"ref-width":{set:Te("width","width")},"ref-height":{set:Te("height","height")},"ref-rx":{set:Te("rx","width")},"ref-ry":{set:Te("ry","height")},"ref-cx":{set:Te("cx","width")},"ref-cy":{set:Te("cy","height")},"ref-r-inscribed":{set:function(t){var e=Te(t,"width"),n=Te(t,"height");return function(r,i){var s=i.height>i.width?e:n;return s(r,i)}}("r")},"ref-r-circumscribed":{set:function(t,e){var n=It(t);t=parseFloat(t),n&&(t/=100);var r=Math.sqrt(e.height*e.height+e.width*e.width),i;return isFinite(t)&&(n||t>=0&&t<=1?i=t*r:i=Math.max(t+r,0)),{r:i}}}};Ut.refX=Ut["ref-x"];Ut.refY=Ut["ref-y"];Ut["ref-x2"]=Ut["ref-x"];Ut["ref-y2"]=Ut["ref-y"];Ut["ref-width2"]=Ut["ref-width"];Ut["ref-height2"]=Ut["ref-height"];Ut["ref-r"]=Ut["ref-r-inscribed"];const ye={x:"x",y:"y",width:"w",height:"h",minimum:"s",maximum:"l",diagonal:"d"},Bh=Object.keys(ye).map(t=>ye[t]).join(""),ni="[-+]?[0-9]*\\.?[0-9]+(?:[eE][-+]?[0-9]+)?",Fh=/\s/g,eo=new RegExp(`^(${ni}\\*)?([${Bh}])(/${ni})?([-+]{1,2}${ni})?$`,"g");function Ec(t){throw new Error(`Invalid calc() expression: ${t}`)}function Vh(t,e){const n=eo.exec(t.replace(Fh,""));n||Ec(t),eo.lastIndex=0;const[,r,i,s,o]=n,{x:a,y:c,width:l,height:f}=e;let u=0;switch(i){case ye.width:{u=l;break}case ye.height:{u=f;break}case ye.x:{u=a;break}case ye.y:{u=c;break}case ye.minimum:{u=Math.min(f,l);break}case ye.maximum:{u=Math.max(f,l);break}case ye.diagonal:{u=Math.sqrt(f*f+l*l);break}}return r&&(u*=parseFloat(r)),s&&(u/=parseFloat(s.slice(1))),o&&(u+=zh(o)),u}function zh(t){if(!t)return 0;const[e]=t;switch(e){case"+":return parseFloat(t.substr(1));case"-":return-parseFloat(t.substr(1))}return parseFloat(t)}function Ne(t){return typeof t=="string"&&t.includes("calc")}const Pc="calc(",no=Pc.length;function Ie(t,e){let n=t,r=0;do{let i=n.indexOf(Pc,r);if(i===-1)return n;let s=i+no,o=1;t:do{switch(n[s]){case"(":{o++;break}case")":{if(o--,o===0)break t;break}case void 0:Ec(n)}s++}while(!0);let a=n.slice(i+no,s);Ne(a)&&(a=Ie(a,e));const c=String(Vh(a,e));n=n.slice(0,i)+c+n.slice(s+1),r=i+c.length}while(!0)}function en(t,e,n){return n.text!==void 0}const ri=["font-weight","font-family","font-size","letter-spacing","text-transform"],Cc={"line-height":{qualify:en},"text-vertical-anchor":{qualify:en},"text-path":{qualify:en},annotations:{qualify:en},eol:{qualify:en},"display-empty":{qualify:en},text:{qualify:function(t,e,n){const r=n["text-wrap"];return!r||!Pt(r)},unset:function(t){t.textContent=""},set:function(t,e,n,r){const i="joint-text",s=j.data.get(n,i),o=r["line-height"],a=r["text-vertical-anchor"],c=r["display-empty"],l=r["font-size"],f=r.annotations,u=r.eol,d=r.x;let g=r["text-path"];const v=JSON.stringify([t,o,f,a,u,c,g,d,l]);if(s===void 0||s!==v){if(l&&n.setAttribute("font-size",l),gt(g)){const y=g.selector;if(typeof y=="string"){const x=this.findNode(y);x instanceof SVGPathElement&&(g=J({"xlink:href":"#"+x.id},g))}}z(n).text(""+t,{lineHeight:o,annotations:f,textPath:g,x:d,textVerticalAnchor:a,eol:u,displayEmpty:c}),j.data.set(n,i,v)}}},"text-wrap":{qualify:Pt,set:function(t,e,n,r){var i={},s=t.width||0;It(s)?i.width=e.width*parseFloat(s)/100:Ne(s)?i.width=Number(Ie(s,e)):t.width===null?i.width=1/0:s<=0?i.width=e.width+s:i.width=s;var o=t.height||0;It(o)?i.height=e.height*parseFloat(o)/100:Ne(o)?i.height=Number(Ie(o,e)):t.height===null||(o<=0?i.height=e.height+o:i.height=o);var a,c=t.text;if(c===void 0&&(c=r.text),c!==void 0){const l=t.breakText||Sh,f=getComputedStyle(n),u={};for(let d=0;d<ri.length;d++){const g=ri[d];g in r&&n.setAttribute(g,r[g]),u[g]=f[g]}u.lineHeight=r["line-height"],a=l(""+c,i,u,{svgDocument:this.paper.svg,ellipsis:t.ellipsis,hyphen:t.hyphen,separator:t.separator,maxLineCount:t.maxLineCount,preserveSpaces:t.preserveSpaces})}else a="";Cc.text.set.call(this,a,e,n,r)},FONT_ATTRIBUTES:ri},title:{qualify:function(t,e){return e instanceof SVGElement},unset:function(t){j.data.remove(t,"joint-title");const e=t.firstElementChild;e&&e.remove()},set:function(t,e,n){var r="joint-title",i=j.data.get(n,r);if(i===void 0||i!==t){if(j.data.set(n,r,t),n.tagName==="title"){n.textContent=t;return}var s=n.firstElementChild;if(s&&s.tagName==="title")s.textContent=t;else{var o=document.createElementNS(n.namespaceURI,"title");o.textContent=t,n.insertBefore(o,s)}}}}};function sr(t,e){var n=new E(1,0);return function(r){var i,s,o=this[t](r);return o?(s=e.rotate?o.vector().vectorAngle(n):0,i=o.start):(i=this.path.start,s=0),s===0?{transform:"translate("+i.x+","+i.y+")"}:{transform:"translate("+i.x+","+i.y+") rotate("+s+")"}}}function Sn(){return this.model.isLink()}const Dn={connection:{qualify:Sn,unset:"d",set:function({stubs:t=0}){let e;if(isFinite(t)&&t!==0){let n;t<0?n=(this.getConnectionLength()+t)/2:n=t;const r=this.getConnection(),i=this.getConnectionSubdivisions(),s=r.divideAtLength(n,{segmentSubdivisions:i}),o=r.divideAtLength(-n,{segmentSubdivisions:i});s&&o&&(e=`${s[0].serialize()} ${o[1].serialize()}`)}return{d:e||this.getSerializedConnection()}}},"at-connection-length-keep-gradient":{qualify:Sn,unset:"transform",set:sr("getTangentAtLength",{rotate:!0})},"at-connection-length-ignore-gradient":{qualify:Sn,unset:"transform",set:sr("getTangentAtLength",{rotate:!1})},"at-connection-ratio-keep-gradient":{qualify:Sn,unset:"transform",set:sr("getTangentAtRatio",{rotate:!0})},"at-connection-ratio-ignore-gradient":{qualify:Sn,unset:"transform",set:sr("getTangentAtRatio",{rotate:!1})}};Dn["at-connection-length"]=Dn["at-connection-length-keep-gradient"];Dn["at-connection-ratio"]=Dn["at-connection-ratio-keep-gradient"];function _c(t,e){var n="joint-shape",r=e&&e.resetOffset;return function(i,s,o){var a=j.data.get(o,n);if(!a||a.value!==i){var c=t(i);a={value:i,shape:c,shapeBBox:c.bbox()},j.data.set(o,n,a)}var l=a.shape.clone(),f=a.shapeBBox.clone(),u=f.origin(),d=s.origin();f.x=d.x,f.y=d.y;var g=s.maxRectScaleToFit(f,d),v=f.width===0||s.width===0?1:g.sx,y=f.height===0||s.height===0?1:g.sy;return l.scale(v,y,u),r&&l.translate(-u.x,-u.y),l}}function ro(t){function e(r){return new et(z.normalizePathData(r))}var n=_c(e,t);return function(r,i,s){var o=n(r,i,s);return{d:o.serialize()}}}function io(t){var e=_c(St,t);return function(n,r,i){var s=e(n,r,i);return{points:s.serialize()}}}const Bn={"ref-d-reset-offset":{unset:"d",set:ro({resetOffset:!0})},"ref-d-keep-offset":{unset:"d",set:ro({resetOffset:!1})},"ref-points-reset-offset":{unset:"points",set:io({resetOffset:!0})},"ref-points-keep-offset":{unset:"points",set:io({resetOffset:!1})}};Bn["ref-d"]=Bn["ref-d-reset-offset"];Bn["ref-points"]=Bn["ref-points-reset-offset"];function ii(t){var e={},n=t.stroke;typeof n=="string"&&(e.stroke=n,e.fill=n);var r=t["stroke-opacity"];return r===void 0&&(r=t.opacity),r!==void 0&&(e["stroke-opacity"]=r,e["fill-opacity"]=r),e}function so(t){const{paper:e}=this;return`url(#${t.type==="pattern"?e.definePattern(t):e.defineGradient(t)})`}const Gh={"source-marker":{qualify:Pt,unset:"marker-start",set:function(t,e,n,r){return t=J(ii(r),t),{"marker-start":"url(#"+this.paper.defineMarker(t)+")"}}},"target-marker":{qualify:Pt,unset:"marker-end",set:function(t,e,n,r){return t=J(ii(r),{transform:"rotate(180)"},t),{"marker-end":"url(#"+this.paper.defineMarker(t)+")"}}},"vertex-marker":{qualify:Pt,unset:"marker-mid",set:function(t,e,n,r){return t=J(ii(r),t),{"marker-mid":"url(#"+this.paper.defineMarker(t)+")"}}},fill:{qualify:Pt,set:so},stroke:{qualify:Pt,set:so},filter:{qualify:Pt,set:function(t){return"url(#"+this.paper.defineFilter(t)+")"}}};function oo(t,e,n){return function(r,i){var s;r==="middle"?s=i[e]/2:r===n?s=i[e]:isFinite(r)?s=r>-1&&r<1?-i[e]*r:-r:It(r)?s=i[e]*parseFloat(r)/100:s=0;var o=new E;return o[t]=-(i[t]+s),o}}const Uh={"x-alignment":{offset:oo("x","width","right")},"y-alignment":{offset:oo("y","height","bottom")},"reset-offset":{offset:function(t,e){return t?{x:-e.x,y:-e.y}:{x:0,y:0}}}};function ao(t){return function(n,r,i){const s=z(i);s.attr(t)!==n&&s.attr(t,n)}}const Ke={ref:{},href:{set:ao("href")},"xlink:href":{set:ao("xlink:href")},port:{set:function(t){return t===null||t.id===void 0?t:t.id}},style:{qualify:Pt,set:function(t,e,n){j(n).css(t)}},html:{unset:function(t){j(t).empty()},set:function(t,e,n){j(n).html(t+"")}},props:Dh};J(Ke,Ut);J(Ke,Cc);J(Ke,Dn);J(Ke,Bn);J(Ke,Gh);J(Ke,Uh);const Lc=Ke,$h=function(t,e){if(Array.isArray(t))return e};function co(t){for(const e in t){const n=t[e];gt(n)&&!Array.isArray(n)&&Xt(n)&&delete t[e]}}const ve=Jt.extend({constructor:function(t,e){var n,r=t||{};if(typeof this.preinitialize=="function"&&this.preinitialize.apply(this,arguments),this.cid=kn("c"),this.attributes={},e&&e.collection&&(this.collection=e.collection),e&&e.parse&&(r=this.parse(r,e)||{}),n=xt(this,"defaults")){const i=e&&e.mergeArrays===!0?!1:$h;r=Lt({},n,r,i)}this.set(r,e),this.changed={},this.initialize.apply(this,arguments)},translate:function(t,e,n){throw new Error("Must define a translate() method.")},toJSON:function(t){const{ignoreDefaults:e,ignoreEmptyAttributes:n=!1}=t||{},r=xt(this.constructor.prototype,"defaults");if(e===!1){const a=jt(this.attributes);return n&&co(a),a}let i={},s=jt(this.attributes);e===!0?i=r:(Array.isArray(e)?e:["attrs"]).forEach(c=>{i[c]=r[c]||{}});const o=Ph(s,Wn(i,"id","type"),{maxDepth:4});return n&&co(o),o},initialize:function(t){const e=this.getIdAttribute();(!t||t[e]===void 0)&&this.set(e,this.generateId(),{silent:!0}),this._transitionIds={},this._scheduledTransitionIds={},this.processPorts(),this.on("change:attrs",this.processPorts,this)},getIdAttribute:function(){return this.idAttribute||"id"},generateId:function(){return mh()},processPorts:function(){var t=this.ports,e={};he(this.get("attrs"),function(s,o){s&&s.port&&(s.port.id!==void 0?e[s.port.id]=s.port:e[s.port]={id:s.port})});var n={};if(he(t,function(s,o){e[o]||(n[o]=!0)}),this.graph&&!Xt(n)){var r=this.graph.getConnectedLinks(this,{inbound:!0});r.forEach(function(s){n[s.get("target").port]&&s.remove()});var i=this.graph.getConnectedLinks(this,{outbound:!0});i.forEach(function(s){n[s.get("source").port]&&s.remove()})}this.ports=e},remove:function(t={}){const{graph:e,collection:n}=this;if(!e)return n&&n.remove(this,t),this;e.startBatch("remove");const r=this.getParentCell();r&&r.unembed(this,t);const i=this.getEmbeddedCells();for(let s=0,o=i.length;s<o;s++){const a=i[s];a&&a.remove(t)}return this.trigger("remove",this,e.attributes.cells,t),e.stopBatch("remove"),this},toFront:function(t){var e=this.graph;if(e){t=Yt(t||{},{foregroundEmbeds:!0});let n;t.deep?(n=this.getEmbeddedCells({deep:!0,breadthFirst:t.breadthFirst!==!1,sortSiblings:t.foregroundEmbeds}),n.unshift(this)):n=[this];const r=t.foregroundEmbeds?n:dr(n,c=>c.z());let s=e.maxZIndex()-n.length+1;const o=e.get("cells");let a=o.toArray().indexOf(r[0])!==o.length-n.length;a||(a=r.some(function(c,l){return c.z()!==s+l})),a&&(this.startBatch("to-front"),s=s+n.length,r.forEach(function(c,l){c.set("z",s+l,t)}),this.stopBatch("to-front"))}return this},toBack:function(t){var e=this.graph;if(e){t=Yt(t||{},{foregroundEmbeds:!0});let r;t.deep?(r=this.getEmbeddedCells({deep:!0,breadthFirst:t.breadthFirst!==!1,sortSiblings:t.foregroundEmbeds}),r.unshift(this)):r=[this];const i=t.foregroundEmbeds?r:dr(r,a=>a.z());let s=e.minZIndex();var n=e.get("cells");let o=n.toArray().indexOf(i[0])!==0;o||(o=i.some(function(a,c){return a.z()!==s+c})),o&&(this.startBatch("to-back"),s-=r.length,i.forEach(function(a,c){a.set("z",s+c,t)}),this.stopBatch("to-back"))}return this},parent:function(t,e){return t===void 0?this.get("parent"):this.set("parent",t,e)},embed:function(t,e={}){const n=Array.isArray(t)?t:[t];if(!this.canEmbed(n))throw new Error("Recursive embedding not allowed.");if(e.reparent)Ye(n.map(i=>i.getParentCell())).forEach(i=>{i&&i._unembedCells(n,e)});else if(n.some(r=>r.isEmbedded()&&this.id!==r.parent()))throw new Error("Embedding of already embedded cells is not allowed.");return this._embedCells(n,e),this},unembed:function(t,e){const n=Array.isArray(t)?t:[t];return this._unembedCells(n,e),this},canEmbed:function(t){return(Array.isArray(t)?t:[t]).every(n=>this!==n&&!this.isEmbeddedIn(n))},_embedCells:function(t,e){const n="embed";this.startBatch(n);const r=J([],this.get("embeds"));t.forEach(i=>{r[i.isLink()?"unshift":"push"](i.id),i.parent(this.id,e)}),this.set("embeds",Ye(r),e),this.stopBatch(n)},_unembedCells:function(t,e){const n="unembed";this.startBatch(n),t.forEach(r=>r.unset("parent",e)),this.set("embeds",Ws(this.get("embeds"),...t.map(r=>r.id)),e),this.stopBatch(n)},getParentCell:function(){var t=this.parent(),e=this.graph;return t&&e&&e.getCell(t)||null},getAncestors:function(){var t=[];if(!this.graph)return t;for(var e=this.getParentCell();e;)t.push(e),e=e.getParentCell();return t},getEmbeddedCells:function(t){if(t=t||{},!this.graph)return[];if(t.deep)return t.breadthFirst?this._getEmbeddedCellsBfs(t.sortSiblings):this._getEmbeddedCellsDfs(t.sortSiblings);const e=this.get("embeds");if(Xt(e))return[];let n=e.map(this.graph.getCell,this.graph);return t.sortSiblings&&(n=dr(n,r=>r.z())),n},_getEmbeddedCellsBfs:function(t){const e=[],n=[];for(n.push(this);n.length>0;){const r=n.shift();e.push(r);const i=r.getEmbeddedCells({sortSiblings:t});n.push(...i)}return e.shift(),e},_getEmbeddedCellsDfs:function(t){const e=[],n=[];for(n.push(this);n.length>0;){const r=n.pop();e.push(r);const i=r.getEmbeddedCells({sortSiblings:t});for(let s=i.length-1;s>=0;--s)n.push(i[s])}return e.shift(),e},isEmbeddedIn:function(t,e){var n=Ct(t)?t:t.id,r=this.parent();if(e=J({deep:!0},e),this.graph&&e.deep){for(;r;){if(r===n)return!0;r=this.graph.getCell(r).parent()}return!1}else return r===n},isEmbedded:function(){return!!this.parent()},clone:function(t){if(t=t||{},t.deep)return pt(Tc([this].concat(this.getEmbeddedCells({deep:!0}))));var e=Jt.prototype.clone.apply(this,arguments);return e.set(this.getIdAttribute(),this.generateId()),e.unset("embeds"),e.unset("parent"),e},prop:function(t,e,n){var r="/",i=Ct(t);if(i||Array.isArray(t))if(arguments.length>1){var s,o;i?(s=t,o=s.split("/")):(s=t.join(r),o=t.slice());var a=o[0],c=o.length;const P=n||{};P.propertyPath=s,P.propertyValue=e,P.propertyPathArray=o,"rewrite"in P||(P.rewrite=!1);for(var l={},f=l,u=a,d=1;d<c;d++){var g=o[d],v=Number.isFinite(i?Number(g):g);f=f[u]=v?[]:{},u=g}l=Xs(l,o,e,"/");var y=Lt({},this.attributes);P.rewrite&&Zs(y,s,"/");var x=Lt(y,l);return this.set(a,x[a],P)}else return vn(this.attributes,t,r);const w=e||{};w.propertyPath=null,w.propertyValue=t,w.propertyPathArray=[],"rewrite"in w||(w.rewrite=!1);const T={};for(const P in t){const{changedValue:M}=Lt({},{changedValue:this.attributes[P]},{changedValue:t[P]});T[P]=M}return this.set(T,w)},removeProp:function(t,e){e=e||{};var n=Array.isArray(t)?t:t.split("/"),r=n[0];if(r==="attrs"&&(e.dirty=!0),n.length===1)return this.unset(t,e);var i=n.slice(1),s=this.get(r);return s==null?this:(s=jt(s),Zs(s,i,"/"),this.set(r,s,e))},attr:function(t,e,n){var r=Array.from(arguments);return r.length===0?this.get("attrs"):(Array.isArray(t)?r[0]=["attrs"].concat(t):Ct(t)?r[0]="attrs/"+t:r[0]={attrs:t},this.prop.apply(this,r))},removeAttr:function(t,e){return Array.isArray(t)?this.removeProp(["attrs"].concat(t)):this.removeProp("attrs/"+t,e)},transition:function(t,e,n,r){r=r||"/";var i={duration:100,delay:10,timingFunction:Th.linear,valueFunction:xc.number};n=J(i,n);var s=0,o,a=(function(u){var d,g,v;s=s||u,u-=s,g=u/n.duration,g<1?this._transitionIds[t]=d=Ci(a):(g=1,delete this._transitionIds[t]),v=o(n.timingFunction(g)),n.transitionId=d,this.prop(t,v,n),d||this.trigger("transition:end",this,t)}).bind(this);const{_scheduledTransitionIds:c}=this;let l;var f=u=>{c[t]&&(c[t]=Ws(c[t],l),c[t].length===0&&delete c[t]),this.stopPendingTransitions(t,r),o=n.valueFunction(vn(this.attributes,t,r),e),this._transitionIds[t]=Ci(u),this.trigger("transition:start",this,t)};return l=setTimeout(f,n.delay,a),c[t]||(c[t]=[]),c[t].push(l),l},getTransitions:function(){return Pi(Object.keys(this._transitionIds),Object.keys(this._scheduledTransitionIds))},stopScheduledTransitions:function(t,e="/"){const{_scheduledTransitionIds:n={}}=this;let r=Object.keys(n);if(t){const i=t.split(e);r=r.filter(s=>_e(i,s.split(e).slice(0,i.length)))}return r.forEach(i=>{n[i].forEach(o=>clearTimeout(o)),delete n[i]}),this},stopPendingTransitions(t,e="/"){const{_transitionIds:n={}}=this;let r=Object.keys(n);if(t){const i=t.split(e);r=r.filter(s=>_e(i,s.split(e).slice(0,i.length)))}r.forEach(i=>{const s=n[i];vr(s),delete n[i],this.trigger("transition:end",this,i)})},stopTransitions:function(t,e="/"){return this.stopScheduledTransitions(t,e),this.stopPendingTransitions(t,e),this},addTo:function(t,e){return t.addCell(this,e),this},findView:function(t){return t.findViewByModel(this)},isElement:function(){return!1},isLink:function(){return!1},startBatch:function(t,e){return this.graph&&this.graph.startBatch(t,J({},e,{cell:this})),this},stopBatch:function(t,e){return this.graph&&this.graph.stopBatch(t,J({},e,{cell:this})),this},getChangeFlag:function(t){var e=0;if(!t)return e;for(var n in t)!t.hasOwnProperty(n)||!this.hasChanged(n)||(e|=t[n]);return e},angle:function(){return 0},position:function(){return new E(0,0)},z:function(){return this.get("z")||0},getPointFromConnectedLink:function(){return new E},getBBox:function(){return new Y(0,0,0,0)},getPointRotatedAroundCenter(t,e,n){const r=new E(e,n);return t&&r.rotate(this.getBBox().center(),t),r},getAbsolutePointFromRelative(t,e){return this.getPointRotatedAroundCenter(-this.angle(),this.position().offset(t,e))},getRelativePointFromAbsolute(t,e){return this.getPointRotatedAroundCenter(this.angle(),t,e).difference(this.position())}},{getAttributeDefinition:function(t){var e=this.attributes,n=Lc;return e&&e[t]||n[t]},define:function(t,e,n,r){n=J({defaults:us({type:t},e,this.prototype.defaults)},n);var i=this.extend(n,r);return typeof joint<"u"&&ge(joint,"shapes")&&Xs(joint.shapes,t,i,"."),i}}),Hh=function(t,e,n){if(Ct(n)){if(!_i[n])throw new Error('Unknown wrapper: "'+n+'"');n=_i[n]}if(!yt(n))throw new Error("Wrapper must be a function.");pt(e).forEach(function(r){t[r]=n(t[r])})},_i={cells:function(t){return function(){var e=Array.from(arguments),n=e.length,r=n>0&&e[0]||[],i=n>1&&e[n-1]||{};return Array.isArray(r)||(i instanceof ve?r=e:r instanceof ve&&(e.length>1&&e.pop(),r=e)),i instanceof ve&&(i={}),t.call(this,r,i)}}},Tt={TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left",TOP_LEFT:"top-left",TOP_RIGHT:"top-right",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",CENTER:"center"};function Mc(t,e){const n=new Y(t);switch(e){case void 0:throw new Error("Position required");case Tt.LEFT:case"leftMiddle":return n.leftMiddle();case Tt.RIGHT:case"rightMiddle":return n.rightMiddle();case Tt.TOP:case"topMiddle":return n.topMiddle();case Tt.BOTTOM:case"bottomMiddle":return n.bottomMiddle();case Tt.TOP_LEFT:case"topLeft":case"origin":return n.topLeft();case Tt.TOP_RIGHT:case"topRight":return n.topRight();case Tt.BOTTOM_LEFT:case"bottomLeft":return n.bottomLeft();case Tt.BOTTOM_RIGHT:case"bottomRight":case"corner":return n.bottomRight();case Tt.CENTER:return n.center();default:throw new Error(`Unknown position: ${e}`)}}function Oc(t,e,n){var r=t.toJSON();return r.angle=e||0,Yt({},n,r)}function jn(t,e,n,r){return t.map(function(i,s,o){var a=this.pointAt((s+.5)/o.length);return(i.dx||i.dy)&&a.offset(i.dx||0,i.dy||0),Oc(a.round(),0,ds(r,i))},qe(e,n))}function Nc(t,e,n,r){var i=e.center(),s=e.width/e.height,o=e.topMiddle(),a=Vt.fromRect(e);return t.map(function(c,l,f){var u=n+r(l,f.length),d=o.clone().rotate(i,-u).scale(s,1,i),g=c.compensateRotation?-a.tangentTheta(d):0;return(c.dx||c.dy)&&d.offset(c.dx||0,c.dy||0),c.dr&&d.move(i,c.dr),Oc(d.round(),g,ds(e,c))})}function ds(t,e){let{x:n,y:r,angle:i}=e;return It(n)?n=parseFloat(n)/100*t.width:Ne(n)&&(n=Number(Ie(n,t))),It(r)?r=parseFloat(r)/100*t.height:Ne(r)&&(r=Number(Ie(r,t))),{x:n,y:r,angle:i}}function Li(t,e){const{x:n,y:r}=ds(t,e);return new E(n||0,r||0)}const qh=function(t,e){return t.map(n=>{const r=Li(e,n).round().toJSON();return r.angle=n.angle||0,r})},Wh=function(t,e,n){return n.fn(t,e,n)},jh=function(t,e,n){var r=Li(e,n.start||e.origin()),i=Li(e,n.end||e.corner());return jn(t,r,i,e)},Yh=function(t,e,n){return jn(t,e.origin(),e.bottomLeft(),e)},Xh=function(t,e,n){return jn(t,e.topRight(),e.corner(),e)},Zh=function(t,e,n){return jn(t,e.origin(),e.topRight(),e)},Jh=function(t,e,n){return jn(t,e.bottomLeft(),e.corner(),e)},Kh=function(t,e,n){var r=n.startAngle||0,i=n.step||360/t.length;return Nc(t,e,r,function(s){return s*i})},Qh=function(t,e,n){var r=n.startAngle||0,i=n.step||20;return Nc(t,e,r,function(s,o){return(s+.5-o/2)*i})},td=Object.freeze(Object.defineProperty({__proto__:null,absolute:qh,bottom:Jh,ellipse:Qh,ellipseSpread:Kh,fn:Wh,left:Yh,line:jh,right:Xh,top:Zh},Symbol.toStringTag,{value:"Module"}));function De(t,e){return us({},t,e,{x:0,y:0,angle:0,attrs:{}})}function Ic(t){var e=t.center(),n=e.theta(t.origin()),r=e.theta(t.bottomLeft()),i=e.theta(t.corner()),s=e.theta(t.topRight());return[n,s,i,r]}function Rc(t,e,n,r){r=Yt({},r,{offset:15});var i=e.center().theta(t),s,o,a,c,l=r.offset,f=0;const[u,d,g,v]=Ic(e);i<d||i>g?(a=".3em",s=l,o=0,c="start"):i<u?(s=0,o=-l,n?(f=-90,c="start",a=".3em"):(c="middle",a="0")):i<v?(a=".3em",s=-l,o=0,c="end"):(s=0,o=l,n?(f=90,c="start",a=".3em"):(c="middle",a=".6em"));var y=Math.round;return De(r,{x:y(s),y:y(o),angle:f,attrs:{labelText:{y:a,textAnchor:c}}})}function kc(t,e,n,r){r=Yt({},r,{offset:15});var i=e.center().theta(t),s,o,a,c,l=r.offset,f=0;const[u,d,g,v]=Ic(e);i<d||i>g?(a=".3em",s=-l,o=0,c="end"):i<u?(s=0,o=l,n?(f=90,c="start",a=".3em"):(c="middle",a=".6em")):i<v?(a=".3em",s=l,o=0,c="start"):(s=0,o=-l,n?(f=-90,c="start",a=".3em"):(c="middle",a="0"));var y=Math.round;return De(r,{x:y(s),y:y(o),angle:f,attrs:{labelText:{y:a,textAnchor:c}}})}function Dc(t,e,n){n=Yt({},n,{offset:20});var r=Ar(0,0),i=-t.theta(r),s=i,o=t.clone().move(r,n.offset).difference(t).round(),a=".3em",c;(i+90)%180===0?(c=e?"end":"middle",!e&&i===-270&&(a="0em")):i>-270&&i<-90?(c="start",s=i-180):c="end";var l=Math.round;return De(n,{x:l(o.x),y:l(o.y),angle:e?s:0,attrs:{labelText:{y:a,textAnchor:c}}})}const ed=function(t,e,n){return De(n)},nd=function(t,e,n){return De(n,{x:-15,attrs:{labelText:{y:".3em",textAnchor:"end"}}})},rd=function(t,e,n){return De(n,{x:15,attrs:{labelText:{y:".3em",textAnchor:"start"}}})},id=function(t,e,n){return De(n,{y:-15,attrs:{labelText:{y:"0",textAnchor:"middle"}}})},sd=function(t,e,n){return De(n,{y:15,attrs:{labelText:{y:".6em",textAnchor:"middle"}}})},od=function(t,e,n){return Rc(t,e,!0,n)},ad=function(t,e,n){return Rc(t,e,!1,n)},cd=function(t,e,n){return kc(t,e,!0,n)},ud=function(t,e,n){return kc(t,e,!1,n)},ld=function(t,e,n){return Dc(t.difference(e.center()),!1,n)},fd=function(t,e,n){return Dc(t.difference(e.center()),!0,n)},hd=Object.freeze(Object.defineProperty({__proto__:null,bottom:sd,inside:ud,insideOriented:cd,left:nd,manual:ed,outside:ad,outsideOriented:od,radial:ld,radialOriented:fd,right:rd,top:id},Symbol.toStringTag,{value:"Module"}));var Bc=function(t){var e=jt(t)||{};this.ports=[],this.groups={},this.portLayoutNamespace=td,this.portLabelLayoutNamespace=hd,this._init(e)};Bc.prototype={getPorts:function(){return this.ports},getGroup:function(t){return this.groups[t]||{}},getPortsByGroup:function(t){return this.ports.filter(function(e){return e.group===t})},getGroupPortsMetrics:function(t,e){var n=this.getGroup(t),r=this.getPortsByGroup(t),i=n.position||{},s=i.name,o=this.portLayoutNamespace;o[s]||(s="left");var a=i.args||{},c=r.map(function(u){return u&&u.position&&u.position.args}),l=o[s](c,e,a),f={ports:r,result:[]};return pt(l).reduce((function(u,d,g){var v=u.ports[g];return u.result.push({portId:v.id,portTransformation:d,labelTransformation:this._getPortLabelLayout(v,E(d),e),portAttrs:v.attrs,portSize:v.size,labelSize:v.label.size}),u}).bind(this),f),f.result},_getPortLabelLayout:function(t,e,n){var r=this.portLabelLayoutNamespace,i=t.label.position.name||"left";return r[i]?r[i](e,n,t.label.position.args):null},_init:function(t){if(gt(t.groups))for(var e=Object.keys(t.groups),n=0,r=e.length;n<r;n++){var i=e[n];this.groups[i]=this._evaluateGroup(t.groups[i])}for(var s=pt(t.items),o=0,a=s.length;o<a;o++)this.ports.push(this._evaluatePort(s[o]))},_evaluateGroup:function(t){return Lt(t,{position:this._getPosition(t.position,!0),label:this._getLabel(t,!0)})},_evaluatePort:function(t){var e=J({},t),n=this.getGroup(t.group);return e.markup=e.markup||n.markup,e.attrs=Lt({},n.attrs,e.attrs),e.position=this._createPositionNode(n,e),e.label=Lt({},n.label,this._getLabel(e)),e.z=this._getZIndex(n,e),e.size=J({},n.size,e.size),e},_getZIndex:function(t,e){return Bt(e.z)?e.z:Bt(t.z)||t.z==="auto"?t.z:"auto"},_createPositionNode:function(t,e){return Lt({name:"left",args:{}},t.position,{args:e.args})},_getPosition:function(t,e){var n={},r;yt(t)?(r="fn",n.fn=t):Ct(t)?r=t:t===void 0?r=e?"left":null:Array.isArray(t)?(r="absolute",n.x=t[0],n.y=t[1]):gt(t)&&(r=t.name,J(n,t.args));var i={args:n};return r&&(i.name=r),i},_getLabel:function(t,e){var n=t.label||{},r=n;return r.position=this._getPosition(n.position,e),r}};const dd={_initializePorts:function(){this._createPortData(),this.on("change:ports",function(){this._processRemovedPort(),this._createPortData()},this)},_processRemovedPort:function(){var t=this.get("ports")||{},e={};pt(t.items).forEach(function(a){e[a.id]=!0});var n=this.previous("ports")||{},r={};pt(n.items).forEach(function(a){e[a.id]||(r[a.id]=!0)});var i=this.graph;if(i&&!Xt(r)){var s=i.getConnectedLinks(this,{inbound:!0});s.forEach(function(a){r[a.get("target").port]&&a.remove()});var o=i.getConnectedLinks(this,{outbound:!0});o.forEach(function(a){r[a.get("source").port]&&a.remove()})}},hasPorts:function(){var t=this.prop("ports/items");return Array.isArray(t)&&t.length>0},hasPort:function(t){return this.getPortIndex(t)!==-1},getPorts:function(){return jt(this.prop("ports/items"))||[]},getGroupPorts:function(t){const e=pt(this.prop(["ports","items"])).filter(n=>n.group===t);return jt(e)},getPort:function(t){return jt(pt(this.prop("ports/items")).find(function(e){return e.id&&e.id===t}))},getPortGroupNames:function(){return Object.keys(this._portSettingsData.groups)},getPortsPositions:function(t){var e=this._portSettingsData.getGroupPortsMetrics(t,Y(this.size()));return e.reduce(function(n,r){var i=r.portTransformation;return n[r.portId]={x:i.x,y:i.y,angle:i.angle},n},{})},getPortIndex:function(t){var e=gt(t)?t.id:t;return this._isValidPortId(e)?pt(this.prop("ports/items")).findIndex(function(n){return n.id===e}):-1},addPort:function(t,e){if(!gt(t)||Array.isArray(t))throw new Error("Element: addPort requires an object.");var n=J([],this.prop("ports/items"));return n.push(t),this.prop("ports/items",n,e),this},insertPort:function(t,e,n){const r=typeof t=="number"?t:this.getPortIndex(t);if(!gt(e)||Array.isArray(e))throw new Error("dia.Element: insertPort requires an object.");const i=J([],this.prop("ports/items"));return i.splice(r,0,e),this.prop("ports/items",i,n),this},portProp:function(t,e,n,r){var i=this.getPortIndex(t);if(i===-1)throw new Error("Element: unable to find port with id "+t);var s=Array.prototype.slice.call(arguments,1);return Array.isArray(e)?s[0]=["ports","items",i].concat(e):Ct(e)?s[0]=["ports/items/",i,"/",e].join(""):(s=["ports/items/"+i],Pt(e)&&(s.push(e),s.push(n))),this.prop.apply(this,s)},_validatePorts:function(){var t=this.get("ports")||{},e=[];t=t||{};var n=pt(t.items);return n.forEach(function(r){typeof r!="object"&&e.push("Element: invalid port ",r),this._isValidPortId(r.id)||(r.id=this.generatePortId())},this),Ye(n,"id").length!==n.length&&e.push("Element: found id duplicities in ports."),e},generatePortId:function(){return this.generateId()},_isValidPortId:function(t){return t!=null&&!gt(t)},addPorts:function(t,e){return t.length&&this.prop("ports/items",J([],this.prop("ports/items")).concat(t),e),this},removePort:function(t,e){const n=e||{},r=this.getPortIndex(t);if(r!==-1){const i=J([],this.prop(["ports","items"]));i.splice(r,1),n.rewrite=!0,this.startBatch("port-remove"),this.prop(["ports","items"],i,n),this.stopBatch("port-remove")}return this},removePorts:function(t,e){let n,r;if(Array.isArray(t)){if(n=e||{},t.length===0)return this.this;r=J([],this.prop(["ports","items"])).filter(function(s){return!t.some(function(o){const a=gt(o)?o.id:o;return s.id===a})})}else n=t||{},r=[];return this.startBatch("port-remove"),n.rewrite=!0,this.prop(["ports","items"],r,n),this.stopBatch("port-remove"),this},_createPortData:function(){var t=this._validatePorts();if(t.length>0)throw this.set("ports",this.previous("ports")),new Error(t.join(" "));var e;this._portSettingsData&&(e=this._portSettingsData.getPorts()),this._portSettingsData=new Bc(this.get("ports"));var n=this._portSettingsData.getPorts();if(e){var r=n.filter(function(s){if(!e.find(function(o){return o.id===s.id}))return s}),i=e.filter(function(s){if(!n.find(function(o){return o.id===s.id}))return s});i.length>0&&this.trigger("ports:remove",this,i),r.length>0&&this.trigger("ports:add",this,r)}}},gd={portContainerMarkup:"g",portMarkup:[{tagName:"circle",selector:"circle",attributes:{r:10,fill:"#FFFFFF",stroke:"#000000"}}],portLabelMarkup:[{tagName:"text",selector:"text",attributes:{fill:"#000000"}}],_portElementsCache:null,_initializePorts:function(){this._cleanPortsCache()},_refreshPorts:function(){this._removePorts(),this._cleanPortsCache(),this._renderPorts()},_cleanPortsCache:function(){this._portElementsCache={}},_renderPorts:function(){for(var t=[],e=this._getContainerElement(),n=0,r=e.node.childNodes.length;n<r;n++)t.push(e.node.childNodes[n]);var i=Cf(this.model._portSettingsData.getPorts(),"z"),s="auto";pt(i[s]).forEach(function(f){var u=this._getPortElement(f);e.append(u),t.push(u)},this);for(var o=Object.keys(i),a=0;a<o.length;a++){var c=o[a];if(c!==s){var l=parseInt(c,10);this._appendPorts(i[c],l,t)}}this._updatePorts()},_getContainerElement:function(){return this.rotatableNode||this.vel},_appendPorts:function(t,e,n){var r=this._getContainerElement(),i=pt(t).map(this._getPortElement,this);n[e]||e<0?z(n[Math.max(e,0)]).before(i):r.append(i)},_getPortElement:function(t){return this._portElementsCache[t.id]?this._portElementsCache[t.id].portElement:this._createPortElement(t)},findPortNodes:function(t,e){const n=this._portElementsCache[t];if(!n)return[];if(!e)return[n.portContentElement.node];const r=n.portElement.node,i=n.portSelectors;return this.findBySelector(e,r,i)},findPortNode:function(t,e){const[n=null]=this.findPortNodes(t,e);return n},_updatePorts:function(){this._updatePortGroup(void 0);var t=Object.keys(this.model._portSettingsData.groups);t.forEach(this._updatePortGroup,this)},_removePorts:function(){de(this._portElementsCache,"portElement.remove")},_createPortElement:function(t){let e,n,r,i;var s=z(this.portContainerMarkup).addClass("joint-port"),o=this._getPortMarkup(t);if(Array.isArray(o)){var a=this.parseDOMJSON(o,s.node),c=a.fragment;c.childNodes.length>1?e=z("g").append(c):e=z(c.firstChild),i=a.selectors}else e=z(o),Array.isArray(e)&&(e=z("g").append(e));if(!e)throw new Error("ElementView: Invalid port markup.");e.attr({port:t.id,"port-group":t.group}),Bt(t.id)&&e.attr("port-id-type","number");const l=this._getPortLabelMarkup(t.label);if(Array.isArray(l)){const{fragment:y,selectors:x}=this.parseDOMJSON(l,s.node),w=y.childNodes.length;w>0&&(r=x,n=w===1?z(y.firstChild):z("g").append(y))}else n=z(l),Array.isArray(n)&&(n=z("g").append(n));var f;if(i&&r){for(var u in r)if(i[u]&&u!==this.selector)throw new Error("ElementView: selectors within port must be unique.");f=J({},i,r)}else f=i||r||{};const d="portRoot",g="labelRoot",v="labelText";if(d in f||(f[d]=e.node),n){const y=n.node;if(g in f||(f[g]=y),!(v in f)){const x=n.tagName()==="TEXT"?y:Array.from(y.querySelectorAll("text"));f[v]=x,r||(r={}),r[v]=x}}return s.append(e.addClass("joint-port-body")),n&&s.append(n.addClass("joint-port-label")),this._portElementsCache[t.id]={portElement:s,portLabelElement:n,portSelectors:f,portLabelSelectors:r,portContentElement:e,portContentSelectors:i},s},_updatePortGroup:function(t){for(var e=Y(this.model.size()),n=this.model._portSettingsData.getGroupPortsMetrics(t,e),r=0,i=n.length;r<i;r++){var s=n[r],o=s.portId,a=this._portElementsCache[o]||{},c=s.portTransformation,l=s.labelTransformation;l&&a.portLabelElement&&(this.updateDOMSubtreeAttributes(a.portLabelElement.node,l.attrs,{rootBBox:new Y(s.labelSize),selectors:a.portLabelSelectors}),this.applyPortTransform(a.portLabelElement,l,-c.angle||0)),this.updateDOMSubtreeAttributes(a.portElement.node,s.portAttrs,{rootBBox:new Y(s.portSize),selectors:a.portSelectors}),this.applyPortTransform(a.portElement,c)}},applyPortTransform:function(t,e,n){var r=z.createSVGMatrix().rotate(n||0).translate(e.x||0,e.y||0).rotate(e.angle||0);t.transform(r,{absolute:!0})},_getPortMarkup:function(t){return t.markup||this.model.get("portMarkup")||this.model.portMarkup||this.portMarkup},_getPortLabelMarkup:function(t){return t.markup||this.model.get("portLabelMarkup")||this.model.portLabelMarkup||this.portLabelMarkup}},qt=ve.extend({defaults:{position:{x:0,y:0},size:{width:1,height:1},angle:0},initialize:function(){this._initializePorts(),ve.prototype.initialize.apply(this,arguments)},_initializePorts:function(){},_refreshPorts:function(){},isElement:function(){return!0},position:function(t,e,n){const r=Bt(e);n=(r?n:t)||{};const{parentRelative:i,deep:s,restrictedArea:o}=n;let a;if(i){if(!this.graph)throw new Error("Element must be part of a graph.");const c=this.getParentCell();c&&!c.isLink()&&(a=c.get("position"))}if(r){if(a&&(t+=a.x,e+=a.y),s||o){const{x:c,y:l}=this.get("position");this.translate(t-c,e-l,n)}else this.set("position",{x:t,y:e},n);return this}else{const c=E(this.get("position"));return i?c.difference(a):c}},translate:function(t,e,n){if(t=t||0,e=e||0,t===0&&e===0)return this;n=n||{},n.translateBy=n.translateBy||this.id;var r=this.get("position")||{x:0,y:0},i=n.restrictedArea;if(i&&n.translateBy===this.id)if(typeof i=="function"){var s=i.call(this,r.x+t,r.y+e,n);t=s.x-r.x,e=s.y-r.y}else{var o=this.getBBox({deep:!0}),a=r.x-o.x,c=r.y-o.y,l=Math.max(i.x+a,Math.min(i.x+i.width+a-o.width,r.x+t)),f=Math.max(i.y+c,Math.min(i.y+i.height+c-o.height,r.y+e));t=l-r.x,e=f-r.y}var u={x:r.x+t,y:r.y+e};return n.tx=t,n.ty=e,n.transition?(gt(n.transition)||(n.transition={}),this.transition("position",u,J({},n.transition,{valueFunction:xc.object})),de(this.getEmbeddedCells(),"translate",t,e,n)):(this.startBatch("translate",n),this.set("position",u,n),de(this.getEmbeddedCells(),"translate",t,e,n),this.stopBatch("translate",n)),this},size:function(t,e,n){var r=this.get("size");return t===void 0?{width:r.width,height:r.height}:(gt(t)&&(n=e,e=Bt(t.height)?t.height:r.height,t=Bt(t.width)?t.width:r.width),this.resize(t,e,n))},resize:function(t,e,n){if(n=n||{},this.startBatch("resize",n),n.direction){var r=this.get("size");switch(n.direction){case"left":case"right":e=r.height;break;case"top":case"bottom":t=r.width;break}var i=Qt(this.get("angle")||0),s=this.getBBox(),o;if(i){var a={"top-right":0,right:0,"top-left":1,top:1,"bottom-left":2,left:2,"bottom-right":3,bottom:3}[n.direction];n.absolute&&(a+=Math.floor((i+45)/90),a%=4);var c=s[["bottomLeft","corner","topRight","origin"][a]](),l=E(c).rotate(s.center(),-i),f=Math.sqrt(t*t+e*e)/2,u=a*Math.PI/2;u+=Math.atan(a%2==0?e/t:t/e),u-=$t(i);var d=E.fromPolar(f,u,l);o=E(d).offset(t/-2,e/-2)}else switch(o=s.topLeft(),n.direction){case"top":case"top-right":o.offset(0,s.height-e);break;case"left":case"bottom-left":o.offset(s.width-t,0);break;case"top-left":o.offset(s.width-t,s.height-e);break}this.set("size",{width:t,height:e},n),this.position(o.x,o.y,n)}else this.set("size",{width:t,height:e},n);return this.stopBatch("resize",n),this},scale:function(t,e,n,r){var i=this.getBBox().scale(t,e,n);return this.startBatch("scale",r),this.position(i.x,i.y,r),this.resize(i.width,i.height,r),this.stopBatch("scale"),this},fitEmbeds:function(t){return this.fitToChildren(t)},fitToChildren:function(t={}){const{graph:e}=this;if(!e)throw new Error("Element must be part of a graph.");const n=this.getEmbeddedCells().filter(r=>r.isElement());return n.length===0?this:(this.startBatch("fit-embeds",t),t.deep&&de(n,"fitToChildren",t),this._fitToElements(Object.assign({elements:n},t)),this.stopBatch("fit-embeds"),this)},fitParent:function(t={}){const{graph:e}=this;if(!e)throw new Error("Element must be part of a graph.");if(t.deep&&t.terminator&&(t.terminator===this||t.terminator===this.id))return this;const n=this.getParentCell();if(!n||!n.isElement())return this;const r=n.getEmbeddedCells().filter(i=>i.isElement());return r.length===0?this:(this.startBatch("fit-parent",t),n._fitToElements(Object.assign({elements:r},t)),t.deep&&n.fitParent(t),this.stopBatch("fit-parent"),this)},_fitToElements:function(t={}){const e=this.graph.getCellsBBox(t.elements);if(!e)return;const{expandOnly:n,shrinkOnly:r}=t;if(n&&r)return;let{x:i,y:s,width:o,height:a}=e;const{left:c,right:l,top:f,bottom:u}=Oe(t.padding);i-=c,s-=f,o+=c+l,a+=u+f;let d=new Y(i,s,o,a);if(n)d=this.getBBox().union(d);else if(r){const g=this.getBBox().intersect(d);if(!g)return;d=g}this.set({position:{x:d.x,y:d.y},size:{width:d.width,height:d.height}},t)},rotate:function(t,e,n,r){if(n){var i=this.getBBox().center(),s=this.get("size"),o=this.get("position");i.rotate(n,this.get("angle")-t);var a=i.x-s.width/2-o.x,c=i.y-s.height/2-o.y;this.startBatch("rotate",{angle:t,absolute:e,origin:n}),this.position(o.x+a,o.y+c,r),this.rotate(t,e,null,r),this.stopBatch("rotate")}else this.set("angle",e?t:(this.get("angle")+t)%360,r);return this},angle:function(){return Qt(this.get("angle")||0)},getBBox:function(t={}){const{graph:e,attributes:n}=this,{deep:r,rotate:i}=t;if(r&&e){const u=this.getEmbeddedCells({deep:!0,breadthFirst:!0});return u.push(this),e.getCellsBBox(u,t)}const{angle:s=0,position:{x:o,y:a},size:{width:c,height:l}}=n,f=new Y(o,a,c,l);return i&&f.rotateAroundCenter(s),f},getPointFromConnectedLink:function(t,e){var n=this.getBBox(),r=n.center(),i=t.get(e);if(!i)return r;var s=i.port;if(!s||!this.hasPort(s))return r;var o=this.portProp(s,["group"]),a=this.getPortsPositions(o),c=new E(a[s]).offset(n.origin()),l=this.angle();return l&&c.rotate(r,-l),c}});J(qt.prototype,dd);const jr=ve.extend({defaultLabel:void 0,labelMarkup:void 0,_builtins:{defaultLabel:{markup:[{tagName:"rect",selector:"rect"},{tagName:"text",selector:"text"}],attrs:{text:{fill:"#000000",fontSize:14,textAnchor:"middle",textVerticalAnchor:"middle",pointerEvents:"none"},rect:{ref:"text",fill:"#ffffff",rx:3,ry:3,x:"calc(x)",y:"calc(y)",width:"calc(w)",height:"calc(h)"}},position:{distance:.5}}},defaults:{source:{},target:{}},isLink:function(){return!0},disconnect:function(t){return this.set({source:{x:0,y:0},target:{x:0,y:0}},t)},source:function(t,e,n){if(t===void 0)return Dt(this.get("source"));var r,i,s=t instanceof ve;if(s)return r=Dt(e)||{},r.id=t.id,i=n,this.set("source",r,i);var o=!Pt(t);return o?(r=Dt(e)||{},r.x=t.x,r.y=t.y,i=n,this.set("source",r,i)):(r=t,i=e,this.set("source",r,i))},target:function(t,e,n){if(t===void 0)return Dt(this.get("target"));var r,i,s=t instanceof ve;if(s)return r=Dt(e)||{},r.id=t.id,i=n,this.set("target",r,i);var o=!Pt(t);return o?(r=Dt(e)||{},r.x=t.x,r.y=t.y,i=n,this.set("target",r,i)):(r=t,i=e,this.set("target",r,i))},router:function(t,e,n){if(t===void 0){var r=this.get("router");return r?typeof r=="object"?Dt(r):r:null}var i=typeof t=="object"||typeof t=="function",s=i?t:{name:t,args:e},o=i?e:n;return this.set("router",s,o)},connector:function(t,e,n){if(t===void 0){var r=this.get("connector");return r?typeof r=="object"?Dt(r):r:null}var i=typeof t=="object"||typeof t=="function",s=i?t:{name:t,args:e},o=i?e:n;return this.set("connector",s,o)},label:function(t,e,n){var r=this.labels();return t=isFinite(t)&&t!==null?t|0:0,t<0&&(t=r.length+t),arguments.length<=1?this.prop(["labels",t]):this.prop(["labels",t],e,n)},labels:function(t,e){return arguments.length===0?(t=this.get("labels"),Array.isArray(t)?t.slice():[]):(Array.isArray(t)||(t=[]),this.set("labels",t,e))},hasLabels:function(){const{labels:t}=this.attributes;return Array.isArray(t)&&t.length>0},insertLabel:function(t,e,n){if(!e)throw new Error("dia.Link: no label provided");var r=this.labels(),i=r.length;return t=isFinite(t)&&t!==null?t|0:i,t<0&&(t=i+t+1),r.splice(t,0,e),this.labels(r,n)},appendLabel:function(t,e){return this.insertLabel(-1,t,e)},removeLabel:function(t,e){var n=this.labels();return t=isFinite(t)&&t!==null?t|0:-1,n.splice(t,1),this.labels(n,e)},vertex:function(t,e,n){var r=this.vertices();if(t=isFinite(t)&&t!==null?t|0:0,t<0&&(t=r.length+t),arguments.length<=1)return this.prop(["vertices",t]);var i=this._normalizeVertex(e);return this.prop(["vertices",t],i,n)},vertices:function(t,e){if(arguments.length===0)return t=this.get("vertices"),Array.isArray(t)?t.slice():[];Array.isArray(t)||(t=[]);for(var n=[],r=0;r<t.length;r++){var i=t[r],s=this._normalizeVertex(i);n.push(s)}return this.set("vertices",n,e)},insertVertex:function(t,e,n){if(!e)throw new Error("dia.Link: no vertex provided");var r=this.vertices(),i=r.length;t=isFinite(t)&&t!==null?t|0:i,t<0&&(t=i+t+1);var s=this._normalizeVertex(e);return r.splice(t,0,s),this.vertices(r,n)},removeVertex:function(t,e){var n=this.vertices();return t=isFinite(t)&&t!==null?t|0:-1,n.splice(t,1),this.vertices(n,e)},_normalizeVertex:function(t){var e=!Pt(t);return e?{x:t.x,y:t.y}:t},translate:function(t,e,n){return n=n||{},n.translateBy=n.translateBy||this.id,n.tx=t,n.ty=e,this.applyToPoints(function(r){return{x:(r.x||0)+t,y:(r.y||0)+e}},n)},scale:function(t,e,n,r){return this.applyToPoints(function(i){return E(i).scale(t,e,n).toJSON()},r)},applyToPoints:function(t,e){if(!yt(t))throw new TypeError("dia.Link: applyToPoints expects its first parameter to be a function.");var n={},{source:r,target:i}=this.attributes;r.id||(n.source=t(r)),i.id||(n.target=t(i));var s=this.vertices();return s.length>0&&(n.vertices=s.map(t)),this.set(n,e)},getSourcePoint:function(){var t=this.getSourceCell();return t?t.getPointFromConnectedLink(this,"source"):new E(this.source())},getTargetPoint:function(){var t=this.getTargetCell();return t?t.getPointFromConnectedLink(this,"target"):new E(this.target())},getPointFromConnectedLink:function(){return this.getPolyline().pointAt(.5)},getPolyline:function(){const t=[this.getSourcePoint(),...this.vertices().map(E),this.getTargetPoint()];return new St(t)},getBBox:function(){return this.getPolyline().bbox()},reparent:function(t){var e;if(this.graph){var n=this.getSourceElement(),r=this.getTargetElement(),i=this.getParentCell();n&&r&&(n===r||n.isEmbeddedIn(r)?e=r:r.isEmbeddedIn(n)?e=n:e=this.graph.getCommonAncestor(n,r)),i&&(!e||e.id!==i.id)&&i.unembed(this,t),e&&e.embed(this,t)}return e},hasLoop:function(t){t=t||{};var{source:e,target:n}=this.attributes,r=e.id,i=n.id;if(!r||!i)return!1;var s=r===i;if(!s&&t.deep&&this.graph){var o=this.getSourceCell(),a=this.getTargetCell();s=o.isEmbeddedIn(a)||a.isEmbeddedIn(o)}return s},getSourceCell:function(){const{graph:t,attributes:e}=this;var n=e.source;return n&&n.id&&t&&t.getCell(n.id)||null},getSourceElement:function(){var t=this,e={};do{if(e[t.id])return null;e[t.id]=!0,t=t.getSourceCell()}while(t&&t.isLink());return t},getTargetCell:function(){const{graph:t,attributes:e}=this;var n=e.target;return n&&n.id&&t&&t.getCell(n.id)||null},getTargetElement:function(){var t=this,e={};do{if(e[t.id])return null;e[t.id]=!0,t=t.getTargetCell()}while(t&&t.isLink());return t},getRelationshipAncestor:function(){var t;if(this.graph){var e=[this,this.getSourceElement(),this.getTargetElement()].filter(function(n){return!!n});t=this.graph.getCommonAncestor.apply(this.graph,e)}return t||null},isRelationshipEmbeddedIn:function(t){var e=Ct(t)||Bt(t)?t:t.id,n=this.getRelationshipAncestor();return!!n&&(n.id===e||n.isEmbeddedIn(e))},_getDefaultLabel:function(){var t=this.get("defaultLabel")||this.defaultLabel||{},e={};return e.markup=t.markup||this.get("labelMarkup")||this.labelMarkup,e.position=t.position,e.attrs=t.attrs,e.size=t.size,e}},{endsEqual:function(t,e){var n=t.port===e.port||!t.port&&!e.port;return t.id===e.id&&n}}),Fc={_results:{},_tests:{svgforeignobject:function(){return!!document.createElementNS&&/SVGForeignObject/.test({}.toString.call(document.createElementNS("http://www.w3.org/2000/svg","foreignObject")))},isSafari:function(){return/Safari/.test(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)}},addTest:function(t,e){return this._tests[t]=e},test:function(t){var e=this._tests[t];if(!e)throw new Error('Test not defined ("'+t+'"). Use `joint.env.addTest(name, fn) to add a new test.`');var n=this._results[t];if(typeof n<"u")return n;try{n=e()}catch{n=!1}return this._results[t]=n,n}},pd=qt.define("standard.Rectangle",{attrs:{root:{cursor:"move"},body:{width:"calc(w)",height:"calc(h)",strokeWidth:2,stroke:"#000000",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:"calc(h/2)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"}]}),vd=qt.define("standard.Circle",{attrs:{root:{cursor:"move"},body:{cx:"calc(s/2)",cy:"calc(s/2)",r:"calc(s/2)",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:"calc(h/2)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}]}),md=qt.define("standard.Ellipse",{attrs:{root:{cursor:"move"},body:{cx:"calc(w/2)",cy:"calc(h/2)",rx:"calc(w/2)",ry:"calc(h/2)",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:"calc(h/2)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"ellipse",selector:"body"},{tagName:"text",selector:"label"}]}),yd=qt.define("standard.Path",{attrs:{root:{cursor:"move"},body:{d:"M 0 0 H calc(w) V calc(h) H 0 Z",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:"calc(h/2)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"path",selector:"body"},{tagName:"text",selector:"label"}]}),bd=qt.define("standard.Polygon",{attrs:{root:{cursor:"move"},body:{points:"0 0 calc(w) 0 calc(w) calc(h) 0 calc(h)",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:"calc(h/2)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"polygon",selector:"body"},{tagName:"text",selector:"label"}]}),xd=qt.define("standard.Polyline",{attrs:{root:{cursor:"move"},body:{points:"0 0 calc(w) 0 calc(w) calc(h) 0 calc(h)",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:"calc(h/2)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"polyline",selector:"body"},{tagName:"text",selector:"label"}]}),wd=qt.define("standard.Image",{attrs:{root:{cursor:"move"},image:{width:"calc(w)",height:"calc(h)"},label:{textVerticalAnchor:"top",textAnchor:"middle",x:"calc(w/2)",y:"calc(h+10)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]}),Sd=qt.define("standard.BorderedImage",{attrs:{root:{cursor:"move"},border:{width:"calc(w)",height:"calc(h)",stroke:"#333333",strokeWidth:2},background:{width:"calc(w-1)",height:"calc(h-1)",x:.5,y:.5,fill:"#FFFFFF"},image:{width:"calc(w-1)",height:"calc(h-1)",x:.5,y:.5},label:{textVerticalAnchor:"top",textAnchor:"middle",x:"calc(w/2)",y:"calc(h+10)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"background",attributes:{stroke:"none"}},{tagName:"image",selector:"image"},{tagName:"rect",selector:"border",attributes:{fill:"none"}},{tagName:"text",selector:"label"}]}),Ad=qt.define("standard.EmbeddedImage",{attrs:{root:{cursor:"move"},body:{width:"calc(w)",height:"calc(h)",stroke:"#333333",fill:"#FFFFFF",strokeWidth:2},image:{width:"calc(0.3*w)",height:"calc(h-20)",x:10,y:10,preserveAspectRatio:"xMidYMin"},label:{textVerticalAnchor:"top",textAnchor:"left",x:"calc(0.3*w+20)",y:10,fontSize:14,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]}),Td=qt.define("standard.InscribedImage",{attrs:{root:{cursor:"move"},border:{rx:"calc(w/2)",ry:"calc(h/2)",cx:"calc(w/2)",cy:"calc(h/2)",stroke:"#333333",strokeWidth:2},background:{rx:"calc(w/2)",ry:"calc(h/2)",cx:"calc(w/2)",cy:"calc(h/2)",fill:"#FFFFFF"},image:{width:"calc(0.68*w)",height:"calc(0.68*h)",x:"calc(0.16*w)",y:"calc(0.16*h)",preserveAspectRatio:"xMidYMid"},label:{textVerticalAnchor:"top",textAnchor:"middle",x:"calc(w/2)",y:"calc(h+10)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"ellipse",selector:"background"},{tagName:"image",selector:"image"},{tagName:"ellipse",selector:"border",attributes:{fill:"none"}},{tagName:"text",selector:"label"}]}),Vc=qt.define("standard.HeaderedRectangle",{attrs:{root:{cursor:"move"},body:{width:"calc(w)",height:"calc(h)",strokeWidth:2,stroke:"#000000",fill:"#FFFFFF"},header:{width:"calc(w)",height:30,strokeWidth:2,stroke:"#000000",fill:"#FFFFFF"},headerText:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:15,fontSize:16,fill:"#333333"},bodyText:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:"calc(h/2+15)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"rect",selector:"header"},{tagName:"text",selector:"headerText"},{tagName:"text",selector:"bodyText"}]});var si=10;const Ed=qt.define("standard.Cylinder",{attrs:{root:{cursor:"move"},body:{lateralArea:si,fill:"#FFFFFF",stroke:"#333333",strokeWidth:2},top:{cx:"calc(w/2)",cy:si,rx:"calc(w/2)",ry:si,fill:"#FFFFFF",stroke:"#333333",strokeWidth:2},label:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:"calc(h+15)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"path",selector:"body"},{tagName:"ellipse",selector:"top"},{tagName:"text",selector:"label"}],topRy:function(t,e){if(t===void 0)return this.attr("body/lateralArea");var n={lateralArea:t},r=It(t),i=r?`calc(${parseFloat(t)/100}*h)`:t,s={cy:i,ry:i};return this.attr({body:n,top:s},e)}},{attributes:{"lateral-area":{set:function(t,e){var n=It(t);n&&(t=parseFloat(t)/100);var r=e.x,i=e.y,s=e.width,o=e.height,a=s/2,c=n?o*t:t,l=z.KAPPA,f=l*a,u=l*(n?o*t:t),d=r,g=r+s/2,v=r+s,y=i+c,x=y-c,w=i+o-c,T=i+o,P=["M",d,y,"L",d,w,"C",r,w+u,g-f,T,g,T,"C",g+f,T,v,w+u,v,w,"L",v,y,"C",v,y-u,g+f,x,g,x,"C",g-f,x,d,y-u,d,y,"Z"];return{d:P.join(" ")}},unset:"d"}}});var Pd={tagName:"foreignObject",selector:"foreignObject",attributes:{overflow:"hidden"},children:[{tagName:"div",namespaceURI:"http://www.w3.org/1999/xhtml",selector:"label",style:{width:"100%",height:"100%",position:"static",backgroundColor:"transparent",textAlign:"center",margin:0,padding:"0px 5px",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center"}}]},Cd={tagName:"text",selector:"label",attributes:{"text-anchor":"middle"}},_d=Fc.test("svgforeignobject")?Pd:Cd;const Ld=qt.define("standard.TextBlock",{attrs:{root:{cursor:"move"},body:{width:"calc(w)",height:"calc(h)",stroke:"#333333",fill:"#ffffff",strokeWidth:2},foreignObject:{width:"calc(w)",height:"calc(h)"},label:{style:{fontSize:14}}}},{markup:[{tagName:"rect",selector:"body"},_d]},{attributes:{text:{set:function(t,e,n,r){if(n instanceof HTMLElement)n.textContent=t;else{var i=r.style||{},s={text:t,width:-5,height:"100%"},o=J({"text-vertical-anchor":"middle"},i);return Lc["text-wrap"].set.call(this,s,e,n,o),{fill:i.color||null}}},unset:function(t){if(t.textContent="",t instanceof SVGElement)return"fill"},position:function(t,e,n){if(n instanceof SVGElement)return e.center()}}}}),zc=jr.define("standard.Link",{attrs:{line:{connection:!0,stroke:"#333333",strokeWidth:2,strokeLinejoin:"round",targetMarker:{type:"path",d:"M 10 -5 0 0 10 5 z"}},wrapper:{connection:!0,strokeWidth:10,strokeLinejoin:"round"}}},{markup:[{tagName:"path",selector:"wrapper",attributes:{fill:"none",cursor:"pointer",stroke:"transparent","stroke-linecap":"round"}},{tagName:"path",selector:"line",attributes:{fill:"none","pointer-events":"none"}}]}),Md=jr.define("standard.DoubleLink",{attrs:{line:{connection:!0,stroke:"#DDDDDD",strokeWidth:4,strokeLinejoin:"round",targetMarker:{type:"path",stroke:"#000000",d:"M 10 -3 10 -10 -2 0 10 10 10 3"}},outline:{connection:!0,stroke:"#000000",strokeWidth:6,strokeLinejoin:"round"}}},{markup:[{tagName:"path",selector:"outline",attributes:{fill:"none",cursor:"pointer"}},{tagName:"path",selector:"line",attributes:{fill:"none","pointer-events":"none"}}]}),Od=jr.define("standard.ShadowLink",{attrs:{line:{connection:!0,stroke:"#FF0000",strokeWidth:20,strokeLinejoin:"round",targetMarker:{type:"path",stroke:"none",d:"M 0 -10 -10 0 0 10 z"},sourceMarker:{type:"path",stroke:"none",d:"M -10 -10 0 0 -10 10 0 10 0 -10 z"}},shadow:{connection:!0,transform:"translate(3,6)",stroke:"#000000",strokeOpacity:.2,strokeWidth:20,strokeLinejoin:"round",targetMarker:{type:"path",d:"M 0 -10 -10 0 0 10 z",stroke:"none"},sourceMarker:{type:"path",stroke:"none",d:"M -10 -10 0 0 -10 10 0 10 0 -10 z"}}}},{markup:[{tagName:"path",selector:"shadow",attributes:{fill:"none","pointer-events":"none"}},{tagName:"path",selector:"line",attributes:{fill:"none",cursor:"pointer"}}]}),Nd=Object.freeze(Object.defineProperty({__proto__:null,BorderedImage:Sd,Circle:vd,Cylinder:Ed,DoubleLink:Md,Ellipse:md,EmbeddedImage:Ad,HeaderedRectangle:Vc,Image:wd,InscribedImage:Td,Link:zc,Path:yd,Polygon:bd,Polyline:xd,Rectangle:pd,ShadowLink:Od,TextBlock:Ld},Symbol.toStringTag,{value:"Module"})),uo=Object.freeze(Object.defineProperty({__proto__:null,standard:Nd},Symbol.toStringTag,{value:"Module"})),cn={POINT:"point",CUBIC:"cubic",LINE:"line",GAP:"gap"},Id=Object.values(cn),Rd=10,kd=1,gs=function(t,e,n=[],r={}){const{cornerType:i=cn.POINT,cornerRadius:s=Rd,cornerPreserveAspectRatio:o=!1,precision:a=kd,raw:c=!1}=r;if(Id.indexOf(i)===-1)throw new Error("Invalid `cornerType` provided to `straight` connector.");let l;if(i===cn.POINT||!s){const f=[t].concat(n).concat([e]),u=new St(f);l=new et(u)}else{l=new et,l.appendSegment(et.createSegment("M",t));let f;const u=n.length;for(let d=0;d<u;d++){const g=new E(n[d]),v=n[d-1]||t,y=n[d+1]||e,x=f||g.distance(v)/2;f=g.distance(y)/2;let w,T;o?w=T=-Math.min(s,x,f):(w=-Math.min(s,x),T=-Math.min(s,f));const P=g.clone().move(v,w).round(a),M=g.clone().move(y,T).round(a);switch(l.appendSegment(et.createSegment("L",P)),i){case cn.CUBIC:{const I=.3333333333333333,D=2/3,h=new E(I*P.x+D*g.x,D*g.y+I*P.y),p=new E(I*M.x+D*g.x,D*g.y+I*M.y);l.appendSegment(et.createSegment("C",h,p,M));break}case cn.LINE:{l.appendSegment(et.createSegment("L",M));break}case cn.GAP:{l.appendSegment(et.createSegment("M",M));break}}}l.appendSegment(et.createSegment("L",e))}return c?l:l.serialize()};var Dd=5,lo=["arc","gap","cubic"],Bd=0,fo=1,Fd=["smooth"],or=1/3,ar=2/3;function ho(t,e){let{x:n,y:r}=t,{x:i,y:s}=e;if(n>i){let o=n;n=i,i=o,o=r,r=s,s=o}if(r>s){let o=n;n=i,i=o,o=r,r=s,s=o}return[new E(n,r),new E(i,s)]}function Vd(t,e){const[{x:n,y:r},{x:i,y:s}]=ho(t.start,t.end),[{x:o,y:a},{x:c,y:l}]=ho(e.start,e.end),f=n<=c&&o<=i,u=r<=l&&a<=s;return f&&u}function oi(t,e,n){var r=[].concat(t,n,e);return r.reduce(function(i,s,o){var a=r[o+1];return a!=null&&(i[o]=qe(s,a)),i},[])}function zd(t){var e=t.paper,n=e._jumpOverUpdateList;if(n==null){n=e._jumpOverUpdateList=[];var r=e.model;r.on("batch:stop",function(){this.hasActiveBatch()||Gd(e)}),r.on("reset",function(){n=e._jumpOverUpdateList=[]})}n.indexOf(t)<0&&(n.push(t),t.listenToOnce(t.model,"change:connector remove",function(){n.splice(n.indexOf(t),1)}))}function Gd(t){for(var e=t._jumpOverUpdateList,n=0;n<e.length;n++){const r=e[n],i=r.getFlag(r.constructor.Flags.CONNECTOR);r.requestUpdate(i)}}function Ud(t,e){return pt(e).reduce(function(n,r){var i=t.intersection(r);return i&&n.push(i),n},[])}function go(t,e){return qe(t,e).squaredLength()}function $d(t,e,n){return e.reduce(function(r,i,s){if(i.skip===!0)return r;var o=r.pop()||t,a=Ar(i).move(o.start,-n),c=Ar(i).move(o.start,+n),l=e[s+1];if(l!=null){var f=c.distance(l);f<=n&&(c=l.move(o.start,f),l.skip=!0)}else{var u=a.distance(o.end);if(u<n*2+fo)return r.push(o),r}var d=c.distance(o.start);if(d<n*2+fo)return r.push(o),r;var g=qe(a,c);return g.isJump=!0,r.push(qe(o.start,a),g,qe(c,o.end)),r},[])}function po(t,e,n,r){var i=new et,s;return s=et.createSegment("M",t[0].start),i.appendSegment(s),pt(t).forEach(function(o,a){if(o.isJump){var c,l,f,u;if(n==="arc"){c=-90,l=o.start.difference(o.end);var d=+(l.x<0||l.x===0&&l.y<0);d&&(c+=180);var g=o.midpoint(),v=new X(g,o.end).rotate(g,c),y;y=new X(o.start,g),f=y.pointAt(2/3).rotate(o.start,c),u=v.pointAt(1/3).rotate(v.end,-c),s=et.createSegment("C",f,u,v.end),i.appendSegment(s),y=new X(g,o.end),f=v.pointAt(1/3).rotate(v.end,c),u=y.pointAt(1/3).rotate(o.end,-c),s=et.createSegment("C",f,u,o.end),i.appendSegment(s)}else if(n==="gap")s=et.createSegment("M",o.end),i.appendSegment(s);else if(n==="cubic"){c=o.start.theta(o.end);var x=e*.6,w=e*1.35;l=o.start.difference(o.end),d=+(l.x<0||l.x===0&&l.y<0),d&&(w*=-1),f=E(o.start.x+x,o.start.y+w).rotate(o.start,c),u=E(o.end.x-x,o.end.y+w).rotate(o.end,c),s=et.createSegment("C",f,u,o.end),i.appendSegment(s)}}else{var T=t[a+1];r==0||!T||T.isJump?(s=et.createSegment("L",o.end),i.appendSegment(s)):Hd(r,i,o.end,o.start,T.end)}}),i}function Hd(t,e,n,r,i){var s=n.distance(r)/2,o=n.distance(i)/2,a=-Math.min(t,s),c=-Math.min(t,o),l=n.clone().move(r,a).round(),f=n.clone().move(i,c).round(),u=new E(or*l.x+ar*n.x,ar*n.y+or*l.y),d=new E(or*f.x+ar*n.x,ar*n.y+or*f.y),g;g=et.createSegment("L",l),e.appendSegment(g),g=et.createSegment("C",u,d,f),e.appendSegment(g)}const qd=function(t,e,n,r){zd(this);var i=r.raw,s=r.size||Dd,o=r.jump&&(""+r.jump).toLowerCase(),a=r.radius||Bd,c=r.ignoreConnectors||Fd;lo.indexOf(o)===-1&&(o=lo[0]);var l=this.paper,f=l.model,u=f.getLinks();if(u.length===1)return po(oi(t,e,n),s,o,a);var d=this.model,g=u.indexOf(d),v=l.options.defaultConnector||{},y=u.filter(function(I,D){var h=I.get("connector")||v;return pt(c).includes(h.name)?!1:D>g?h.name!=="jumpover":!0}),x=y.map(function(I){return l.findViewByModel(I)}),w=oi(t,e,n),T=x.map(function(I){return I==null?[]:I===this?w:oi(I.sourcePoint,I.targetPoint,I.route)},this),P=w.reduce(function(I,D){var h=y.reduce(function(p,m,b){if(m!==d){const S=T[b].slice(),O=S.findIndex(F=>Vd(D,F));O>-1&&D.containsPoint(S[O].end)&&S.splice(O+1,1);const N=Ud(D,S);p.push.apply(p,N)}return p},[]).sort(function(p,m){return go(D.start,p)-go(D.start,m)});return h.length>0?I.push.apply(I,$d(D,h,s)):I.push(D),I},[]),M=po(P,s,o,a);return i?M:M.serialize()},Wd=function(t,e,n=[],r={}){const{raw:i}=r;return gs(t,e,n,{cornerType:"point",raw:i})},jd=10,Yd=0,Xd=function(t,e,n=[],r={}){const{radius:i=jd,raw:s}=r;return gs(t,e,n,{cornerType:"cubic",cornerRadius:i,precision:Yd,raw:s})},Zd=function(t,e,n,r){var i=r&&r.raw,s;if(n&&n.length!==0){var o=[t].concat(n).concat([e]),a=vt.throughPoints(o);s=new et(a)}else{s=new et;var c;if(c=et.createSegment("M",t),s.appendSegment(c),Math.abs(t.x-e.x)>=Math.abs(t.y-e.y)){var l=(t.x+e.x)/2;c=et.createSegment("C",l,t.y,l,e.y,e.x,e.y),s.appendSegment(c)}else{var f=(t.y+e.y)/2;c=et.createSegment("C",t.x,f,e.x,f,e.x,e.y),s.appendSegment(c)}}return i?s:s.serialize()},Kt={AUTO:"auto",HORIZONTAL:"horizontal",VERTICAL:"vertical",CLOSEST_POINT:"closest-point",OUTWARDS:"outwards"},Ft={UP:"up",DOWN:"down",LEFT:"left",RIGHT:"right",AUTO:"auto",CLOSEST_POINT:"closest-point",OUTWARDS:"outwards"},ps=function(t,e,n=[],r={},i){const s=!!r.raw,{direction:o=Kt.AUTO,precision:a=3}=r,c={coeff:r.distanceCoefficient||.6,angleTangentCoefficient:r.angleTangentCoefficient||80,tau:r.tension||.5,sourceTangent:r.sourceTangent?new E(r.sourceTangent):null,targetTangent:r.targetTangent?new E(r.targetTangent):null,rotate:!!r.rotate};typeof r.sourceDirection=="string"?c.sourceDirection=r.sourceDirection:typeof r.sourceDirection=="number"?c.sourceDirection=new E(1,0).rotate(null,r.sourceDirection):c.sourceDirection=r.sourceDirection?new E(r.sourceDirection).normalize():null,typeof r.targetDirection=="string"?c.targetDirection=r.targetDirection:typeof r.targetDirection=="number"?c.targetDirection=new E(1,0).rotate(null,r.targetDirection):c.targetDirection=r.targetDirection?new E(r.targetDirection).normalize():null;const l=[t,...n,e].map(y=>new E(y));let f;if(c.sourceTangent)f=c.sourceTangent;else{const y=eg(i,l,o,c),x=l[0].distance(l[1])*c.coeff,w=l[1].difference(l[0]).normalize(),T=Mi(y,w);if(T>Math.PI/4){const P=x+(T-Math.PI/4)*c.angleTangentCoefficient;f=y.clone().scale(P,P)}else f=y.clone().scale(x,x)}let u;if(c.targetTangent)u=c.targetTangent;else{const y=ng(i,l,o,c),x=l.length-1,w=l[x-1].distance(l[x])*c.coeff,T=l[x-1].difference(l[x]).normalize(),P=Mi(y,T);if(P>Math.PI/4){const M=w+(P-Math.PI/4)*c.angleTangentCoefficient;u=y.clone().scale(M,M)}else u=y.clone().scale(w,w)}const g=ig(l,f,u,c).map(y=>sg(y,c)),v=new et(g).round(a);return s?v:v.serialize()};ps.Directions=Kt;ps.TangentDirections=Ft;function Jd(t,e,n){const{sourceBBox:r}=t;let i,s;if(!t.sourceView)r.x>e[1].x?i="right":i="left";else if(s=t.sourceView.model.angle(),n.rotate&&s){const a=t.sourceView.getNodeUnrotatedBBox(t.sourceView.el),c=e[0].clone();c.rotate(r.center(),s),i=a.sideNearestToPoint(c)}else i=r.sideNearestToPoint(e[0]);let o;switch(i){case"left":o=new E(-1,0);break;case"right":default:o=new E(1,0);break}return n.rotate&&s&&o.rotate(null,-s),o}function Kd(t,e,n){const{targetBBox:r}=t;let i,s;if(!t.targetView)r.x>e[e.length-2].x?i="left":i="right";else if(s=t.targetView.model.angle(),n.rotate&&s){const a=t.targetView.getNodeUnrotatedBBox(t.targetView.el),c=e[e.length-1].clone();c.rotate(r.center(),s),i=a.sideNearestToPoint(c)}else i=r.sideNearestToPoint(e[e.length-1]);let o;switch(i){case"left":o=new E(-1,0);break;case"right":default:o=new E(1,0);break}return n.rotate&&s&&o.rotate(null,-s),o}function Qd(t,e,n){const{sourceBBox:r}=t;let i,s;if(!t.sourceView)r.y>e[1].y?i="bottom":i="top";else if(s=t.sourceView.model.angle(),n.rotate&&s){const a=t.sourceView.getNodeUnrotatedBBox(t.sourceView.el),c=e[0].clone();c.rotate(r.center(),s),i=a.sideNearestToPoint(c)}else i=r.sideNearestToPoint(e[0]);let o;switch(i){case"top":o=new E(0,-1);break;case"bottom":default:o=new E(0,1);break}return n.rotate&&s&&o.rotate(null,-s),o}function tg(t,e,n){const{targetBBox:r}=t;let i,s;if(!t.targetView)r.y>e[e.length-2].y?i="top":i="bottom";else if(s=t.targetView.model.angle(),n.rotate&&s){const a=t.targetView.getNodeUnrotatedBBox(t.targetView.el),c=e[e.length-1].clone();c.rotate(r.center(),s),i=a.sideNearestToPoint(c)}else i=r.sideNearestToPoint(e[e.length-1]);let o;switch(i){case"top":o=new E(0,-1);break;case"bottom":default:o=new E(0,1);break}return n.rotate&&s&&o.rotate(null,-s),o}function vo(t,e,n){const{sourceBBox:r}=t;let i,s;if(!t.sourceView)i=r.sideNearestToPoint(e[1]);else if(s=t.sourceView.model.angle(),n.rotate&&s){const a=t.sourceView.getNodeUnrotatedBBox(t.sourceView.el),c=e[0].clone();c.rotate(r.center(),s),i=a.sideNearestToPoint(c)}else i=r.sideNearestToPoint(e[0]);let o;switch(i){case"top":o=new E(0,-1);break;case"bottom":o=new E(0,1);break;case"right":o=new E(1,0);break;case"left":o=new E(-1,0);break}return n.rotate&&s&&o.rotate(null,-s),o}function mo(t,e,n){const{targetBBox:r}=t;let i,s;if(!t.targetView)i=r.sideNearestToPoint(e[e.length-2]);else if(s=t.targetView.model.angle(),n.rotate&&s){const a=t.targetView.getNodeUnrotatedBBox(t.targetView.el),c=e[e.length-1].clone();c.rotate(r.center(),s),i=a.sideNearestToPoint(c)}else i=r.sideNearestToPoint(e[e.length-1]);let o;switch(i){case"top":o=new E(0,-1);break;case"bottom":o=new E(0,1);break;case"right":o=new E(1,0);break;case"left":o=new E(-1,0);break}return n.rotate&&s&&o.rotate(null,-s),o}function yo(t,e,n){return e[1].difference(e[0]).normalize()}function bo(t,e,n){const r=e.length-1;return e[r-1].difference(e[r]).normalize()}function xo(t,e,n){const{sourceBBox:r}=t,i=r.center();return e[0].difference(i).normalize()}function wo(t,e,n){const{targetBBox:r}=t,i=r.center();return e[e.length-1].difference(i).normalize()}function eg(t,e,n,r){if(r.sourceDirection)switch(r.sourceDirection){case Ft.UP:return new E(0,-1);case Ft.DOWN:return new E(0,1);case Ft.LEFT:return new E(-1,0);case Ft.RIGHT:return new E(1,0);case Ft.AUTO:return vo(t,e,r);case Ft.CLOSEST_POINT:return yo(t,e);case Ft.OUTWARDS:return xo(t,e);default:return r.sourceDirection}switch(n){case Kt.HORIZONTAL:return Jd(t,e,r);case Kt.VERTICAL:return Qd(t,e,r);case Kt.CLOSEST_POINT:return yo(t,e);case Kt.OUTWARDS:return xo(t,e);case Kt.AUTO:default:return vo(t,e,r)}}function ng(t,e,n,r){if(r.targetDirection)switch(r.targetDirection){case Ft.UP:return new E(0,-1);case Ft.DOWN:return new E(0,1);case Ft.LEFT:return new E(-1,0);case Ft.RIGHT:return new E(1,0);case Ft.AUTO:return mo(t,e,r);case Ft.CLOSEST_POINT:return bo(t,e);case Ft.OUTWARDS:return wo(t,e);default:return r.targetDirection}switch(n){case Kt.HORIZONTAL:return Kd(t,e,r);case Kt.VERTICAL:return tg(t,e,r);case Kt.CLOSEST_POINT:return bo(t,e);case Kt.OUTWARDS:return wo(t,e);case Kt.AUTO:default:return mo(t,e,r)}}function rg(t,e){const n=Math.cos(e),r=Math.sin(e),i=n*t.x-r*t.y,s=r*t.x+n*t.y;t.x=i,t.y=s}function Mi(t,e){let n=t.dot(e)/(t.magnitude()*e.magnitude());return n<-1&&(n=-1),n>1&&(n=1),Math.acos(n)}function So(t,e){return t.x*e.y-t.y*e.x}function ig(t,e,n,r){const{tau:i,coeff:s}=r,o=[],a=[],c=[],l=t.length-1;for(let f=0;f<l;f++)o[f]=t[f].distance(t[f+1]);a[0]=e,a[l]=n;for(let f=1;f<l;f++){let u,d;f===1?u=t[f-1].clone().offset(a[f-1].x,a[f-1].y):u=t[f-1].clone(),f===l-1?d=t[f+1].clone().offset(a[f+1].x,a[f+1].y):d=t[f+1].clone();const g=u.difference(t[f]).normalize(),v=d.difference(t[f]).normalize(),y=Mi(g,v);let x=(Math.PI-y)/2,w;const T=So(g,v);let P;P=So(t[f].difference(t[f+1]),t[f].difference(t[f-1])),T<0&&(x=-x),y<Math.PI/2&&(x<0&&P<0||x>0&&P>0)&&(x=x-Math.PI),w=v.clone(),rg(w,x);const M=w.clone(),I=w.clone(),D=o[f-1]*s,h=o[f]*s;M.scale(D,D),I.scale(h,h),a[f]=[M,I]}for(let f=0;f<l;f++){let u,d;f===0?u=t[f+1].difference(a[f].x/i,a[f].y/i):u=t[f+1].difference(a[f][1].x/i,a[f][1].y/i),f===l-1?d=t[f].clone().offset(a[f+1].x/i,a[f+1].y/i):d=t[f].difference(a[f+1][0].x/i,a[f+1][0].y/i),c[f]=[u,t[f],t[f+1],d]}return c}function sg(t,e){const{tau:n}=e,r=new E;r.x=t[1].x+(t[2].x-t[0].x)/(6*n),r.y=t[1].y+(t[2].y-t[0].y)/(6*n);const i=new E;return i.x=t[2].x+(t[3].x-t[1].x)/(6*n),i.y=t[2].y+(t[3].y-t[1].y)/(6*n),new vt(t[1],r,i,t[2])}const og=Object.freeze(Object.defineProperty({__proto__:null,curve:ps,jumpover:qd,normal:Wd,rounded:Xd,smooth:Zd,straight:gs},Symbol.toStringTag,{value:"Module"}));var He=function(t){this.cid=kn("view"),this.preinitialize.apply(this,arguments),J(this,Mf(t,cg)),this._ensureElement(),this.initialize.apply(this,arguments)},ag=/^(\S+)\s*(.*)$/,cg=["model","collection","el","id","attributes","className","tagName","events","style"];J(He.prototype,Gt,{tagName:"div",$:function(t){return this.$el.find(t)},preinitialize:function(){},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(t){return this.undelegateEvents(),this._setElement(t),this.delegateEvents(),this},_setElement:function(t){this.$el=t instanceof j?t:j(t),this.el=this.$el[0]},delegateEvents:function(t){if(t||(t=xt(this,"events")),!t)return this;this.undelegateEvents();for(var e in t){var n=t[e];if(yt(n)||(n=this[n]),!!n){var r=e.match(ag);this.delegate(r[1],r[2],n.bind(this))}}return this},delegate:function(t,e,n){return this.$el.on(t+".delegateEvents"+this.cid,e,n),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(t,e,n){return this.$el.off(t+".delegateEvents"+this.cid,e,n),this},_createElement:function(t){return document.createElement(t)},_ensureElement:function(){if(this.el)this.setElement(xt(this,"el"));else{var t=J({},xt(this,"attributes"));this.id&&(t.id=xt(this,"id")),this.className&&(t.class=xt(this,"className")),this.setElement(this._createElement(xt(this,"tagName"))),this._setAttributes(t)}},_setAttributes:function(t){this.$el.attr(t)}});He.extend=hs;const ze={},Le=He.extend({options:{},theme:null,themeClassNamePrefix:xe("theme-"),requireSetThemeOverride:!1,defaultTheme:hn.defaultTheme,children:null,childNodes:null,DETACHABLE:!0,UPDATE_PRIORITY:2,FLAG_INSERT:1<<30,FLAG_REMOVE:1<<29,FLAG_INIT:1<<28,constructor:function(t){this.requireSetThemeOverride=t&&!!t.theme,this.options=J({},this.options,t),He.call(this,t)},initialize:function(){ze[this.cid]=this,this.setTheme(this.options.theme||this.defaultTheme),this.init()},unmount:function(){this.svgElement?this.vel.remove():this.$el.remove()},isMounted:function(){return this.el.parentNode!==null},renderChildren:function(t){if(t||(t=xt(this,"children")),t){var e=this.svgElement,n=z.namespace[e?"svg":"xhtml"],r=Pr(t,n);(e?this.vel:this.$el).empty().append(r.fragment),this.childNodes=r.selectors}return this},findAttributeNode:function(t,e){let n=e;for(;n&&n.nodeType===1;){if(n.getAttribute(t))return n;if(n===this.el)return null;n=n.parentNode}return null},findAttribute:function(t,e){const n=this.findAttributeNode(t,e);return n&&n.getAttribute(t)},_ensureElement:function(){if(this.el)this.setElement(xt(this,"el"));else{var t=xt(this,"tagName"),e=J({},xt(this,"attributes")),n=J({},xt(this,"style"));this.id&&(e.id=xt(this,"id")),this.setElement(this._createElement(t)),this._setAttributes(e),this._setStyle(n)}this._ensureElClassName()},_setAttributes:function(t){this.svgElement?this.vel.attr(t):this.$el.attr(t)},_setStyle:function(t){this.$el.css(t)},_createElement:function(t){return this.svgElement?document.createElementNS(z.namespace.svg,t):document.createElement(t)},_setElement:function(t){this.$el=t instanceof j?t:j(t),this.el=this.$el[0],this.svgElement&&(this.vel=z(this.el))},_ensureElClassName:function(){var t=xt(this,"className");if(t){var e=xe(t);this.svgElement?this.vel.removeClass(t).addClass(e):this.$el.removeClass(t).addClass(e)}},init:function(){},onRender:function(){},confirmUpdate:function(){return 0},setTheme:function(t,e){return e=e||{},this.theme&&this.requireSetThemeOverride&&!e.override?this:(this.removeThemeClassName(),this.addThemeClassName(t),this.onSetTheme(this.theme,t),this.theme=t,this)},addThemeClassName:function(t){if(t=t||this.theme,!t)return this;var e=this.themeClassNamePrefix+t;return this.svgElement?this.vel.addClass(e):this.$el.addClass(e),this},removeThemeClassName:function(t){t=t||this.theme;var e=this.themeClassNamePrefix+t;return this.svgElement?this.vel.removeClass(e):this.$el.removeClass(e),this},onSetTheme:function(t,e){},remove:function(){return this.onRemove(),this.undelegateDocumentEvents(),ze[this.cid]=null,He.prototype.remove.apply(this,arguments),this},onRemove:function(){},getEventNamespace:function(){return".joint-event-ns-"+this.cid},delegateElementEvents:function(t,e,n){if(!e)return this;n||(n={});var r=this.getEventNamespace();for(var i in e){var s=e[i];typeof s!="function"&&(s=this[s]),s&&j(t).on(i+r,n,s.bind(this))}return this},undelegateElementEvents:function(t){return j(t).off(this.getEventNamespace()),this},delegateDocumentEvents:function(t,e){return t||(t=xt(this,"documentEvents")),this.delegateElementEvents(document,t,e)},undelegateDocumentEvents:function(){return this.undelegateElementEvents(document)},eventData:function(t,e){if(!t)throw new Error("eventData(): event object required.");var n=t.data,r="__"+this.cid+"__";return e===void 0?n?n[r]||{}:{}:(n||(n=t.data={}),n[r]||(n[r]={}),J(n[r],e),this)},stopPropagation:function(t){return this.eventData(t,{propagationStopped:!0}),this},isPropagationStopped:function(t){return!!this.eventData(t).propagationStopped}},{extend:function(){var t=Array.from(arguments),e=t[0]&&J({},t[0])||{},n=t[1]&&J({},t[1])||{},r=e.render||this.prototype&&this.prototype.render||null;return e.render=function(){return typeof r=="function"&&r.apply(this,arguments),this.render.__render__===r&&this.onRender(),this},e.render.__render__=r,He.extend.call(this,e,n)}});var Me=function(t,e){e||(e={}),this.preinitialize.apply(this,arguments),e.model&&(this.model=e.model),e.comparator!==void 0&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,J({silent:!0},e))},ug={add:!0,remove:!0,merge:!0},lg={add:!0,remove:!1},Ao=function(t,e,n){n=Math.min(Math.max(n,0),t.length);var r=Array(t.length-n),i=e.length,s;for(s=0;s<r.length;s++)r[s]=t[s+n];for(s=0;s<i;s++)t[s+n]=e[s];for(s=0;s<r.length;s++)t[s+i+n]=r[s]};J(Me.prototype,Gt,{model:Jt,preinitialize:function(){},initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},add:function(t,e){return this.set(t,J({merge:!1},e,lg))},remove:function(t,e){e=J({},e);var n=!Array.isArray(t);t=n?[t]:t.slice();var r=this._removeModels(t,e);return!e.silent&&r.length&&(e.changes={added:[],merged:[],removed:r},this.trigger("update",this,e)),n?r[0]:r},set:function(t,e){if(t!=null){e=J({},ug,e);var n=!Array.isArray(t);t=n?[t]:t.slice();var r=e.at;r!=null&&(r=+r),r>this.length&&(r=this.length),r<0&&(r+=this.length+1);var i=[],s=[],o=[],a=[],c={},l=e.add,f=e.merge,u=e.remove,d=!1,g=this.comparator&&r==null&&e.sort!==!1,v=Ct(this.comparator)?this.comparator:null,y,x;for(x=0;x<t.length;x++){y=t[x];var w=this.get(y);if(w){if(f&&y!==w){var T=this._isModel(y)?y.attributes:y;w.set(T,e),o.push(w),g&&!d&&(d=w.hasChanged(v))}c[w.cid]||(c[w.cid]=!0,i.push(w)),t[x]=w}else l&&(y=t[x]=this._prepareModel(y,e),y&&(s.push(y),this._addReference(y,e),c[y.cid]=!0,i.push(y)))}if(u){for(x=0;x<this.length;x++)y=this.models[x],c[y.cid]||a.push(y);a.length&&this._removeModels(a,e)}var P=!1,M=!g&&l&&u;if(i.length&&M?(P=this.length!==i.length||this.models.some(function(I,D){return I!==i[D]}),this.models.length=0,Ao(this.models,i,0),this.length=this.models.length):s.length&&(g&&(d=!0),Ao(this.models,s,r??this.length),this.length=this.models.length),d&&this.sort({silent:!0}),!e.silent){for(x=0;x<s.length;x++)r!=null&&(e.index=r+x),y=s[x],y.trigger("add",y,this,e);(d||P)&&this.trigger("sort",this,e),(s.length||a.length||o.length)&&(e.changes={added:s,removed:a,merged:o},this.trigger("update",this,e))}return n?t[0]:t}},reset:function(t,e){e=e?Dt(e):{};for(var n=0;n<this.models.length;n++)this._removeReference(this.models[n],e);return e.previousModels=this.models,this._reset(),t=this.add(t,J({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,J({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t)},unshift:function(t,e){return this.add(t,J({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t)},slice:function(){return Array.prototype.slice.apply(this.models,arguments)},get:function(t){if(t!=null)return this._byId[t]||this._byId[this.modelId(this._isModel(t)?t.attributes:t,t.idAttribute)]||t.cid&&this._byId[t.cid]},has:function(t){return this.get(t)!=null},at:function(t){return t<0&&(t+=this.length),this.models[t]},sort:function(t){var e=this.comparator;if(!e)throw new Error("Cannot sort a set without a comparator");t||(t={});var n=e.length;return yt(e)&&(e=e.bind(this)),n===1||Ct(e)?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("sort",this,t),this},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(t,e){return t[e||this.model.prototype.idAttribute||"id"]},values:function(){return new Cn(this,Gc)},keys:function(){return new Cn(this,Uc)},entries:function(){return new Cn(this,fg)},each:function(t,e){this.models.forEach(t,e)},filter:function(t,e){return this.models.filter(t,e)},find:function(t,e){return this.models.find(t,e)},findIndex:function(t,e){return this.models.findIndex(t,e)},first:function(){return this.models[0]},includes:function(t){return this.models.includes(t)},last:function(){return this.models[this.models.length-1]},isEmpty:function(){return!this.models.length},map:function(t,e){return this.models.map(t,e)},reduce:function(t,e=this.first()){return this.models.reduce(t,e)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(t,e){if(this._isModel(t))return t.collection||(t.collection=this),t;e=e?Dt(e):{},e.collection=this;var n;return this.model.prototype?n=new this.model(t,e):n=this.model(t,e),n.validationError?(this.trigger("invalid",this,n.validationError,e),!1):n},_removeModels:function(t,e){for(var n=[],r=0;r<t.length;r++){var i=this.get(t[r]);if(i){var s=this.models.indexOf(i);this.models.splice(s,1),this.length--,delete this._byId[i.cid];var o=this.modelId(i.attributes,i.idAttribute);o!=null&&delete this._byId[o],e.silent||(e.index=s,i.trigger("remove",i,this,e)),n.push(i),this._removeReference(i,e)}}return t.length>0&&!e.silent&&delete e.index,n},_isModel:function(t){return t instanceof Jt},_addReference:function(t,e){this._byId[t.cid]=t;var n=this.modelId(t.attributes,t.idAttribute);n!=null&&(this._byId[n]=t),t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){delete this._byId[t.cid];var n=this.modelId(t.attributes,t.idAttribute);n!=null&&delete this._byId[n],this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,n,r){if(e){if((t==="add"||t==="remove")&&n!==this)return;if(t==="changeId"){var i=this.modelId(e.previousAttributes(),e.idAttribute),s=this.modelId(e.attributes,e.idAttribute);i!=null&&delete this._byId[i],s!=null&&(this._byId[s]=e)}}this.trigger.apply(this,arguments)}});var Cr=typeof Symbol=="function"&&Symbol.iterator;Cr&&(Me.prototype[Cr]=Me.prototype.values);var Cn=function(t,e){this._collection=t,this._kind=e,this._index=0},Gc=1,Uc=2,fg=3;Cr&&(Cn.prototype[Cr]=function(){return this});Cn.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){var t=this._collection.at(this._index);this._index++;var e;if(this._kind===Gc)e=t;else{var n=this._collection.modelId(t.attributes,t.idAttribute);this._kind===Uc?e=n:e=[n,t]}return{value:e,done:!1}}this._collection=void 0}return{value:void 0,done:!0}};var hg={toArray:1,sortBy:3},dg=[Me,hg,"models"];function gg(t){var e=t[0],n=t[1],r=t[2];Nh(e,{sortBy:dr,toArray:pt},n,r)}gg(dg);Me.extend=hs;function An(t){return t?Array.isArray(t)?t:[t]:[]}const ae=Le.extend({tagName:"g",svgElement:!0,className:"highlight",HIGHLIGHT_FLAG:1,UPDATE_PRIORITY:3,DETACHABLE:!1,UPDATABLE:!0,MOUNTABLE:!0,cellView:null,nodeSelector:null,node:null,updateRequested:!1,postponedUpdate:!1,transformGroup:null,detachedTransformGroup:null,requestUpdate(t,e){const{paper:n}=t;this.cellView=t,this.nodeSelector=e,n&&(this.updateRequested=!0,n.requestViewUpdate(this,this.HIGHLIGHT_FLAG,this.UPDATE_PRIORITY))},confirmUpdate(){this.updateRequested=!1;const{cellView:t,nodeSelector:e}=this;return t.isMounted()?(this.update(t,e),this.mount(),this.transform()):this.postponedUpdate=!0,0},findNode(t,e=null){let n;if(typeof e=="string")n=t.findNode(e);else if(Pt(e)){const r=t.model.isLink(),{label:i=null,port:s,selector:o}=e;r&&i!==null?n=t.findLabelNode(i,o):!r&&s?n=t.findPortNode(s,o):n=t.findNode(o)}else e&&(n=z.toNode(e),n instanceof SVGElement||(n=null));return n||null},getNodeMatrix(t,e){const{options:n}=this,{layer:r}=n,{rotatableNode:i}=t,s=t.getNodeMatrix(e);return i?r?i.contains(e)?s:t.getRootRotateMatrix().inverse().multiply(s):t.getNodeRotateMatrix(e).multiply(s):s},mount(){const{MOUNTABLE:t,cellView:e,el:n,options:r,transformGroup:i,detachedTransformGroup:s,postponedUpdate:o,nodeSelector:a}=this;if(!t||i)return;if(o){this.update(e,a),this.transform();return}const{vel:c,paper:l}=e,{layer:f}=r;if(f){let u;s?(u=s,this.detachedTransformGroup=null):u=z("g").addClass("highlight-transform").append(n),this.transformGroup=u,l.getLayerView(f).insertSortedNode(u.node,r.z)}else(!n.parentNode||n.nextSibling)&&c.append(n)},unmount(){const{MOUNTABLE:t,transformGroup:e,vel:n}=this;t&&(e?(this.transformGroup=null,this.detachedTransformGroup=e,e.remove()):n.remove())},transform(){const{transformGroup:t,cellView:e,updateRequested:n}=this;if(!t||e.model.isLink()||n)return;const r=e.getRootTranslateMatrix(),i=e.getRootRotateMatrix(),s=r.multiply(i);t.attr("transform",z.matrixToTransformString(s))},update(){const{node:t,cellView:e,nodeSelector:n,updateRequested:r,id:i}=this;if(r)return;this.postponedUpdate=!1;const s=this.node=this.findNode(e,n);t&&this.unhighlight(e,t),s?(this.highlight(e,s),this.mount()):(this.unmount(),e.notify("cell:highlight:invalid",i,this))},onRemove(){const{node:t,cellView:e,id:n,constructor:r}=this;t&&this.unhighlight(e,t),this.unmount(),r._removeRef(e,n)},highlight(t,e){},unhighlight(t,e){},listenToUpdateAttributes(t){const e=xt(this,"UPDATE_ATTRIBUTES");!Array.isArray(e)||e.length===0||this.listenTo(t.model,"change",this.onCellAttributeChange)},onCellAttributeChange(){const{cellView:t}=this;if(!t)return;const{model:e,paper:n}=t;xt(this,"UPDATE_ATTRIBUTES").some(i=>e.hasChanged(i))&&n.requestViewUpdate(this,this.HIGHLIGHT_FLAG,this.UPDATE_PRIORITY)}},{_views:{},highlight:function(t,e,n){const r=this.uniqueId(e,n);this.add(t,e,r,n)},unhighlight:function(t,e,n){const r=this.uniqueId(e,n);this.remove(t,r)},get(t,e=null){const{cid:n}=t,{_views:r}=this,i=r[n];if(e===null){const s=[];if(!i)return s;for(let o in i){const a=i[o];a instanceof this&&s.push(a)}return s}else{if(!i)return null;if(e in i){const s=i[e];if(s instanceof this)return s}return null}},add(t,e,n,r={}){if(!n)throw new Error("dia.HighlighterView: An ID required.");const i=ae.get(t,n);i&&i.remove();const s=new this(r);return s.id=n,this._addRef(t,n,s),s.requestUpdate(t,e),s.listenToUpdateAttributes(t),s},_addRef(t,e,n){const{cid:r}=t,{_views:i}=this;let s=i[r];s||(s=i[r]={}),s[e]=n},_removeRef(t,e){const{cid:n}=t,{_views:r}=this,i=r[n];if(i){e&&delete i[e];for(let s in i)return;delete r[n]}},remove(t,e=null){An(this.get(t,e)).forEach(n=>{n.remove()})},getAll(t,e=null){const n=[],{_views:r}=this;for(let i in r)for(let s in r[i]){const o=r[i][s];o.cellView.paper===t&&o instanceof this&&(e===null||s===e)&&n.push(o)}return n},removeAll(t,e=null){this.getAll(t,e).forEach(n=>n.remove())},update(t,e=null,n=!1){An(this.get(t,e)).forEach(r=>{(n||r.UPDATABLE)&&r.update()})},transform(t,e=null){An(this.get(t,e)).forEach(n=>{n.UPDATABLE&&n.transform()})},unmount(t,e=null){An(this.get(t,e)).forEach(n=>n.unmount())},mount(t,e=null){An(this.get(t,e)).forEach(n=>n.mount())},uniqueId(t,e=""){return z.ensureId(t)+JSON.stringify(e)}}),pg=ae.extend({tagName:"path",className:"highlight-stroke",attributes:{"pointer-events":"none",fill:"none"},options:{padding:3,rx:0,ry:0,useFirstSubpath:!1,attrs:{"stroke-width":3,stroke:"#FEB663"}},getPathData(t,e){const{options:n}=this,{useFirstSubpath:r}=n;let i;try{const s=z(e);if(i=s.convertToPathData().trim(),s.tagName()==="PATH"&&r){const o=i.search(/.M/i)+1;o>0&&(i=i.substr(0,o))}}catch{const o=t.getNodeBoundingRect(e);i=z.rectToPath(J({},n,o.toJSON()))}return i},highlightConnection(t){this.vel.attr("d",t.getSerializedConnection())},highlightNode(t,e){const{vel:n,options:r}=this,{padding:i,layer:s}=r;let o=this.getNodeMatrix(t,e);if(i){!s&&e===t.el&&n.remove();let a=t.getNodeBoundingRect(e);const c=a.x+a.width/2,l=a.y+a.height/2;a=z.transformRect(a,o);const f=Math.max(a.width,1),u=Math.max(a.height,1),d=(f+i)/f,g=(u+i)/u,v=z.createSVGMatrix({a:d,b:0,c:0,d:g,e:c-d*c,f:l-g*l});o=o.multiply(v)}n.attr({d:this.getPathData(t,e),transform:z.matrixToTransformString(o)})},highlight(t,e){const{vel:n,options:r}=this;n.attr(r.attrs),r.nonScalingStroke&&n.attr("vector-effect","non-scaling-stroke"),t.isNodeConnection(e)?this.highlightConnection(t):this.highlightNode(t,e)}}),To=20;function vg(t,e){const n=t.children();for(;n.length>0;){const r=n.shift();e(r)&&n.push(...r.children())}}const mg=ae.extend({tagName:"rect",className:"highlight-mask",attributes:{"pointer-events":"none"},options:{padding:3,maskClip:To,deep:!1,attrs:{stroke:"#FEB663","stroke-width":3,"stroke-linecap":"butt","stroke-linejoin":"miter"}},VISIBLE:"white",INVISIBLE:"black",MASK_ROOT_ATTRIBUTE_BLACKLIST:["marker-start","marker-end","marker-mid","transform","stroke-dasharray","class"],MASK_CHILD_ATTRIBUTE_BLACKLIST:["stroke","fill","stroke-width","stroke-opacity","stroke-dasharray","fill-opacity","marker-start","marker-end","marker-mid","class"],MASK_REPLACE_TAGS:["FOREIGNOBJECT","IMAGE","USE","TEXT","TSPAN","TEXTPATH"],MASK_REMOVE_TAGS:["TEXT","TSPAN","TEXTPATH"],transformMaskChild(t,e){const{MASK_CHILD_ATTRIBUTE_BLACKLIST:n,MASK_REPLACE_TAGS:r,MASK_REMOVE_TAGS:i}=this,s=e.tagName();if(!z.isSVGGraphicsElement(e)||i.includes(s))return e.remove(),!1;if(r.includes(s)){const o=t.vel.findOne(`#${e.id}`);if(o){const{node:a}=o;let c=t.getNodeBoundingRect(a);t.model.isElement()&&(c=z.transformRect(c,t.getNodeMatrix(a)));const l=z("rect",c.toJSON()),{x:f,y:u}=c.center(),{angle:d,cx:g=f,cy:v=u}=o.rotate();d&&l.rotate(d,g,v),e.parent().append(l)}return e.remove(),!1}return n.forEach(o=>{o==="fill"&&e.attr("fill")==="none"||e.removeAttr(o)}),!0},transformMaskRoot(t,e){const{MASK_ROOT_ATTRIBUTE_BLACKLIST:n}=this;n.forEach(r=>{e.removeAttr(r)})},getMaskShape(t,e){const{options:n,MASK_REPLACE_TAGS:r}=this,{deep:i}=n,s=e.tagName();let o;if(s==="G"){if(!i)return null;o=e.clone(),vg(o,a=>this.transformMaskChild(t,a))}else{if(r.includes(s))return null;o=e.clone()}return this.transformMaskRoot(t,o),o},getMaskId(){return`highlight-mask-${this.cid}`},getMask(t,e){const{VISIBLE:n,INVISIBLE:r,options:i}=this,{padding:s,attrs:o}=i,a=parseFloat(z("g").attr(o).attr("stroke-width")),c=e.attr("fill")!=="none";let l=parseFloat(e.attr("stroke-width"));isNaN(l)&&(l=1);const f=l+s*2,u=f+a*2;let d=this.getMaskShape(t,e);if(!d){const g=t.getNodeBoundingRect(e.node);g.inflate(g.width?0:.5,g.height?0:.5),d=z("rect",g.toJSON())}return d.attr(o),z("mask",{id:this.getMaskId()}).append([d.clone().attr({fill:c?n:"none",stroke:n,"stroke-width":u}),d.clone().attr({fill:c?r:"none",stroke:r,"stroke-width":f})])},removeMask(t){const e=t.svg.getElementById(this.getMaskId());e&&t.defs.removeChild(e)},addMask(t,e){t.defs.appendChild(e.node)},highlight(t,e){const{options:n,vel:r}=this,{padding:i,attrs:s,maskClip:o=To,layer:a}=n,c="stroke"in s?s.stroke:"#000000";!a&&e===t.el&&r.remove();const l=t.getNodeBoundingRect(e).inflate(i+o),f=this.getNodeMatrix(t,e),u=this.getMask(t,z(e));this.addMask(t.paper,u),r.attr(l.toJSON()),r.attr({transform:z.matrixToTransformString(f),mask:`url(#${u.id})`,fill:c})},unhighlight(t){this.removeMask(t.paper)}}),yg=ae.extend({UPDATABLE:!1,MOUNTABLE:!1,highlight:function(t,e){const{alphaValue:n=.3}=this.options;e.style.opacity=n},unhighlight:function(t,e){e.style.opacity=""}}),Eo=xe("highlighted"),bg=ae.extend({UPDATABLE:!1,MOUNTABLE:!1,options:{className:Eo},highlight:function(t,e){z(e).addClass(this.options.className)},unhighlight:function(t,e){z(e).removeClass(this.options.className)}},{className:Eo}),ai={ROW:"row",COLUMN:"column"},xg=ae.extend({tagName:"g",MOUNTABLE:!0,UPDATE_ATTRIBUTES:function(){return[this.options.attribute]},_prevItems:null,highlight(t,e){const n=t.model,{attribute:r,size:i=20,gap:s=5,direction:o=ai.ROW}=this.options;if(!r)throw new Error("List: attribute is required");const a=typeof i=="number"?{width:i,height:i}:i,c=o===ai.ROW,l=c?a.width:a.height;let f=n.get(r);Array.isArray(f)||(f=[]);const u=this._prevItems||[],d=f.map((x,w)=>_e(u[w],f[w]));if(u.length!==f.length||d.some(x=>!x)){const x=this.vel.children(),w=f.map((T,P)=>{const M=P in x?x[P].node:null;if(d[P])return M;const I=this.createListItem(T,a,M);if(!I)return null;if(!(I instanceof SVGElement))throw new Error("List: item must be an SVGElement");I.dataset.index=P,I.dataset.attribute=r;const D=P*(l+s);return I.setAttribute("transform",c?`translate(${D}, 0)`:`translate(0, ${D})`),I});this.vel.empty().append(w),this._prevItems=f}const g=f.length,v=g===0?0:g*l+(g-1)*s,y=c?{width:v,height:a.height}:{width:a.width,height:v};this.position(n,y)},position(t,e){const{vel:n,options:r}=this,{margin:i=5,position:s="top-left"}=r,{width:o,height:a}=t.size(),{left:c,right:l,top:f,bottom:u}=Oe(i),d=new Y(c,f,o-(c+l),a-(f+u));let{x:g,y:v}=Mc(d,s);switch(s){case Tt.CENTER:case Tt.TOP:case Tt.BOTTOM:{g-=e.width/2;break}case Tt.RIGHT:case Tt.BOTTOM_RIGHT:case Tt.TOP_RIGHT:{g-=e.width;break}}switch(s){case Tt.CENTER:case Tt.RIGHT:case Tt.LEFT:{v-=e.height/2;break}case Tt.BOTTOM:case Tt.BOTTOM_RIGHT:case Tt.BOTTOM_LEFT:{v-=e.height;break}}n.attr("transform",`translate(${g}, ${v})`)}},{Directions:ai,Positions:Tt}),wg=Object.freeze(Object.defineProperty({__proto__:null,addClass:bg,list:xg,mask:mg,opacity:yg,stroke:pg},Symbol.toStringTag,{value:"Module"}));function Yr(t,e,n){if(Pt(n)){const{x:i,y:s}=n;if(isFinite(s)){const o=new X(e,t),{start:a,end:c}=o.parallel(s);e=a,t=c}n=i}if(!isFinite(n))return t;var r=t.distance(e);return n===0&&r>0?t:t.move(e,-Math.min(n,r-1))}function vs(t){var e=t.getAttribute("stroke-width");return e===null?0:parseFloat(e)||0}function Sg(t,e,n=0){let r,i,s,o;const{start:a,end:c}=t;switch(e){case"left":r="x",i=c,s=a,o=-1;break;case"right":r="x",i=a,s=c,o=1;break;case"top":r="y",i=c,s=a,o=-1;break;case"bottom":r="y",i=a,s=c,o=1;break;default:return}a[r]<c[r]?i[r]=s[r]:s[r]=i[r],isFinite(n)&&(i[r]+=o*n,s[r]+=o*n)}function Ag(t,e,n,r){let{offset:i,alignOffset:s,align:o}=r;return o&&Sg(t,o,s),Yr(t.end,t.start,i)}function $c(t,e,n,r){var i=e.getNodeBBox(n);r.stroke&&i.inflate(vs(n)/2);var s=t.intersect(i),o=s?t.start.chooseClosest(s):t.end;return Yr(o,t.start,r.offset)}function Tg(t,e,n,r){var i=e.model.angle();if(i===0)return $c(t,e,n,r);var s=e.getNodeUnrotatedBBox(n);r.stroke&&s.inflate(vs(n)/2);var o=s.center(),a=t.clone().rotate(o,i),c=a.setLength(1e6).intersect(s),l=c?a.start.chooseClosest(c).rotate(o,-i):t.end;return Yr(l,t.start,r.offset)}function Eg(t){if(!t)return null;var e=t;do{var n=e.tagName;if(typeof n!="string")return null;if(n=n.toUpperCase(),n==="G")e=e.firstElementChild;else if(n==="TITLE")e=e.nextElementSibling;else break}while(e);return e}var ci="segmentSubdivisons",ui="shapeBBox";function Pg(t,e,n,r){var i,s,o=r.selector,a=t.end;if(typeof o=="string"?i=e.findNode(o):o===!1?i=n:Array.isArray(o)?i=vn(n,o):i=Eg(n),!z.isSVGGraphicsElement(i)){if(i===n||!z.isSVGGraphicsElement(n))return a;i=n}var c=e.getNodeShape(i),l=e.getNodeMatrix(i),f=e.getRootTranslateMatrix(),u=e.getRootRotateMatrix(),d=f.multiply(u).multiply(l),g=d.inverse(),v=z.transformLine(t,g),y=v.start.clone(),x=e.getNodeData(i);if(r.insideout===!1){x[ui]||(x[ui]=c.bbox());var w=x[ui];if(w.containsPoint(y))return a}var T;if(c instanceof et){var P=r.precision||2;x[ci]||(x[ci]=c.getSegmentSubdivisions({precision:P})),T={precision:P,segmentSubdivisions:x[ci]}}r.extrapolate===!0&&v.setLength(1e6),s=v.intersect(c,T),s?z.isArray(s)&&(s=y.chooseClosest(s)):r.sticky===!0&&(c instanceof Y?s=c.pointNearestToPoint(y):c instanceof Vt?s=c.intersectionWithLineFromCenterToPoint(y):s=c.closestPoint(y,T));var M=s?z.transformPoint(s,d):a,I=r.offset||0;return r.stroke&&(I+=vs(i)/2),Yr(M,t.start,I)}const Cg=Ag,_g=$c,Lg=Tg,Mg=Pg,Og=Object.freeze(Object.defineProperty({__proto__:null,anchor:Cg,bbox:_g,boundary:Mg,rectangle:Lg},Symbol.toStringTag,{value:"Module"})),Ng=function(t,e,n){return t},Ig=function(t,e,n){var r=e.side||"bottom",i=Oe(e.padding||40),s=n.sourceBBox,o=n.targetBBox,a=s.center(),c=o.center(),l,f,u;switch(r){case"bottom":u=1,l="y",f="height";break;case"top":u=-1,l="y",f="height";break;case"left":u=-1,l="x",f="width";break;case"right":u=1,l="x",f="width";break;default:throw new Error("Router: invalid side")}return a[l]+=u*(s[f]/2+i[r]),c[l]+=u*(o[f]/2+i[r]),u*(a[l]-c[l])>0?c[l]=a[l]:a[l]=c[l],[a].concat(t,c)};var Rg={N:"S",S:"N",E:"W",W:"E"},kg={N:-Math.PI/2*3,S:-Math.PI/2,E:0,W:Math.PI};function _r(t,e,n){var r=new E(t.x,e.y);return n.containsPoint(r)&&(r=new E(e.x,t.y)),r}function Oi(t,e){return t[e==="W"||e==="E"?"width":"height"]}function zt(t,e){return t.x===e.x?t.y>e.y?"N":"S":t.y===e.y?t.x>e.x?"W":"E":null}function cr(t){return new Y(t.x,t.y,0,0)}function Lr(t){var e=Oe(t.padding||t.elementPadding||20);return{x:-e.left,y:-e.top,width:e.left+e.right,height:e.top+e.bottom}}function Hc(t,e){return t.sourceBBox.clone().moveAndExpand(Lr(e))}function qc(t,e){return t.targetBBox.clone().moveAndExpand(Lr(e))}function Dg(t,e){if(t.sourceAnchor)return t.sourceAnchor;var n=Hc(t,e);return n.center()}function Bg(t,e){if(t.targetAnchor)return t.targetAnchor;var n=qc(t,e);return n.center()}function Wc(t,e,n){var r=new E(t.x,e.y),i=new E(e.x,t.y),s=zt(t,r),o=zt(t,i),a=Rg[n],c=s===n||s!==a&&(o===a||o!==n)?r:i;return{points:[c],direction:zt(c,e)}}function mr(t,e,n){var r=_r(t,e,n);return{points:[r],direction:zt(r,e)}}function Fg(t,e,n,r){var i={},s=[new E(t.x,e.y),new E(e.x,t.y)],o=s.filter(function(u){return!n.containsPoint(u)}),a=o.filter(function(u){return zt(u,t)!==r}),c;if(a.length>0)c=a.filter(function(u){return zt(t,u)===r}).pop(),c=c||a[0],i.points=[c],i.direction=zt(c,e);else{c=Lf(s,o)[0];var l=new E(e).move(c,-Oi(n,r)/2),f=_r(l,t,n);i.points=[f,l],i.direction=zt(l,e)}return i}function Vg(t,e,n,r){var i=mr(e,t,r),s=i.points[0];if(n.containsPoint(s)){i=mr(t,e,n);var o=i.points[0];if(r.containsPoint(o)){var a=new E(t).move(o,-Oi(n,zt(t,o))/2),c=new E(e).move(s,-Oi(r,zt(e,s))/2),l=new X(a,c).midpoint(),f=mr(t,l,n),u=Wc(l,e,f.direction);i.points=[f.points[0],u.points[0]],i.direction=u.direction}}return i}function li(t,e,n,r,i){var s={},o=n.union(r).inflate(1),a=o.center().distance(e)>o.center().distance(t),c=a?e:t,l=a?t:e,f,u,d;return i?(f=E.fromPolar(o.width+o.height,kg[i],c),f=o.pointNearestToPoint(f).move(f,-1)):f=o.pointNearestToPoint(c).move(c,1),u=_r(f,l,o),f.round().equals(u.round())?(u=E.fromPolar(o.width+o.height,$t(f.theta(c))+Math.PI/2,l),u=o.pointNearestToPoint(u).move(l,1).round(),d=_r(f,u,o),s.points=a?[u,d,f]:[f,d,u]):s.points=a?[u,f]:[f,u],s.direction=zt(a?f:u,e),s}function Ni(t,e,n){var r=Hc(n,e),i=qc(n,e),s=Dg(n,e),o=Bg(n,e);r=r.union(cr(s)),i=i.union(cr(o)),t=pt(t).map(E),t.unshift(s),t.push(o);for(var a,c=[],l=0,f=t.length-1;l<f;l++){var u=null,d=t[l],g=t[l+1],v=!!zt(d,g);if(l===0)l+1===f?r.intersect(i.clone().inflate(1))?u=li(d,g,r,i):v||(u=Vg(d,g,r,i)):r.containsPoint(g)?u=li(d,g,r,cr(g).moveAndExpand(Lr(e))):v||(u=mr(d,g,r));else if(l+1===f){var y=v&&zt(g,d)===a;i.containsPoint(d)||y?u=li(d,g,cr(d).moveAndExpand(Lr(e)),i,a):v||(u=Fg(d,g,i,a))}else v||(u=Wc(d,g,a));u?(Array.prototype.push.apply(c,u.points),a=u.direction):a=zt(d,g),l+1<f&&c.push(g)}return c}var jc={step:10,maximumLoops:2e3,precision:1,maxAllowedDirectionChange:90,perpendicular:!0,excludeEnds:[],excludeTypes:[],startDirections:["top","right","bottom","left"],endDirections:["top","right","bottom","left"],directionMap:{top:{x:0,y:-1},right:{x:1,y:0},bottom:{x:0,y:1},left:{x:-1,y:0}},cost:function(){return this.step},directions:function(){var t=this.step,e=this.cost();return[{offsetX:t,offsetY:0,cost:e},{offsetX:-t,offsetY:0,cost:e},{offsetX:0,offsetY:t,cost:e},{offsetX:0,offsetY:-t,cost:e}]},penalties:function(){return{0:0,45:this.step/2,90:this.step/2}},paddingBox:function(){var t=this.step;return{x:-t,y:-t,width:2*t,height:2*t}},isPointObstacle:null,fallbackRouter:function(t,e,n){if(!yt(Ni))throw new Error("Manhattan requires the orthogonal router as default fallback.");return Ni(t,J({},jc,e),n)},fallbackRoute:function(t,e,n){return null},draggingRoute:null};function ms(t){this.map={},this.options=t,this.mapGridSize=100}ms.prototype.build=function(t,e){var n=this.options,r=pt(n.excludeEnds).reduce(function(c,l){var f=e.get(l);if(f){var u=t.getCell(f.id);u&&c.push(u)}return c},[]),i=[],s=t.getCell(e.get("source").id);s&&(i=Pi(i,s.getAncestors().map(function(c){return c.id})));var o=t.getCell(e.get("target").id);o&&(i=Pi(i,o.getAncestors().map(function(c){return c.id})));var a=this.mapGridSize;return t.getElements().reduce(function(c,l){var f=pt(n.excludeTypes).includes(l.get("type")),u=r.find(function(M){return M.id===l.id}),d=i.includes(l.id),g=f||u||d;if(!g)for(var v=l.getBBox().moveAndExpand(n.paddingBox),y=v.origin().snapToGrid(a),x=v.corner().snapToGrid(a),w=y.x;w<=x.x;w+=a)for(var T=y.y;T<=x.y;T+=a){var P=w+"@"+T;c[P]=c[P]||[],c[P].push(v)}return c},this.map),this};ms.prototype.isPointAccessible=function(t){var e=t.clone().snapToGrid(this.mapGridSize).toString();return pt(this.map[e]).every(function(n){return!n.containsPoint(t)})};function Qe(){this.items=[],this.hash={},this.values={},this.OPEN=1,this.CLOSE=2}Qe.prototype.add=function(t,e){this.hash[t]?this.items.splice(this.items.indexOf(t),1):this.hash[t]=this.OPEN,this.values[t]=e;var n=cc(this.items,t,(function(r){return this.values[r]}).bind(this));this.items.splice(n,0,t)};Qe.prototype.remove=function(t){this.hash[t]=this.CLOSE};Qe.prototype.isOpen=function(t){return this.hash[t]===this.OPEN};Qe.prototype.isClose=function(t){return this.hash[t]===this.CLOSE};Qe.prototype.isEmpty=function(){return this.items.length===0};Qe.prototype.pop=function(){var t=this.items.shift();return this.remove(t),t};function Yc(t,e){return e&&e.paddingBox?t.sourceBBox.clone().moveAndExpand(e.paddingBox):t.sourceBBox.clone()}function Xc(t,e){return e&&e.paddingBox?t.targetBBox.clone().moveAndExpand(e.paddingBox):t.targetBBox.clone()}function Zc(t,e){if(t.sourceAnchor)return t.sourceAnchor;var n=Yc(t,e);return n.center()}function zg(t,e){if(t.targetAnchor)return t.targetAnchor;var n=Xc(t,e);return n.center()}function fi(t,e,n,r,i){var s=360/n,o=t.theta(Gg(t,e,r,i)),a=Qt(o+s/2);return s*Math.floor(a/s)}function Gg(t,e,n,r){var i=r.step,s=e.x-t.x,o=e.y-t.y,a=s/n.x,c=o/n.y,l=a*i,f=c*i;return new E(t.x+l,t.y+f)}function Po(t,e){var n=Math.abs(t-e);return n>180?360-n:n}function Ug(t,e,n){var r=n.step;pt(n.directions).forEach(function(i){i.gridOffsetX=i.offsetX/r*e.x,i.gridOffsetY=i.offsetY/r*e.y})}function $g(t,e,n){return{source:e.clone(),x:Co(n.x-e.x,t),y:Co(n.y-e.y,t)}}function Co(t,e){if(!t)return e;var n=Math.abs(t),r=Math.round(n/e);if(!r)return n;var i=r*e,s=n-i,o=s/r;return e+o}function Hg(t,e){var n=e.source,r=je(t.x-n.x,e.x)+n.x,i=je(t.y-n.y,e.y)+n.y;return new E(r,i)}function En(t,e){return t.round(e)}function yr(t,e,n){return En(Hg(t.clone(),e),n)}function _n(t){return t.clone().toString()}function hi(t){return new E(t.x===0?0:Math.abs(t.x)/t.x,t.y===0?0:Math.abs(t.y)/t.y)}function qg(t,e,n,r,i,s,o){for(var a=[],c=hi(i.difference(n)),l=_n(n),f=t[l],u;f;){u=e[l];var d=hi(u.difference(f));d.equals(c)||(a.unshift(u),c=d),l=_n(f),f=t[l]}var g=e[l],v=hi(g.difference(r));return v.equals(c)||a.unshift(g),a}function _o(t,e){for(var n=1/0,r=0,i=e.length;r<i;r++){var s=t.manhattanDistance(e[r]);s<n&&(n=s)}return n}function Lo(t,e,n,r,i){var s=i.precision,o=i.directionMap,a=t.difference(e.center()),c=gt(o)?Object.keys(o):[],l=pt(n),f=c.reduce(function(u,d){if(l.includes(d)){for(var g=o[d],v=new E(t.x+g.x*(Math.abs(a.x)+e.width),t.y+g.y*(Math.abs(a.y)+e.height)),y=new X(t,v),x=y.intersect(e)||[],w=x.length,T,P=null,M=0;M<w;M++){var I=x[M],D=t.squaredDistance(I);(T===void 0||D>T)&&(T=D,P=I)}if(P){var h=yr(P,r,s);e.containsPoint(h)&&(h=yr(h.offset(g.x*r.x,g.y*r.y),r,s)),u.push(h)}}return u},[]);return e.containsPoint(t)||f.push(yr(t,r,s)),f}function Wg(t,e,n,r){var i=r.precision,s,o;t instanceof Y?s=En(Zc(this,r).clone(),i):s=En(t.clone(),i),e instanceof Y?o=En(zg(this,r).clone(),i):o=En(e.clone(),i);var a=$g(r.step,s,o),c,l,f,u;if(t instanceof Y?(c=s,f=Lo(c,t,r.startDirections,a,r)):(c=s,f=[c]),e instanceof Y?(l=o,u=Lo(o,e,r.endDirections,a,r)):(l=o,u=[l]),f=f.filter(W=>!n(W)),u=u.filter(W=>!n(W)),f.length>0&&u.length>0){for(var d=new Qe,g={},v={},y={},x=0,w=f.length;x<w;x++){var T=f[x],P=_n(T);d.add(P,_o(T,u)),g[P]=T,y[P]=0}var M=r.previousDirectionAngle,I=M===void 0,D,h,p=r.directions;Ug(p,a,r);for(var m=p.length,b=pt(u).reduce(function(W,at){var Q=_n(at);return W.push(Q),W},[]),S=r.maximumLoops;!d.isEmpty()&&S>0;){var O=d.pop(),N=g[O],F=v[O],q=y[O],A=F===void 0,C=N.equals(c),_;A?I?C?_=null:_=fi(c,N,m,a,r):_=M:_=fi(F,N,m,a,r);var L=f.length===u.length;if(L){for(var ct=0;ct<f.length;ct++)if(!f[ct].equals(u[ct])){L=!1;break}}var ot=A&&L;if(!ot&&b.indexOf(O)>=0)return r.previousDirectionAngle=_,qg(v,g,N,c,l);for(x=0;x<m;x++){D=p[x];var bt=D.angle;if(h=Po(_,bt),!(!(I&&C)&&h>r.maxAllowedDirectionChange)){var wt=yr(N.clone().offset(D.gridOffsetX,D.gridOffsetY),a,i),K=_n(wt);if(!(d.isClose(K)||n(wt))){if(b.indexOf(K)>=0){var nt=wt.equals(l);if(!nt){var st=fi(wt,l,m,a,r),rt=Po(bt,st);if(rt>r.maxAllowedDirectionChange)continue}}var U=D.cost,k=C?0:r.penalties[h],$=q+U+k;(!d.isOpen(K)||$<y[K])&&(g[K]=wt,v[K]=N,y[K]=$,d.add(K,$+_o(wt,u)))}}}S--}}return r.fallbackRoute.call(this,c,l,r)}function jg(t){if(t.directions=xt(t,"directions"),t.penalties=xt(t,"penalties"),t.paddingBox=xt(t,"paddingBox"),t.padding=xt(t,"padding"),t.padding){var e=Oe(t.padding);t.paddingBox={x:-e.left,y:-e.top,width:e.left+e.right,height:e.top+e.bottom}}pt(t.directions).forEach(function(n){var r=new E(0,0),i=new E(n.offsetX,n.offsetY);n.angle=Qt(r.theta(i))})}function Yg(t,e,n){jg(e),n.options.perpendicular=!!e.perpendicular;var r=Yc(n,e),i=Xc(n,e),s=Zc(n,e);let o;if(typeof e.isPointObstacle=="function")o=e.isPointObstacle;else{const P=new ms(e);P.build(n.paper.model,n.model),o=M=>!P.isPointAccessible(M)}for(var a=pt(t).map(E),c=[],l=s,f,u,d=0,g=a.length;d<=g;d++){var v=null;if(u=f||r,f=a[d],!f){f=i;var y=!n.model.get("source").id||!n.model.get("target").id;if(y&&yt(e.draggingRoute)){var x=u===r?s:u,w=f.origin();v=e.draggingRoute.call(n,x,w,e)}}if(v=v||Wg.call(n,u,f,o,e),v===null)return e.fallbackRouter(t,e,n);var T=v[0];T&&T.equals(l)&&v.shift(),l=v[v.length-1]||l,Array.prototype.push.apply(c,v)}return c}const Ii=function(t,e,n){return Yg(t,J({},jc,e),n)};var Xg={maxAllowedDirectionChange:45,diagonalCost:function(){var t=this.step;return Math.ceil(Math.sqrt(t*t<<1))},directions:function(){var t=this.step,e=this.cost(),n=this.diagonalCost();return[{offsetX:t,offsetY:0,cost:e},{offsetX:t,offsetY:t,cost:n},{offsetX:0,offsetY:t,cost:e},{offsetX:-t,offsetY:t,cost:n},{offsetX:-t,offsetY:0,cost:e},{offsetX:-t,offsetY:-t,cost:n},{offsetX:0,offsetY:-t,cost:e},{offsetX:t,offsetY:-t,cost:n}]},fallbackRoute:function(t,e,n){var r=t.theta(e),i=[],s={x:e.x,y:t.y},o={x:t.x,y:e.y};if(r%180>90){var a=s;s=o,o=a}var c=r%90<45?s:o,l=new X(t,c),f=90*Math.ceil(r/90),u=E.fromPolar(l.squaredLength(),$t(f+135),c),d=new X(e,u),g=l.intersection(d),v=g||e,y=g?v:t,x=360/n.directions.length,w=y.theta(e),T=Qt(w+x/2),P=x*Math.floor(T/x);return n.previousDirectionAngle=P,v&&i.push(v.round()),i.push(e),i}};const Zg=function(t,e,n){if(!yt(Ii))throw new Error("Metro requires the manhattan router.");return Ii(t,J({},Xg,e),n)},G={AUTO:"auto",LEFT:"left",RIGHT:"right",TOP:"top",BOTTOM:"bottom",ANCHOR_SIDE:"anchor-side",MAGNET_SIDE:"magnet-side"},Mo=[G.LEFT,G.RIGHT,G.TOP,G.BOTTOM],be={[G.LEFT]:G.RIGHT,[G.RIGHT]:G.LEFT,[G.TOP]:G.BOTTOM,[G.BOTTOM]:G.TOP},Jg=[G.TOP,G.BOTTOM],Pe={0:G.RIGHT,180:G.LEFT,270:G.TOP,90:G.BOTTOM};function fe(t){return t.angle()}function nn(t){return new St(t).simplify({threshold:1}).points}function Ln(t,e){const{point:n,x0:r,y0:i,view:s,bbox:o,direction:a}=t,{point:c,x0:l,y0:f,view:u,bbox:d,direction:g}=e;let v;if(s)s.model.isLink()?v=Oo(c,n,s):a===G.ANCHOR_SIDE?v=o.sideNearestToPoint(n):a===G.MAGNET_SIDE?v=s.model.getBBox().sideNearestToPoint(n):v=a;else{const x=new Y(r,i,0,0);v=Mo.includes(a)?a:x.sideNearestToPoint(c)}let y;if(u)u.model.isLink()?y=Oo(n,c,u):g===G.ANCHOR_SIDE?y=d.sideNearestToPoint(c):g===G.MAGNET_SIDE?y=u.model.getBBox().sideNearestToPoint(c):y=g;else{const x=new Y(l,f,0,0);y=Mo.includes(g)?g:x.sideNearestToPoint(n)}return[v,y]}function Kg(t,e,n){const{x0:r,y0:i,width:s,height:o,point:a,margin:c}=t,l=r+s,f=i+o,u=r-c,d=l+c,g=i-c,{x:v}=a,{x0:y,y0:x}=e;return y===v&&x<i?G.BOTTOM:y<v&&x<g?n.point.x===v?G.BOTTOM:G.RIGHT:y>v&&x<g?n.point.x===v?G.BOTTOM:G.LEFT:y<u&&x>g||y>d&&x>g?G.TOP:y>=u&&y<=v&&x>f||y<=d&&y>=v&&x>f?n.point.x<y?G.RIGHT:G.LEFT:G.BOTTOM}function Qg(t,e,n){const{x0:r,y0:i,width:s,height:o,point:a,margin:c}=t,l=r+s,f=i+o,u=r-c,d=l+c,g=f+c,{x:v}=a,{x0:y,y0:x}=e;return y===v&&x>f?G.TOP:y<v&&x>g?n.point.x===v?G.TOP:G.RIGHT:y>v&&x>g?n.point.x===v?G.TOP:G.LEFT:y<u&&x<g||y>d&&x<g?G.BOTTOM:y>=u&&y<=v&&x<i||y<=d&&y>=v&&x<i?n.point.x<y?G.RIGHT:G.LEFT:G.TOP}function tp(t,e,n){const{y0:r,x0:i,width:s,height:o,point:a,margin:c}=t,l=i+s,f=r+o,u=i-c,d=r-c,g=f+c,{x:v,y}=a,{x0:x,y0:w}=e;return x<v&&w===y?G.RIGHT:x<=u&&w<y?G.BOTTOM:x<=u&&w>y?G.TOP:x>=u&&w<d||x>=u&&w>g?G.LEFT:x>l&&w>=d&&w<=y||x>l&&w<=g&&w>=y?n.point.y<w?G.BOTTOM:G.TOP:G.RIGHT}function ep(t,e,n){const{y0:r,x0:i,width:s,height:o,point:a,margin:c}=t,l=i+s,f=r+o,u=l+c,d=r-c,g=f+c,{x:v,y}=a,{x0:x,y0:w}=e;return x>v&&w===y?G.LEFT:x>=u&&w<y?G.BOTTOM:x>=u&&w>y?G.TOP:x<=u&&w<d||x<=u&&w>g?G.RIGHT:x<i&&w>=d&&w<=y||x<i&&w<=g&&w>=y?n.point.y<w?G.BOTTOM:G.TOP:G.LEFT}function np(t,e,n){const[r]=Ln(t,e);switch(r){case G.TOP:return Kg(t,e,n);case G.RIGHT:return ep(t,e,n);case G.BOTTOM:return Qg(t,e,n);case G.LEFT:return tp(t,e,n)}}function Oo(t,e,n){const r=n.getTangentAtLength(n.getClosestPointLength(e)),i=Math.round(fe(r)/90)*90;if(i%180===0&&t.y===e.y)return t.x<e.x?G.LEFT:G.RIGHT;if(t.x===e.x)return t.y<e.y?G.TOP:G.BOTTOM;switch(i){case 0:case 180:case 360:return t.y<e.y?G.TOP:G.BOTTOM;case 90:case 270:return t.x<e.x?G.LEFT:G.RIGHT}}function No(t,e,n,r,i,s,o){r===G.AUTO&&(r=i?G.MAGNET_SIDE:G.ANCHOR_SIDE);const a=t&&t.model.isElement(),{x:c,y:l,width:f=0,height:u=0}=a?Y.fromRectUnion(n,t.model.getBBox()):s;return{point:e,x0:c,y0:l,view:t,bbox:n,width:f,height:u,direction:r,margin:a?o:0}}function rp({x:t,y:e}){const n=new E(t,e);return{point:n,x0:n.x,y0:n.y,view:null,bbox:new Y(t,e,0,0),width:0,height:0,direction:null,margin:0}}function Mr(t,e,n){const r=e.point.clone(),{x0:i,y0:s,width:o,height:a}=e;switch(t){case"left":r.x=i-n;break;case"right":r.x=i+o+n;break;case"top":r.y=s-n;break;case"bottom":r.y=s+a+n;break}return r}function Ri(t,e,{dx:n=0,dy:r=0}){const i={x:t.point.x+n,y:t.point.y+r},s={x:e.point.x+n,y:e.point.y+r};return[t.point,i,s,e.point]}function Io(t,e,n,r){const i=Qt(n-90);let s=0,o=0;i===90?o=-r:i===180?s=-r:i===270?o=r:i===0&&(s=r);const a=Ri(t,e,{dx:s,dy:o}),c=a[2],l=new X(e.point,c),f=Pe[fe(l)];return{loopRoute:a,continueDirection:f}}function ip(t,e){const{x0:n,x1:r,outsidePoint:i}=t,{x0:s,x1:o,outsidePoint:a}=e;let c=Math.min(n,s),l=Math.max(r,o);if(t.direction===e.direction){const T=t.y0<e.y0?t:e,P=T===t?e:t,M=t.direction===G.TOP?T:P;c=M.x0,l=M.x1}const{x:f}=i,{x:u}=a,d=Math.abs(f-c),g=Math.abs(u-c),v=d+g,y=Math.abs(f-l),x=Math.abs(u-l),w=y+x;return[v,w]}function sp(t,e){const{y0:n,y1:r,outsidePoint:i}=t,{y0:s,y1:o,outsidePoint:a}=e;let c=Math.min(n,s),l=Math.max(r,o);if(t.direction===e.direction){const T=t.x0<e.x0?t:e,P=T===t?e:t,M=t.direction===G.LEFT?T:P;c=M.y0,l=M.y1}const{y:f}=i,{y:u}=a,d=Math.abs(f-c),g=Math.abs(u-c),v=d+g,y=Math.abs(f-l),x=Math.abs(u-l),w=y+x;return[v,w]}function Ro(t,e,n){switch(e){case G.LEFT:t.inflate(0,n).moveAndExpand({x:-n,width:n});break;case G.RIGHT:t.inflate(0,n).moveAndExpand({width:n});break;case G.TOP:t.inflate(n,0).moveAndExpand({y:-n,height:n});break;case G.BOTTOM:t.inflate(n,0).moveAndExpand({height:n});break}return t}function Ee(t,e,n={}){const{point:r,x0:i,y0:s,width:o,height:a,margin:c}=t,{point:l,x0:f,y0:u,width:d,height:g,margin:v}=e,{targetInSourceBBox:y=!1}=n,x=f+d,w=u+g,T=i+o,P=s+a,M=i-c,I=T+c,D=s-c,h=P+c,p=f-v,m=x+v,b=u-v,S=w+v,[O,N]=Ln(t,e),F=Mr(O,{point:r,x0:i,y0:s,width:o,height:a},c),q=Mr(N,{point:l,x0:f,y0:u,width:d,height:g},v),{x:A,y:C}=F,{x:_,y:L}=q,ct=(f+x)/2,ot=(u+w)/2,bt=(i+T)/2,wt=(s+P)/2,K=(bt<ct?T+f:x+i)/2,nt=(wt<ot?P+u:w+s)/2,st=new Y(i,s,o,a),rt=new Y(f,u,d,g),U=st.clone().inflate(c),k=rt.clone().inflate(v),$=Object.assign({},t,{x1:T,y1:P,outsidePoint:F,direction:O}),W=Object.assign({},e,{x1:x,y1:w,outsidePoint:q,direction:N}),[at,Q]=ip($,W),[tt,ut]=sp($,W);if(O==="left"&&N==="right"){const Z=U.containsPoint(q),R=k.containsPoint(F);if(Z||R){const B=(C+L)/2;return[{x:A,y:C},{x:A,y:B},{x:_,y:B},{x:_,y:L}]}if(M<_){let B=nt,it=A,At=_;const mt=tt<ut;return(B>=D&&B<=h||B>=b&&B<=S)&&(h>=b&&mt?B=Math.min(b,D):D<=S&&!mt&&(B=Math.max(S,h)),it=Math.min(A,p),At=Math.max(_,I),mt&&C<u||!mt&&C>w?it=A:(mt&&L<s||!mt&&L>P)&&(At=_)),[{x:it,y:C},{x:it,y:B},{x:At,y:B},{x:At,y:L}]}const V=(A+_)/2;return[{x:V,y:C},{x:V,y:L}]}else if(O==="right"&&N==="left"){const Z=U.containsPoint(q),R=k.containsPoint(F);if(Z||R){const B=(C+L)/2;return[{x:A,y:C},{x:A,y:B},{x:_,y:B},{x:_,y:L}]}if(I>_){let B=nt,it=A,At=_;const mt=tt<ut;return(B>=D&&B<=h||B>=b&&B<=S)&&(h>=b&&mt?B=Math.min(b,D):D<=S&&!mt&&(B=Math.max(S,h)),it=Math.max(A,m),At=Math.min(_,M),mt&&C<u||!mt&&C>w?it=A:(mt&&L<s||!mt&&L>P)&&(At=_)),[{x:it,y:C},{x:it,y:B},{x:At,y:B},{x:At,y:L}]}const V=(A+_)/2;return[{x:V,y:C},{x:V,y:L}]}else if(O==="top"&&N==="bottom"){const Z=U.containsPoint(q),R=k.containsPoint(F);if(Z||R){const B=(A+_)/2;return[{x:A,y:C},{x:B,y:C},{x:B,y:L},{x:_,y:L}]}if(D<L){let B=K,it=C,At=L;const mt=at<Q;return(B>=M&&B<=I||B>=p&&B<=m)&&(I>=p&&mt?B=Math.min(p,M):M<=m&&!mt&&(B=Math.max(m,I)),it=Math.min(C,b),At=Math.max(L,h),mt&&A<f||!mt&&A>x?it=C:(mt&&_<i||!mt&&_>T)&&(At=L)),[{x:A,y:it},{x:B,y:it},{x:B,y:At},{x:_,y:At}]}const V=(C+L)/2;return[{x:A,y:V},{x:_,y:V}]}else if(O==="bottom"&&N==="top"){const Z=U.containsPoint(q),R=k.containsPoint(F);if(Z||R){const B=(A+_)/2;return[{x:A,y:C},{x:B,y:C},{x:B,y:L},{x:_,y:L}]}if(h>L){let B=K,it=C,At=L;const mt=at<Q;return(B>=M&&B<=I||B>=p&&B<=m)&&(I>=p&&mt?B=Math.min(p,M):M<=m&&!mt&&(B=Math.max(m,I)),it=Math.max(C,S),At=Math.min(L,D),mt&&A<f||!mt&&A>x?it=C:(mt&&_<i||!mt&&_>T)&&(At=L)),[{x:A,y:it},{x:B,y:it},{x:B,y:At},{x:_,y:At}]}const V=(C+L)/2;return[{x:A,y:V},{x:_,y:V}]}else if(O==="top"&&N==="top"){if((y||$e.rectWithRect(U,rt)||C<=u&&(U.bottomRight().x<=_||U.bottomLeft().x>=_)||C>=u&&(k.bottomRight().x<=A||k.bottomLeft().x>=A))&&A!==_)return[{x:A,y:Math.min(C,L)},{x:_,y:Math.min(C,L)}];let R,V=Math.min((P+u)/2,L),B=Math.min((s+w)/2,C);return L<C?Q>at?R=Math.min(A,p):R=Math.max(A,m):Q>at?R=Math.min(_,M):R=Math.max(_,I),[{x:A,y:B},{x:R,y:B},{x:R,y:V},{x:_,y:V}]}else if(O==="bottom"&&N==="bottom"){if((y||$e.rectWithRect(U,rt)||C>=L&&(U.topRight().x<=_||U.topLeft().x>=_)||C<=L&&(k.topRight().x<=A||k.topLeft().x>=A))&&A!==_)return[{x:A,y:Math.max(C,L)},{x:_,y:Math.max(C,L)}];let R,V=Math.max((s+w)/2,L),B=Math.max((P+u)/2,C);return L>C?Q>at?R=Math.min(A,p):R=Math.max(A,m):Q>at?R=Math.min(_,M):R=Math.max(_,I),[{x:A,y:B},{x:R,y:B},{x:R,y:V},{x:_,y:V}]}else if(O==="left"&&N==="left"){if((y||$e.rectWithRect(U,rt)||A<=_&&(U.bottomRight().y<=L||U.topRight().y>=L)||A>=_&&(k.bottomRight().y<=C||k.topRight().y>=C))&&C!==L)return[{x:Math.min(A,_),y:C},{x:Math.min(A,_),y:L}];let R,V=Math.min((T+f)/2,_),B=Math.min((i+x)/2,A);return _>A?tt<=ut?R=Math.min(D,L):R=Math.max(h,L):tt<=ut?R=Math.min(b,C):R=Math.max(S,C),[{x:B,y:C},{x:B,y:R},{x:V,y:R},{x:V,y:L}]}else if(O==="right"&&N==="right"){if((y||$e.rectWithRect(U,rt)||A>=_&&(U.bottomLeft().y<=L||U.topLeft().y>=L)||A<=_&&(k.bottomLeft().y<=C||k.topLeft().y>=C))&&C!==L)return[{x:Math.max(A,_),y:C},{x:Math.max(A,_),y:L}];let R,V=Math.max((i+x)/2,_),B=Math.max((T+f)/2,A);return _<=A?tt<=ut?R=Math.min(D,L):R=Math.max(h,L):tt<=ut?R=Math.min(b,C):R=Math.max(S,C),[{x:B,y:C},{x:B,y:R},{x:V,y:R},{x:V,y:L}]}else if(O==="top"&&N==="right"){if(U.containsPoint(l)){if(A<=m){const B=Math.max(A+c,_),it=Math.min(D,b);return[{x:A,y:it},{x:B,y:it},{x:B,y:L}]}const V=(A-c+_)/2;return[{x:A,y:C},{x:V,y:C},{x:V,y:L}]}if(D>L){if(A<_){let V=b;return S<=D&&m>=A&&(V=nt),[{x:A,y:V},{x:_,y:V},{x:_,y:L}]}return[{x:A,y:L}]}const R=Math.max(K,m);if(A>_&&P>=L)return[{x:A,y:C},{x:R,y:C},{x:R,y:L}];if(R>M&&C<w){const V=Math.min(D,b),B=Math.max(I,m);return[{x:A,y:V},{x:B,y:V},{x:B,y:L}]}return[{x:A,y:C},{x:R,y:C},{x:R,y:L}]}else if(O==="top"&&N==="left"){if(U.containsPoint(l)){if(A>=p){const B=Math.min(A-c,_),it=Math.min(D,b);return[{x:A,y:it},{x:B,y:it},{x:B,y:L}]}const V=(A+c+_)/2;return[{x:A,y:C},{x:V,y:C},{x:V,y:L}]}if(D>L){if(A>_){let V=b;return S<=D&&p<=A&&(V=nt),[{x:A,y:V},{x:_,y:V},{x:_,y:L}]}return[{x:A,y:L}]}const R=Math.min(p,K);if(A<_&&P>=L)return[{x:A,y:C},{x:R,y:C},{x:R,y:L}];if(R<I&&C<w){const V=Math.min(D,b),B=Math.min(M,p);return[{x:A,y:V},{x:B,y:V},{x:B,y:L}]}return[{x:A,y:C},{x:R,y:C},{x:R,y:L}]}else if(O==="bottom"&&N==="right"){if(U.containsPoint(l)){if(A<=m){const B=Math.max(A+c,_),it=Math.max(h,S);return[{x:A,y:it},{x:B,y:it},{x:B,y:L}]}const V=(A-c+_)/2;return[{x:A,y:C},{x:V,y:C},{x:V,y:L}]}if(h<L){if(A<_){let V=S;return b>=h&&m>=A&&(V=nt),[{x:A,y:V},{x:_,y:V},{x:_,y:L}]}return[{x:A,y:L}]}const R=Math.max(K,m);if(A>_&&s<=L)return[{x:A,y:C},{x:R,y:C},{x:R,y:L}];if(R>M&&C>u){const V=Math.max(h,S),B=Math.max(I,m);return[{x:A,y:V},{x:B,y:V},{x:B,y:L}]}return[{x:A,y:C},{x:R,y:C},{x:R,y:L}]}else if(O==="bottom"&&N==="left"){if(U.containsPoint(l)){if(A>=p){const B=Math.min(A-c,_),it=Math.max(h,S);return[{x:A,y:it},{x:B,y:it},{x:B,y:L}]}const V=(A+c+_)/2;return[{x:A,y:C},{x:V,y:C},{x:V,y:L}]}if(h<L){if(A>_){let V=S;return b>=h&&p<=A&&(V=nt),[{x:A,y:V},{x:_,y:V},{x:_,y:L}]}return[{x:A,y:L}]}const R=Math.min(p,K);if(A<_&&s<=L)return[{x:A,y:C},{x:R,y:C},{x:R,y:L}];if(R<I&&C>u){const V=Math.max(h,S),B=Math.min(M,p);return[{x:A,y:V},{x:B,y:V},{x:B,y:L}]}return[{x:A,y:C},{x:R,y:C},{x:R,y:L}]}else if(O==="left"&&N==="bottom"){if(U.containsPoint(l)){if(C<=S){const B=Math.min(M,p),it=Math.max(C+c,L);return[{x:B,y:C},{x:B,y:it},{x:_,y:it}]}const V=(C-c+L)/2;return[{x:A,y:C},{x:A,y:V},{x:_,y:V}]}if(M>_){if(C<L){let V=p;return m<=M&&S>=C&&(V=K),[{x:V,y:C},{x:V,y:L},{x:_,y:L}]}return[{x:_,y:C}]}const R=Math.max(S,nt);if(C>L&&T>=_)return[{x:A,y:C},{x:A,y:R},{x:_,y:R}];if(R>D&&A<x){const V=Math.min(M,p),B=Math.max(h,S);return[{x:V,y:C},{x:V,y:B},{x:_,y:B}]}return[{x:A,y:C},{x:A,y:R},{x:_,y:R}]}else if(O==="left"&&N==="top"){if(U.containsPoint(l)){if(C>=b){const B=Math.min(C-c,L),it=Math.min(M,p);return[{x:it,y:C},{x:it,y:B},{x:_,y:B}]}const V=(C+c+L)/2;return[{x:A,y:C},{x:A,y:V},{x:_,y:V}]}if(M>_){if(C>L){let V=p;return m<=M&&b<=C&&(V=K),[{x:V,y:C},{x:V,y:L},{x:_,y:L}]}return[{x:_,y:C}]}const R=Math.min(b,nt);if(C<L&&T>=_)return[{x:A,y:C},{x:A,y:R},{x:_,y:R}];if(R<h&&A<x){const V=Math.min(M,p),B=Math.min(D,b);return[{x:V,y:C},{x:V,y:B},{x:_,y:B}]}return[{x:A,y:C},{x:A,y:R},{x:_,y:R}]}else if(O==="right"&&N==="top"){if(U.containsPoint(l)){if(C>=b){const B=Math.max(I,m),it=Math.min(C-c,L);return[{x:B,y:C},{x:B,y:it},{x:_,y:it}]}const V=(C+c+L)/2;return[{x:A,y:C},{x:A,y:V},{x:_,y:V}]}if(I<_){if(C>L){let V=m;return p>=I&&b<=C&&(V=K),[{x:V,y:C},{x:V,y:L},{x:_,y:L}]}return[{x:_,y:C}]}const R=Math.min(b,nt);if(C<L&&i<=_)return[{x:A,y:C},{x:A,y:R},{x:_,y:R}];if(R<h&&A>f){const V=Math.max(I,m),B=Math.min(D,b);return[{x:V,y:C},{x:V,y:B},{x:_,y:B}]}return[{x:A,y:C},{x:A,y:R},{x:_,y:R}]}else if(O==="right"&&N==="bottom"){if(U.containsPoint(l)){if(C<=S){const B=Math.max(I,m),it=Math.max(C+c,L);return[{x:B,y:C},{x:B,y:it},{x:_,y:it}]}const V=(C-c+L)/2;return[{x:A,y:C},{x:A,y:V},{x:_,y:V}]}if(I<_){if(C<L){let V=m;return p>=I&&S>=C&&(V=K),[{x:V,y:C},{x:V,y:L},{x:_,y:L}]}return[{x:_,y:C}]}const R=Math.max(S,nt);if(C>L&&i<=_)return[{x:A,y:C},{x:A,y:R},{x:_,y:R}];if(R>D&&A>f){const V=Math.max(I,m),B=Math.max(h,S);return[{x:V,y:C},{x:V,y:B},{x:_,y:B}]}return[{x:A,y:C},{x:A,y:R},{x:_,y:R}]}}function ko(t,e,n){const r=t===G.LEFT||t===G.RIGHT;let i=0,s=0;switch(Qt(Math.round(e))){case 0:case 90:i=r?0:n,s=r?n:0;break;case 180:case 270:i=r?0:-n,s=r?-n:0;break}return{dx:i,dy:s}}function Jc(t,e,n){const{sourceDirection:r=G.AUTO,targetDirection:i=G.AUTO}=e,s=e.margin||20,o=e.useVertices||!1,a=!!n.model.source().port,c=No(n.sourceView,n.sourceAnchor,n.sourceBBox,r,a,n.sourceAnchor,s),l=!!n.model.target().port,f=No(n.targetView,n.targetAnchor,n.targetBBox,i,l,n.targetAnchor,s);let u=[];if(!o||t.length===0)return nn(Ee(c,f));const d=t.map(P=>rp(P)),[g]=d,[v]=Ln(c,g),y=c.view&&c.view.model.isElement(),x=y?Ro(c.view.model.getBBox(),v,s):null,w=y?x.containsPoint(g.point):!1;if(w){const P=Mr(v,c,s),M=P.equals(g.point),I=c.point.x===g.point.x,D=c.point.y===g.point.y,h=I&&(v===G.TOP||v===G.BOTTOM),p=D&&(v===G.LEFT||v===G.RIGHT),m=new X(c.point,P),b=m.containsPoint(g.point),S=w&&(p||h);if(M)u.push(c.point,g.point),g.direction=be[v];else if(b||S){const O=fe(b?m:new X(c.point,g.point)),{dx:N,dy:F}=ko(v,O,s),q=Ri({point:P},g,{dx:N,dy:F}),A=q[2],C=new X(g.point,A),_=Pe[fe(C)];g.direction=_,u.push(...q)}else g.direction=v,g.margin=s,u.push(...Ee(c,g,{targetInSourceBBox:!0}),g.point)}else{const P=d[1]||f,M=np(c,g,P);g.direction=M,u.push(...Ee(c,g),g.point)}for(let P=0;P<d.length-1;P++){const M=d[P],I=d[P+1],D=new X(M.point,I.point),h=fe(D);if(h%90===0){const b=Pe[h],S=nn([...u,M.point]),O=new X(S[S.length-2],S[S.length-1]),N=Pe[Math.round(fe(O))];if(b!==be[N]){u.push(M.point,I.point);const[,F]=Ln(M,I);I.direction=F}else{const{loopRoute:F,continueDirection:q}=Io(M,I,h,s);I.direction=q,u.push(...F)}continue}const[p,m]=Do(M,I);M.direction=p,I.direction=m,u.push(...Ee(M,I),I.point)}const T=d[d.length-1];if(f.view&&f.view.model.isElement()){const[,P]=Ln(T,f),M=Mr(P,f,s),I=nn([...u,T.point]),D=new X(I[I.length-2],I[I.length-1]),h=Math.round(fe(D)),p=Pe[h],m=M.equals(T.point);if(!m||m&&p===P){T.direction=p;let b=Ee(T,f);const[S,O]=nn([...b,f.point]),N=new X(S,O),F=Math.round(fe(N)),q=Pe[F],A=Ro(f.view.model.getBBox(),P,s),C=T.point.x===f.point.x,_=T.point.y===f.point.y,L=A.containsPoint(T.point),ct=C&&(P===G.TOP||P===G.BOTTOM),ot=_&&(P===G.LEFT||P===G.RIGHT);if(!m&&L&&(ot||ct)){const{dx:bt,dy:wt}=ko(P,h,s);b=Ri(T,{point:M},{dx:bt,dy:wt})}else L&&P!==be[p]?(T.margin=s,T.direction=P,b=Ee(T,f)):q!==p&&p===be[q]&&(T.margin=s,b=Ee(T,f));u.push(...b)}}else{const P=T,M=f,I=new X(P.point,M.point),D=fe(I);if(D%90===0){const h=Pe[D],p=nn(u),m=new X(p[p.length-2],P.point),b=Pe[Math.round(fe(m))];if(h!==be[b])u.push(P.point);else{const{loopRoute:S}=Io(P,M,D,s);S.pop(),u.push(...S)}}else{const[h,p]=Do(P,M);P.direction=h,M.direction=p,u.push(...Ee(P,M))}}return nn(u)}function Do(t,e){const n=t.direction,r=Jg.includes(n);let i=t.direction,s=e.direction;if(r){const o=t.point.y>e.point.y,a=e.point.x-t.point.x;n===G.BOTTOM?(i=o?be[n]:a>=0?G.RIGHT:G.LEFT,a>0?s=o?G.LEFT:G.TOP:a<0&&(s=o?G.RIGHT:G.TOP)):(i=o?a>=0?G.RIGHT:G.LEFT:be[n],a>0?s=o?G.BOTTOM:G.LEFT:a<0&&(s=o?G.BOTTOM:G.RIGHT))}else{const o=t.point.x>e.point.x,a=e.point.y-t.point.y;n===G.RIGHT?(i=o?be[n]:a>=0?G.BOTTOM:G.TOP,a>0?s=o?G.TOP:G.LEFT:a<0&&(s=o?G.BOTTOM:G.LEFT)):(i=o?a>=0?G.BOTTOM:G.TOP:be[n],a>0?s=o?G.RIGHT:G.TOP:a<0&&(s=o?G.RIGHT:G.BOTTOM))}return[i,s]}Jc.Directions=G;const op=Jc,ap=Object.freeze(Object.defineProperty({__proto__:null,manhattan:Ii,metro:Zg,normal:Ng,oneSide:Ig,orthogonal:Ni,rightAngle:op},Symbol.toStringTag,{value:"Module"}));function cp(t,e,n,r){var i="ratio"in r?r.ratio:.5;return t.getPointAtRatio(i)}function up(t,e,n,r){var i="length"in r?r.length:20;return t.getPointAtLength(i)}function lp(t,e,n,r){var i=1e6,s=t.getConnection(),o=t.getConnectionSubdivisions(),a=new X(n.clone().offset(0,i),n.clone().offset(0,-1e6)),c=new X(n.clone().offset(i,0),n.clone().offset(-1e6,0)),l=a.intersect(s,{segmentSubdivisions:o}),f=c.intersect(s,{segmentSubdivisions:o}),u=[];return l&&Array.prototype.push.apply(u,l),f&&Array.prototype.push.apply(u,f),u.length>0?n.chooseClosest(u):"fallbackAt"in r?Kc(t,r.fallbackAt):Qc(t,e,n,r)}function fp(t,e,n,r){var i=t.getClosestPoint(n);return i||new E}function Yn(t){return function(e,n,r,i){if(r instanceof Element){var s=this.paper.findView(r),o;if(s)if(s.isNodeConnection(r)){var a="fixedAt"in i?i.fixedAt:"50%";o=Kc(s,a)}else o=s.getNodeBBox(r).center();else o=new E;return t.call(this,e,n,o,i)}return t.apply(this,arguments)}}function Kc(t,e){var n=parseFloat(e);return It(e)?t.getPointAtRatio(n/100):t.getPointAtLength(n)}const hp=Yn(lp),Qc=Yn(fp),dp=Object.freeze(Object.defineProperty({__proto__:null,connectionClosest:Qc,connectionLength:up,connectionPerpendicular:hp,connectionRatio:cp,resolveRef:Yn},Symbol.toStringTag,{value:"Module"}));function we(t){return function(e,n,r,i){var s=!!i.rotate,o=s?e.getNodeUnrotatedBBox(n):e.getNodeBBox(n),a=o[t](),c=i.dx;if(c){var l=It(c);c=parseFloat(c),isFinite(c)&&(l&&(c/=100,c*=o.width),a.x+=c)}var f=i.dy;if(f){var u=It(f);f=parseFloat(f),isFinite(f)&&(u&&(f/=100,f*=o.height),a.y+=f)}return s?a.rotate(e.model.getBBox().center(),-e.model.angle()):a}}function gp(t,e,n,r){var i=t.model.angle(),s=t.getNodeBBox(e),o=s.center(),a=s.origin(),c=s.corner(),l=r.padding;if(isFinite(l)||(l=0),a.y+l<=n.y&&n.y<=c.y-l){var f=n.y-o.y;o.x+=i===0||i===180?0:f*1/Math.tan($t(i)),o.y+=f}else if(a.x+l<=n.x&&n.x<=c.x-l){var u=n.x-o.x;o.y+=i===90||i===270?0:u*Math.tan($t(i)),o.x+=u}return o}function pp(t,e,n,r){var i=!!r.rotate,s,o,a;i?(s=t.getNodeUnrotatedBBox(e),a=t.model.getBBox().center(),o=t.model.angle()):s=t.getNodeBBox(e);var c=r.padding;isFinite(c)&&s.inflate(c),i&&n.rotate(a,o);var l=s.sideNearestToPoint(n),f;switch(l){case"left":f=s.leftMiddle();break;case"right":f=s.rightMiddle();break;case"top":f=s.topMiddle();break;case"bottom":f=s.bottomMiddle();break}return i?f.rotate(a,-o):f}function vp(t,e,n,r,i){return t.model.getPointFromConnectedLink(this.model,i).offset(r.dx,r.dy)}const mp=we("center"),yp=we("topMiddle"),bp=we("bottomMiddle"),xp=we("leftMiddle"),wp=we("rightMiddle"),Sp=we("origin"),Ap=we("topRight"),Tp=we("bottomLeft"),Ep=we("corner"),Pp=Yn(gp),Cp=Yn(pp),_p=vp,Lp=Object.freeze(Object.defineProperty({__proto__:null,bottom:bp,bottomLeft:Tp,bottomRight:Ep,center:mp,left:xp,midSide:Cp,modelCenter:_p,perpendicular:Pp,right:wp,top:yp,topLeft:Sp,topRight:Ap},Symbol.toStringTag,{value:"Module"})),Mp=Me.extend({initialize:function(t,e){e.cellNamespace?this.cellNamespace=e.cellNamespace:this.cellNamespace=typeof joint<"u"&&ge(joint,"shapes")?joint.shapes:null,this.graph=e.graph},model:function(t,e){const r=e.collection.cellNamespace,{type:i}=t,s=vn(r,i,".");if(!s)throw new Error(`dia.Graph: Could not find cell constructor for type: '${i}'. Make sure to add the constructor to 'cellNamespace'.`);return new s(t,e)},_addReference:function(t,e){Me.prototype._addReference.apply(this,arguments),!e.dry&&!t.graph&&(t.graph=this.graph)},_removeReference:function(t,e){Me.prototype._removeReference.apply(this,arguments),!e.dry&&t.graph===this.graph&&(t.graph=null)},comparator:function(t){return t.get("z")||0}}),ys=Jt.extend({initialize:function(t,e){e=e||{};var n=new Mp([],{model:e.cellModel,cellNamespace:e.cellNamespace,graph:this});Jt.prototype.set.call(this,"cells",n),n.on("all",this.trigger,this),this.on("change:z",this._sortOnChangeZ,this),this._out={},this._in={},this._nodes={},this._edges={},this._batches={},n.on("add",this._restructureOnAdd,this),n.on("remove",this._restructureOnRemove,this),n.on("reset",this._restructureOnReset,this),n.on("change:source",this._restructureOnChangeSource,this),n.on("change:target",this._restructureOnChangeTarget,this),n.on("remove",this._removeCell,this)},_sortOnChangeZ:function(){this.get("cells").sort()},_restructureOnAdd:function(t){if(t.isLink()){this._edges[t.id]=!0;var{source:e,target:n}=t.attributes;e.id&&((this._out[e.id]||(this._out[e.id]={}))[t.id]=!0),n.id&&((this._in[n.id]||(this._in[n.id]={}))[t.id]=!0)}else this._nodes[t.id]=!0},_restructureOnRemove:function(t){if(t.isLink()){delete this._edges[t.id];var{source:e,target:n}=t.attributes;e.id&&this._out[e.id]&&this._out[e.id][t.id]&&delete this._out[e.id][t.id],n.id&&this._in[n.id]&&this._in[n.id][t.id]&&delete this._in[n.id][t.id]}else delete this._nodes[t.id]},_restructureOnReset:function(t){t=t.models,this._out={},this._in={},this._nodes={},this._edges={},t.forEach(this._restructureOnAdd,this)},_restructureOnChangeSource:function(t){var e=t.previous("source");e.id&&this._out[e.id]&&delete this._out[e.id][t.id];var n=t.attributes.source;n.id&&((this._out[n.id]||(this._out[n.id]={}))[t.id]=!0)},_restructureOnChangeTarget:function(t){var e=t.previous("target");e.id&&this._in[e.id]&&delete this._in[e.id][t.id];var n=t.get("target");n.id&&((this._in[n.id]||(this._in[n.id]={}))[t.id]=!0)},getOutboundEdges:function(t){return this._out&&this._out[t]||{}},getInboundEdges:function(t){return this._in&&this._in[t]||{}},toJSON:function(t={}){var e=Jt.prototype.toJSON.apply(this,arguments);return e.cells=this.get("cells").toJSON(t.cellAttributes),e},fromJSON:function(t,e){if(!t.cells)throw new Error("Graph JSON must contain cells array.");return this.set(t,e)},set:function(t,e,n){var r;return typeof t=="object"?(r=t,n=e):(r={})[t]=e,r.hasOwnProperty("cells")&&(this.resetCells(r.cells,n),r=Wn(r,"cells")),Jt.prototype.set.call(this,r,n)},clear:function(t){t=J({},t,{clear:!0});var e=this.get("cells");if(e.length===0)return this;this.startBatch("clear",t);var n=e.sortBy(function(r){return r.isLink()?1:2});do n.shift().remove(t);while(n.length>0);return this.stopBatch("clear"),this},_prepareCell:function(t){let e;if(t instanceof Jt?e=t.attributes:e=t,!Ct(e.type))throw new TypeError("dia.Graph: cell type must be a string.");return t},minZIndex:function(){var t=this.get("cells").first();return t&&t.get("z")||0},maxZIndex:function(){var t=this.get("cells").last();return t&&t.get("z")||0},addCell:function(t,e){return Array.isArray(t)?this.addCells(t,e):(t instanceof Jt?t.has("z")||t.set("z",this.maxZIndex()+1):t.z===void 0&&(t.z=this.maxZIndex()+1),this.get("cells").add(this._prepareCell(t,e),e||{}),this)},addCells:function(t,e){return t.length===0?this:(t=_f(t),e.maxPosition=e.position=t.length-1,this.startBatch("add",e),t.forEach(function(n){this.addCell(n,e),e.position--},this),this.stopBatch("add",e),this)},resetCells:function(t,e){var n=pt(t).map(function(r){return this._prepareCell(r,e)},this);return this.get("cells").reset(n,e),this},removeCells:function(t,e){return t.length&&(this.startBatch("remove"),de(t,"remove",e),this.stopBatch("remove")),this},_removeCell:function(t,e,n){n=n||{},n.clear||(n.disconnectLinks?this.disconnectLinks(t,n):this.removeLinks(t,n)),this.get("cells").remove(t,{silent:!0})},transferCellEmbeds:function(t,e,n={}){const r="transfer-embeds";this.startBatch(r);const i=t.getEmbeddedCells();e.embed(i,{...n,reparent:!0}),this.stopBatch(r)},transferCellConnectedLinks:function(t,e,n={}){const r="transfer-connected-links";this.startBatch(r),this.getConnectedLinks(t,n).forEach(s=>{s.getSourceCell()===t&&s.prop(["source","id"],e.id,n),s.getTargetCell()===t&&s.prop(["target","id"],e.id,n)}),this.stopBatch(r)},getCell:function(t){return this.get("cells").get(t)},getCells:function(){return this.get("cells").toArray()},getElements:function(){return this.get("cells").toArray().filter(t=>t.isElement())},getLinks:function(){return this.get("cells").toArray().filter(t=>t.isLink())},getFirstCell:function(){return this.get("cells").first()},getLastCell:function(){return this.get("cells").last()},getConnectedLinks:function(t,e){e=e||{};var n=e.indirect,r=e.inbound,i=e.outbound;r===void 0&&i===void 0&&(r=i=!0);var s=[],o={};i&&a(this,t),r&&c(this,t);function a(u,d){if(he(u.getOutboundEdges(d.id),(function(v,y){if(!o[y]){var x=u.getCell(y);s.push(x),o[y]=!0,n&&(r&&c(u,x),i&&a(u,x))}}).bind(u)),n&&d.isLink()){var g=d.getTargetCell();g&&g.isLink()&&(o[g.id]||(s.push(g),a(u,g)))}}function c(u,d){if(he(u.getInboundEdges(d.id),(function(v,y){if(!o[y]){var x=u.getCell(y);s.push(x),o[y]=!0,n&&(r&&c(u,x),i&&a(u,x))}}).bind(u)),n&&d.isLink()){var g=d.getSourceCell();g&&g.isLink()&&(o[g.id]||(s.push(g),c(u,g)))}}if(e.deep){var l=t.getEmbeddedCells({deep:!0}),f={};l.forEach(function(u){u.isElement()&&(f[u.id]=!0)}),l.forEach(function(u){u.isLink()||(i&&he(this.getOutboundEdges(u.id),(function(d,g){if(!o[g]){var v=this.getCell(g),{source:y,target:x}=v.attributes,w=y.id,T=x.id;if(!e.includeEnclosed&&w&&f[w]&&T&&f[T])return;s.push(this.getCell(g)),o[g]=!0}}).bind(this)),r&&he(this.getInboundEdges(u.id),(function(d,g){if(!o[g]){var v=this.getCell(g),{source:y,target:x}=v.attributes,w=y.id,T=x.id;if(!e.includeEnclosed&&w&&f[w]&&T&&f[T])return;s.push(this.getCell(g)),o[g]=!0}}).bind(this)))},this)}return s},getNeighbors:function(t,e){e||(e={});var n=e.inbound,r=e.outbound;n===void 0&&r===void 0&&(n=r=!0);var i=this.getConnectedLinks(t,e).reduce((function(a,c){var{source:l,target:f}=c.attributes,u=c.hasLoop(e);if(n&&ge(l,"id")&&!a[l.id]){var d=this.getCell(l.id);d.isElement()&&(u||d&&d!==t&&(!e.deep||!d.isEmbeddedIn(t)))&&(a[l.id]=d)}if(r&&ge(f,"id")&&!a[f.id]){var g=this.getCell(f.id);g.isElement()&&(u||g&&g!==t&&(!e.deep||!g.isEmbeddedIn(t)))&&(a[f.id]=g)}return a}).bind(this),{});if(t.isLink()){if(n){var s=t.getSourceCell();s&&s.isElement()&&!i[s.id]&&(i[s.id]=s)}if(r){var o=t.getTargetCell();o&&o.isElement()&&!i[o.id]&&(i[o.id]=o)}}return pt(i)},getCommonAncestor:function(){var t=Array.from(arguments).map(function(n){for(var r=[],i=n.get("parent");i;)r.push(i),i=this.getCell(i).get("parent");return r},this);t=t.sort(function(n,r){return n.length-r.length});var e=pt(t.shift()).find(function(n){return t.every(function(r){return r.includes(n)})});return this.getCell(e)},getSuccessors:function(t,e){e=e||{};var n=[];return this.search(t,function(r){r!==t&&n.push(r)},J({},e,{outbound:!0})),n},cloneCells:Tc,cloneSubgraph:function(t,e){var n=this.getSubgraph(t,e);return this.cloneCells(n)},getSubgraph:function(t,e){e=e||{};var n=[],r={},i=[],s=[];return pt(t).forEach(function(o){if(r[o.id]||(n.push(o),r[o.id]=o,o.isLink()?s.push(o):i.push(o)),e.deep){var a=o.getEmbeddedCells({deep:!0});a.forEach(function(c){r[c.id]||(n.push(c),r[c.id]=c,c.isLink()?s.push(c):i.push(c))})}}),s.forEach(function(o){var{source:a,target:c}=o.attributes;if(a.id&&!r[a.id]){var l=this.getCell(a.id);n.push(l),r[l.id]=l,i.push(l)}if(c.id&&!r[c.id]){var f=this.getCell(c.id);n.push(this.getCell(c.id)),r[f.id]=f,i.push(f)}},this),i.forEach(function(o){var a=this.getConnectedLinks(o,e);a.forEach(function(c){var{source:l,target:f}=c.attributes;!r[c.id]&&l.id&&r[l.id]&&f.id&&r[f.id]&&(n.push(c),r[c.id]=c)})},this),n},getPredecessors:function(t,e){e=e||{};var n=[];return this.search(t,function(r){r!==t&&n.push(r)},J({},e,{inbound:!0})),n},search:function(t,e,n){n=n||{},n.breadthFirst?this.bfs(t,e,n):this.dfs(t,e,n)},bfs:function(t,e,n={}){const r={},i={},s=[];for(s.push(t),i[t.id]=0;s.length>0;){var o=s.shift();if(r[o.id]||(r[o.id]=!0,e.call(this,o,i[o.id])===!1))continue;const a=this.getNeighbors(o,n);for(let c=0,l=a.length;c<l;c++){const f=a[c];i[f.id]=i[o.id]+1,s.push(f)}}},dfs:function(t,e,n={}){const r={},i={},s=[];for(s.push(t),i[t.id]=0;s.length>0;){const o=s.pop();if(r[o.id]||(r[o.id]=!0,e.call(this,o,i[o.id])===!1))continue;const a=this.getNeighbors(o,n),c=s.length;for(let l=0,f=a.length;l<f;l++){const u=a[l];i[u.id]=i[o.id]+1,s.splice(c,0,u)}}},getSources:function(){var t=[];return he(this._nodes,(function(e,n){(!this._in[n]||Xt(this._in[n]))&&t.push(this.getCell(n))}).bind(this)),t},getSinks:function(){var t=[];return he(this._nodes,(function(e,n){(!this._out[n]||Xt(this._out[n]))&&t.push(this.getCell(n))}).bind(this)),t},isSource:function(t){return!this._in[t.id]||Xt(this._in[t.id])},isSink:function(t){return!this._out[t.id]||Xt(this._out[t.id])},isSuccessor:function(t,e){var n=!1;return this.search(t,function(r){if(r===e&&r!==t)return n=!0,!1},{outbound:!0}),n},isPredecessor:function(t,e){var n=!1;return this.search(t,function(r){if(r===e&&r!==t)return n=!0,!1},{inbound:!0}),n},isNeighbor:function(t,e,n){n=n||{};var r=n.inbound,i=n.outbound;r===void 0&&i===void 0&&(r=i=!0);var s=!1;return this.getConnectedLinks(t,n).forEach(function(o){var{source:a,target:c}=o.attributes;if(r&&ge(a,"id")&&a.id===e.id||i&&ge(c,"id")&&c.id===e.id)return s=!0,!1}),s},disconnectLinks:function(t,e){this.getConnectedLinks(t).forEach(function(n){n.set(n.attributes.source.id===t.id?"source":"target",{x:0,y:0},e)})},removeLinks:function(t,e){de(this.getConnectedLinks(t),"remove",e)},findElementsAtPoint:function(t,e){return this._filterAtPoint(this.getElements(),t,e)},findLinksAtPoint:function(t,e){return this._filterAtPoint(this.getLinks(),t,e)},findCellsAtPoint:function(t,e){return this._filterAtPoint(this.getCells(),t,e)},_filterAtPoint:function(t,e,n={}){return t.filter(r=>r.getBBox({rotate:!0}).containsPoint(e,n))},findElementsInArea:function(t,e={}){return this._filterInArea(this.getElements(),t,e)},findLinksInArea:function(t,e={}){return this._filterInArea(this.getLinks(),t,e)},findCellsInArea:function(t,e={}){return this._filterInArea(this.getCells(),t,e)},_filterInArea:function(t,e,n={}){const r=new Y(e),{strict:i=!1}=n,s=i?"containsRect":"intersect";return t.filter(o=>r[s](o.getBBox({rotate:!0})))},findElementsUnderElement:function(t,e){return this._filterCellsUnderElement(this.getElements(),t,e)},findLinksUnderElement:function(t,e){return this._filterCellsUnderElement(this.getLinks(),t,e)},findCellsUnderElement:function(t,e){return this._filterCellsUnderElement(this.getCells(),t,e)},_isValidElementUnderElement:function(t,e){return t.id!==e.id&&!t.isEmbeddedIn(e)},_isValidLinkUnderElement:function(t,e){return t.source().id!==e.id&&t.target().id!==e.id&&!t.isEmbeddedIn(e)},_validateCellsUnderElement:function(t,e){return t.filter(n=>n.isLink()?this._isValidLinkUnderElement(n,e):this._isValidElementUnderElement(n,e))},_getFindUnderElementGeometry:function(t,e="bbox"){const n=t.getBBox({rotate:!0});return e!=="bbox"?Mc(n,e):n},_filterCellsUnderElement:function(t,e,n={}){const r=this._getFindUnderElementGeometry(e,n.searchBy),i=r.type===lt.Point?this._filterAtPoint(t,r):this._filterInArea(t,r,n);return this._validateCellsUnderElement(i,e)},findModelsInArea:function(t,e){return this.findElementsInArea(t,e)},findModelsFromPoint:function(t){return this.findElementsAtPoint(t)},findModelsUnderElement:function(t,e){return this.findElementsUnderElement(t,e)},getBBox:function(){return this.getCellsBBox(this.getCells())},getCellsBBox:function(t,e={}){const{rotate:n=!0}=e;return pt(t).reduce(function(r,i){const s=i.getBBox({rotate:n});return s?r?r.union(s):s:r},null)},translate:function(t,e,n){var r=this.getCells().filter(function(i){return!i.isEmbedded()});return de(r,"translate",t,e,n),this},resize:function(t,e,n){return this.resizeCells(t,e,this.getCells(),n)},resizeCells:function(t,e,n,r){var i=this.getCellsBBox(n);if(i){var s=Math.max(t/i.width,0),o=Math.max(e/i.height,0);de(n,"scale",s,o,i.origin(),r)}return this},startBatch:function(t,e){return e=e||{},this._batches[t]=(this._batches[t]||0)+1,this.trigger("batch:start",J({},e,{batchName:t}))},stopBatch:function(t,e){return e=e||{},this._batches[t]=(this._batches[t]||0)-1,this.trigger("batch:stop",J({},e,{batchName:t}))},hasActiveBatch:function(t){const e=this._batches;let n;return arguments.length===0?n=Object.keys(e):Array.isArray(t)?n=t:n=[t],n.some(r=>e[r]>0)}},{validations:{multiLinks:function(t,e){var{source:n,target:r}=e.attributes;if(n.id&&r.id){var i=e.getSourceCell();if(i){var s=t.getConnectedLinks(i,{outbound:!0}),o=s.filter(function(a){var{source:c,target:l}=a.attributes;return c&&c.id===n.id&&(!c.port||c.port===n.port)&&l&&l.id===r.id&&(!l.port||l.port===r.port)});if(o.length>1)return!1}}return!0},linkPinning:function(t,e){var{source:n,target:r}=e.attributes;return n.id&&r.id}}});Hh(ys.prototype,["resetCells","addCells","removeCells"],_i.cells);const kt={GRID:"grid",CELLS:"cells",BACK:"back",FRONT:"front",TOOLS:"tools",LABELS:"labels"},ki=Le.extend({tagName:"g",svgElement:!0,pivotNodes:null,defaultTheme:null,options:{name:""},className:function(){return xe(`${this.options.name}-layer`)},init:function(){this.pivotNodes={}},insertSortedNode:function(t,e){this.el.insertBefore(t,this.insertPivot(e))},insertNode:function(t){const{el:e}=this;t.parentNode!==e&&e.appendChild(t)},insertPivot:function(t){const{el:e,pivotNodes:n}=this;t=+t,t||(t=0);let r=n[t];if(r)return r;r=n[t]=document.createComment("z-index:"+(t+1));let i=-1/0;for(let s in n)s=+s,s<t&&s>i&&(i=s,t-1);if(i!==-1/0){const s=n[i];e.insertBefore(r,s.nextSibling)}else e.insertBefore(r,e.firstChild);return r},removePivots:function(){const{el:t,pivotNodes:e}=this;for(let n in e)t.removeChild(e[n]);this.pivotNodes={}}}),Op=["transform","x","y","cx","cy","dx","dy","x1","y1","x2","y2","points","d","r","rx","ry","width","height","stroke-width","font-size"],Np=["r","rx","ry","width","height","stroke-width","font-size"],Ip=Op.reduce((t,e)=>(t[e]=!0,t),{}),Rp=Np.reduce((t,e)=>(t[e]=!0,t),{});function Bo(t,e){const n={};for(let r in t)t.hasOwnProperty(r)&&(n[r]=tu(r,t[r],e));return n}function tu(t,e,n){if(t in Ip&&Ne(e)){let r=Ie(e,n);return t in Rp&&(r=Math.max(0,r)),r}return e}const rn={DEFAULT:"default",EMBEDDING:"embedding",CONNECTING:"connecting",MAGNET_AVAILABILITY:"magnetAvailability",ELEMENT_AVAILABILITY:"elementAvailability"},kp={TOOLS:"TOOLS"},ft=Le.extend({tagName:"g",svgElement:!0,selector:"root",metrics:null,className:function(){var t=["cell"],e=this.model.get("type");return e&&e.toLowerCase().split(".").forEach(function(n,r,i){t.push("type-"+i.slice(0,r+1).join("-"))}),t.join(" ")},_presentationAttributes:null,_flags:null,setFlags:function(){var t={},e={},n=0,r,i,s,o=xt(this,"presentationAttributes");for(var a in o)if(o.hasOwnProperty(a)){var c=o[a];for(Array.isArray(c)||(c=[c]),r=0,i=c.length;r<i;r++){s=c[r];var l=t[s];l||(l=t[s]=1<<n++),e[a]|=l}}var f=xt(this,"initFlag");for(Array.isArray(f)||(f=[f]),r=0,i=f.length;r<i;r++)s=f[r],t[s]||(t[s]=1<<n++);if(n>25)throw new Error("dia.CellView: Maximum number of flags exceeded.");this._flags=t,this._presentationAttributes=e},hasFlag:function(t,e){return t&this.getFlag(e)},removeFlag:function(t,e){return t^t&this.getFlag(e)},getFlag:function(t){var e=this._flags;if(!e)return 0;var n=0;if(Array.isArray(t))for(var r=0,i=t.length;r<i;r++)n|=e[t[r]];else n|=e[t];return n},attributes:function(){var t=this.model;return{"model-id":t.id,"data-type":t.attributes.type}},constructor:function(t){t.id=t.id||ln(this),Le.call(this,t)},initialize:function(){this.setFlags(),Le.prototype.initialize.apply(this,arguments),this.cleanNodesCache(),this.startListening()},startListening:function(){this.listenTo(this.model,"change",this.onAttributesChange)},onAttributesChange:function(t,e){var n=t.getChangeFlag(this._presentationAttributes);e.updateHandled||!n||(e.dirty&&this.hasFlag(n,"UPDATE")&&(n|=this.getFlag("RENDER")),e.tool&&(e.async=!1),this.requestUpdate(n,e))},requestUpdate:function(t,e){const{paper:n}=this;n&&t>0&&n.requestViewUpdate(this,t,this.UPDATE_PRIORITY,e)},parseDOMJSON:function(t,e){var n=Pr(t),r=n.selectors,i=n.groupSelectors;for(var s in i){if(r[s])throw new Error("dia.CellView: ambiguous group selector");r[s]=i[s]}if(e){var o=this.selector;if(r[o])throw new Error("dia.CellView: ambiguous root selector.");r[o]=e}return{fragment:n.fragment,selectors:r}},can:function(t){var e=yt(this.options.interactive)?this.options.interactive(this):this.options.interactive;return gt(e)&&e[t]!==!1||Sf(e)&&e!==!1},findBySelector:function(t,e,n){if(!t||t===".")return[e];if(n){var r=n[t];if(r)return Array.isArray(r)?r:[r]}return this.useCSSSelectors?j(e).find(t).toArray():[]},findNodes:function(t){return this.findBySelector(t,this.el,this.selectors)},findNode:function(t){const[e=null]=this.findNodes(t);return e},notify:function(t){if(this.paper){var e=Array.prototype.slice.call(arguments,1);this.trigger.apply(this,[t].concat(e)),this.paper.trigger.apply(this.paper,[t,this].concat(e))}},getBBox:function(t){var e;if(t&&t.useModelGeometry){var n=this.model;e=n.getBBox().bbox(n.angle())}else e=this.getNodeBBox(this.el);return this.paper.localToPaperRect(e)},getNodeBBox:function(t){const e=this.getNodeBoundingRect(t),n=this.getRootTranslateMatrix().multiply(this.getNodeRotateMatrix(t)),r=this.getNodeMatrix(t);return z.transformRect(e,n.multiply(r))},getNodeRotateMatrix(t){return!this.rotatableNode||this.rotatableNode.contains(t)?this.getRootRotateMatrix():z.createSVGMatrix()},getNodeUnrotatedBBox:function(t){var e=this.getNodeBoundingRect(t),n=this.getNodeMatrix(t),r=this.getRootTranslateMatrix();return z.transformRect(e,r.multiply(n))},getRootTranslateMatrix:function(){var t=this.model,e=t.position(),n=z.createSVGMatrix().translate(e.x,e.y);return n},getRootRotateMatrix:function(){var t=z.createSVGMatrix(),e=this.model,n=e.angle();if(n){var r=e.getBBox(),i=r.width/2,s=r.height/2;t=t.translate(i,s).rotate(n).translate(-i,-s)}return t},_notifyHighlight:function(t,e,n={}){const{el:r}=this;let i;if(typeof e=="string"?i=this.findNode(e)||r:[i=r]=this.$(e),n.partial=i!==r,n.type===void 0){let s;switch(!0){case n.embedding:s=rn.EMBEDDING;break;case n.connecting:s=rn.CONNECTING;break;case n.magnetAvailability:s=rn.MAGNET_AVAILABILITY;break;case n.elementAvailability:s=rn.ELEMENT_AVAILABILITY;break;default:s=rn.DEFAULT;break}n.type=s}return this.notify(t,i,n),this},highlight:function(t,e){return this._notifyHighlight("cell:highlight",t,e)},unhighlight:function(t,e={}){return this._notifyHighlight("cell:unhighlight",t,e)},findMagnet:function(t){const e=this.el;let n=this.$(t)[0];n||(n=e);do{const r=n.getAttribute("magnet"),i=n===e;if((r||i)&&r!=="false")return n;if(i)return;n=n.parentNode}while(n)},findProxyNode:function(t,e){t||(t=this.el);const n=t.getAttribute(`${e}-selector`);if(n){const r=this.findNode(n);if(r)return r}return t},getSelector:function(t,e){var n;if(t===this.el)return typeof e=="string"&&(n=":scope > "+e),n;if(t){var r=z(t).index()+1;n=t.tagName+":nth-child("+r+")",e&&(n+=" > "+e),n=this.getSelector(t.parentNode,n)}return n},addLinkFromMagnet:function(t,e,n){var r=this.paper,i=r.model,s=r.getDefaultLink(this,t);return s.set({source:this.getLinkEnd(t,e,n,s,"source"),target:{x:e,y:n}}).addTo(i,{async:!1,ui:!0}),s.findView(r)},getLinkEnd:function(t,...e){const n=this.model,r=n.id,i=this.findAttributeNode("port",t),s=t.getAttribute("joint-selector"),o={id:r};if(s!=null&&(o.magnet=s),i!=null){let a=i.getAttribute("port");i.getAttribute("port-id-type")==="number"&&(a=parseInt(a,10)),o.port=a,!n.hasPort(a)&&!s&&(o.selector=this.getSelector(t))}else s==null&&this.el!==t&&(o.selector=this.getSelector(t));return this.customizeLinkEnd(o,t,...e)},customizeLinkEnd:function(t,e,n,r,i,s){const{paper:o}=this,{connectionStrategy:a}=o.options;if(typeof a=="function"){var c=a.call(o,t,this,e,new E(n,r),i,s,o);if(c)return c}return t},getMagnetFromLinkEnd:function(t){var e=t.port,n=t.magnet,r=this.model,i;return e!=null&&r.isElement()&&r.hasPort(e)?i=this.findPortNode(e,n)||this.el:(n||(n=t.selector),!n&&e!=null&&(n='[port="'+e+'"]'),i=this.findNode(n)),this.findProxyNode(i,"magnet")},dragLinkStart:function(t,e,n,r){this.model.startBatch("add-link");const i=this.addLinkFromMagnet(e,n,r);i.notifyPointerdown(t,n,r),i.eventData(t,i.startArrowheadMove("target",{whenNotAllowed:"remove"})),this.eventData(t,{linkView:i})},dragLink:function(t,e,n){var r=this.eventData(t),i=r.linkView;if(i)i.pointermove(t,e,n);else{var s=this.paper,o=s.options.magnetThreshold,a=this.getEventTarget(t),c=r.targetMagnet;if(o==="onleave"){if(c===a||z(c).contains(a))return}else if(s.eventData(t).mousemoved<=o)return;this.dragLinkStart(t,c,e,n)}},dragLinkEnd:function(t,e,n){var r=this.eventData(t),i=r.linkView;i&&(i.pointerup(t,e,n),this.model.stopBatch("add-link"))},getAttributeDefinition:function(t){return this.model.constructor.getAttributeDefinition(t)},setNodeAttributes:function(t,e){Xt(e)||(t instanceof SVGElement?z(t).attr(e):j(t).attr(e))},processNodeAttributes:function(t,e){var n,r,i,s,o,a,c,l,f,u=[];const d={};for(n in e)e.hasOwnProperty(n)&&(d[z.attributeNames[n]]=e[n]);for(n in d)if(d.hasOwnProperty(n))if(r=d[n],i=this.getAttributeDefinition(n),i)if(r===null){let g;if(yt(i.unset)?g=i.unset.call(this,t,d,this):g=i.unset,!g&&Ct(i.set)&&(g=i.set),g||(g=n),Ct(g)&&g){if(a||(a={}),g in a)continue;a[g]=r}else if(Array.isArray(g)&&g.length>0)for(a||(a={}),s=0,o=g.length;s<o;s++){const v=g[s];v in a||(a[v]=r)}}else!yt(i.qualify)||i.qualify.call(this,r,t,d,this)?(Ct(i.set)&&(a||(a={}),a[i.set]=r),u.push(n,i)):(a||(a={}),a[n]=r);else a||(a={}),a[n]=r;for(s=0,o=u.length;s<o;s+=2)n=u[s],i=u[s+1],r=e[n],yt(i.set)&&(c||(c={}),c[n]=r),yt(i.position)&&(l||(l={}),l[n]=r),yt(i.offset)&&(f||(f={}),f[n]=r);return{raw:d,normal:a,set:c,position:l,offset:f}},updateRelativeAttributes:function(t,e,n,r){r||(r={});var i,s,o,a=Bo(e.raw||{},n),c=e.normal||{};for(const p in c)c[p]=a[p];var l=e.set,f=e.position,u=e.offset;for(i in l){s=a[i],o=this.getAttributeDefinition(i);var d=o.set.call(this,s,n.clone(),t,a,this);gt(d)?J(c,d):d!==void 0&&(c[i]=d)}if(t instanceof HTMLElement){this.setNodeAttributes(t,c);return}var g=c.transform,v=z.transformStringToMatrix(g),y=E(v.e,v.f);g&&(c=Wn(c,"transform"),v.e=v.f=0);var x,w,T;if(f||u){var P=this.getNodeScale(t,r.scalableNode);x=P.sx,w=P.sy}var M=!1;for(i in f)s=a[i],o=this.getAttributeDefinition(i),T=o.position.call(this,s,n.clone(),t,a,this),T&&(y.offset(E(T).scale(x,w)),M||(M=!0));this.setNodeAttributes(t,c);var I=!1;if(u){var D=this.getNodeBoundingRect(t);if(D.width>0&&D.height>0){var h=z.transformRect(D,v).scale(1/x,1/w);for(i in u)s=a[i],o=this.getAttributeDefinition(i),T=o.offset.call(this,s,h,t,a,this),T&&(y.offset(E(T).scale(x,w)),I||(I=!0))}}(g!==void 0||M||I)&&(y.round(1),v.e=y.x,v.f=y.y,t.setAttribute("transform",z.matrixToTransformString(v)))},getNodeScale:function(t,e){var n,r;if(e&&e.contains(t)){var i=e.scale();n=1/i.sx,r=1/i.sy}else n=1,r=1;return{sx:n,sy:r}},cleanNodesCache:function(){this.metrics={}},cleanNodeCache:function(t){const e=t.id;e&&delete this.metrics[e]},nodeCache:function(t){var e=this.metrics;if(!e)return{};var n=z.ensureId(t),r=e[n];return r||(r=e[n]={}),r},getNodeData:function(t){var e=this.nodeCache(t);return e.data||(e.data={}),e.data},getNodeBoundingRect:function(t){var e=this.nodeCache(t);return e.boundingRect===void 0&&(e.boundingRect=z(t).getBBox()),new Y(e.boundingRect)},getNodeMatrix:function(t){const e=this.nodeCache(t);if(e.magnetMatrix===void 0){const{rotatableNode:n,el:r}=this;let i;n&&n.contains(t)?i=n:i=r,e.magnetMatrix=z(t).getTransformToElement(i)}return z.createSVGMatrix(e.magnetMatrix)},getNodeShape:function(t){var e=this.nodeCache(t);return e.geometryShape===void 0&&(e.geometryShape=z(t).toGeometryShape()),e.geometryShape.clone()},isNodeConnection:function(t){return this.model.isLink()&&(!t||t===this.el)},findNodesAttributes:function(t,e,n,r){var i,s,o,a,c={},l=[];for(var f in t)if(t.hasOwnProperty(f)&&(o=t[f],!!Pt(o))){var u=n[f]=this.findBySelector(f,e,r);for(i=0,s=u.length;i<s;i++){var d=u[i];a=z.ensureId(d);var g=r&&r[f]===d,v=c[a];if(v){v.array||(l.push(a),v.array=!0,v.attributes=[v.attributes],v.selectedLength=[v.selectedLength]);var y=v.attributes,x=v.selectedLength;if(g)y.unshift(o),x.unshift(-1);else{var w=cc(x,s);y.splice(w,0,o),x.splice(w,0,s)}}else c[a]={attributes:o,selectedLength:g?-1:s,node:d,array:!1}}}for(i=0,s=l.length;i<s;i++)a=l[i],o=c[a],o.attributes=Lt({},...o.attributes.reverse());return c},getEventTarget:function(t,e={}){const{target:n,type:r,clientX:i=0,clientY:s=0}=t;return e.fromPoint||r==="touchmove"||r==="touchend"||"pointerId"in t&&n.hasPointerCapture(t.pointerId)?document.elementFromPoint(i,s):n},updateDOMSubtreeAttributes:function(t,e,n){n||(n={}),n.rootBBox||(n.rootBBox=Y()),n.selectors||(n.selectors=this.selectors);var r={},i={},s=[],o=[],a,c,l,f,u,d=n.roAttributes,g=this.findNodesAttributes(d||e,t,r,n.selectors),v=d?this.findNodesAttributes(e,t,r,n.selectors):g;for(var y in g)if(f=g[y],l=f.attributes,c=f.node,u=this.processNodeAttributes(c,l),!u.set&&!u.position&&!u.offset&&!u.raw.ref)this.setNodeAttributes(c,Bo(u.normal,n.rootBBox));else{var x=v[y]&&v[y].attributes,w=x&&l.ref===void 0?x.ref:l.ref,T;if(w){if(T=(r[w]||this.findBySelector(w,t,n.selectors))[0],!T)throw new Error('dia.CellView: "'+w+'" reference does not exist.')}else T=null;if(a={node:c,refNode:T,processedAttributes:u,allAttributes:x},T){var P=o.findIndex(function(M){return M.refNode===c});P>-1?o.splice(P,0,a):o.push(a)}else s.push(a)}s.push(...o);for(let M=0,I=s.length;M<I;M++){a=s[M],c=a.node,T=a.refNode;const D=T?z.ensureId(T):"";let h=i[D];h||(h=i[D]=T?z(T).getBBox({target:Dp(c,T)}):n.rootBBox),d?(u=this.processNodeAttributes(c,a.allAttributes),this.mergeProcessedAttributes(u,a.processedAttributes)):u=a.processedAttributes,this.updateRelativeAttributes(c,u,h,n)}},mergeProcessedAttributes:function(t,e){t.set||(t.set={}),t.position||(t.position={}),t.offset||(t.offset={}),J(t.set,e.set),J(t.position,e.position),J(t.offset,e.offset);var n=t.normal&&t.normal.transform;n!==void 0&&e.normal&&(e.normal.transform=n),t.normal=e.normal},onMount(t){t||(this.mountTools(),ae.mount(this))},onDetach(){this.unmountTools(),ae.unmount(this)},onRemove:function(){this.removeTools(),this.removeHighlighters()},_toolsView:null,hasTools:function(t){var e=this._toolsView;return e?t?e.getName()===t:!0:!1},addTools:function(t){return this.removeTools(),t&&(this._toolsView=t,t.configure({relatedView:this}),t.listenTo(this.paper,"tools:event",this.onToolEvent.bind(this))),this},unmountTools(){const t=this._toolsView;return t&&t.unmount(),this},mountTools(){const t=this._toolsView;return t&&!t.isMounted()&&t.mount(),this},updateTools:function(t){var e=this._toolsView;return e&&e.update(t),this},removeTools:function(){var t=this._toolsView;return t&&(t.remove(),this._toolsView=null),this},hideTools:function(){var t=this._toolsView;return t&&t.hide(),this},showTools:function(){var t=this._toolsView;return t&&t.show(),this},onToolEvent:function(t){switch(t){case"remove":this.removeTools();break;case"hide":this.hideTools();break;case"show":this.showTools();break}},removeHighlighters:function(){ae.remove(this)},updateHighlighters:function(t=!1){ae.update(this,null,t)},transformHighlighters:function(){ae.transform(this)},preventDefaultInteraction(t){this.eventData(t,{defaultInteractionPrevented:!0})},isDefaultInteractionPrevented(t){const{defaultInteractionPrevented:e=!1}=this.eventData(t);return e},pointerdblclick:function(t,e,n){this.notify("cell:pointerdblclick",t,e,n)},pointerclick:function(t,e,n){this.notify("cell:pointerclick",t,e,n)},contextmenu:function(t,e,n){this.notify("cell:contextmenu",t,e,n)},pointerdown:function(t,e,n){const{model:r}=this,{graph:i}=r;i&&(r.startBatch("pointer"),this.eventData(t,{graph:i})),this.notify("cell:pointerdown",t,e,n)},pointermove:function(t,e,n){this.notify("cell:pointermove",t,e,n)},pointerup:function(t,e,n){const{graph:r}=this.eventData(t);this.notify("cell:pointerup",t,e,n),r&&r.stopBatch("pointer",{cell:this.model})},mouseover:function(t){this.notify("cell:mouseover",t)},mouseout:function(t){this.notify("cell:mouseout",t)},mouseenter:function(t){this.notify("cell:mouseenter",t)},mouseleave:function(t){this.notify("cell:mouseleave",t)},mousewheel:function(t,e,n,r){this.notify("cell:mousewheel",t,e,n,r)},onevent:function(t,e,n,r){this.notify(e,t,n,r)},onmagnet:function(){},magnetpointerdblclick:function(){},magnetcontextmenu:function(){},checkMouseleave(t){const{paper:e,model:n}=this;if(e.isAsync()){if(n.isLink()){const s=n.getSourceElement();if(s){const a=e.findViewByModel(s);a&&(e.dumpView(a),e.checkViewVisibility(a))}const o=n.getTargetElement();if(o){const a=e.findViewByModel(o);a&&(e.dumpView(a),e.checkViewVisibility(a))}}e.dumpView(this),e.checkViewVisibility(this)}const r=this.getEventTarget(t,{fromPoint:!0}),i=e.findView(r);i!==this&&(this.mouseleave(t),i&&i.mouseenter(t))},setInteractivity:function(t){this.options.interactive=t},isIntersecting:function(t,e){return $e.exists(t,this.getNodeBBox(this.el),e)},isEnclosedIn:function(t){return t.containsRect(this.getNodeBBox(this.el))},isInArea:function(t,e={}){return e.strict?this.isEnclosedIn(t):this.isIntersecting(t)},isAtPoint:function(t,e){return this.getNodeBBox(this.el).containsPoint(t,e)}},{Flags:kp,Highlighting:rn,addPresentationAttributes:function(t){return Lt({},xt(this.prototype,"presentationAttributes"),t,function(e,n){if(!(!e||!n)&&(typeof e=="string"&&(e=[e]),typeof n=="string"&&(n=[n]),Array.isArray(e)&&Array.isArray(n)))return Ye(e.concat(n))})},evalAttribute:tu});Object.defineProperty(ft.prototype,"useCSSSelectors",{get(){const t=this.model.useCSSSelectors;return t!==void 0?t:hn.useCSSSelectors}});function Dp(t,e){let n=t;do{if(n.contains(e))return n;n=n.parentNode}while(n);return null}const dt={TOOLS:ft.Flags.TOOLS,UPDATE:"UPDATE",TRANSLATE:"TRANSLATE",RESIZE:"RESIZE",PORTS:"PORTS",ROTATE:"ROTATE",RENDER:"RENDER"},sn={MOVE:"move",MAGNET:"magnet"},br=ft.extend({_removePorts:function(){},_renderPorts:function(){},className:function(){var t=ft.prototype.className.apply(this).split(" ");return t.push("element"),t.join(" ")},initialize:function(){ft.prototype.initialize.apply(this,arguments),this._initializePorts()},presentationAttributes:{attrs:[dt.UPDATE],position:[dt.TRANSLATE,dt.TOOLS],size:[dt.RESIZE,dt.PORTS,dt.TOOLS],angle:[dt.ROTATE,dt.TOOLS],markup:[dt.RENDER],ports:[dt.PORTS]},initFlag:[dt.RENDER],UPDATE_PRIORITY:0,confirmUpdate:function(t,e){const{useCSSSelectors:n}=this;this.hasFlag(t,dt.PORTS)&&(this._removePorts(),this._cleanPortsCache());let r=!1;if(this.hasFlag(t,dt.RENDER))this.render(),this.updateTools(e),this.updateHighlighters(!0),r=!0,t=this.removeFlag(t,[dt.RENDER,dt.UPDATE,dt.RESIZE,dt.TRANSLATE,dt.ROTATE,dt.PORTS,dt.TOOLS]);else{let i=!1;this.hasFlag(t,dt.RESIZE)&&(this.resize(e),i=!0,t=this.removeFlag(t,[dt.RESIZE,dt.UPDATE]),n&&(t=this.removeFlag(t,dt.PORTS))),this.hasFlag(t,dt.UPDATE)&&(this.update(this.model,null,e),t=this.removeFlag(t,dt.UPDATE),i=!0,n&&(t=this.removeFlag(t,dt.PORTS))),this.hasFlag(t,dt.TRANSLATE)&&(this.translate(),t=this.removeFlag(t,dt.TRANSLATE),r=!0),this.hasFlag(t,dt.ROTATE)&&(this.rotate(),t=this.removeFlag(t,dt.ROTATE),r=!0),this.hasFlag(t,dt.PORTS)&&(this._renderPorts(),i=!0,t=this.removeFlag(t,dt.PORTS)),i&&this.updateHighlighters(!1)}return r&&this.transformHighlighters(),this.hasFlag(t,dt.TOOLS)&&(this.updateTools(e),t=this.removeFlag(t,dt.TOOLS)),t},_initializePorts:function(){},update:function(t,e){this.cleanNodesCache();const{useCSSSelectors:n}=this;n&&this._removePorts();var r=this.model,i=r.attr();this.updateDOMSubtreeAttributes(this.el,i,{rootBBox:new Y(r.size()),selectors:this.selectors,scalableNode:this.scalableNode,rotatableNode:this.rotatableNode,roAttributes:e===i?null:e}),n&&this._renderPorts()},rotatableSelector:"rotatable",scalableSelector:"scalable",scalableNode:null,rotatableNode:null,renderMarkup:function(){var t=this.model,e=t.get("markup")||t.markup;if(!e)throw new Error("dia.ElementView: markup required");if(Array.isArray(e))return this.renderJSONMarkup(e);if(typeof e=="string")return this.renderStringMarkup(e);throw new Error("dia.ElementView: invalid markup")},renderJSONMarkup:function(t){var e=this.parseDOMJSON(t,this.el),n=this.selectors=e.selectors;this.rotatableNode=z(n[this.rotatableSelector])||null,this.scalableNode=z(n[this.scalableSelector])||null,this.vel.append(e.fragment)},renderStringMarkup:function(t){var e=this.vel;e.append(z(t)),this.rotatableNode=e.findOne(".rotatable"),this.scalableNode=e.findOne(".scalable");var n=this.selectors={};n[this.selector]=this.el},render:function(){return this.vel.empty(),this.renderMarkup(),this.scalableNode&&this.update(),this.resize(),this.rotatableNode?(this.rotate(),this.translate()):this.updateTransformation(),this.useCSSSelectors||this._renderPorts(),this},resize:function(t){if(this.scalableNode)return this.sgResize(t);this.model.attributes.angle&&this.rotate(),this.update()},translate:function(){if(this.rotatableNode)return this.rgTranslate();this.updateTransformation()},rotate:function(){if(this.rotatableNode){this.rgRotate(),this.update();return}this.updateTransformation()},updateTransformation:function(){var t=this.getTranslateString(),e=this.getRotateString();e&&(t+=" "+e),this.vel.attr("transform",t)},getTranslateString:function(){const{x:t,y:e}=this.model.position();return`translate(${t},${e})`},getRotateString:function(){const t=this.model.angle();if(!t)return null;const{width:e,height:n}=this.model.size();return`rotate(${t},${e/2},${n/2})`},rgRotate:function(){this.rotatableNode.attr("transform",this.getRotateString())},rgTranslate:function(){this.vel.attr("transform",this.getTranslateString())},sgResize:function(t){var e=this.model,n=e.angle(),r=e.size(),i=this.scalableNode,s=!1;i.node.getElementsByTagName("path").length>0&&(s=!0);var o=i.getBBox({recursive:s}),a=r.width/(o.width||1),c=r.height/(o.height||1);i.attr("transform","scale("+a+","+c+")");var l=this.rotatableNode,f=l&&l.attr("transform");if(f){l.attr("transform",f+" rotate("+-n+","+r.width/2+","+r.height/2+")");var u=i.getBBox({target:this.paper.cells});e.set("position",{x:u.x,y:u.y},J({updateHandled:!0},t)),this.translate(),this.rotate()}this.update()},prepareEmbedding:function(t={}){const e=t.model||this.model,r=(t.paper||this.paper).model,i=t.initialZIndices={},s=e.getEmbeddedCells({deep:!0}),o=r.getConnectedLinks(e,{deep:!0,includeEnclosed:!0});[e,...s,...o].forEach(l=>i[l.id]=l.attributes.z),e.startBatch("to-front"),e.toFront({deep:!0,ui:!0});const a=r.getElements().reduce((l,f)=>Math.max(l,f.attributes.z||0),0);o.forEach(l=>{l.attributes.z<=a&&l.set("z",a+1,{ui:!0})}),e.stopBatch("to-front");const c=e.parent();c?(r.getCell(c).unembed(e,{ui:!0}),t.initialParentId=c):t.initialParentId=null},processEmbedding:function(t={},e,n,r){const i=t.model||this.model,s=t.paper||this.paper,o=s.model,{findParentBy:a,frontParentOnly:c,validateEmbedding:l}=s.options;let f;yt(a)?f=pt(a.call(o,this,e,n,r)):a==="pointer"?f=o.findElementsAtPoint({x:n,y:r}):f=o.findElementsUnderElement(i,{searchBy:a}),f=f.filter(g=>g instanceof ve&&i.id!==g.id&&!g.isEmbeddedIn(i)),c&&(f=f.slice(-1));let u=null;const d=t.candidateEmbedView;for(let g=f.length-1;g>=0;g--){const v=f[g];if(d&&d.model.id==v.id){u=d;break}else{const y=v.findView(s);if(!yt(l)||l.call(s,this,y)){u=y;break}}}u&&u!=d&&(this.clearEmbedding(t),t.candidateEmbedView=u.highlight(u.findProxyNode(null,"container"),{embedding:!0})),!u&&d&&this.clearEmbedding(t)},clearEmbedding:function(t){t||(t={});var e=t.candidateEmbedView;e&&(e.unhighlight(e.findProxyNode(null,"container"),{embedding:!0}),t.candidateEmbedView=null)},finalizeEmbedding:function(t={}){const e=t.candidateEmbedView,n=t.model||this.model,r=t.paper||this.paper;if(e)e.model.embed(n,{ui:!0}),e.unhighlight(e.findProxyNode(null,"container"),{embedding:!0}),t.candidateEmbedView=null;else{const{validateUnembedding:i}=r.options,{initialParentId:s}=t;if(s&&typeof i=="function"&&!i.call(r,this)){this._disallowUnembed(t);return}}r.model.getConnectedLinks(n,{deep:!0}).forEach(i=>{i.reparent({ui:!0})})},_disallowUnembed:function(t){const{model:e,whenNotAllowed:n="revert"}=t,r=e||this.model,s=(t.paper||this.paper).model;switch(n){case"remove":{r.remove({ui:!0});break}case"revert":{const{initialParentId:o,initialPosition:a,initialZIndices:c}=t;if(a){const{x:f,y:u}=a;r.position(f,u,{deep:!0,ui:!0})}c&&Object.keys(c).forEach(f=>{const u=s.getCell(f);u&&u.set("z",c[f],{ui:!0})});const l=s.getCell(o);l&&l.embed(r,{ui:!0});break}}},getTargetParentView:function(t){const{candidateEmbedView:e=null}=this.eventData(t);return e},getDelegatedView:function(){for(var t=this,e=t.model,n=t.paper;t&&!e.isLink();){if(!e.isEmbedded()||t.can("stopDelegation"))return t;e=e.getParentCell(),t=n.findViewByModel(e)}return null},findProxyNode:function(t,e){t||(t=this.el);const n=t.getAttribute(`${e}-selector`);if(n){const r=this.findAttribute("port",t);if(r){const i=this.findPortNode(r,n);if(i)return i}else{const i=this.findNode(n);if(i)return i}}return t},notifyPointerdown(t,e,n){ft.prototype.pointerdown.call(this,t,e,n),this.notify("element:pointerdown",t,e,n)},notifyPointermove(t,e,n){ft.prototype.pointermove.call(this,t,e,n),this.notify("element:pointermove",t,e,n)},notifyPointerup(t,e,n){this.notify("element:pointerup",t,e,n),ft.prototype.pointerup.call(this,t,e,n)},pointerdblclick:function(t,e,n){ft.prototype.pointerdblclick.apply(this,arguments),this.notify("element:pointerdblclick",t,e,n)},pointerclick:function(t,e,n){ft.prototype.pointerclick.apply(this,arguments),this.notify("element:pointerclick",t,e,n)},contextmenu:function(t,e,n){ft.prototype.contextmenu.apply(this,arguments),this.notify("element:contextmenu",t,e,n)},pointerdown:function(t,e,n){this.notifyPointerdown(t,e,n),this.dragStart(t,e,n)},pointermove:function(t,e,n){const r=this.eventData(t),{targetMagnet:i,action:s,delegatedView:o}=r;switch(i&&this.magnetpointermove(t,i,e,n),s){case sn.MAGNET:this.dragMagnet(t,e,n);break;case sn.MOVE:(o||this).drag(t,e,n);default:if(r.preventPointerEvents)break;this.notifyPointermove(t,e,n);break}this.eventData(t,r)},pointerup:function(t,e,n){const r=this.eventData(t),{targetMagnet:i,action:s,delegatedView:o}=r;switch(i&&this.magnetpointerup(t,i,e,n),s){case sn.MAGNET:this.dragMagnetEnd(t,e,n);break;case sn.MOVE:(o||this).dragEnd(t,e,n);default:if(r.preventPointerEvents)break;this.notifyPointerup(t,e,n)}i&&this.magnetpointerclick(t,i,e,n),this.checkMouseleave(t)},mouseover:function(t){ft.prototype.mouseover.apply(this,arguments),this.notify("element:mouseover",t)},mouseout:function(t){ft.prototype.mouseout.apply(this,arguments),this.notify("element:mouseout",t)},mouseenter:function(t){ft.prototype.mouseenter.apply(this,arguments),this.notify("element:mouseenter",t)},mouseleave:function(t){ft.prototype.mouseleave.apply(this,arguments),this.notify("element:mouseleave",t)},mousewheel:function(t,e,n,r){ft.prototype.mousewheel.apply(this,arguments),this.notify("element:mousewheel",t,e,n,r)},onmagnet:function(t,e,n){const{currentTarget:r}=t;this.magnetpointerdown(t,r,e,n),this.eventData(t,{targetMagnet:r}),this.dragMagnetStart(t,e,n)},magnetpointerdown:function(t,e,n,r){this.notify("element:magnet:pointerdown",t,e,n,r)},magnetpointermove:function(t,e,n,r){this.notify("element:magnet:pointermove",t,e,n,r)},magnetpointerup:function(t,e,n,r){this.notify("element:magnet:pointerup",t,e,n,r)},magnetpointerdblclick:function(t,e,n,r){this.notify("element:magnet:pointerdblclick",t,e,n,r)},magnetcontextmenu:function(t,e,n,r){this.notify("element:magnet:contextmenu",t,e,n,r)},dragStart:function(t,e,n){if(this.isDefaultInteractionPrevented(t))return;var r=this.getDelegatedView();if(!r||!r.can("elementMove"))return;this.eventData(t,{action:sn.MOVE,delegatedView:r});const i=r.model.position();r.eventData(t,{initialPosition:i,pointerOffset:i.difference(e,n),restrictedArea:this.paper.getRestrictedArea(r,e,n)})},dragMagnetStart:function(t,e,n){const{paper:r}=this,i=t.isPropagationStopped();if(i&&this.eventData(t,{preventPointerEvents:!0}),this.isDefaultInteractionPrevented(t)||!this.can("addLinkFromMagnet"))return;const{targetMagnet:s=t.currentTarget}=this.eventData(t);if(t.stopPropagation(),!r.options.validateMagnet.call(r,this,s,t)){i?this.dragStart(t,e,n):this.pointerdown(t,e,n);return}r.options.magnetThreshold<=0&&this.dragLinkStart(t,s,e,n),this.eventData(t,{action:sn.MAGNET})},snapToGrid:function(t,e,n){const r=this.paper.options.gridSize;return{x:je(e,r),y:je(n,r)}},drag:function(t,e,n){var r=this.paper,i=this.model,s=this.eventData(t),{pointerOffset:o,restrictedArea:a,embedding:c}=s;const{x:l,y:f}=this.snapToGrid(t,e+o.x,n+o.y);i.position(l,f,{restrictedArea:a,deep:!0,ui:!0}),r.options.embeddingMode&&(c||(this.prepareEmbedding(s),c=!0),this.processEmbedding(s,t,e,n)),this.eventData(t,{embedding:c})},dragMagnet:function(t,e,n){this.dragLink(t,e,n)},dragEnd:function(t,e,n){var r=this.eventData(t);r.embedding&&this.finalizeEmbedding(r)},dragMagnetEnd:function(t,e,n){this.dragLinkEnd(t,e,n)},magnetpointerclick:function(t,e,n,r){var i=this.paper;i.eventData(t).mousemoved>i.options.clickThreshold||this.notify("element:magnet:pointerclick",t,e,n,r)}},{Flags:dt});J(br.prototype,gd);const ht={TOOLS:ft.Flags.TOOLS,RENDER:"RENDER",UPDATE:"UPDATE",LABELS:"LABELS",SOURCE:"SOURCE",TARGET:"TARGET",CONNECTOR:"CONNECTOR"},Mn=ft.extend({className:function(){var t=ft.prototype.className.apply(this).split(" ");return t.push("link"),t.join(" ")},_labelCache:null,_labelSelectors:null,_V:null,_dragData:null,metrics:null,decimalsRounding:2,initialize:function(){ft.prototype.initialize.apply(this,arguments),this._labelCache={},this._labelSelectors={},this._V={},this.cleanNodesCache()},presentationAttributes:{markup:[ht.RENDER],attrs:[ht.UPDATE],router:[ht.UPDATE],connector:[ht.CONNECTOR],labels:[ht.LABELS,ht.TOOLS],labelMarkup:[ht.LABELS],vertices:[ht.UPDATE],source:[ht.SOURCE,ht.UPDATE],target:[ht.TARGET,ht.UPDATE]},initFlag:[ht.RENDER,ht.SOURCE,ht.TARGET,ht.TOOLS],UPDATE_PRIORITY:1,EPSILON:1e-6,confirmUpdate:function(t,e){if(e||(e={}),this.hasFlag(t,ht.SOURCE)){if(!this.updateEndProperties("source"))return t;t=this.removeFlag(t,ht.SOURCE)}if(this.hasFlag(t,ht.TARGET)){if(!this.updateEndProperties("target"))return t;t=this.removeFlag(t,ht.TARGET)}const{paper:n,sourceView:r,targetView:i}=this;if(n&&(r&&!n.isViewMounted(r)||i&&!n.isViewMounted(i)))return t;if(this.hasFlag(t,ht.RENDER))return this.render(),this.updateHighlighters(!0),this.updateTools(e),t=this.removeFlag(t,[ht.RENDER,ht.UPDATE,ht.LABELS,ht.TOOLS,ht.CONNECTOR]),Fc.test("isSafari")&&this.__fixSafariBug268376(),t;let s=!1;const{model:o}=this,{attributes:a}=o;let c=this.hasFlag(t,ht.LABELS);c&&(this.onLabelsChange(o,a.labels,e),t=this.removeFlag(t,ht.LABELS),s=!0);const l=this.hasFlag(t,ht.UPDATE),f=this.hasFlag(t,ht.CONNECTOR);return(l||f)&&(l?e.translateBy&&o.isRelationshipEmbeddedIn(e.translateBy)?this.translate(e.tx,e.ty):this.update():(this.updatePath(),this.updateDOM()),this.updateTools(e),t=this.removeFlag(t,[ht.UPDATE,ht.TOOLS,ht.CONNECTOR]),c=!1,s=!0),c&&this.updateLabelPositions(),s&&this.updateHighlighters(),this.hasFlag(t,ht.TOOLS)&&(this.updateTools(e),t=this.removeFlag(t,ht.TOOLS)),t},__fixSafariBug268376:function(){const{el:t}=this,e=Array.from(t.childNodes),n=document.createDocumentFragment();for(let r=0,i=e.length;r<i;r++)t.removeChild(e[r]),n.appendChild(e[r]);t.appendChild(n)},requestConnectionUpdate:function(t){this.requestUpdate(this.getFlag(ht.UPDATE),t)},isLabelsRenderRequired:function(t={}){const e=this.model.previous("labels");if(!e)return!0;if("propertyPathArray"in t&&"propertyValue"in t){var n=t.propertyPathArray||[],r=n.length;if(r>1){var i=!!e[n[1]];if(i){if(r===2)return"markup"in Object(t.propertyValue);if(n[2]!=="markup")return!1}}}return!0},onLabelsChange:function(t,e,n){this.isLabelsRenderRequired(n)?this.renderLabels():this.updateLabels()},render:function(){return this.vel.empty(),this.unmountLabels(),this._V={},this.renderMarkup(),this.renderLabels(),this.update(),this},renderMarkup:function(){var t=this.model,e=t.get("markup")||t.markup;if(!e)throw new Error("dia.LinkView: markup required");if(Array.isArray(e))return this.renderJSONMarkup(e);if(typeof e=="string")return this.renderStringMarkup(e);throw new Error("dia.LinkView: invalid markup")},renderJSONMarkup:function(t){var e=this.parseDOMJSON(t,this.el);this.selectors=e.selectors,this.vel.append(e.fragment)},renderStringMarkup:function(t){var e=z(t);Array.isArray(e)||(e=[e]),this.vel.append(e)},_getLabelMarkup:function(t){if(t){if(Array.isArray(t))return this.parseDOMJSON(t,null);if(typeof t=="string")return this._getLabelStringMarkup(t);throw new Error("dia.linkView: invalid label markup")}},_getLabelStringMarkup:function(t){var e=z(t),n=document.createDocumentFragment();if(!Array.isArray(e))n.appendChild(e.node);else for(var r=0,i=e.length;r<i;r++){var s=e[r].node;n.appendChild(s)}return{fragment:n,selectors:{}}},_normalizeLabelMarkup:function(t){if(t){var e=t.fragment;if(!(t.fragment instanceof DocumentFragment)||!t.fragment.hasChildNodes())throw new Error("dia.LinkView: invalid label markup.");var n,r=e.childNodes;return r.length>1||r[0].nodeName.toUpperCase()!=="G"?n=z("g").append(e):n=z(r[0]),n.addClass("label"),{node:n.node,selectors:t.selectors}}},renderLabels:function(){var t=this._V,e=t.labels,n=this._labelCache={},r=this._labelSelectors={},i=this.model,s=i.attributes.labels||[],o=s.length;if(o===0)return e&&e.remove(),this;e?e.empty():(e=t.labels=z("g").addClass("labels"),this.options.labelsLayer&&(e.addClass(xe(xt(this,"className"))),e.attr("model-id",i.id)));for(var a=0;a<o;a++){var c=s[a],l=this._normalizeLabelMarkup(this._getLabelMarkup(c.markup)),f,u;if(l)f=l.node,u=l.selectors;else{var d=i._builtins.defaultLabel,g=this._normalizeLabelMarkup(this._getLabelMarkup(d.markup)),v=i._getDefaultLabel(),y=this._normalizeLabelMarkup(this._getLabelMarkup(v.markup)),x=y||g;f=x.node,u=x.selectors}f.setAttribute("label-idx",a),e.append(f),n[a]=f;var w=this.selector;if(u[w])throw new Error("dia.LinkView: ambiguous label root selector.");u[w]=f,r[a]=u}return e.parent()||this.mountLabels(),this.updateLabels(),this},mountLabels:function(){const{el:t,paper:e,model:n,_V:r,options:i}=this,{labels:s}=r;if(!s||!n.hasLabels())return;const{node:o}=s;i.labelsLayer?e.getLayerView(i.labelsLayer).insertSortedNode(o,n.get("z")):o.parentNode!==t&&t.appendChild(o)},unmountLabels:function(){const{options:t,_V:e}=this;if(!e)return;const{labels:n}=e;n&&t.labelsLayer&&n.remove()},findLabelNodes:function(t,e){const n=this._labelCache[t];if(!n)return[];const r=this._labelSelectors[t];return this.findBySelector(e,n,r)},findLabelNode:function(t,e){const[n=null]=this.findLabelNodes(t,e);return n},_mergeLabelAttrs:function(t,e,n,r){return e===null?null:e===void 0?n===null?null:n===void 0?t?void 0:r:t?n:Lt({},r,n):t?Lt({},n,e):Lt({},r,n,e)},_mergeLabelSize:function(t,e){return t===null?null:t===void 0?e===null?null:e===void 0?void 0:e:Lt({},e,t)},updateLabels:function(){if(!this._V.labels)return this;this.paper.options.labelLayer||this.cleanNodeCache(this.el);for(var t=this.model,e=t.get("labels")||[],n=this.can("labelMove"),r=t._builtins.defaultLabel,i=r.attrs,s=t._getDefaultLabel(),o=s.markup,a=s.attrs,c=s.size,l=0,f=e.length;l<f;l++){var u=this._labelCache[l];u.setAttribute("cursor",n?"move":"default");var d=this._labelSelectors[l],g=e[l],v=g.markup,y=g.attrs,x=g.size,w=this._mergeLabelAttrs(v||o,y,a,i),T=this._mergeLabelSize(x,c);this.updateDOMSubtreeAttributes(u,w,{rootBBox:new Y(T),selectors:d})}return this},removeRedundantLinearVertices:function(t){const n=this.model,r=n.vertices(),i=[this.sourceAnchor,...r,this.targetAnchor],s=i.length,o=new St(i);o.simplify({threshold:.001});const a=o.points.map(l=>l.toJSON()),c=a.length;return s===c?0:(n.vertices(a.slice(1,c-1),t),s-c)},getEndView:function(t){switch(t){case"source":return this.sourceView||null;case"target":return this.targetView||null;default:throw new Error("dia.LinkView: type parameter required.")}},getEndAnchor:function(t){switch(t){case"source":return new E(this.sourceAnchor);case"target":return new E(this.targetAnchor);default:throw new Error("dia.LinkView: type parameter required.")}},getEndConnectionPoint:function(t){switch(t){case"source":return new E(this.sourcePoint);case"target":return new E(this.targetPoint);default:throw new Error("dia.LinkView: type parameter required.")}},getEndMagnet:function(t){switch(t){case"source":var e=this.sourceView;if(!e)break;return this.sourceMagnet||e.el;case"target":var n=this.targetView;if(!n)break;return this.targetMagnet||n.el;default:throw new Error("dia.LinkView: type parameter required.")}return null},update:function(){return this.updateRoute(),this.updatePath(),this.updateDOM(),this},translate:function(t=0,e=0){const{route:n,path:r}=this;if(!n||!r)return;const i=new St(n);i.translate(t,e),this.route=i.points,this.sourcePoint.offset(t,e),this.targetPoint.offset(t,e),this.sourceAnchor.offset(t,e),this.targetAnchor.offset(t,e),r.translate(t,e),this.updateDOM()},updateDOM(){const{el:t,model:e,selectors:n}=this;this.cleanNodesCache(),this.updateDOMSubtreeAttributes(t,e.attr(),{selectors:n}),this.updateLabelPositions(),this.options.perpendicular=null},updateRoute:function(){const{model:t}=this,e=t.vertices(),n=this.findAnchors(e),r=this.sourceAnchor=n.source,i=this.targetAnchor=n.target,s=this.findRoute(e);this.route=s;var o=this.findConnectionPoints(s,r,i);this.sourcePoint=o.source,this.targetPoint=o.target},updatePath:function(){const{route:t,sourcePoint:e,targetPoint:n}=this,r=this.findPath(t,e.clone(),n.clone());this.path=r},findAnchorsOrdered:function(t,e,n,r){var i,s,o,a,c=this.model,l=c.get(t),f=c.get(n),u=this.getEndView(t),d=this.getEndView(n),g=this.getEndMagnet(t),v=this.getEndMagnet(n);u?(e?o=new E(e):d?o=v:o=new E(f),i=this.getAnchor(l.anchor,u,g,o,t)):i=new E(l),d?(a=new E(r||i),s=this.getAnchor(f.anchor,d,v,a,n)):s=new E(f);var y={};return y[t]=i,y[n]=s,y},findAnchors:function(t){var e=this.model,n=t[0],r=t[t.length-1];return e.target().priority&&!e.source().priority?this.findAnchorsOrdered("target",r,"source",n):this.findAnchorsOrdered("source",n,"target",r)},findConnectionPoints:function(t,e,n){var r=t[0],i=t[t.length-1],s=this.model,o=s.get("source"),a=s.get("target"),c=this.sourceView,l=this.targetView,f=this.paper.options,u,d,g;if(c&&!c.isNodeConnection(this.sourceMagnet)){u=this.sourceMagnet||c.el;var v=o.connectionPoint||f.defaultConnectionPoint,y=r||n,x=new X(y,e);g=this.getConnectionPoint(v,c,u,x,"source")}else g=e;var w;if(l&&!l.isNodeConnection(this.targetMagnet)){d=this.targetMagnet||l.el;var T=a.connectionPoint||f.defaultConnectionPoint,P=i||e,M=new X(P,n);w=this.getConnectionPoint(T,l,d,M,"target")}else w=n;return{source:g,target:w}},getAnchor:function(t,e,n,r,i){var s=e.isNodeConnection(n),o=this.paper.options;if(t||(s?t=o.defaultLinkAnchor:this.options.perpendicular?t={name:"perpendicular"}:t=o.defaultAnchor),!t)throw new Error("Anchor required.");var a;if(typeof t=="function")a=t;else{var c=t.name,l=s?"linkAnchorNamespace":"anchorNamespace";if(a=o[l][c],typeof a!="function")throw new Error("Unknown anchor: "+c)}var f=a.call(this,e,n,r,t.args||{},i,this);return f?f.round(this.decimalsRounding):new E},getConnectionPoint:function(t,e,n,r,i){var s,o=r.end,a=this.paper.options;if(!t)return o;var c;if(typeof t=="function")c=t;else{var l=t.name;if(c=a.connectionPointNamespace[l],typeof c!="function")throw new Error("Unknown connection point: "+l)}return s=c.call(this,r,e,n,t.args||{},i,this),s?s.round(this.decimalsRounding):o},isIntersecting:function(t,e){const n=this.getConnection();return n?$e.exists(t,n,e,{segmentSubdivisions:this.getConnectionSubdivisions()}):!1},isEnclosedIn:function(t){const e=this.getConnection();if(!e)return!1;const n=e.bbox();return n?t.containsRect(n):!1},isAtPoint:function(t){const e=new Y(t);return e.inflate(this.EPSILON),this.isIntersecting(e)},_getDefaultLabelPositionProperty:function(){var t=this.model,e=t._builtins.defaultLabel,n=e.position,r=t._getDefaultLabel(),i=this._normalizeLabelPosition(r.position);return Lt({},n,i)},_normalizeLabelPosition:function(t){return typeof t=="number"?{distance:t,offset:null,angle:0,args:null}:t},_mergeLabelPositionProperty:function(t,e){return t===null?null:t===void 0?e===null?null:e:Lt({},e,t)},updateLabelPositions:function(){if(!this._V.labels)return this;var t=this.path;if(!t)return this;var e=this.model,n=e.get("labels")||[];if(!n.length)return this;for(var r=this._getDefaultLabelPositionProperty(),i=0,s=n.length;i<s;i++){var o=this._labelCache[i];if(o){var a=n[i],c=this._normalizeLabelPosition(a.position),l=this._mergeLabelPositionProperty(c,r),f=this._getLabelTransformationMatrix(l);o.setAttribute("transform",z.matrixToTransformString(f)),this._cleanLabelMatrices(i)}}return this},_cleanLabelMatrices:function(t){const{metrics:e,_labelSelectors:n}=this,r=n[t];if(r)for(let i in r){const{id:s}=r[i];s&&s in e&&delete e[s].magnetMatrix}},updateEndProperties:function(t){const{model:e,paper:n}=this,r=`${t}View`,i=e.get(t),s=i&&i.id;if(!s)return this[r]=null,this.updateEndMagnet(t),!0;const o=n.getModelById(s);if(!o)throw new Error("LinkView: invalid "+t+" cell.");const a=o.findView(n);return a?(this[r]=a,this.updateEndMagnet(t),!0):!1},updateEndMagnet:function(t){const e=`${t}Magnet`,n=this.getEndView(t);if(n){let r=n.getMagnetFromLinkEnd(this.model.get(t));r===n.el&&(r=null),this[e]=r}else this[e]=null},_getLabelPositionProperty:function(t){return this.model.label(t).position||{}},_getLabelPositionAngle:function(t){var e=this._getLabelPositionProperty(t);return e.angle||0},_getLabelPositionArgs:function(t){var e=this._getLabelPositionProperty(t);return e.args},_getDefaultLabelPositionArgs:function(){var t=this.model._getDefaultLabel(),e=t.position||{};return e.args},_mergeLabelPositionArgs:function(t,e){return t===null?null:t===void 0?e===null?null:e:Lt({},e,t)},addLabel:function(t,e,n,r){var i,s,o=0,a;typeof t!="number"?(i=t.x,s=t.y,typeof e=="number"?(o=e,a=n):a=e):(i=t,s=e,typeof n=="number"?(o=n,a=r):a=n);var c=this._getDefaultLabelPositionArgs(),l=a,f=this._mergeLabelPositionArgs(l,c),u={position:this.getLabelPosition(i,s,o,f)},d=-1;return this.model.insertLabel(d,u,a),d},addVertex:function(t,e,n){var r=typeof t!="number",i=r?t.x:t,s=r?t.y:e,o=r?e:n,a={x:i,y:s},c=this.getVertexIndex(i,s);return this.model.insertVertex(c,a,o),c},sendToken:function(t,e,n){function r(u,d){return function(){u.remove(),typeof d=="function"&&d()}}var i,s,o;gt(e)?(i=e.duration,s=e.direction==="reverse",o=e.connection):(i=e,s=!1,o=null),i=i||1e3;var a={dur:i+"ms",repeatCount:1,calcMode:"linear",fill:"freeze"};s&&(a.keyPoints="1;0",a.keyTimes="0;1");var c=z(t),l;if(typeof o=="string")l=this.findNode(o);else{var f=this._V;l=f.connection?f.connection.node:this.el.querySelector("path")}if(!(l instanceof SVGPathElement))throw new Error("dia.LinkView: token animation requires a valid connection path.");c.appendTo(this.paper.cells).animateAlongPath(a,l),setTimeout(r(c,n),i)},findRoute:function(t){t||(t=[]);var e=this.paper.options.routerNamespace||ap,n=this.model.router(),r=this.paper.options.defaultRouter;if(!n)if(r)n=r;else return t.map(E);var i=yt(n)?n:e[n.name];if(!yt(i))throw new Error('dia.LinkView: unknown router: "'+n.name+'".');var s=n.args||{},o=i.call(this,t,s,this);return o||t.map(E)},findPath:function(t,e,n){var r=this.paper.options.connectorNamespace||og,i=this.model.connector(),s=this.paper.options.defaultConnector;i||(i=s||{});var o=yt(i)?i:r[i.name];if(!yt(o))throw new Error('dia.LinkView: unknown connector: "'+i.name+'".');var a=Dt(i.args||{});a.raw=!0;var c=o.call(this,e,n,t,a,this);return typeof c=="string"&&(c=new et(z.normalizePathData(c))),c},getConnection:function(){var t=this.path;return t?t.clone():null},getSerializedConnection:function(){var t=this.path;if(!t)return null;var e=this.metrics;if(e.hasOwnProperty("data"))return e.data;var n=t.serialize();return e.data=n,n},getConnectionSubdivisions:function(){var t=this.path;if(!t)return null;var e=this.metrics;if(e.hasOwnProperty("segmentSubdivisions"))return e.segmentSubdivisions;var n=t.getSegmentSubdivisions();return e.segmentSubdivisions=n,n},getConnectionLength:function(){var t=this.path;if(!t)return 0;var e=this.metrics;if(e.hasOwnProperty("length"))return e.length;var n=t.length({segmentSubdivisions:this.getConnectionSubdivisions()});return e.length=n,n},getPointAtLength:function(t){var e=this.path;return e?e.pointAtLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getPointAtRatio:function(t){var e=this.path;return e?(It(t)&&(t=parseFloat(t)/100),e.pointAt(t,{segmentSubdivisions:this.getConnectionSubdivisions()})):null},getTangentAtLength:function(t){var e=this.path;return e?e.tangentAtLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getTangentAtRatio:function(t){var e=this.path;return e?e.tangentAt(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getClosestPoint:function(t){var e=this.path;return e?e.closestPoint(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getClosestPointLength:function(t){var e=this.path;return e?e.closestPointLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getClosestPointRatio:function(t){var e=this.path;return e?e.closestPointNormalizedLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getLabelPosition:function(t,e,n,r){var i={},s=0,o;typeof n=="number"?(s=n,o=r):o=n,o&&(i.args=o);var a=!(o&&o.absoluteDistance),c=o&&o.absoluteDistance&&o.reverseDistance,l=o&&o.absoluteOffset,f=this.path,u={segmentSubdivisions:this.getConnectionSubdivisions()},d=new E(t,e),g=f.closestPointT(d,u),v=f.lengthAtT(g,u);a&&(v=v/this.getConnectionLength()||0),c&&(v=-1*(this.getConnectionLength()-v)||1),i.distance=v;var y;l||(y=f.tangentAtT(g));var x;if(y)x=y.pointOffset(d);else{var w=f.pointAtT(g),T=d.difference(w);x={x:T.x,y:T.y}}return i.offset=x,i.angle=s,i},_getLabelTransformationMatrix:function(t){var e,n=0,r={};if(typeof t=="number")e=t;else if(typeof t.distance=="number")r=t.args||{},e=t.distance,n=t.angle||0;else throw new Error("dia.LinkView: invalid label position distance.");var i=e>0&&e<=1,s=0,o={x:0,y:0};if(t.offset){var a=t.offset;typeof a=="number"&&(s=a),a.x&&(o.x=a.x),a.y&&(o.y=a.y)}var c=o.x!==0||o.y!==0||s===0,l=r.keepGradient,f=r.ensureLegibility,u=this.path,d={segmentSubdivisions:this.getConnectionSubdivisions()},g=i?e*this.getConnectionLength():e,v=u.tangentAtLength(g,d),y,x=n;if(v){if(c)y=v.start.clone(),y.offset(o);else{var w=v.clone();w.rotate(v.start,-90),w.setLength(s),y=w.end}l&&(x=v.angle()+n,f&&(x=Qt((x+90)%180-90)))}else y=u.start.clone(),c&&y.offset(o);return z.createSVGMatrix().translate(y.x,y.y).rotate(x)},getLabelCoordinates:function(t){var e=this._getLabelTransformationMatrix(t);return new E(e.e,e.f)},getVertexIndex:function(t,e){for(var n=this.model,r=n.vertices(),i=this.getClosestPointLength(new E(t,e)),s=0,o=r.length;s<o;s++){var a=r[s],c=this.getClosestPointLength(a);if(i<c)break}return s},notifyPointerdown(t,e,n){ft.prototype.pointerdown.call(this,t,e,n),this.notify("link:pointerdown",t,e,n)},notifyPointermove(t,e,n){ft.prototype.pointermove.call(this,t,e,n),this.notify("link:pointermove",t,e,n)},notifyPointerup(t,e,n){this.notify("link:pointerup",t,e,n),ft.prototype.pointerup.call(this,t,e,n)},pointerdblclick:function(t,e,n){ft.prototype.pointerdblclick.apply(this,arguments),this.notify("link:pointerdblclick",t,e,n)},pointerclick:function(t,e,n){ft.prototype.pointerclick.apply(this,arguments),this.notify("link:pointerclick",t,e,n)},contextmenu:function(t,e,n){ft.prototype.contextmenu.apply(this,arguments),this.notify("link:contextmenu",t,e,n)},pointerdown:function(t,e,n){this.notifyPointerdown(t,e,n),this.dragStart(t,e,n)},pointermove:function(t,e,n){var r=this._dragData;r&&this.eventData(t,r);var i=this.eventData(t);switch(i.action){case"label-move":this.dragLabel(t,e,n);break;case"arrowhead-move":this.dragArrowhead(t,e,n);break;case"move":this.drag(t,e,n);break}r&&J(r,this.eventData(t)),this.notifyPointermove(t,e,n)},pointerup:function(t,e,n){var r=this._dragData;r&&(this.eventData(t,r),this._dragData=null);var i=this.eventData(t);switch(i.action){case"label-move":this.dragLabelEnd(t,e,n);break;case"arrowhead-move":this.dragArrowheadEnd(t,e,n);break;case"move":this.dragEnd(t,e,n)}this.notifyPointerup(t,e,n),this.checkMouseleave(t)},mouseover:function(t){ft.prototype.mouseover.apply(this,arguments),this.notify("link:mouseover",t)},mouseout:function(t){ft.prototype.mouseout.apply(this,arguments),this.notify("link:mouseout",t)},mouseenter:function(t){ft.prototype.mouseenter.apply(this,arguments),this.notify("link:mouseenter",t)},mouseleave:function(t){ft.prototype.mouseleave.apply(this,arguments),this.notify("link:mouseleave",t)},mousewheel:function(t,e,n,r){ft.prototype.mousewheel.apply(this,arguments),this.notify("link:mousewheel",t,e,n,r)},onlabel:function(t,e,n){this.notifyPointerdown(t,e,n),this.dragLabelStart(t,e,n);var r=this.eventData(t).stopPropagation;r&&t.stopPropagation()},dragLabelStart:function(t,e,n){if(this.can("labelMove")){if(this.isDefaultInteractionPrevented(t))return;var r=t.currentTarget,i=parseInt(r.getAttribute("label-idx"),10),s=this._getDefaultLabelPositionProperty(),o=this._normalizeLabelPosition(this._getLabelPositionProperty(i)),a=this._mergeLabelPositionProperty(o,s),c=this.getLabelCoordinates(a),l=c.x-e,f=c.y-n,u=this._getLabelPositionAngle(i),d=this._getLabelPositionArgs(i),g=this._getDefaultLabelPositionArgs(),v=this._mergeLabelPositionArgs(d,g);this.eventData(t,{action:"label-move",labelIdx:i,dx:l,dy:f,positionAngle:u,positionArgs:v,stopPropagation:!0})}else this.eventData(t,{stopPropagation:!0});this.paper.delegateDragEvents(this,t.data)},dragArrowheadStart:function(t,e,n){if(this.can("arrowheadMove")){var r=t.target,i=r.getAttribute("end"),s=this.startArrowheadMove(i,{ignoreBackwardsCompatibility:!0});this.eventData(t,s)}},dragStart:function(t,e,n){this.isDefaultInteractionPrevented(t)||this.can("linkMove")&&this.eventData(t,{action:"move",dx:e,dy:n})},dragLabel:function(t,e,n){var r=this.eventData(t),i={position:this.getLabelPosition(e+r.dx,n+r.dy,r.positionAngle,r.positionArgs)};this.paper.options.snapLabels&&delete i.position.offset;const s={ui:!0};this.paper.isAsync()&&t.type==="touchmove"&&(s.async=!1),this.model.label(r.labelIdx,i,s)},dragArrowhead:function(t,e,n){this.paper.options.snapLinks?!this._snapArrowhead(t,e,n)&&this.paper.options.snapLinksSelf&&this._snapArrowheadSelf(t,e,n):this.paper.options.snapLinksSelf?this._snapArrowheadSelf(t,e,n):this._connectArrowhead(this.getEventTarget(t),e,n,this.eventData(t))},drag:function(t,e,n){var r=this.eventData(t);this.model.translate(e-r.dx,n-r.dy,{ui:!0}),this.eventData(t,{dx:e,dy:n})},dragLabelEnd:function(){},dragArrowheadEnd:function(t,e,n){var r=this.eventData(t),i=this.paper;i.options.snapLinks?this._snapArrowheadEnd(r):this._connectArrowheadEnd(r,e,n),i.linkAllowed(this)?(this._finishEmbedding(r),this._notifyConnectEvent(r,t)):this._disallow(r),this._afterArrowheadMove(r)},dragEnd:function(){},_disallow:function(t){switch(t.whenNotAllowed){case"remove":this.model.remove({ui:!0});break;case"revert":default:this.model.set(t.arrowhead,t.initialEnd,{ui:!0});break}},_finishEmbedding:function(t){this.paper.options.embeddingMode&&this.model.reparent()&&(t.z=null)},_notifyConnectEvent:function(t,e){var n=t.arrowhead,r=t.initialEnd,i=this.model.prop(n),s=i&&!jr.endsEqual(r,i);if(s){var o=this.paper;r.id&&this.notify("link:disconnect",e,o.findViewByModel(r.id),t.initialMagnet,n),i.id&&this.notify("link:connect",e,o.findViewByModel(i.id),t.magnetUnderPointer,n)}},_snapToPoints:function(t,e,n){let r=null,i=1/0,s=null,o=1/0,a=t.x,c=t.y;for(let l=0;l<e.length;l++){const f=Math.abs(e[l].x-t.x);f<i&&(i=f,r=e[l]);const u=Math.abs(e[l].y-t.y);u<o&&(o=u,s=e[l])}return i<n&&(a=r.x),o<n&&(c=s.y),{x:a,y:c}},_snapArrowheadSelf:function(t,e,n){const{paper:r,model:i}=this,{snapLinksSelf:s}=r.options,o=this.eventData(t),a=s.radius||20,c=this.getEndAnchor(o.arrowhead==="source"?"target":"source"),l=i.vertices(),f=[c,...l],u=this._snapToPoints({x:e,y:n},f,a),d=r.localToClientPoint(u);this._connectArrowhead(document.elementFromPoint(d.x,d.y),u.x,u.y,this.eventData(t))},_snapArrowhead:function(t,e,n){const{paper:r}=this,{snapLinks:i,connectionStrategy:s}=r.options,o=this.eventData(t);let a=!1;var c=i.radius||50,l=r.findElementViewsInArea({x:e-c,y:n-c,width:2*c,height:2*c},i.findInAreaOptions),f=o.closestView||null,u=o.closestMagnet||null,d=o.magnetProxy||null;o.closestView=o.closestMagnet=o.magnetProxy=null;var g=Number.MAX_VALUE,v=new E(e,n);l.forEach(function(I){const D=[];I.el.getAttribute("magnet")!=="false"&&D.push({bbox:I.model.getBBox(),magnet:I.el}),I.$("[magnet]").toArray().forEach(h=>{D.push({bbox:I.getNodeBBox(h),magnet:h})}),D.forEach(h=>{const{magnet:p,bbox:m}=h,b=m.center().squaredDistance(v);b<g&&(u===p||r.options.validateConnection.apply(r,o.validateConnectionArgs(I,I.el===p?null:p)))&&(g=b,o.closestView=I,o.closestMagnet=p)})},this);var y,x=null,w=o.closestView,T=o.closestMagnet;T&&(x=o.magnetProxy=w.findProxyNode(T,"highlighter"));var P=o.arrowhead,M=u!==T;if(f&&M&&f.unhighlight(d,{connecting:!0,snapping:!0}),w){const{prevEnd:I,prevX:D,prevY:h}=o;if(o.prevX=e,o.prevY=n,a=!0,!M&&(typeof s!="function"||D===e&&h===n)||(y=w.getLinkEnd(T,e,n,this.model,P),!M&&_e(I,y)))return a;o.prevEnd=y,M&&w.highlight(x,{connecting:!0,snapping:!0})}else y={x:e,y:n};return this.model.set(P,y||{x:e,y:n},{ui:!0}),f&&this.notify("link:snap:disconnect",t,f,u,P),w&&this.notify("link:snap:connect",t,w,T,P),a},_snapArrowheadEnd:function(t){var e=t.closestView,n=t.closestMagnet;e&&n&&(e.unhighlight(t.magnetProxy,{connecting:!0,snapping:!0}),t.magnetUnderPointer=e.findMagnet(n)),t.closestView=t.closestMagnet=null},_connectArrowhead:function(t,e,n,r){const{paper:i,model:s}=this;if(r.eventTarget!==t){r.magnetProxy&&r.viewUnderPointer.unhighlight(r.magnetProxy,{connecting:!0});const o=r.viewUnderPointer=i.findView(t);if(o){const a=r.magnetUnderPointer=o.findMagnet(t),c=r.magnetProxy=o.findProxyNode(a,"highlighter");a&&this.paper.options.validateConnection.apply(i,r.validateConnectionArgs(o,a))?c&&o.highlight(c,{connecting:!0}):(r.magnetUnderPointer=null,r.magnetProxy=null)}else r.magnetUnderPointer=null,r.magnetProxy=null}r.eventTarget=t,s.set(r.arrowhead,{x:e,y:n},{ui:!0})},_connectArrowheadEnd:function(t={},e,n){const{model:r}=this,{viewUnderPointer:i,magnetUnderPointer:s,magnetProxy:o,arrowhead:a}=t;if(!s||!o||!i)return;i.unhighlight(o,{connecting:!0});const c=i.getLinkEnd(s,e,n,r,a);r.set(a,c,{ui:!0})},_beforeArrowheadMove:function(t){t.z=this.model.get("z"),this.model.toFront();var e=this.el.style;t.pointerEvents=e.pointerEvents,e.pointerEvents="none",this.paper.options.markAvailable&&this._markAvailableMagnets(t)},_afterArrowheadMove:function(t){t.z!==null&&(this.model.set("z",t.z,{ui:!0}),t.z=null),this.el.style.pointerEvents=t.pointerEvents,this.paper.options.markAvailable&&this._unmarkAvailableMagnets(t)},_createValidateConnectionArgs:function(t){var e=[];e[4]=t,e[5]=this;var n,r=0,i=0;t==="source"?(r=2,n="target"):(i=2,n="source");var s=this.model.get(n);if(s.id){var o=e[r]=this.paper.findViewByModel(s.id),a=o.getMagnetFromLinkEnd(s);a===o.el&&(a=void 0),e[r+1]=a}function c(l,f){return e[i]=l,e[i+1]=l.el===f?void 0:f,e}return c},_markAvailableMagnets:function(t){function e(u,d){var g=u.paper,v=g.options.validateConnection;return v.apply(g,this.validateConnectionArgs(u,d))}var n=this.paper,r=n.model.getCells();t.marked={};for(var i=0,s=r.length;i<s;i++){var o=r[i].findView(n);if(o){var a=Array.prototype.slice.call(o.el.querySelectorAll("[magnet]"));o.el.getAttribute("magnet")!=="false"&&a.push(o.el);var c=a.filter(e.bind(t,o));if(c.length>0){for(var l=0,f=c.length;l<f;l++)o.highlight(c[l],{magnetAvailability:!0});o.highlight(null,{elementAvailability:!0}),t.marked[o.model.id]=c}}}},_unmarkAvailableMagnets:function(t){for(var e=Object.keys(t.marked),n,r,i=0,s=e.length;i<s;i++){n=e[i],r=t.marked[n];var o=this.paper.findViewByModel(n);if(o){for(var a=0,c=r.length;a<c;a++)o.unhighlight(r[a],{magnetAvailability:!0});o.unhighlight(null,{elementAvailability:!0})}}t.marked=null},startArrowheadMove:function(t,e){e||(e={});var n={action:"arrowhead-move",arrowhead:t,whenNotAllowed:e.whenNotAllowed||"revert",initialMagnet:this[t+"Magnet"]||(this[t+"View"]?this[t+"View"].el:null),initialEnd:Dt(this.model.get(t)),validateConnectionArgs:this._createValidateConnectionArgs(t)};return this._beforeArrowheadMove(n),e.ignoreBackwardsCompatibility!==!0&&(this._dragData=n),n},onMount:function(){ft.prototype.onMount.apply(this,arguments),this.mountLabels()},onDetach:function(){ft.prototype.onDetach.apply(this,arguments),this.unmountLabels()},onRemove:function(){ft.prototype.onRemove.apply(this,arguments),this.unmountLabels()}},{Flags:ht});Object.defineProperty(Mn.prototype,"sourceBBox",{enumerable:!0,get:function(){var t=this.sourceView;if(!t){var e=this.model.source();return new Y(e.x,e.y)}var n=this.sourceMagnet;return t.isNodeConnection(n)?new Y(this.sourceAnchor):t.getNodeBBox(n||t.el)}});Object.defineProperty(Mn.prototype,"targetBBox",{enumerable:!0,get:function(){var t=this.targetView;if(!t){var e=this.model.target();return new Y(e.x,e.y)}var n=this.targetMagnet;return t.isNodeConnection(n)?new Y(this.targetAnchor):t.getNodeBBox(n||t.el)}});const Bp=ki.extend({style:{"pointer-events":"none"},_gridCache:null,_gridSettings:null,init(){ki.prototype.init.apply(this,arguments);const{options:{paper:t}}=this;this._gridCache=null,this._gridSettings=[],this.listenTo(t,"transform resize",this.updateGrid)},setGrid(t){this._gridSettings=this.getGridSettings(t),this.renderGrid()},getGridSettings(t){const e=[];return t&&(Array.isArray(t)?t:[t||{}]).forEach(r=>{e.push(...this._resolveDrawGridOption(r))}),e},removeGrid(){const{_gridCache:t}=this;t&&(t.root.remove(),this._gridCache=null)},renderGrid(){const{options:{paper:t}}=this,{_gridSettings:e}=this;if(this.removeGrid(),e.length===0)return;const n=t.options.drawGridSize||t.options.gridSize;if(n<=1)return;const r=this._getGridRefs();e.forEach((i,s)=>{const o=this._getPatternId(s),a=Lt({},i),{scaleFactor:c=1}=a;a.width=n*c||1,a.height=n*c||1;let l;r.exist(o)?l=r.get(o):(l=z("pattern",{id:o,patternUnits:"userSpaceOnUse"},z(a.markup)),r.add(o,l)),yt(a.render)&&a.render(l.node.firstChild,a,t),l.attr({width:a.width,height:a.height})}),r.root.appendTo(this.el),this.updateGrid()},updateGrid(){const{_gridCache:t,_gridSettings:e,options:{paper:n}}=this;if(!t)return;const{root:r,patterns:i}=t,{x:s,y:o,width:a,height:c}=n.getArea();r.attr({x:s,y:o,width:a,height:c});for(const l in i)i[l].attr({x:-s,y:-o});e.forEach((l,f)=>{if(yt(l.update)){const u=i[this._getPatternId(f)];l.update(u.node.firstChild,l,n)}})},_getPatternId(t){return`pattern_${this.options.paper.cid}_${t}`},_getGridRefs(){let{_gridCache:t}=this;if(t)return t;const e=z("defs"),n=z("svg",{width:"100%",height:"100%"},[e]);return t=this._gridCache={root:n,patterns:{},add:function(r,i){const s=z("rect",{width:"100%",height:"100%",fill:`url(#${r})`});e.append(i),n.append(s),this.patterns[r]=i},get:function(r){return this.patterns[r]},exist:function(r){return this.patterns[r]!==void 0}},t},_resolveDrawGridOption(t){var e=this.options.patterns;if(Ct(t)&&Array.isArray(e[t]))return e[t].map(function(c){return J({},c)});var n=t||{args:[{}]},r=Array.isArray(n),i=n.name;if(!r&&!i&&!n.markup&&(i="dot"),i&&Array.isArray(e[i])){var s=e[i].map(function(c){return J({},c)}),o=Array.isArray(n.args)?n.args:[n.args||{}];Yt(o[0],Wn(t,"args"));for(var a=0;a<o.length;a++)s[a]&&J(s[a],o[a]);return s}return r?n:[n]}}),on={NONE:"sorting-none",APPROX:"sorting-approximate",EXACT:"sorting-exact"},Fp=50,Fo=20,Vo=1e3,Vp=1/0,ur=9007199254740991,di=ft.Highlighting,zo={[di.DEFAULT]:{name:"stroke",options:{padding:3}},[di.MAGNET_AVAILABILITY]:{name:"addClass",options:{className:"available-magnet"}},[di.ELEMENT_AVAILABILITY]:{name:"addClass",options:{className:"available-cell"}}},zp=[{name:kt.GRID},{name:kt.BACK},{name:kt.CELLS},{name:kt.LABELS},{name:kt.FRONT},{name:kt.TOOLS}],Uo=Le.extend({className:"paper",options:{width:800,height:600,gridSize:1,drawGrid:!1,drawGridSize:null,background:!1,elementView:br,linkView:Mn,snapLabels:!1,snapLinks:!1,snapLinksSelf:!1,labelsLayer:!1,multiLinks:!0,guard:function(t,e){return!1},highlighting:zo,preventContextMenu:!0,preventDefaultBlankAction:!0,preventDefaultViewAction:!0,restrictTranslate:!1,markAvailable:!1,defaultLink:function(){const{cellNamespace:t}=this.model.get("cells"),e=vn(t,["standard","Link"]);if(!e)throw new Error("dia.Paper: no default link model found. Use `options.defaultLink` to specify a default link model.");return new e},defaultConnector:{name:"normal"},defaultRouter:{name:"normal"},defaultAnchor:{name:"center"},defaultLinkAnchor:{name:"connectionRatio"},defaultConnectionPoint:{name:"boundary"},connectionStrategy:null,validateMagnet:function(t,e,n){return e.getAttribute("magnet")!=="passive"},validateConnection:function(t,e,n,r,i,s){return(i==="target"?n:t)instanceof br},embeddingMode:!1,validateEmbedding:function(t,e){return!0},validateUnembedding:function(t){return!0},findParentBy:"bbox",frontParentOnly:!0,interactive:{labelMove:!1},linkPinning:!0,allowLink:null,clickThreshold:0,moveThreshold:0,magnetThreshold:0,sorting:on.APPROX,frozen:!1,autoFreeze:!1,onViewUpdate:function(t,e,n,r,i){e&(t.FLAG_INSERT|t.FLAG_REMOVE)||r.mounting||r.isolate||i.requestConnectedLinksUpdate(t,n,r)},onViewPostponed:function(t,e,n){return n.forcePostponedViewUpdate(t,e)},beforeRender:null,afterRender:null,viewport:null,cellViewNamespace:null,routerNamespace:null,connectorNamespace:null,highlighterNamespace:wg,anchorNamespace:Lp,linkAnchorNamespace:dp,connectionPointNamespace:Og,overflow:!1},events:{dblclick:"pointerdblclick",dbltap:"pointerdblclick",contextmenu:"contextmenu",mousedown:"pointerdown",touchstart:"pointerdown",mouseover:"mouseover",mouseout:"mouseout",mouseenter:"mouseenter",mouseleave:"mouseleave",wheel:"mousewheel","mouseenter .joint-cell":"mouseenter","mouseleave .joint-cell":"mouseleave","mouseenter .joint-tools":"mouseenter","mouseleave .joint-tools":"mouseleave","dblclick .joint-cell [magnet]":"magnetpointerdblclick","contextmenu .joint-cell [magnet]":"magnetcontextmenu","mousedown .joint-link .label":"onlabel","touchstart .joint-link .label":"onlabel","dragstart .joint-cell image":"onImageDragStart"},documentEvents:{mousemove:"pointermove",touchmove:"pointermove",mouseup:"pointerup",touchend:"pointerup",touchcancel:"pointerup"},stylesheet:`
        .joint-element .scalable * {
            vector-effect: non-scaling-stroke;
        }
    `,svg:null,viewport:null,defs:null,tools:null,layers:null,_viewportMatrix:null,_viewportTransformString:null,_updates:null,_layers:null,SORT_DELAYING_BATCHES:["add","to-front","to-back"],UPDATE_DELAYING_BATCHES:["translate"],FORM_CONTROL_TAG_NAMES:["TEXTAREA","INPUT","BUTTON","SELECT","OPTION"],GUARDED_TAG_NAMES:["SELECT"],MIN_SCALE:1e-6,DEFAULT_FIND_BUFFER:200,init:function(){const{options:t}=this;t.cellViewNamespace||(t.cellViewNamespace=typeof joint<"u"&&ge(joint,"shapes")?joint.shapes:null);const e=this.model=t.model||new ys;this._layers={},this.cloneOptions(),this.render(),this._setDimensions(),this.startListening(),this._views={},this._mw_evt_buffer={event:null,deltas:[]},this.resetViews(e.attributes.cells.models),!this.isFrozen()&&this.isAsync()&&this.updateViewsAsync()},_resetUpdates:function(){return this._updates&&this._updates.id&&vr(this._updates.id),this._updates={id:null,priorities:[{},{},{}],unmountedCids:[],mountedCids:[],unmounted:{},mounted:{},count:0,keyFrozen:!1,freezeKey:null,sort:!1,disabled:!1,idle:!1}},startListening:function(){var t=this.model;this.listenTo(t,"add",this.onCellAdded).listenTo(t,"remove",this.onCellRemoved).listenTo(t,"change",this.onCellChange).listenTo(t,"reset",this.onGraphReset).listenTo(t,"sort",this.onGraphSort).listenTo(t,"batch:stop",this.onGraphBatchStop),this.on("cell:highlight",this.onCellHighlight).on("cell:unhighlight",this.onCellUnhighlight).on("transform",this.update)},onCellAdded:function(t,e,n){var r=n.position;this.isAsync()||!Bt(r)?this.renderView(t,n):(n.maxPosition===r&&this.freeze({key:"addCells"}),this.renderView(t,n),r===0&&this.unfreeze({key:"addCells"}))},onCellRemoved:function(t,e,n){const r=this.findViewByModel(t);r&&this.requestViewUpdate(r,r.FLAG_REMOVE,r.UPDATE_PRIORITY,n)},onCellChange:function(t,e){if(t!==this.model.attributes.cells&&t.hasChanged("z")&&this.options.sorting===on.APPROX){const n=this.findViewByModel(t);n&&this.requestViewUpdate(n,n.FLAG_INSERT,n.UPDATE_PRIORITY,e)}},onGraphReset:function(t,e){this.resetLayers(),this.resetViews(t.models,e)},onGraphSort:function(){this.model.hasActiveBatch(this.SORT_DELAYING_BATCHES)||this.sortViews()},onGraphBatchStop:function(t){if(!this.isFrozen()){var e=t&&t.batchName,n=this.model;if(!this.isAsync()){var r=this.UPDATE_DELAYING_BATCHES;r.includes(e)&&!n.hasActiveBatch(r)&&this.updateViews(t)}var i=this.SORT_DELAYING_BATCHES;i.includes(e)&&!n.hasActiveBatch(i)&&this.sortViews()}},cloneOptions:function(){const{options:t}=this,{defaultConnector:e,defaultRouter:n,defaultConnectionPoint:r,defaultAnchor:i,defaultLinkAnchor:s,highlighting:o,cellViewNamespace:a,interactive:c}=t;!a&&typeof joint<"u"&&ge(joint,"shapes")&&(t.cellViewNamespace=joint.shapes),yt(e)||(t.defaultConnector=jt(e)),yt(n)||(t.defaultRouter=jt(n)),yt(r)||(t.defaultConnectionPoint=jt(r)),yt(i)||(t.defaultAnchor=jt(i)),yt(s)||(t.defaultLinkAnchor=jt(s)),Pt(c)&&(t.interactive=J({},c)),Pt(o)&&(t.highlighting=us({},o,zo))},children:function(){var t=z.namespace;return[{namespaceURI:t.xhtml,tagName:"div",className:xe("paper-background"),selector:"background",style:{position:"absolute",inset:0}},{namespaceURI:t.svg,tagName:"svg",attributes:{width:"100%",height:"100%","xmlns:xlink":t.xlink},selector:"svg",style:{position:"absolute",inset:0},children:[{tagName:"defs",selector:"defs"},{tagName:"g",className:xe("layers"),selector:"layers"}]}]},hasLayerView(t){return t in this._layers},getLayerView(t){const{_layers:e}=this;if(t in e)return e[t];throw new Error(`dia.Paper: Unknown layer "${t}"`)},getLayerNode(t){return this.getLayerView(t).el},render:function(){this.renderChildren();const{el:t,childNodes:e,options:n,stylesheet:r}=this,{svg:i,defs:s,layers:o}=e;return t.style.position="relative",i.style.overflow=n.overflow?"visible":"hidden",this.svg=i,this.defs=s,this.layers=o,this.renderLayers(),z.ensureId(i),this.addStylesheet(r),n.background&&this.drawBackground(n.background),n.drawGrid&&this.setGrid(n.drawGrid),this},addStylesheet:function(t){t&&z(this.svg).prepend(z.createSVGStyle(t))},createLayer(t){switch(t){case kt.GRID:return new Bp({name:t,paper:this,patterns:this.constructor.gridPatterns});default:return new ki({name:t})}},renderLayers:function(t=zp){this.removeLayers(),t.forEach(({name:i,sorted:s})=>{const o=this.createLayer(i);this.layers.appendChild(o.el),this._layers[i]=o});const e=this.getLayerView(kt.CELLS),n=this.getLayerView(kt.TOOLS),r=this.getLayerView(kt.LABELS);this.tools=n.el,this.cells=this.viewport=e.el,e.vel.addClass(xe("viewport")),r.vel.addClass(xe("viewport")),e.el.style.webkitUserSelect="none",e.el.style.userSelect="none",r.el.style.webkitUserSelect="none",r.el.style.userSelect="none"},removeLayers:function(){const{_layers:t}=this;Object.keys(t).forEach(e=>{t[e].remove(),delete t[e]})},resetLayers:function(){const{_layers:t}=this;Object.keys(t).forEach(e=>{t[e].removePivots()})},update:function(){return this._background&&this.updateBackgroundImage(this._background),this},scale:function(t,e,n){const r=this.matrix();return t===void 0?z.matrixToScale(r):(e===void 0&&(e=t),t=Math.max(t||0,this.MIN_SCALE),e=Math.max(e||0,this.MIN_SCALE),r.a=t,r.d=e,this.matrix(r,n),this)},scaleUniformAtPoint:function(t,e,n){const{a:r,d:i,e:s,f:o}=this.matrix();if(t=Math.max(t||0,this.MIN_SCALE),t===r&&t===i)return this;const a=z.createSVGMatrix().translate(s-e.x*(t-r),o-e.y*(t-i)).scale(t,t);return this.matrix(a,n),this},translate:function(t,e,n){const r=this.matrix();return t===void 0?z.matrixToTranslate(r):(t||(t=0),e||(e=0),r.e===t&&r.f===e?this:(r.e=t,r.f=e,this.matrix(r,n),this))},matrix:function(t,e={}){var n=this.layers;if(t===void 0){var r=n.getAttribute("transform");return(this._viewportTransformString||null)===r?t=this._viewportMatrix:(t=n.getCTM(),this._viewportMatrix=t,this._viewportTransformString=r),z.createSVGMatrix(t)}const i=this.matrix(),s=z.createSVGMatrix(t),o=this._viewportTransformString,a=z.matrixToTransformString(s);if(a===o)return this;if(!o&&z.matrixToTransformString()===a)return this;const{a:c,d:l,e:f,f:u}=s;return n.setAttribute("transform",a),this._viewportMatrix=s,this._viewportTransformString=n.getAttribute("transform"),(c!==i.a||l!==i.d)&&this.trigger("scale",c,l,e),(f!==i.e||u!==i.f)&&this.trigger("translate",f,u,e),this.trigger("transform",s,e),this},clientMatrix:function(){return z.createSVGMatrix(this.cells.getScreenCTM())},requestConnectedLinksUpdate:function(t,e,n){if(t instanceof ft)for(var r=t.model,i=this.model.getConnectedLinks(r),s=0,o=i.length;s<o;s++){var a=i[s],c=this.findViewByModel(a);if(c){var l=["UPDATE"];a.getTargetCell()===r&&l.push("TARGET"),a.getSourceCell()===r&&l.push("SOURCE");var f=Math.max(e+1,c.UPDATE_PRIORITY);this.scheduleViewUpdate(c,c.getFlag(l),f,n)}}},forcePostponedViewUpdate:function(t,e){if(!t||!(t instanceof ft))return!1;var n=t.model;if(n.isElement())return!1;if(!(e&t.getFlag(["SOURCE","TARGET"]))){var r={silent:!0},i=0,s=this.findViewByModel(n.getSourceCell());s&&!this.isViewMounted(s)&&(i=this.dumpView(s,r),t.updateEndMagnet("source"));var o=0,a=this.findViewByModel(n.getTargetCell());if(a&&!this.isViewMounted(a)&&(o=this.dumpView(a,r),t.updateEndMagnet("target")),i===0&&o===0)return!this.dumpView(t,r)}return!1},requestViewUpdate:function(t,e,n,r){r||(r={}),this.scheduleViewUpdate(t,e,n,r);var i=this.isAsync();if(!(this.isFrozen()||i&&r.async!==!1)&&!this.model.hasActiveBatch(this.UPDATE_DELAYING_BATCHES)){var s=this.updateViews(r);i&&this.notifyAfterRender(s,r)}},scheduleViewUpdate:function(t,e,n,r){const{_updates:i,options:s}=this;i.idle&&s.autoFreeze&&(i.idle=!1,this.unfreeze());const{FLAG_REMOVE:o,FLAG_INSERT:a,UPDATE_PRIORITY:c,cid:l}=t;let f=i.priorities[n];if(f||(f=i.priorities[n]={}),n>c)for(let g=n-1;g>=c;g--){const v=i.priorities[g];!v||!(l in v)||(f[l]|=v[l],delete v[l])}let u=f[l]||0;if((u&e)===e)return;u||i.count++,e&o&&u&a?f[l]^=a:e&a&&u&o&&(f[l]^=o),f[l]|=e;const d=s.onViewUpdate;typeof d=="function"&&d.call(this,t,e,n,r||{},this)},dumpViewUpdate:function(t){if(!t)return 0;var e=this._updates,n=t.cid,r=e.priorities[t.UPDATE_PRIORITY],i=this.registerMountedView(t)|r[n];return delete r[n],i},dumpView:function(t,e={}){const n=this.dumpViewUpdate(t);if(!n)return 0;const r=!e.silent;r&&this.notifyBeforeRender(e);const i=this.updateView(t,n,e);if(r){const s={updated:1,priority:t.UPDATE_PRIORITY};this.notifyAfterRender(s,e)}return i},updateView:function(t,e,n){if(!t)return 0;const{FLAG_REMOVE:r,FLAG_INSERT:i,FLAG_INIT:s,model:o}=t;if(t instanceof ft){if(e&r)return this.removeView(o),0;if(e&i){const a=!!(e&s);a&&(e^=s),this.insertView(t,a),e^=i}}return e?t.confirmUpdate(e,n||{}):0},requireView:function(t,e){var n=this.findViewByModel(t);return n?(this.dumpView(n,e),n):null},registerUnmountedView:function(t){var e=t.cid,n=this._updates;if(e in n.unmounted)return 0;var r=n.unmounted[e]|=t.FLAG_INSERT;return n.unmountedCids.push(e),delete n.mounted[e],r},registerMountedView:function(t){var e=t.cid,n=this._updates;if(e in n.mounted)return 0;n.mounted[e]=!0,n.mountedCids.push(e);var r=n.unmounted[e]||0;return delete n.unmounted[e],r},isViewMounted:function(t){if(!t)return!1;var e=t.cid,n=this._updates;return e in n.mounted},dumpViews:function(t){var e=Yt({},t,{viewport:null});this.checkViewport(e),this.updateViews(e)},updateViews:function(t){this.notifyBeforeRender(t);let e,n=0,r=0,i=ur;do r++,e=this.updateViewsBatch(t),n+=e.updated,i=Math.min(e.priority,i);while(!e.empty);const s={updated:n,batches:r,priority:i};return this.notifyAfterRender(s,t),s},hasScheduledUpdates:function(){const t=this._updates.priorities,e=Object.keys(t);let n=e.length;for(;n>0&&n--;)for(let r in t[e[n]])return!0;return!1},updateViewsAsync:function(t,e){t||(t={}),e||(e={processed:0,priority:ur});const{_updates:n,options:r}=this,i=n.id;if(i){vr(i),e.processed===0&&this.hasScheduledUpdates()&&this.notifyBeforeRender(t);const s=this.updateViewsBatch(t),o=Yt({},t,{mountBatchSize:Vo-s.mounted,unmountBatchSize:Vo-s.unmounted}),a=this.checkViewport(o),c=a.unmounted,l=a.mounted;let f=e.processed;const u=n.count;s.updated>0?(f+=s.updated+s.unmounted,s.processed=f,e.priority=Math.min(s.priority,e.priority),s.empty&&l===0?(s.unmounted+=c,s.mounted+=l,s.priority=e.priority,this.notifyAfterRender(s,t),e.processed=0,e.priority=ur,n.count=0):e.processed=f):n.idle||r.autoFreeze&&(this.freeze(),n.idle=!0,this.trigger("render:idle",t));const d=t.progress;if(u&&typeof d=="function"&&d.call(this,s.empty,f,u,s,this),n.id!==i)return}if(n.disabled)throw new Error("dia.Paper: can not unfreeze the paper after it was removed");n.id=Ci(this.updateViewsAsync,this,t,e)},notifyBeforeRender:function(t={}){let e=t.beforeRender;typeof e!="function"&&(e=this.options.beforeRender,typeof e!="function")||e.call(this,t,this)},notifyAfterRender:function(t,e={}){let n=e.afterRender;typeof n!="function"&&(n=this.options.afterRender),typeof n=="function"&&n.call(this,t,e,this),this.trigger("render:done",t,e)},updateViewsBatch:function(t){t||(t={});var e=t.batchSize||Vp,n=this._updates,r=0,i=0,s=0,o=0,a=ur,c=!0,l=this.options,f=n.priorities,u="viewport"in t?t.viewport:l.viewport;typeof u!="function"&&(u=null);var d=l.onViewPostponed;typeof d!="function"&&(d=null);var g=Object.keys(f);t:for(var v=0,y=g.length;v<y;v++){var x=+g[v],w=f[x];for(var T in w){if(r>=e){c=!1;break t}var P=ze[T];if(!P){delete w[T];continue}var M=w[T];if(!(M&P.FLAG_REMOVE)){var I=T in n.unmounted;if(P.DETACHABLE&&u&&!u.call(this,P,!I,this)){I||(this.registerUnmountedView(P),this.detachView(P)),n.unmounted[T]|=M,delete w[T],s++;continue}I&&(M|=P.FLAG_INSERT,o++),M|=this.registerMountedView(P)}var D=this.updateView(P,M,t);if(D>0&&(w[T]=D,!d||!d.call(this,P,D,this)||w[T])){i++,c=!1;continue}a>x&&(a=x),r++,delete w[T]}}return{priority:a,updated:r,postponed:i,unmounted:s,mounted:o,empty:c}},getUnmountedViews:function(){const t=this._updates,e=Object.keys(t.unmounted),n=e.length,r=new Array(n);for(var i=0;i<n;i++)r[i]=ze[e[i]];return r},getMountedViews:function(){const t=this._updates,e=Object.keys(t.mounted),n=e.length,r=new Array(n);for(var i=0;i<n;i++)r[i]=ze[e[i]];return r},checkUnmountedViews:function(t,e){e||(e={});var n=0;typeof t!="function"&&(t=null);for(var r=("mountBatchSize"in e)?e.mountBatchSize:1/0,i=this._updates,s=i.unmountedCids,o=i.unmounted,a=0,c=Math.min(s.length,r);a<c;a++){var l=s[a];if(l in o){var f=ze[l];if(f){if(f.DETACHABLE&&t&&!t.call(this,f,!1,this)){s.push(l);continue}n++;var u=this.registerMountedView(f);u&&this.scheduleViewUpdate(f,u,f.UPDATE_PRIORITY,{mounting:!0})}}}return s.splice(0,a),n},checkMountedViews:function(t,e){e||(e={});var n=0;if(typeof t!="function")return n;for(var r=("unmountBatchSize"in e)?e.unmountBatchSize:1/0,i=this._updates,s=i.mountedCids,o=i.mounted,a=0,c=Math.min(s.length,r);a<c;a++){var l=s[a];if(l in o){var f=ze[l];if(f){if(!f.DETACHABLE||t.call(this,f,!0,this)){s.push(l);continue}n++;var u=this.registerUnmountedView(f);u&&this.detachView(f)}}}return s.splice(0,a),n},checkViewVisibility:function(t,e={}){let n="viewport"in e?e.viewport:this.options.viewport;typeof n!="function"&&(n=null);const r=this._updates,{mounted:i,unmounted:s}=r,o=!t.DETACHABLE||!n||n.call(this,t,!1,this);let a=!1,c=!1;if(t.cid in i&&!o){this.registerUnmountedView(t)&&this.detachView(t);const u=r.mountedCids.indexOf(t.cid);r.mountedCids.splice(u,1),a=!0}if(!a&&t.cid in s&&o){const f=r.unmountedCids.indexOf(t.cid);r.unmountedCids.splice(f,1);var l=this.registerMountedView(t);l&&this.scheduleViewUpdate(t,l,t.UPDATE_PRIORITY,{mounting:!0}),c=!0}return{mounted:c?1:0,unmounted:a?1:0}},checkViewport:function(t){var e=Yt({},t,{mountBatchSize:1/0,unmountBatchSize:1/0}),n="viewport"in e?e.viewport:this.options.viewport,r=this.checkMountedViews(n,e);if(r>0){var i=this._updates.unmountedCids;e.mountBatchSize=Math.min(i.length-r,e.mountBatchSize)}var s=this.checkUnmountedViews(n,e);return{mounted:s,unmounted:r}},freeze:function(t){t||(t={});var e=this._updates,n=t.key,r=this.options.frozen,i=e.freezeKey;if(n&&n!==i){if(r&&i)return;e.freezeKey=n,e.keyFrozen=r}this.options.frozen=!0;var s=e.id;e.id=null,this.isAsync()&&s&&vr(s)},unfreeze:function(t){t||(t={});var e=this._updates,n=t.key,r=e.freezeKey;n&&r&&n!==r||(e.freezeKey=null,!(n&&n===r&&e.keyFrozen)&&(this.isAsync()?(this.freeze(),this.updateViewsAsync(t)):this.updateViews(t),this.options.frozen=e.keyFrozen=!1,e.sort&&(this.sortViews(),e.sort=!1)))},isAsync:function(){return!!this.options.async},isFrozen:function(){return!!this.options.frozen},isExactSorting:function(){return this.options.sorting===on.EXACT},onRemove:function(){this.freeze(),this._updates.disabled=!0,this.removeLayers(),this.removeViews()},getComputedSize:function(){var t=this.options,e=t.width,n=t.height;return Bt(e)||(e=this.el.clientWidth),Bt(n)||(n=this.el.clientHeight),{width:e,height:n}},setDimensions:function(t,e,n={}){const{options:r}=this,{width:i,height:s}=r;let o=t===void 0?i:t,a=e===void 0?s:e;if(i===o&&s===a)return;r.width=o,r.height=a,this._setDimensions();const c=this.getComputedSize();this.trigger("resize",c.width,c.height,n)},_setDimensions:function(){const{options:t}=this;let e=t.width,n=t.height;Bt(e)&&(e=`${Math.round(e)}px`),Bt(n)&&(n=`${Math.round(n)}px`),this.$el.css({width:e===null?"":e,height:n===null?"":n})},fitToContent:function(t,e,n,r){gt(t)?r=t:r=J({gridWidth:t,gridHeight:e,padding:n},r);const{x:i,y:s,width:o,height:a}=this.getFitToContentArea(r),{sx:c,sy:l}=this.scale();return this.translate(-i*c,-s*l,r),this.setDimensions(o*c,a*l,r),new Y(i,s,o,a)},getFitToContentArea:function(t={}){const e=t.gridWidth||1,n=t.gridHeight||1,r=Oe(t.padding||0),i=Math.max(t.minWidth||0,e),s=Math.max(t.minHeight||0,n),o=t.maxWidth||Number.MAX_VALUE,a=t.maxHeight||Number.MAX_VALUE,c=t.allowNewOrigin,l="contentArea"in t?new Y(t.contentArea):this.getContentArea(t),{sx:f,sy:u}=this.scale();l.x*=f,l.y*=u,l.width*=f,l.height*=u;let d=Math.ceil((l.width+l.x)/e),g=Math.ceil((l.height+l.y)/n);t.allowNegativeBottomRight||(d=Math.max(d,1),g=Math.max(g,1)),d*=e,g*=n;let v=0;(c==="negative"&&l.x<0||c==="positive"&&l.x>=0||c==="any")&&(v=Math.ceil(-l.x/e)*e,v+=r.left,d+=v);let y=0;return(c==="negative"&&l.y<0||c==="positive"&&l.y>=0||c==="any")&&(y=Math.ceil(-l.y/n)*n,y+=r.top,g+=y),d+=r.right,g+=r.bottom,d=Math.max(d,i),g=Math.max(g,s),d=Math.min(d,o),g=Math.min(g,a),new Y(-v/f,-y/u,d/f,g/u)},transformToFitContent:function(t){t||(t={});let e,n;if("contentArea"in t){const P=t.contentArea;e=this.localToPaperRect(P),n=new E(P)}else e=this.getContentBBox(t),n=this.paperToLocalPoint(e);if(!e.width||!e.height)return;Yt(t,{padding:0,preserveAspectRatio:!0,scaleGrid:null,minScale:0,maxScale:Number.MAX_VALUE,verticalAlign:"top",horizontalAlign:"left"});const r=Oe(t.padding),i=t.minScaleX||t.minScale,s=t.maxScaleX||t.maxScale,o=t.minScaleY||t.minScale,a=t.maxScaleY||t.maxScale;let c;if(t.fittingBBox)c=t.fittingBBox;else{const P=this.translate(),M=this.getComputedSize();c={x:P.tx,y:P.ty,width:M.width,height:M.height}}c=new Y(c).moveAndExpand({x:r.left,y:r.top,width:-r.left-r.right,height:-r.top-r.bottom});const l=this.matrix(),{a:f,d:u,e:d,f:g}=l;let v=c.width/e.width*f,y=c.height/e.height*u;if(t.preserveAspectRatio&&(v=y=Math.min(v,y)),t.scaleGrid){const P=t.scaleGrid;v=P*Math.floor(v/P),y=P*Math.floor(y/P)}v=Math.min(s,Math.max(i,v)),y=Math.min(a,Math.max(o,y));const x={x:v/f,y:y/u};let w=c.x-n.x*v-d,T=c.y-n.y*y-g;switch(t.verticalAlign){case"middle":T=T+(c.height-e.height*x.y)/2;break;case"bottom":T=T+(c.height-e.height*x.y);break}switch(t.horizontalAlign){case"middle":w=w+(c.width-e.width*x.x)/2;break;case"right":w=w+(c.width-e.width*x.x);break}l.a=v,l.d=y,l.e=w,l.f=T,this.matrix(l,t)},scaleContentToFit:function(t){this.transformToFitContent(t)},getContentArea:function(t){return t&&t.useModelGeometry?this.model.getBBox()||new Y:z(this.cells).getBBox()},getContentBBox:function(t){return this.localToPaperRect(this.getContentArea(t))},getArea:function(){return this.paperToLocalRect(this.getComputedSize())},getRestrictedArea:function(...t){const{restrictTranslate:e}=this.options;let n;return yt(e)?n=e.apply(this,t):e===!0?n=this.getArea():e?n=new Y(e):n=null,n},createViewForModel:function(t){const{options:e}=this;var n,r,i=e.cellViewNamespace,s=t.get("type")+"View",o=vn(i,s,".");t.isLink()?(n=e.linkView,r=Mn):(n=e.elementView,r=br);var a=n.prototype instanceof He?o||n:n.call(this,t)||o||r;return new a({model:t,interactive:e.interactive,labelsLayer:e.labelsLayer===!0?kt.LABELS:e.labelsLayer})},removeView:function(t){const{id:e}=t,{_views:n,_updates:r}=this,i=n[e];if(i){var{cid:s}=i;const{mounted:o,unmounted:a}=r;i.remove(),delete n[e],delete o[s],delete a[s]}return i},renderView:function(t,e){const{id:n}=t,r=this._views;let i,s,o=!0;return n in r&&(i=r[n],i.model===t?(s=i.FLAG_INSERT,o=!1):this.removeView(t)),o&&(i=r[n]=this.createViewForModel(t),i.paper=this,s=this.registerUnmountedView(i)|this.FLAG_INIT|i.getFlag(xt(i,"initFlag"))),this.requestViewUpdate(i,s,i.UPDATE_PRIORITY,e),i},onImageDragStart:function(){return!1},resetViews:function(t,e){e||(e={}),t||(t=[]),this._resetUpdates(),this.removeViews();const n=this.options.autoFreeze?null:"reset";this.freeze({key:n});for(var r=0,i=t.length;r<i;r++)this.renderView(t[r],e);this.unfreeze({key:n}),this.sortViews()},removeViews:function(){de(this._views,"remove"),this._views={}},sortViews:function(){if(this.isExactSorting()){if(this.isFrozen()){this._updates.sort=!0;return}this.sortViewsExact()}},sortViewsExact:function(){var t=Array.from(this.cells.childNodes).filter(n=>n.getAttribute("model-id")),e=this.model.get("cells");Ah(t,function(n,r){var i=e.get(n.getAttribute("model-id")),s=e.get(r.getAttribute("model-id")),o=i.attributes.z||0,a=s.attributes.z||0;return o===a?0:o<a?-1:1})},insertView:function(t,e){const n=this.getLayerView(kt.CELLS),{el:r,model:i}=t;switch(this.options.sorting){case on.APPROX:n.insertSortedNode(r,i.get("z"));break;case on.EXACT:default:n.insertNode(r);break}t.onMount(e)},detachView(t){t.unmount(),t.onDetach()},findView:function(t){var e=Ct(t)?this.cells.querySelector(t):t instanceof j?t[0]:t,n=this.findAttribute("model-id",e);if(n)return this._views[n]},findViewByModel:function(t){var e=Ct(t)||Bt(t)?t:t&&t.id;return this._views[e]},findViewsFromPoint:function(t){t=new E(t);var e=this.model.getElements().map(this.findViewByModel,this);return e.filter(function(n){return n&&n.vel.getBBox({target:this.cells}).containsPoint(t)},this)},findViewsInArea:function(t,e){e=Yt(e||{},{strict:!1}),t=new Y(t);var n=this.model.getElements().map(this.findViewByModel,this),r=e.strict?"containsRect":"intersect";return n.filter(function(i){return i&&t[r](i.vel.getBBox({target:this.cells}))},this)},findElementViewsInArea(t,e){return this._filterViewsInArea(t,(n,r)=>this.model.findElementsInArea(n,r),e)},findLinkViewsInArea:function(t,e){return this._filterViewsInArea(t,(n,r)=>this.model.findLinksInArea(n,r),e)},findCellViewsInArea:function(t,e){return this._filterViewsInArea(t,(n,r)=>this.model.findCellsInArea(n,r),e)},findElementViewsAtPoint:function(t,e){return this._filterViewsAtPoint(t,n=>this.model.findElementsInArea(n),e)},findLinkViewsAtPoint:function(t,e){return this._filterViewsAtPoint(t,n=>this.model.findLinksInArea(n),e)},findCellViewsAtPoint:function(t,e){return this._filterViewsAtPoint(t,n=>this.model.findCellsInArea(n),e)},_findInExtendedArea:function(t,e,n={}){const{buffer:r=this.DEFAULT_FIND_BUFFER}=n,i=new Y(t).inflate(r);return e(i,n).map(o=>this.findViewByModel(o))},_filterViewsInArea:function(t,e,n={}){const r=new Y(t);return this._findInExtendedArea(r,e,n).filter(o=>o?o.isInArea(r,n):!1)},_filterViewsAtPoint:function(t,e,n={}){const r=new Y(t);return this._findInExtendedArea(r,e,n).filter(o=>o?o.isAtPoint(t,n):!1)},removeTools:function(){return this.dispatchToolsEvent("remove"),this},hideTools:function(){return this.dispatchToolsEvent("hide"),this},showTools:function(){return this.dispatchToolsEvent("show"),this},dispatchToolsEvent:function(t,...e){typeof t=="string"&&this.trigger("tools:event",t,...e)},getModelById:function(t){return this.model.getCell(t)},snapToGrid:function(t,e){return this.clientToLocalPoint(t,e).snapToGrid(this.options.gridSize)},localToPaperPoint:function(t,e){var n=new E(t,e),r=z.transformPoint(n,this.matrix());return r},localToPaperRect:function(t,e,n,r){var i=new Y(t,e,n,r),s=z.transformRect(i,this.matrix());return s},paperToLocalPoint:function(t,e){var n=new E(t,e),r=z.transformPoint(n,this.matrix().inverse());return r},paperToLocalRect:function(t,e,n,r){var i=new Y(t,e,n,r),s=z.transformRect(i,this.matrix().inverse());return s},localToClientPoint:function(t,e){var n=new E(t,e),r=z.transformPoint(n,this.clientMatrix());return r},localToClientRect:function(t,e,n,r){var i=new Y(t,e,n,r),s=z.transformRect(i,this.clientMatrix());return s},clientToLocalPoint:function(t,e){var n=new E(t,e),r=z.transformPoint(n,this.clientMatrix().inverse());return r},clientToLocalRect:function(t,e,n,r){var i=new Y(t,e,n,r),s=z.transformRect(i,this.clientMatrix().inverse());return s},localToPagePoint:function(t,e){return this.localToPaperPoint(t,e).offset(this.pageOffset())},localToPageRect:function(t,e,n,r){return this.localToPaperRect(t,e,n,r).offset(this.pageOffset())},pageToLocalPoint:function(t,e){var n=new E(t,e),r=n.difference(this.pageOffset());return this.paperToLocalPoint(r)},pageToLocalRect:function(t,e,n,r){var i=this.pageOffset(),s=new Y(t,e,n,r);return s.x-=i.x,s.y-=i.y,this.paperToLocalRect(s)},clientOffset:function(){var t=this.svg.getBoundingClientRect();return new E(t.left,t.top)},pageOffset:function(){return this.clientOffset().offset(window.scrollX,window.scrollY)},linkAllowed:function(t){if(!(t instanceof Mn))throw new Error("Must provide a linkView.");var e=t.model,n=this.options,r=this.model,i=r.constructor.validations;return!(!n.multiLinks&&!i.multiLinks.call(this,r,e)||!n.linkPinning&&!i.linkPinning.call(this,r,e)||typeof n.allowLink=="function"&&!n.allowLink.call(this,t,this))},getDefaultLink:function(t,e){return yt(this.options.defaultLink)?this.options.defaultLink.call(this,t,e):this.options.defaultLink.clone()},resolveHighlighter:function(t={}){let{highlighter:e,type:n}=t;const{highlighting:r,highlighterNamespace:i}=this.options;if(e===void 0){if(!r||n&&(e=r[n],e===!1))return!1;e||(e=r.default)}if(!e)return!1;Ct(e)&&(e={name:e});const s=e.name,o=i[s];if(!o)throw new Error('Unknown highlighter ("'+s+'")');if(typeof o.highlight!="function")throw new Error('Highlighter ("'+s+'") is missing required highlight() method');if(typeof o.unhighlight!="function")throw new Error('Highlighter ("'+s+'") is missing required unhighlight() method');return{highlighter:o,options:e.options||{},name:s}},onCellHighlight:function(t,e,n){const r=this.resolveHighlighter(n);if(!r)return;const{highlighter:i,options:s}=r;i.highlight(t,e,s)},onCellUnhighlight:function(t,e,n){const r=this.resolveHighlighter(n);if(!r)return;const{highlighter:i,options:s}=r;i.unhighlight(t,e,s)},pointerdblclick:function(t){t.preventDefault(),t=Ot(t);var e=this.findView(t.target);if(!this.guard(t,e)){var n=this.snapToGrid(t.clientX,t.clientY);e?e.pointerdblclick(t,n.x,n.y):this.trigger("blank:pointerdblclick",t,n.x,n.y)}},pointerclick:function(t){var e=this.eventData(t);if(e.mousemoved<=this.options.clickThreshold){t=Ot(t);var n=this.findView(t.target);if(this.guard(t,n))return;var r=this.snapToGrid(t.clientX,t.clientY);n?n.pointerclick(t,r.x,r.y):this.trigger("blank:pointerclick",t,r.x,r.y)}},contextmenu:function(t){if(this.options.preventContextMenu&&t.preventDefault(),this.contextMenuFired){this.contextMenuFired=!1;return}t=Ot(t),this.contextMenuTrigger(t)},contextMenuTrigger:function(t){var e=this.findView(t.target);if(!this.guard(t,e)){var n=this.snapToGrid(t.clientX,t.clientY);e?e.contextmenu(t,n.x,n.y):this.trigger("blank:contextmenu",t,n.x,n.y)}},pointerdown:function(t){t=Ot(t);const{target:e,button:n}=t,r=this.findView(e),i=n===2;if(r){if(!i&&this.guard(t,r))return;const s=this.FORM_CONTROL_TAG_NAMES.includes(e.tagName);this.options.preventDefaultViewAction&&!s&&t.preventDefault(),s&&r.preventDefaultInteraction(t);const o=this.customEventTrigger(t,r);if(o){if(o.isPropagationStopped())return;t.data=o.data}const a=e.closest("[magnet]");if(a&&r.el!==a&&r.el.contains(a)){const c=Ot(new j.Event(t.originalEvent,{data:t.data,currentTarget:a}));if(this.onmagnet(c),c.isDefaultPrevented()&&t.preventDefault(),c.isPropagationStopped()){if(i)return;this.delegateDragEvents(r,c.data);return}t.data=c.data}}if(i){this.contextMenuFired=!0;const s=new j.Event(t.originalEvent,{type:"contextmenu",data:t.data});this.contextMenuTrigger(s)}else{const s=this.snapToGrid(t.clientX,t.clientY);r?r.pointerdown(t,s.x,s.y):(this.options.preventDefaultBlankAction&&t.preventDefault(),this.trigger("blank:pointerdown",t,s.x,s.y)),this.delegateDragEvents(r,t.data)}},pointermove:function(t){var e=this.eventData(t);e.mousemoved||(e.mousemoved=0,this.undelegateEvents());var n=++e.mousemoved;if(!(n<=this.options.moveThreshold)){t=Ot(t);var r=this.snapToGrid(t.clientX,t.clientY),i=e.sourceView;i?i.pointermove(t,r.x,r.y):this.trigger("blank:pointermove",t,r.x,r.y),this.eventData(t,e)}},pointerup:function(t){this.undelegateDocumentEvents();var e=Ot(t),n=this.snapToGrid(e.clientX,e.clientY),r=this.eventData(t).sourceView;r?r.pointerup(e,n.x,n.y):this.trigger("blank:pointerup",e,n.x,n.y),e.isPropagationStopped()||this.pointerclick(new j.Event(t.originalEvent,{type:"click",data:t.data})),this.delegateEvents()},mouseover:function(t){t=Ot(t);var e=this.findView(t.target);if(!this.guard(t,e))if(e)e.mouseover(t);else{if(this.el===t.target)return;this.trigger("blank:mouseover",t)}},mouseout:function(t){t=Ot(t);var e=this.findView(t.target);if(!this.guard(t,e))if(e)e.mouseout(t);else{if(this.el===t.target)return;this.trigger("blank:mouseout",t)}},mouseenter:function(t){t=Ot(t);const{target:e,relatedTarget:n,currentTarget:r}=t,i=this.findView(e);if(this.guard(t,i))return;const s=this.findView(n);i&&(s===i||(i.mouseenter(t),this.el.contains(n)))||s||r===this.el&&this.trigger("paper:mouseenter",t)},mouseleave:function(t){t=Ot(t);const{target:e,relatedTarget:n,currentTarget:r}=t,i=this.findView(e);if(this.guard(t,i))return;const s=this.findView(n);i&&(s===i||(i.mouseleave(t),this.el.contains(n)))||s||r===this.el&&this.trigger("paper:mouseleave",t)},_processMouseWheelEvtBuf:Pf(function(){const{event:t,deltas:e}=this._mw_evt_buffer,n=e.reduce((o,a)=>o+bh(a,Fp),0),r=Math.pow(.995,n),{x:i,y:s}=this.clientToLocalPoint(t.clientX,t.clientY);this.trigger("paper:pinch",t,i,s,r),this._mw_evt_buffer={event:null,deltas:[]}},Fo,{maxWait:Fo}),mousewheel:function(t){t=Ot(t);const e=this.findView(t.target);if(this.guard(t,e))return;const n=t.originalEvent,r=this.snapToGrid(n.clientX,n.clientY),{deltaX:i,deltaY:s}=yh(n),o=this._events["paper:pinch"];if(t.ctrlKey&&o&&o.length>0)n.preventDefault(),this._mw_evt_buffer.event=t,this._mw_evt_buffer.deltas.push(s),this._processMouseWheelEvtBuf();else{const a=Math.max(-1,Math.min(1,n.wheelDelta));e?e.mousewheel(t,r.x,r.y,a):this.trigger("blank:mousewheel",t,r.x,r.y,a),this.trigger("paper:pan",t,i,s)}},onevent:function(t){var e=t.currentTarget,n=e.getAttribute("event");if(n){var r=this.findView(e);if(r){if(t=Ot(t),this.guard(t,r))return;var i=this.snapToGrid(t.clientX,t.clientY);r.onevent(t,n,i.x,i.y)}}},magnetEvent:function(t,e){var n=t.currentTarget,r=n.getAttribute("magnet");if(r){var i=this.findView(n);if(i){if(t=Ot(t),this.guard(t,i))return;var s=this.snapToGrid(t.clientX,t.clientY);e.call(this,i,t,n,s.x,s.y)}}},onmagnet:function(t){if(t.button===2){this.contextMenuFired=!0,this.magnetContextMenuFired=!0;const e=new j.Event(t.originalEvent,{type:"contextmenu",data:t.data,currentTarget:t.currentTarget});this.magnetContextMenuTrigger(e),e.isPropagationStopped()&&t.stopPropagation()}else this.magnetEvent(t,function(e,n,r,i,s){e.onmagnet(n,i,s)})},magnetpointerdblclick:function(t){this.magnetEvent(t,function(e,n,r,i,s){e.magnetpointerdblclick(n,r,i,s)})},magnetcontextmenu:function(t){if(this.options.preventContextMenu&&t.preventDefault(),this.magnetContextMenuFired){this.magnetContextMenuFired=!1;return}this.magnetContextMenuTrigger(t)},magnetContextMenuTrigger:function(t){this.magnetEvent(t,function(e,n,r,i,s){e.magnetcontextmenu(n,r,i,s)})},onlabel:function(t){var e=t.currentTarget,n=this.findView(e);if(!n||(t=Ot(t),this.guard(t,n)))return;const r=this.customEventTrigger(t,n,e);if(r){if(r.isPropagationStopped())return;t.data=r.data}var i=this.snapToGrid(t.clientX,t.clientY);n.onlabel(t,i.x,i.y)},getPointerArgs(t){const e=Ot(t),{x:n,y:r}=this.snapToGrid(e.clientX,e.clientY);return[e,n,r]},delegateDragEvents:function(t,e){e||(e={}),this.eventData({data:e},{sourceView:t||null,mousemoved:0}),this.delegateDocumentEvents(null,e)},guard:function(t,e){if(t.type==="mousedown"&&t.button===2||this.options.guard&&this.options.guard(t,e))return!0;if(t.data&&t.data.guarded!==void 0)return t.data.guarded;const{target:n}=t;return this.GUARDED_TAG_NAMES.includes(n.tagName)?!0:!(e&&e.model&&e.model instanceof ve||this.el===n||this.svg.contains(n))},setGridSize:function(t){const{options:e}=this;return e.gridSize=t,e.drawGrid&&!e.drawGridSize&&this.getLayerView(kt.GRID).renderGrid(),this},setGrid:function(t){return this.getLayerView(kt.GRID).setGrid(t),this},updateBackgroundImage:function(t){t=t||{};var e=t.position||"center",n=t.size||"auto auto",r=this.scale(),i=this.translate();if(gt(e)){var s=i.tx+r.sx*(e.x||0),o=i.ty+r.sy*(e.y||0);e=s+"px "+o+"px"}gt(n)&&(n=new Y(n).scale(r.sx,r.sy),n=n.width+"px "+n.height+"px");const{background:a}=this.childNodes;a.style.backgroundSize=n,a.style.backgroundPosition=e},drawBackgroundImage:function(t,e){if(!(t instanceof HTMLImageElement)){this.childNodes.background.style.backgroundImage="";return}if(!(!this._background||this._background.id!==e.id)){e=e||{};var n,r=e.size,i=e.repeat||"no-repeat",s=e.opacity||1,o=Math.abs(e.quality)||1,a=this.constructor.backgroundPatterns[uc(i)];if(yt(a)){t.width*=o,t.height*=o;var c=a(t,e);if(!(c instanceof HTMLCanvasElement))throw new Error("dia.Paper: background pattern must return an HTML Canvas instance");n=c.toDataURL("image/png"),i="repeat",gt(r)?(r.width*=c.width/t.width,r.height*=c.height/t.height):r===void 0&&(e.size={width:c.width/o,height:c.height/o})}else n=t.src,r===void 0&&(e.size={width:t.width,height:t.height});this.childNodes.background.style.opacity=s,this.childNodes.background.style.backgroundRepeat=i,this.childNodes.background.style.backgroundImage=`url(${n})`,this.updateBackgroundImage(e)}},updateBackgroundColor:function(t){this.$el.css("backgroundColor",t||"")},drawBackground:function(t){if(t=t||{},this.updateBackgroundColor(t.color),t.image){t=this._background=jt(t),ln(t);var e=document.createElement("img");e.onload=this.drawBackgroundImage.bind(this,e,t),e.src=t.image}else this.drawBackgroundImage(null),this._background=null;return this},setInteractivity:function(t){this.options.interactive=t,de(this._views,"setInteractivity",t)},isDefined:function(t){return!!this.svg.getElementById(t)},defineFilter:function(t){if(!gt(t))throw new TypeError("dia.Paper: defineFilter() requires 1. argument to be an object.");var e=t.id,n=t.name;if(e||(e=n+this.svg.id+rr(JSON.stringify(t))),!this.isDefined(e)){var r=Eh,i=r[n]&&r[n](t.args||{});if(!i)throw new Error("Non-existing filter "+n);var s=J({filterUnits:"userSpaceOnUse"},t.attrs,{id:e});z(i,s).appendTo(this.defs)}return e},defineGradient:function(t){if(!gt(t))throw new TypeError("dia.Paper: defineGradient() requires 1. argument to be an object.");const{svg:e,defs:n}=this,{type:r,id:i=r+e.id+rr(JSON.stringify(t)),stops:s,attrs:o={}}=t;if(this.isDefined(i))return i;const a=pt(s).map(({offset:l,color:f,opacity:u})=>z("stop").attr({offset:l,"stop-color":f,"stop-opacity":Number.isFinite(u)?u:1})),c=z(r,o,a);return c.id=i,c.appendTo(n),i},definePattern:function(t){if(!gt(t))throw new TypeError("dia.Paper: definePattern() requires 1. argument to be an object.");const{svg:e,defs:n}=this,{id:r=e.id+rr(JSON.stringify(t)),markup:i,attrs:s={}}=t;if(!i)throw new TypeError("dia.Paper: definePattern() requires markup.");if(this.isDefined(r))return r;const o=z("pattern",{patternUnits:"userSpaceOnUse"});if(o.id=r,o.attr(s),typeof i=="string")o.append(z(i));else{const{fragment:a}=Pr(i);o.append(a)}return o.appendTo(n),r},defineMarker:function(t){if(!gt(t))throw new TypeError("dia.Paper: defineMarker() requires the first argument to be an object.");const{svg:e,defs:n}=this,{id:r=e.id+rr(JSON.stringify(t)),markup:i,attrs:s={},markerUnits:o="userSpaceOnUse"}=t;if(this.isDefined(r))return r;const a=z("marker",{orient:"auto",overflow:"visible",markerUnits:o});a.id=r,a.attr(s);let c;if(i){let u;if(typeof i=="string")u=z(i),u=Array.isArray(u)?u:[u];else{const{fragment:d}=Pr(i);u=z(d).children()}u.length>1?c=z("g").append(u):c=u[0]}else{const{type:u="path"}=t;c=z(u)}const l=Wn(t,"type","id","markup","attrs","markerUnits");return Object.keys(l).forEach(u=>{const d=l[u],g=c.attr(u);if(g==null)c.attr(u,d);else switch(u){case"transform":c.attr(u,d+" "+g);break}}),c.appendTo(a),a.appendTo(n),r},customEventTrigger:function(t,e,n=e.el){const r=t.target.closest("[event]");if(r&&n!==r&&e.el.contains(r)){const i=Ot(new j.Event(t.originalEvent,{data:t.data,currentTarget:r}));return this.onevent(i),i.isDefaultPrevented()&&t.preventDefault(),i}return null}},{sorting:on,Layers:kt,backgroundPatterns:{flipXy:function(t){var e=document.createElement("canvas"),n=t.width,r=t.height;e.width=2*n,e.height=2*r;var i=e.getContext("2d");return i.drawImage(t,0,0,n,r),i.setTransform(-1,0,0,-1,e.width,e.height),i.drawImage(t,0,0,n,r),i.setTransform(-1,0,0,1,e.width,0),i.drawImage(t,0,0,n,r),i.setTransform(1,0,0,-1,0,e.height),i.drawImage(t,0,0,n,r),e},flipX:function(t){var e=document.createElement("canvas"),n=t.width,r=t.height;e.width=n*2,e.height=r;var i=e.getContext("2d");return i.drawImage(t,0,0,n,r),i.translate(2*n,0),i.scale(-1,1),i.drawImage(t,0,0,n,r),e},flipY:function(t){var e=document.createElement("canvas"),n=t.width,r=t.height;e.width=n,e.height=r*2;var i=e.getContext("2d");return i.drawImage(t,0,0,n,r),i.translate(0,2*r),i.scale(1,-1),i.drawImage(t,0,0,n,r),e},watermark:function(t,e){e=e||{};var n=t.width,r=t.height,i=document.createElement("canvas");i.width=n*3,i.height=r*3;for(var s=i.getContext("2d"),o=Bt(e.watermarkAngle)?-e.watermarkAngle:-20,a=$t(o),c=i.width/4,l=i.height/4,f=0;f<4;f++)for(var u=0;u<4;u++)(f+u)%2>0&&(s.setTransform(1,0,0,1,(2*f-1)*c,(2*u-1)*l),s.rotate(a),s.drawImage(t,-n/2,-r/2,n,r));return i}},gridPatterns:{dot:[{color:"#AAAAAA",thickness:1,markup:"rect",render:function(t,e){z(t).attr({width:e.thickness,height:e.thickness,fill:e.color})}}],fixedDot:[{color:"#AAAAAA",thickness:1,markup:"rect",render:function(t,e){z(t).attr({fill:e.color})},update:function(t,e,n){const{sx:r,sy:i}=n.scale(),s=r<=1?e.thickness:e.thickness/r,o=i<=1?e.thickness:e.thickness/i;z(t).attr({width:s,height:o})}}],mesh:[{color:"#AAAAAA",thickness:1,markup:"path",render:function(t,e){var n,r=e.width,i=e.height,s=e.thickness;r-s>=0&&i-s>=0?n=["M",r,0,"H0 M0 0 V0",i].join(" "):n="M 0 0 0 0",z(t).attr({d:n,stroke:e.color,"stroke-width":e.thickness})}}],doubleMesh:[{color:"#AAAAAA",thickness:1,markup:"path",render:function(t,e){var n,r=e.width,i=e.height,s=e.thickness;r-s>=0&&i-s>=0?n=["M",r,0,"H0 M0 0 V0",i].join(" "):n="M 0 0 0 0",z(t).attr({d:n,stroke:e.color,"stroke-width":e.thickness})}},{color:"#000000",thickness:3,scaleFactor:4,markup:"path",render:function(t,e){var n,r=e.width,i=e.height,s=e.thickness;r-s>=0&&i-s>=0?n=["M",r,0,"H0 M0 0 V0",i].join(" "):n="M 0 0 0 0",z(t).attr({d:n,stroke:e.color,"stroke-width":e.thickness})}}]}}),bs=Le.extend({name:null,tagName:"g",className:"tool",svgElement:!0,_visible:!0,_visibleExplicit:!0,init:function(){var t=this.name;t&&this.vel.attr("data-tool-name",t)},configure:function(t,e){return this.relatedView=t,this.paper=t.paper,this.parentView=e,this.simulateRelatedView(this.el),this.delegateEvents(),this},simulateRelatedView:function(t){t&&t.setAttribute("model-id",this.relatedView.model.id)},getName:function(){return this.name},updateVisibility:function(){const t=this.computeVisibility();this.el.style.display=t?"":"none",this._visible=t},computeVisibility(){if(!this.isExplicitlyVisible())return!1;const{visibility:t}=this.options;return typeof t!="function"?!0:!!t.call(this,this.relatedView,this)},show:function(){this._visibleExplicit=!0,this.updateVisibility()},hide:function(){this._visibleExplicit=!1,this.updateVisibility()},isExplicitlyVisible:function(){return!!this._visibleExplicit},isVisible:function(){return!!this._visible},focus:function(){var t=this.options.focusOpacity;isFinite(t)&&(this.el.style.opacity=t),this.parentView.focusTool(this)},blur:function(){this.el.style.opacity="",this.parentView.blurTool(this)},update:function(){},guard:function(t){const{paper:e,relatedView:n}=this;return!e||!n?!0:e.guard(t,n)}}),Gp=Le.extend({tagName:"g",className:"tools",svgElement:!0,tools:null,isRendered:!1,options:{tools:null,relatedView:null,name:null},configure:function(t){t=J(this.options,t);var e=t.tools;if(!Array.isArray(e))return this;var n=t.relatedView;if(!(n instanceof ft))return this;for(var r=this.tools=[],i=0,s=e.length;i<s;i++){var o=e[i];o instanceof bs&&(o.configure(n,this),this.vel.append(o.el),r.push(o))}return this.isRendered=!1,n.requestUpdate(n.getFlag("TOOLS")),this},getName:function(){return this.options.name},update:function(t){t||(t={});const e=this.tools;if(!e)return this;const n=e.length,r=this.isRendered;for(let i=0;i<n;i++){const s=e[i];s.updateVisibility(),s.isVisible()&&this.ensureToolRendered(e,i)&&t.tool!==s.cid&&s.update()}return!this.isRendered&&n>0?this:(this.isMounted()||this.mount(),r||this.blurTool(),this)},ensureToolRendered(t,e){return this.isRendered||(this.isRendered=Array(t.length).fill(!1)),this.isRendered[e]?!0:(t[e].render(),this.isRendered[e]=!0,!1)},focusTool:function(t){var e=this.tools;if(!e)return this;for(var n=0,r=e.length;n<r;n++){var i=e[n];t===i?i.show():i.hide()}return this},blurTool:function(t){var e=this.tools;if(!e)return this;for(var n=0,r=e.length;n<r;n++){var i=e[n];i!==t&&!i.isExplicitlyVisible()&&(i.show(),i.isVisible()&&this.ensureToolRendered(e,n)&&i.update())}return this},hide:function(){return this.focusTool(null)},show:function(){return this.blurTool(null),this.isMounted()||this.mount(),this},onRemove:function(){var t=this.tools;if(!t)return this;for(var e=0,n=t.length;e<n;e++)t[e].remove();this.tools=null},mount:function(){const{options:t,el:e}=this,{relatedView:n,layer:r=kt.TOOLS,z:i}=t;return n&&(r?n.paper.getLayerView(r).insertSortedNode(e,i):n.el.appendChild(e)),this}});function eu(t,e){const{model:n}=t;return e?n.getBBox():n.isLink()?t.getConnection().bbox():t.getNodeUnrotatedBBox(t.el)}const nu=bs.extend({name:"button",events:{mousedown:"onPointerDown",touchstart:"onPointerDown"},options:{distance:0,offset:0,scale:null,rotate:!1},onRender:function(){this.renderChildren(this.options.markup),this.update()},update:function(){return this.position(),this},position:function(){const{vel:t}=this;t.transform(this.getCellMatrix(),{absolute:!0})},getCellMatrix(){return this.relatedView.model.isLink()?this.getLinkMatrix():this.getElementMatrix()},getElementMatrix(){const{relatedView:t,options:e}=this;let{x:n=0,y:r=0,offset:i={},useModelGeometry:s,rotate:o,scale:a}=e,c=eu(t,s);const l=t.model.angle();o||(c=c.bbox(l));const{x:f=0,y:u=0}=i;It(n)?n=parseFloat(n)/100*c.width:Ne(n)&&(n=Number(Ie(n,c))),It(r)?r=parseFloat(r)/100*c.height:Ne(r)&&(r=Number(Ie(r,c)));let d=z.createSVGMatrix().translate(c.x+c.width/2,c.y+c.height/2);return o&&(d=d.rotate(l)),d=d.translate(n+f-c.width/2,r+u-c.height/2),a&&(d=d.scale(a)),d},getLinkMatrix(){const{relatedView:t,options:e}=this,{offset:n=0,distance:r=0,rotate:i,scale:s}=e,o=typeof r=="function"?r.call(this,t,this):r;let a,c,l;It(o)?a=t.getTangentAtRatio(parseFloat(o)/100):a=t.getTangentAtLength(o),a?(c=a.start,l=a.vector().vectorAngle(new E(1,0))||0):(c=t.getConnection().start,l=0);let f=z.createSVGMatrix().translate(c.x,c.y).rotate(l).translate(0,n);return i||(f=f.rotate(-l)),s&&(f=f.scale(s)),f},onPointerDown:function(t){if(!this.guard(t)){t.stopPropagation(),t.preventDefault();var e=this.options.action;typeof e=="function"&&e.call(this.relatedView,t,this.relatedView,this)}}}),Up=nu.extend({name:"remove",children:[{tagName:"circle",selector:"button",attributes:{r:7,fill:"#FF1D00",cursor:"pointer"}},{tagName:"path",selector:"icon",attributes:{d:"M -3 -3 3 3 M -3 3 3 -3",fill:"none",stroke:"#FFFFFF","stroke-width":2,"pointer-events":"none"}}],options:{distance:60,offset:0,action:function(t,e,n){e.model.remove({ui:!0,tool:n.cid})}}}),$p=bs.extend({name:"boundary",tagName:"rect",options:{padding:10,useModelGeometry:!1},attributes:{fill:"none",stroke:"#33334F","stroke-width":.5,"stroke-dasharray":"5, 5","pointer-events":"none"},onRender:function(){this.update()},update:function(){const{relatedView:t,options:e,vel:n}=this,{useModelGeometry:r,rotate:i}=e,s=Oe(e.padding);let o=eu(t,r).moveAndExpand({x:-s.left,y:-s.top,width:s.left+s.right,height:s.top+s.bottom});var a=t.model;if(a.isElement()){var c=a.angle();if(c)if(i){var l=a.getBBox().center();n.rotate(c,l.x,l.y,{absolute:!0})}else o=o.bbox(c)}return n.attr(o.toJSON()),this}}),gi=(t,e)=>Math.floor(Math.random()*(e-t+1))+t,Hp=t=>{var e=gi(0,360),n=gi(20,t?40:98),r=gi(t?20:70,t?40:90);return`hsl(${e},${n}%,${r}%)`},On=()=>document.getElementById("canvas-section"),xr=document.getElementById("get-id"),qp=document.getElementById("delete-id"),Wp=document.getElementById("set-key"),jp=document.getElementById("set-value"),$o=document.getElementById("sortedset-value"),ru=document.getElementById("run-test"),Yp=document.getElementById("prev-tree"),Xp=document.getElementById("next-tree"),Zp=document.getElementById("set-btn"),Jp=document.getElementById("delete-btn"),Kp=document.getElementById("get-btn"),Qp=document.getElementById("zoom-btn"),tv=document.getElementById("clear-btn"),ev=document.getElementById("sortedset-btn"),nv=document.getElementById("sortedset-add-btn"),rv=document.getElementById("sortedset-sub-btn"),Ho=document.getElementById("result"),iv=document.getElementById("treeForm"),wr=document.querySelector(".modal-overlay"),sv=document.querySelector("#SECRETARY"),ov=document.getElementById("themeToggle");let av=(t,e,n)=>{var f,u,d,g;let r=H.NODEMAP.get(n.nodeID);r||H.NODEMAP.set(n.nodeID,{color:Hp(H.DARK),selected:!1,box:null,node:n}),r=H.NODEMAP.get(n.nodeID);const i=new Vc;i.resize(H.BOXWIDTH,H.BOXHEIGHT),i.position(t,e),i.attr({root:{tabindex:12,title:"shapes.standard.HeaderedRectangle"},bodyText:{fill:H.DARK?"#fff":"#000",fontSize:16,text:`
`+n.prevID+"<Prev Parent^"+n.parentID+" Next >"+n.nextID+`
`+((f=n.keys)==null?void 0:f.map((v,y)=>`
`+(v==xr.value?" > ":"")+v+"  "+(n.value[y]?n.value[y].substring(0,12):"*")).join(""))+`

`+(((u=n.errors)==null?void 0:u.length)>0?n.errors+`
`:"")},body:{fill:((d=n.errors)==null?void 0:d.length)>0?"#ff6565":!xr.value||r.selected?r.color:H.DARK?"#333":"#fff",fillOpacity:1,strokeWidth:1,strokeDasharray:"4,2"},headerText:{fill:H.DARK?"#fff":"#000",fontSize:20,fontVariant:"small-caps",text:""+n.nodeID},header:{fill:((g=n.errors)==null?void 0:g.length)>0?"#ff6565":!xr.value||r.selected?r.color:H.DARK?"#333":"#fff",fillOpacity:1,strokeWidth:1}}),i.addTo(H.graph);const s=new $p,o=new Up,a=new nu,c=new Gp({tools:[s,o,a]}),l=i.findView(H.paper);return l.addTools(c),l.hideTools(),H.paper.on("element:mouseenter",function(v){v.showTools(),v==l&&(H.MouseCurrentNode=n)}),H.paper.on("element:mouseleave",function(v){v.hideTools(),H.MouseCurrentNode=null}),r.box=i,r};function Di(t,e){var s,o,a,c,l,f;const n=new zc;if(!(!(t!=null&&t.box)||t!=null&&t.box&&!H.graph.getCell(t.box.id))&&!(!(e!=null&&e.box)||e!=null&&e.box&&!H.graph.getCell(e.box.id))){n.source(t.box),n.target(e.box),n.appendLabel({attrs:{text:{text:((s=t.node)==null?void 0:s.nodeID)+" "+((o=e.node)==null?void 0:o.nodeID),refY:t.node.nodeID>e.node.nodeID?-10:10}}}),n.router(H.router),n.connector(H.connector,{cornerType:"line",size:20});var r=t.selected&&e.selected?H.DARK?"#fff":"#000":H.DARK?"#555":"#bbb",i=(((c=(a=t.node)==null?void 0:a.errors)==null?void 0:c.length)??0)>0&&(((f=(l=e.node)==null?void 0:l.errors)==null?void 0:f.length)??0)>0;r=i?"#ff6565":r,n.attr({line:{stroke:r,strokeWidth:2,strokeDasharray:t.selected&&e.selected||i?0:4}}),H.graph.addCell(n)}}function iu(t,e,n,r,i,s,o){if(!t)return null;const a=av(i,s,t);if(t.children&&t.children.length>0){const c=t.children.length,l=o/Math.pow(e,r-1),f=i-(c-1)*l/2;t.children.forEach((u,d)=>{const g=f+d*l,v=s+H.BOXHEIGHT*1.5;if(iu(u,e,n,r+1,g,v,o)){let x=H.NODEMAP.get(u.nodeID);Di(a,x)}})}return a}function Or(){H.graph.clear();let t=400,e=50,n=H.getTree();if(!n)return null;let r=H.currentTreeDef.order;const i=n.height(),s=Math.pow(r,i-1)*H.BOXWIDTH/3;iu(n.root,r,i,1,t,e,s),H.NODEMAP.forEach(o=>{var a,c;if((((a=o.node)==null?void 0:a.nextID)??0)>0){let l=H.NODEMAP.get(o.node.nextID);Di(o,l)}if((((c=o.node)==null?void 0:c.prevID)??0)>0){let l=H.NODEMAP.get(o.node.prevID);Di(o,l)}})}function cv(){document.addEventListener("DOMContentLoaded",()=>{H.paper.scale(1),H.paper.setInteractivity({elementMove:!0,linkMove:!0});let t=!1,e={x:0,y:0};document.addEventListener("mousedown",n=>{H.MouseCurrentNode==null?t=!0:Bi(H.MouseCurrentNode),e={x:n.x,y:n.y}}),document.addEventListener("mouseup",()=>{t=!1}),document.addEventListener("mousemove",n=>{if(t){const r=n.x-e.x,i=n.y-e.y,s=H.paper.translate();H.paper.translate(s.tx+r,s.ty+i),e={x:n.x,y:n.y}}}),On().addEventListener("wheel",n=>{n.preventDefault();const r=1.1;let i=H.paper.scale().sx;i=n.deltaY<0?i*r:i/r,H.paper.scale(Math.max(.2,Math.min(2,i)))},{passive:!1})}),window.onresize=()=>{H.paper.setDimensions(On().clientWidth,On().clientHeight)}}function uv(t){const e=H.paper.findViewByModel(t);if(!e)return;const n=e.getBBox(),r={x:n.x+n.width/2,y:n.y+n.height/2};H.paper.translate(-r.x+Number(H.paper.options.width)/2,-r.y+Number(H.paper.options.height)/2)}class lv{constructor(e,n){_t(this,"name");_t(this,"root");_t(this,"convertNode",e=>({nodeID:e.nodeID,nextID:e.nextID,prevID:e.prevID,parentID:e.parentID,keys:e.key,value:e.value,children:e.children?e.children.map(n=>this.convertNode(n)):[],errors:e.errors}));this.name=e,this.root=this.convertNode(n)}searchLeafNode(e){let n=this.root,r=[n];for(;n.children.length>0;){let{index:o,found:a}=this.searchKey(n,e);n=a?n.children[o+1]:n.children[o],r.push(n)}let{index:i,found:s}=this.searchKey(n,e);return{node:n,index:i,found:s,path:r}}searchKey(e,n){for(let r=0;r<e.keys.length;r++){if(n===e.keys[r])return{index:r,found:!0};if(n<e.keys[r])return{index:r,found:!1}}return{index:e.keys.length,found:!1}}height(e=this.root){return e.children.length===0?1:1+Math.max(...e.children.map(n=>this.height(n)))}}let lr=0,pi=["0000000000000026","0000000000000020","0000000000000021","0000000000000018","0000000000000019","0000000000000022","0000000000000024","0000000000000023","0000000000000025","0000000000000017"];async function fv(){if(H.getTree()){if(lr<pi.length){ru.innerHTML=`Test ${lr+1}/${pi.length}`;let t=pi[lr];await xs(t)}lr++}}function Bi(t){const e=document.getElementById("info-box");if(!e)return;e.innerHTML="";const n=document.createElement("div");n.textContent=`Node ID: ${t.nodeID}`,n.style.fontSize="15px",n.style.marginBottom="5px",e.appendChild(n);const r=document.createElement("ul");r.style.listStyle="none",r.style.padding="0",t.keys.forEach((i,s)=>{const o=document.createElement("li");o.style.marginTop="5px",o.style.alignItems="center";const a=document.createElement("span");a.textContent=`${i} `;const c=document.createElement("textarea");c.value=t.value[s],c.oninput=()=>{t.value[s]=c.value,c.style.height="auto",c.style.height=c.scrollHeight+"px"};const l=document.createElement("button");l.textContent=" Update ",l.style.backgroundColor="#c8ffc3",l.onclick=async()=>{await ou(i,c.value),Bi(t)};const f=document.createElement("button");f.textContent=" Delete ",f.style.backgroundColor="#ffa1a1",f.onclick=async()=>{await xs(i),Bi(t)},o.appendChild(a),t.value[s]&&(o.appendChild(c),o.appendChild(l),o.appendChild(f)),r.appendChild(o)}),e.appendChild(r)}async function Xn(){var n;let t,e=H.currentTreeDef.collectionName;if(H.WASM?t=Be("wasm:getTree",H.func.getTree(e)):t=await Fe(`${H.url}/gettree/${e}`,void 0),Ve(t),!t.error){const r=new lv(e,t.data);H.TreeSnapshots=[],H.currentTreeSnapshotIndex=0,H.NODEMAP=new Map,H.MouseCurrentNode=null,H.TreeSnapshots.push(r),H.currentTreeSnapshotIndex=H.TreeSnapshots.length-1;let i=((n=H.currentTreeDef)==null?void 0:n.order)??4;H.BOXHEIGHT=i*36,Or()}}function Be(t,e){let n,r;if(!e.error)try{let i=JSON.parse(e.data);n=i.data,r=i.logs}catch{}return{url:t,data:n,logs:r,error:e.error}}async function su(){let t=await Fe(`${H.url}/getalltree`,void 0);t.error!=""&&(H.WASM=!0,t=Be("wasm:getalltree",H.func.getAllTree())),Ve(t);const e=document.getElementById("collections");e.innerHTML="",t.data.forEach((n,r)=>{const i=document.createElement("div");i.className="card",i.innerHTML=`<pre>${JSON.stringify(n,null,2)}</pre>`,i.onclick=()=>{Array.from(document.getElementsByClassName("highlight")).forEach(s=>{s.classList.remove("highlight")}),i.classList.add("highlight"),H.currentTreeDef=n,Xn()},e.appendChild(i)})}async function ou(t,e){if(!H.getTree())return;t=t??Wp.value,e=e??jp.value;const n={key:t,value:e};let r,i=H.currentTreeDef.collectionName;H.WASM?r=Be("wasm:setRecord",H.func.setRecord(i,t,e)):r=await Fe(`${H.url}/set/${i}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),Ve(r),Xn()}let qo=1;async function vi(t){if(!H.getTree())return;let e=t!=null?qo+t:Number($o.value);if(e<=0)return;qo=e,$o.value=String(e);let n,r=H.currentTreeDef.collectionName;H.WASM?n=Be("wasm:sortedSetRecord",H.func.sortedSetRecord(r,e)):n=await Fe(`${H.url}/sortedset/${r}/${e}`,{method:"POST",headers:{"Content-Type":"application/json"}}),Ve(n),Xn()}async function xs(t){if(!H.getTree())return;let e=t??qp.value,n,r=H.currentTreeDef.collectionName;H.WASM?n=Be("wasm:deleteRecord",H.func.deleteRecord(r,e)):n=await Fe(`${H.url}/delete/${r}/${e}`,{method:"DELETE"}),Ve(n),Xn()}async function hv(t){if(H.getTree()){if(t=t??xr.value,H.NODEMAP.forEach(e=>{e.selected=!1}),t){let e,n=H.currentTreeDef.collectionName;H.WASM?e=Be("wasm:getRecord",H.func.getRecord(n,t)):e=await Fe(`${H.url}/get/${n}/${t}`,void 0),Ve(e),H.getTree().searchLeafNode(t).path.forEach(i=>{H.NODEMAP.get(i.nodeID).selected=!0})}Or()}}async function dv(){if(!H.getTree())return;let t,e=H.currentTreeDef.collectionName;H.WASM?t=Be("wasm:clearTree",H.func.clearTree(e)):t=await Fe(`${H.url}/clear/${e}`,{method:"DELETE"}),Ve(t),Xn()}async function gv(t){t.preventDefault();let e=document.getElementById("collectionName").value,n=Number(document.getElementById("order").value),r=Number(document.getElementById("NumLevel").value),i=Number(document.getElementById("BaseSize").value),s=Number(document.getElementById("Increment").value),o=0;const a={CollectionName:e,Order:n,NumLevel:r,BaseSize:i,Increment:s,compactionBatchSize:o};let c;H.WASM?c=Be("wasm:newTree",H.func.newTree(e,n,r,i,s,o)):c=await Fe(`${H.url}/newtree`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),Ve(c),su()}async function Fe(t,e){let n,r,i="";try{if(n=await fetch(t,e),!n.ok){const s=await n.text();throw new Error(`Error: ${n.status} - ${s}`)}r=await n.json()}catch(s){return{url:t,data:null,logs:null,error:s instanceof Error?s.message:"Unknown error"}}return{url:t,data:r.data,logs:r.logs,error:i}}window.toggleVisibility=function(t){const e=document.getElementById(t);e.style.display=e.style.display==="none"?"block":"none"};function Ve(t){const e=`json-content-${Date.now()}`,n=JSON.stringify(t.data,null,2),r=t.logs?`<pre style="color: gray;">${t.logs}</pre>`:"",i=`
        <div style="background-color:${t.error?"#ffb9b9":"#bdffbd"}; color: black; border:1px solid; padding:5px; margin-bottom: 10px;">
            <div onclick="window.toggleVisibility('${e}')"
                style="cursor: pointer; font-weight: bold; padding: 4px;">
                ${t.url.toString().includes("wasm")?t.url:t.url.toString().split(H.url)[1]}
            </div>
            <div id="${e}" style="display: none; padding: 4px;">
                <pre>${t.error?t.error:n}</pre>
                ${r}
            </div>
        </div>
    `;Ho.innerHTML=i+Ho.innerHTML}function pv(){let t=H.getTree(),e=H.NODEMAP.get(t.root.nodeID);e!=null&&e.box&&uv(e==null?void 0:e.box)}function vv(){document.addEventListener("DOMContentLoaded",()=>{Yp.addEventListener("click",()=>{H.currentTreeSnapshotIndex!=0&&(H.currentTreeSnapshotIndex--,Or())}),Xp.addEventListener("click",()=>{H.currentTreeSnapshotIndex!=H.TreeSnapshots.length-1&&(H.currentTreeSnapshotIndex++,Or())}),ru.addEventListener("click",fv),Zp.addEventListener("click",()=>ou(null,null)),ev.addEventListener("click",()=>vi(null)),nv.addEventListener("click",()=>vi(1)),rv.addEventListener("click",()=>vi(-1)),Jp.addEventListener("click",()=>xs(null)),Kp.addEventListener("click",()=>hv(null)),tv.addEventListener("click",()=>dv()),Qp.addEventListener("click",()=>pv()),iv.addEventListener("submit",gv)})}var Zt=typeof window<"u"?window:null,ws=Zt===null,Fn=ws?void 0:Zt.document,re="addEventListener",ie="removeEventListener",mi="getBoundingClientRect",Tn="_a",se="_b",me="_c",fr="horizontal",oe=function(){return!1},mv=ws?"calc":["","-webkit-","-moz-","-o-"].filter(function(t){var e=Fn.createElement("div");return e.style.cssText="width:"+t+"calc(9px)",!!e.style.length}).shift()+"calc",au=function(t){return typeof t=="string"||t instanceof String},Wo=function(t){if(au(t)){var e=Fn.querySelector(t);if(!e)throw new Error("Selector "+t+" did not match a DOM element");return e}return t},Rt=function(t,e,n){var r=t[e];return r!==void 0?r:n},hr=function(t,e,n,r){if(e){if(r==="end")return 0;if(r==="center")return t/2}else if(n){if(r==="start")return 0;if(r==="center")return t/2}return t},yv=function(t,e){var n=Fn.createElement("div");return n.className="gutter gutter-"+e,n},bv=function(t,e,n){var r={};return au(e)?r[t]=e:r[t]=mv+"("+e+"% - "+n+"px)",r},xv=function(t,e){var n;return n={},n[t]=e+"px",n},wv=function(t,e){if(e===void 0&&(e={}),ws)return{};var n=t,r,i,s,o,a,c;Array.from&&(n=Array.from(n));var l=Wo(n[0]),f=l.parentNode,u=getComputedStyle?getComputedStyle(f):null,d=u?u.flexDirection:null,g=Rt(e,"sizes")||n.map(function(){return 100/n.length}),v=Rt(e,"minSize",100),y=Array.isArray(v)?v:n.map(function(){return v}),x=Rt(e,"maxSize",1/0),w=Array.isArray(x)?x:n.map(function(){return x}),T=Rt(e,"expandToMin",!1),P=Rt(e,"gutterSize",10),M=Rt(e,"gutterAlign","center"),I=Rt(e,"snapOffset",30),D=Array.isArray(I)?I:n.map(function(){return I}),h=Rt(e,"dragInterval",1),p=Rt(e,"direction",fr),m=Rt(e,"cursor",p===fr?"col-resize":"row-resize"),b=Rt(e,"gutter",yv),S=Rt(e,"elementStyle",bv),O=Rt(e,"gutterStyle",xv);p===fr?(r="width",i="clientX",s="left",o="right",a="clientWidth"):p==="vertical"&&(r="height",i="clientY",s="top",o="bottom",a="clientHeight");function N(U,k,$,W){var at=S(r,k,$,W);Object.keys(at).forEach(function(Q){U.style[Q]=at[Q]})}function F(U,k,$){var W=O(r,k,$);Object.keys(W).forEach(function(at){U.style[at]=W[at]})}function q(){return c.map(function(U){return U.size})}function A(U){return"touches"in U?U.touches[0][i]:U[i]}function C(U){var k=c[this.a],$=c[this.b],W=k.size+$.size;k.size=U/this.size*W,$.size=W-U/this.size*W,N(k.element,k.size,this[se],k.i),N($.element,$.size,this[me],$.i)}function _(U){var k,$=c[this.a],W=c[this.b];this.dragging&&(k=A(U)-this.start+(this[se]-this.dragOffset),h>1&&(k=Math.round(k/h)*h),k<=$.minSize+$.snapOffset+this[se]?k=$.minSize+this[se]:k>=this.size-(W.minSize+W.snapOffset+this[me])&&(k=this.size-(W.minSize+this[me])),k>=$.maxSize-$.snapOffset+this[se]?k=$.maxSize+this[se]:k<=this.size-(W.maxSize-W.snapOffset+this[me])&&(k=this.size-(W.maxSize+this[me])),C.call(this,k),Rt(e,"onDrag",oe)(q()))}function L(){var U=c[this.a].element,k=c[this.b].element,$=U[mi](),W=k[mi]();this.size=$[r]+W[r]+this[se]+this[me],this.start=$[s],this.end=$[o]}function ct(U){if(!getComputedStyle)return null;var k=getComputedStyle(U);if(!k)return null;var $=U[a];return $===0?null:(p===fr?$-=parseFloat(k.paddingLeft)+parseFloat(k.paddingRight):$-=parseFloat(k.paddingTop)+parseFloat(k.paddingBottom),$)}function ot(U){var k=ct(f);if(k===null||y.reduce(function(Q,tt){return Q+tt},0)>k)return U;var $=0,W=[],at=U.map(function(Q,tt){var ut=k*Q/100,Z=hr(P,tt===0,tt===U.length-1,M),R=y[tt]+Z;return ut<R?($+=R-ut,W.push(0),R):(W.push(ut-R),ut)});return $===0?U:at.map(function(Q,tt){var ut=Q;if($>0&&W[tt]-$>0){var Z=Math.min($,W[tt]-$);$-=Z,ut=Q-Z}return ut/k*100})}function bt(){var U=this,k=c[U.a].element,$=c[U.b].element;U.dragging&&Rt(e,"onDragEnd",oe)(q()),U.dragging=!1,Zt[ie]("mouseup",U.stop),Zt[ie]("touchend",U.stop),Zt[ie]("touchcancel",U.stop),Zt[ie]("mousemove",U.move),Zt[ie]("touchmove",U.move),U.stop=null,U.move=null,k[ie]("selectstart",oe),k[ie]("dragstart",oe),$[ie]("selectstart",oe),$[ie]("dragstart",oe),k.style.userSelect="",k.style.webkitUserSelect="",k.style.MozUserSelect="",k.style.pointerEvents="",$.style.userSelect="",$.style.webkitUserSelect="",$.style.MozUserSelect="",$.style.pointerEvents="",U.gutter.style.cursor="",U.parent.style.cursor="",Fn.body.style.cursor=""}function wt(U){if(!("button"in U&&U.button!==0)){var k=this,$=c[k.a].element,W=c[k.b].element;k.dragging||Rt(e,"onDragStart",oe)(q()),U.preventDefault(),k.dragging=!0,k.move=_.bind(k),k.stop=bt.bind(k),Zt[re]("mouseup",k.stop),Zt[re]("touchend",k.stop),Zt[re]("touchcancel",k.stop),Zt[re]("mousemove",k.move),Zt[re]("touchmove",k.move),$[re]("selectstart",oe),$[re]("dragstart",oe),W[re]("selectstart",oe),W[re]("dragstart",oe),$.style.userSelect="none",$.style.webkitUserSelect="none",$.style.MozUserSelect="none",$.style.pointerEvents="none",W.style.userSelect="none",W.style.webkitUserSelect="none",W.style.MozUserSelect="none",W.style.pointerEvents="none",k.gutter.style.cursor=m,k.parent.style.cursor=m,Fn.body.style.cursor=m,L.call(k),k.dragOffset=A(U)-k.end}}g=ot(g);var K=[];c=n.map(function(U,k){var $={element:Wo(U),size:g[k],minSize:y[k],maxSize:w[k],snapOffset:D[k],i:k},W;if(k>0&&(W={a:k-1,b:k,dragging:!1,direction:p,parent:f},W[se]=hr(P,k-1===0,!1,M),W[me]=hr(P,!1,k===n.length-1,M),d==="row-reverse"||d==="column-reverse")){var at=W.a;W.a=W.b,W.b=at}if(k>0){var Q=b(k,p,$.element);F(Q,P,k),W[Tn]=wt.bind(W),Q[re]("mousedown",W[Tn]),Q[re]("touchstart",W[Tn]),f.insertBefore(Q,$.element),W.gutter=Q}return N($.element,$.size,hr(P,k===0,k===n.length-1,M),k),k>0&&K.push(W),$});function nt(U){var k=U.i===K.length,$=k?K[U.i-1]:K[U.i];L.call($);var W=k?$.size-U.minSize-$[me]:U.minSize+$[se];C.call($,W)}c.forEach(function(U){var k=U.element[mi]()[r];k<U.minSize&&(T?nt(U):U.minSize=k)});function st(U){var k=ot(U);k.forEach(function($,W){if(W>0){var at=K[W-1],Q=c[at.a],tt=c[at.b];Q.size=k[W-1],tt.size=$,N(Q.element,Q.size,at[se],Q.i),N(tt.element,tt.size,at[me],tt.i)}})}function rt(U,k){K.forEach(function($){if(k!==!0?$.parent.removeChild($.gutter):($.gutter[ie]("mousedown",$[Tn]),$.gutter[ie]("touchstart",$[Tn])),U!==!0){var W=S(r,$.a.size,$[se]);Object.keys(W).forEach(function(at){c[$.a].element.style[at]="",c[$.b].element.style[at]=""})}})}return{setSizes:st,getSizes:q,collapse:function(k){nt(c[k])},destroy:rt,parent:f,pairs:K}};wv(["#json-section","#canvas-section","#form-section"],{sizes:[15,70,15]});document.querySelector(".container").style.visibility="visible";const jo=new Go;class cu{constructor(e){_t(this,"graph");_t(this,"paper");_t(this,"NODEMAP",new Map);_t(this,"BOXWIDTH",280);_t(this,"BOXHEIGHT",200);_t(this,"DARK");_t(this,"func");_t(this,"WASM",!1);_t(this,"router","orthogonal");_t(this,"connector","straight");_t(this,"MouseCurrentNode",null);_t(this,"url","http://localhost:8080");_t(this,"currentTreeDef",null);_t(this,"currentTreeSnapshotIndex",0);_t(this,"TreeSnapshots",[]);this.DARK=e,this.graph=new ys({},{cellNamespace:uo}),this.paper=new Uo({el:document.getElementById("paper"),model:this.graph,background:{color:e?"#111111":"#F5F5F5"},gridSize:20,drawGrid:!0,width:On().clientWidth,height:On().clientHeight,interactive:!0,cellViewNamespace:uo,async:!0,sorting:Uo.sorting.APPROX})}getTree(){return this.TreeSnapshots[this.currentTreeSnapshotIndex]}}let Sv=localStorage.getItem("theme")==="dark",H=new cu(Sv);WebAssembly.instantiateStreaming(fetch("secretary.wasm"),jo.importObject).then(async t=>{let e=t.instance;jo.run(e),H.func=window.lib,console.log(window.lib),su()}).catch(t=>{console.error(t)});vv();cv();sv.addEventListener("click",()=>{wr.classList.add("active")});wr.addEventListener("click",t=>{t.target===wr&&wr.classList.remove("active")});const Av=()=>{document.documentElement.classList.toggle("dark");const t=document.documentElement.classList.contains("dark");localStorage.setItem("theme",t?"dark":"light"),H=new cu(t)};ov.addEventListener("click",Av);
